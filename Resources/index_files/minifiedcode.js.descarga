/*


 opentype.js:
   license: MIT (http://opensource.org/licenses/MIT)
   author: Frederik De Bleser <frederik@debleser.be>
   version: 0.6.4

 tiny-inflate:
   license: MIT (http://opensource.org/licenses/MIT)
   author: Devon Govett <devongovett@gmail.com>
   maintainers: devongovett <devongovett@gmail.com>
   homepage: https://github.com/devongovett/tiny-inflate
   version: 1.0.2

 This header is generated by licensify (https://github.com/twada/licensify)
 Paper.js v0.10.2-develop - The Swiss Army Knife of Vector Graphics Scripting.
 http://paperjs.org/

 Copyright (c) 2011 - 2016, Juerg Lehni & Jonathan Puckey
 http://scratchdisk.com/ & http://jonathanpuckey.com/

 Distributed under the MIT license. See LICENSE file for details.

 All rights reserved.

 Date: Sat Jul 9 21:31:25 2016 +0200

**

 Straps.js - Class inheritance library with support for bean-style accessors

 Copyright (c) 2006 - 2016 Juerg Lehni
 http://scratchdisk.com/

 Distributed under the MIT license.

**

 Acorn.js
 http://marijnhaverbeke.nl/acorn/

 Acorn is a tiny, fast JavaScript parser written in JavaScript,
 created by Marijn Haverbeke and released under an MIT license.

*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};var OS_TYPE="Unknown",BROWSER_TYPE="Unknown",BROWSER_VERSION="Unknown";-1!=window.navigator.userAgent.indexOf("Windows NT 6.2")&&(OS_TYPE="Windows 8");-1!=window.navigator.userAgent.indexOf("Windows NT 6.1")&&(OS_TYPE="Windows 7");-1!=window.navigator.userAgent.indexOf("Windows NT 6.0")&&(OS_TYPE="Windows Vista");
-1!=window.navigator.userAgent.indexOf("Windows NT 5.1")&&(OS_TYPE="Windows XP");-1!=window.navigator.userAgent.indexOf("Windows NT 5.0")&&(OS_TYPE="Windows 2000");-1!=window.navigator.userAgent.indexOf("Mac")&&(OS_TYPE="Mac/iOS");-1!=window.navigator.userAgent.indexOf("X11")&&(OS_TYPE="UNIX");-1!=window.navigator.userAgent.indexOf("Linux")&&(OS_TYPE="Linux");
function BrowserInfo(){var a=navigator.userAgent,b=a.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(/trident/i.test(b[1])){var c=/\brv[ :]+(\d+)/g.exec(a)||[];return{name:"explorer",version:c[1]||""}}if("Chrome"===b[1]&&(c=a.match(/\bOPR\/(\d+)/),null!=c))return{name:"opera",version:c[1]};b=b[2]?[b[1],b[2]]:[navigator.appName,navigator.appVersion,"-?"];null!=(c=a.match(/version\/(\d+)/i))&&b.splice(1,1,c[1]);return{name:b[0].toLowerCase(),version:b[1]}}
var browserInfo=BrowserInfo();BROWSER_TYPE=browserInfo.name;BROWSER_VERSION=parseInt(browserInfo.version);var DEVICE_WITH_TOUCH_EVENTS="ontouchstart"in window;window.DISABLE_TOUCH_EVENTS&&(DEVICE_WITH_TOUCH_EVENTS=!1);var TRANSFER_DATA=null;function SetTransferData(a){TRANSFER_DATA=a}function GetTransferData(){return TRANSFER_DATA}var CLIPBOARD_DATA=null;function SetClipboardData(a){CLIPBOARD_DATA=a}function GetClipboardData(){return CLIPBOARD_DATA}
function GetObjectClassName(a){return"object"!=typeof a||null===a?!1:/(\w+)\(/.exec(a.constructor.toString())[1]}Node.prototype.getParentInGrandParent=function(a){return this.parentNode==a?this:null!==this.parentNode?this.parentNode.getParentInGrandParent(a):null};Node.prototype.getElementOrParentElementByAttribute=function(a,b){return this.hasAttribute?this.hasAttribute(a)&&this.getAttribute(a)==b?this:null!=this.parentNode?this.parentNode.getElementOrParentElementByAttribute(a,b):null:null};
Node.prototype.getParentElementByAttribute=function(a,b){return this.parentNode&&this.parentNode.hasAttribute?this.parentNode.hasAttribute(a)&&this.parentNode.getAttribute(a)==b?this.parentNode:this.parentNode.getParentElementByAttribute(a,b):null};Node.prototype.getParentElementById=function(a){return this.parentNode.id==a?this.parentNode:null!==this.parentNode?this.parentNode.getParentElementById(a):null};
Node.prototype.getParentElementByNodeName=function(a){return null!==this.parentNode?this.parentNode.nodeName==a?this.parentNode:this.parentNode.getParentElementByNodeName(a):null};Node.prototype.getParentElementByClass=function(a){return this.parentNode.classList.contains(a)?this.parentNode:null!==this.parentNode?this.parentNode.getParentElementByClass(a):null};Node.prototype.removeChildren=function(){for(;this.firstChild;)this.removeChild(this.firstChild)};
Element.prototype.selectAllTextInElement=function(){var a=document.createRange();a.selectNodeContents(this);var b=window.getSelection();b.removeAllRanges();b.addRange(a)};
InitControllers=function(a,b){a=a||document;for(var c,d,e=a.querySelectorAll("*[controller-class]"),f=[],g=0;g<e.length;g++){c=e[g];for(var k=c.getAttribute("controller-class").split(","),l=0;l<k.length;l++)d=k[l],window[d]?c.connectController(window[d],b):c.hasAttribute("controller-class-url")?(d=c.getAttribute("controller-class-url"),c.removeAttribute("controller-class-url"),console.log("----carico js: "+d),IncludeJS(d,function(){InitControllers(a,b)},!0)):f.push({element:c,className:"/* class constructor */\nfunction "+
d+"(_e)\n{\n/* constructor code */\n};\n\n_ = "+d+".prototype;"})}if(0<f.length)for(g=0;g<f.length;g++)console.warn("Undefined class/controllers for:",f[g].element),console.log(f[g].className);return e};Node.prototype.__cloneNode=Node.prototype.cloneNode;Node.prototype.cloneNode=function(a){a=this.__cloneNode(a);a.onCloneNode();return a};
Node.prototype.onCloneNode=function(){if(this.hasAttribute("controller-class")){var a=window[this.getAttribute("controller-class")];a&&(this.connectController(a),this.onClone())}for(a=0;a<this.children.length;a++)this.children[a].onCloneNode()};Node.prototype.onClone=function(){};
Node.prototype.connectController=function(a,b){if(this.connectedControllers)for(var c=0;c<this.connectedControllers.length;c++){if(this.connectedControllers[c]==a){console.warn("controller already exists");return}}else this.connectedControllers=[];for(var d in a.prototype)"constructor"!=d&&(this[d]&&console.warn('The methods "'+d+'" already exists in',this),this[d]=a.prototype[d]);a.call(this,b||{});this.connectedControllers.push(a);return this};
Node.prototype.connectEvents=function(a){function b(){document.activeElement!=document.lastActiveElement&&this.select();document.lastActiveElement=this}a=a||this;for(var c,d,e,f,g,k=this.querySelectorAll("[event]"),l={},h=[],m=0;m<k.length;m++)if(g=k[m],c=g.getAttribute("event").split(";"),0<c.length){for(var n=0;n<c.length;n++)d=c[n].split(":"),e=d[0].trim(),d=d[1].trim(),(f=a[d])?ConnectEvent(e,g,f,a):h.push("_."+d+" = function(_e){\n};");g.hasAttribute("name")&&(l[g.getAttribute("name")]=g);"INPUT"==
g.nodeName&&"text"==g.getAttribute("type")&&ConnectEvent("click",g,b)}0<h.length&&(console.warn("Undefined event listeners in element/controller:",a),console.log(h.join("\n\n")));return l};
function SelectElement(a,b){b=b||"radio";if("radio"==b){if(a.parentElement.hasAttribute("id"))var c=a.parentElement.getAttribute("id");else c="TEMP_"+(new Date).getTime(),a.parentElement.setAttribute("id",c);c=a.parentElement.querySelectorAll("#"+c+">.selected");for(var d=0,e=c.length;d<e;d++)c[d].classList.remove("selected");a.classList.add("selected")}else"check"==b&&a.classList.toggle("selected");if(a.parentElement.onChange)a.parentElement.onChange(a)}
function DeselectElements(a){for(var b=0,c=a.length;b<c;b++)a[b].classList.remove("selected")}
function ShowElement(a,b,c){b=b||"radio";if("radio"==b){a.parentNode.hasAttribute("id")?(b=a.parentNode.getAttribute("id"),b=a.parentNode.parentNode.querySelectorAll("#"+b+">.showed")):b=a.parentNode.querySelectorAll(".showed");for(var d=0,e=b.length;d<e;d++)b[d].classList.remove("showed");a.classList.add("showed")}else"check"==b?a.classList.toggle("showed"):"always"==b&&a.classList.add("showed");if(a.onShow)a.onShow();c&&(a.style.left=c.x+"px",a.style.top=c.y+"px");return a}
function HideElements(a){for(var b=0,c=a.length;b<c;b++)a[b].classList.remove("showed")}Event.prototype.preventPropagation=function(){this.preventDefault&&this.preventDefault();this.stopPropagation&&this.stopPropagation();return!1};Event.prototype.responseToJSON=function(){var a=this.target;try{return window.JSON.parse(a.responseText)}catch(b){return console.error(b+"\nresponse: "+a.responseText),!1}};
Event.prototype.getMousePoint=function(){var a={x:0,y:0};if(DEVICE_WITH_TOUCH_EVENTS)0<this.targetTouches.length&&(a.x=this.targetTouches[0].pageX,a.y=this.targetTouches[0].pageY);else if(this)if(this.pageX||this.pageY)a.x=this.pageX,a.y=this.pageY;else if(this.layerX||this.layerY)a.x=this.layerX,a.y=this.layerY;else if(this.clientX||this.clientY)a.x=this.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a.y=this.clientY+document.body.scrollTop+document.documentElement.scrollTop;
return a};function DrawData(a,b,c,d,e,f){!0!==f&&b.removeChildren();for(var g=document.createDocumentFragment(),k=a.length,l=0;l<k;l++){var h=a[l];d&&(h=d(h));f=h.templateElement?h.templateElement.cloneNode(!0):c.cloneNode(!0);h.id&&f.setAttribute("id",h.id);f.data=h;BindData(h,f);g.appendChild(f);e&&e(f)}b.appendChild(g)}
function BindData(a,b,c){c=c||"name";b=b.querySelectorAll("["+c+"]");for(var d,e,f=b.length,g=0;g<f;g++){d=b[g];e=d.getAttribute(c);e=a[e];if(null===e||void 0===e)e="";if(d.onBindData)d.onBindData(a);else switch(d.nodeName){case "INPUT":"radio"===d.type||"checkbox"===d.type?d.checked=e==d.value:d.value=e;break;case "SELECT":d.value=e;break;case "DIV":case "LI":case "SPAN":d.hasAttribute("type")?"checkbox"==d.getAttribute("type")&&(!0===e?d.classList.add("selected"):d.classList.remove("selected")):
d.innerHTML=e;break;case "TEXTAREA":d.value=e;break;case "A":d.setAttribute("href",e);break;case "IMG":d.setAttribute("src",e)}}}
function SendAndLoad(a,b,c,d,e,f,g,k,l){var h=new XMLHttpRequest;d&&(h.onload=d);e&&(h.onerror=e);f&&(h.onprogress=f);g&&(h.upload.onprogress=g);k&&(h.onabort=k);b=b||"GET";d="";if(c)if("string"===typeof c||c instanceof String||c instanceof FormData||c instanceof Blob)d=c;else if(c instanceof HTMLFormElement)d=new FormData(c);else{d=new FormData;for(var m in c)d.append(m,c[m])}h.open(b,a,!0);l&&l(h);h.send(d);return h}
function GetUrlVars(a){a=a||window.location.href;var b={};decodeURIComponent(a).replace(/[?&]+([^=&]+)=([^&]*)/gi,function(a,d,e){console.log("key: "+d);console.log("value: "+e);b[d]=e});return b}
function WriteTemplate(a){a instanceof Function&&(a=a.toString(),a=a.substring(a.indexOf("/*")+2,a.lastIndexOf("*/")));var b=document.createElement("span");b.innerHTML=a;document.currentScript?a=document.currentScript:(a=document.getElementsByTagName("script"),a=a[a.length-1]);for(var c=a.parentElement;b.children.length;)c.appendChild(b.children[0]);c.removeChild(a)}
function IncludeCSS(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("link");c.setAttribute("rel","stylesheet");c.setAttribute("type","text/css");c.setAttribute("href",a);b.appendChild(c)}function IsScriptAlreadyIncluded(a){for(var b=document.getElementsByTagName("script"),c=0;c<b.length;c++)if(b[c].getAttribute("src")==a)return!0;return!1}
function IncludeJS(a,b,c){if(!c||!IsScriptAlreadyIncluded(a)){c=document.getElementsByTagName("head")[0];var d=document.createElement("script");d.src=a;d.type="text/javascript";void 0!=b&&null!=b&&(d.readyState?d.onreadystatechange=function(a){if("loaded"==d.readyState||"complete"==d.readyState)d.onreadystatechange=null,b(d)}:d.onload=function(a){d.loaded=!0;b(d)});c.appendChild(d);return d}}
function Extends(a,b){function c(){}c.prototype=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.superConstructor=b;a.superClass=b.prototype}function BindFunction(a,b){b||console.log(errore);return function(){return b.apply(a,arguments)}}
function ConnectEvent(a,b,c,d,e){if(b){b instanceof Array||b instanceof NodeList||(b=[b]);c=d?BindFunction(d,c):c;e=e||!1;for(var f=b.length,g=0;g<f;g++)if(d=b[g],d.addEventListener){if(DEVICE_WITH_TOUCH_EVENTS)switch(a){case "mousedown":a="touchstart";break;case "mousemove":a="touchmove";break;case "mouseup":a="touchend"}d.addEventListener(a,c,e)}else d.attachEvent?d.attachEvent("on"+a,c):d["on"+a]=c;return c}console.warn("Can't connect the event:"+a+" with the function",c)}
function DisconnectEvent(a,b,c,d){b.length||(b=[b]);for(var e,f=b.length,g=0;g<f;g++)if(e=b[g],e.removeEventListener){if(DEVICE_WITH_TOUCH_EVENTS)switch(a){case "mousedown":a="touchstart";break;case "mousemove":a="touchmove";break;case "mouseup":a="touchend"}e.removeEventListener(a,c,d)}else e.attachEvent?e.detachEvent("on"+a,c):e["on"+a]=null}GetObjectByStringPath=function(a,b){for(var c=b.split("."),d=0,e=c.length;d<e;++d){var f=c[d];if(f in a)a=a[f];else return null}return a};
Array.prototype.clone=function(){return this.slice(0)};Array.prototype.add=Array.prototype.push;Array.prototype.addAt=function(a,b){this.splice(b,0,a)};Array.prototype.replaceAt=function(a,b){var c=this[b];this.splice(b,1,a);return c};Array.prototype.remove=function(a){var b=this.indexOf(a);return-1<b?(this.splice(b,1),a):null};Array.prototype.removeAt=function(a){var b=this[a];this.splice(a,1);return b};Array.prototype.sortOn=function(a){this.sort(function(b,c){return b[a]<c[a]?-1:b[a]>c[a]?1:0})};
Node.prototype.remove=function(){this.parentNode.removeChild(this)};Node.prototype.removeChildren=function(){for(;this.firstChild;)this.removeChild(this.firstChild)};Node.prototype.cloneChildrenTo=function(a){var b,c=this.children.length;for(b=0;b<c;b++)a.appendChild(this.children[b].cloneNode(!0))};Node.prototype.appendChildren=function(a){for(var b=a.length,c=0;c<b;c++)this.appendChild(a[c])};
Node.prototype.insertChildrenBeforeElement=function(a,b){for(var c=a.length,d=0;d<c;d++)this.insertBefore(a[d],b)};Node.prototype.setIndex=function(a){var b=this.getIndex();if(!(0>b||0>a||a==b||a>this.parentNode.childNodes.length-1)){var c=[].slice.call(this.parentNode.childNodes,0);c.splice(b,1);c.splice(a,0,this);a=c.length;for(b=0;b<a;b++)this.parentNode.appendChild(c[b])}};Node.prototype.bringToFront=function(){this.parentNode.appendChild(this)};
Node.prototype.sendToBack=function(){this.parentNode.insertBefore(this,this.parentNode.childNodes[0])};Node.prototype.bringUp=function(){this.nextElementSibling&&this.setIndex(this.nextElementSibling.getIndex())};Node.prototype.sendDown=function(){this.previousElementSibling&&this.setIndex(this.previousElementSibling.getIndex())};Node.prototype.getIndex=function(){for(var a=this,b=0;a=a.previousSibling;)++b;return b};
NodeList.prototype.indexOf=function(a){for(var b=0;a=a.previousSibling;)1===a.nodeType&&++b;return b};Element.prototype.getGlobalPosition=function(){for(var a=this,b=0,c=0;a;)b+=a.offsetLeft-a.scrollLeft+a.clientLeft,c+=a.offsetTop-a.scrollTop+a.clientTop,a=a.offsetParent;return{x:b,y:c}};Element.prototype.globalToLocal=function(a){var b=this.getGlobalPosition();return{x:a.x-b.x,y:a.y-b.y}};Element.prototype.getPosition=function(){return{x:this.offsetLeft,y:this.offsetTop}};
Element.prototype.setPosition=function(a,b,c){c=c||"px";this.style.left=a+c;this.style.top=b+c};Element.prototype.setPositionX=function(a,b){this.style.left=a+(b||"px")};Element.prototype.setPositionY=function(a,b){this.style.top=a+(b||"px")};Element.prototype.getSize=function(){return{x:this.offsetWidth,y:this.offsetHeight}};Element.prototype.setSize=function(a,b,c){c=c||"px";this.style.width=a+c;this.style.height=b+c};Element.prototype.setSizeX=function(a,b){this.style.width=a+(b||"px")};
Element.prototype.setSizeY=function(a,b){this.style.height=a+(b||"px")};Element.prototype.setTransform=function(a,b){el.style.Transform=a;el.style.MozTransform=a;el.style.msTransform=a;el.style.OTransform=a;el.style.webkitTransform=a;void 0!=b&&(el.style.TransformOrigin=b,el.style.MozTransformOrigin=b,el.style.msTransformOrigin=b,el.style.OTransformOrigin=b,el.style.webkitTransformOrigin=b)};
function PathInfo(a){var b=a.split("/");a=b[b.length-1];var c="";1<b.length&&(b.pop(),c=b.join("/"));b=a.split(".");var d=b[0],e="";1<b.length&&(e=b.pop(),d=b.join("."));return{dir:c,fileName:a,fileNameNoExtension:d,fileExtension:e}}
function GetRelativeFilePathFromBaseFilePath(a,b){console.log("_basePath",a);console.log("_absolutePath",b);for(var c=a.split("/"),d=b.split("/"),e=b.split("/"),f=0;f<c.length&&f!=d.length;f++)c[f]==d[f]?e.shift():e.unshift("..");e.shift();c=e.join("/");console.log("relativePath",c);return c}
function GetAbsoluteFilePathFromBaseFilePath(a,b){var c=a.split("/");c.pop();var d=b.split("../");if(1<d.length)for(var e=0;e<d.length;e++)d.shift(),c.pop();c=c.concat(d).join("/");console.log("absolute path",c);return c}
function BrowserLanguage(){var a=window.navigator.languages?window.navigator.languages[0]:null;a=a||window.navigator.language||window.navigator.browserLanguage||window.navigator.userLanguage;-1!==a.indexOf("-")&&(a=a.split("-")[0]);-1!==a.indexOf("_")&&(a=a.split("_")[0]);return a}function SetCookie(a,b,c){if(c){var d=new Date;d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString()}else c="";document.cookie=a+"="+b+c+"; path=/"}
function GetCookie(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return null}function EraseCookie(a){SetCookie(a,"",-1)}
function EvalKeyModifiers(a,b){if(a.metaKey||a.ctrlKey)Event.isCmdCtrlKeyPressed=b;switch(a.keyCode){case 91:case 224:Event.isCmdCtrlKeyPressed=b;break;case 16:Event.isShiftKeyPressed=b;break;case 18:Event.isAltKeyPressed=b;break;case 32:Event.isSpaceBarKeyPressed=b}}ConnectEvent("keydown",window,function(a){EvalKeyModifiers(a,!0)},null,!0);ConnectEvent("keyup",window,function(a){EvalKeyModifiers(a,!1)},null,!0);
function DownloadDataToFile(a,b,c,d){c=new Blob([c],{type:d});a.download=b;a.href=window.URL.createObjectURL(c);a.dataset.downloadurl=[d,a.download,a.href].join(":")}ClosureCompiler=function(){var a="// ==ClosureCompiler==\n// @output_file_name janvas_minified.js\n// @compilation_level SIMPLE_OPTIMIZATIONS\n";for(var b=document.body.querySelectorAll('script[src]:not([compile="false"])'),c=(new Date).getTime(),d=0;d<b.length;d++)a+="// @code_url "+b[d].src+"?timestamp="+c+"\n";console.log(a+"// ==/ClosureCompiler==\n")};
function Localizer(){this.strings={};this.strings_to_translate={}}_=Localizer.prototype;_.setStrings=function(a){this.strings=a};_.translate=function(a,b){if(this.strings[a]){var c=this.strings[a];if(b){var d;for(d in b){var e=new RegExp(d,"g");c=c.replace(e,b[d])}}}else console.log("traduzione non trovata! "+a),this.strings_to_translate[a]="to translate",c=a;return c};
_.printToTranslate=function(){console.log("---------- to translate ----------");for(var a in this.strings_to_translate)"to translate"==this.strings_to_translate[a]&&console.log(a);console.log("----------------------------------")};
_.localizeContents=function(a){a=a||document;for(var b,c=a.querySelectorAll("[data-translate]"),d=c.length,e=0;e<d;e++)b=c[e],a=b.getAttribute("data-translate"),0<a.length?this.strings[a]?(b.innerHTML=this.strings[a],console.log(a,this.strings[a])):this.strings_to_translate[a]="to translate":(a=String(b.innerHTML).trim(),this.strings[a]?(b.innerHTML=this.strings[a],b.setAttribute("data-translate",a)):this.strings_to_translate[a]="to translate")};
_.localizeAttributes=function(a,b){a=a||"title";b=b||document;for(var c,d,e=b.querySelectorAll("[data-translate-"+a+"]"),f=e.length,g=0;g<f;g++)d=e[g],c=d.getAttribute("data-translate-"+a),0<c.length?this.strings[c]?d.setAttribute(a,this.strings[c]):this.strings_to_translate[c]="to translate":(c=d.getAttribute(a),this.strings[c]?(d.setAttribute(a,this.strings[c]),d.setAttribute("data-translate-"+a,c)):this.strings_to_translate[c]="to translate")};
_.loadStrings=function(a,b){IncludeJS(a);var c=this;window.onLoadLanguageStrings=function(a){console.log("onLoadLanguageStrings",a);c.setStrings(a);c.localizeContents();c.localizeAttributes();b&&b()}};function XNode(){this.id=this.name=this.type="";this.idi=createIDI();this.parent=null;this.children=[]}_=XNode.prototype;_.numChildren=function(){return this.children.length};
_.addChild=function(a){a.parent&&a.parent.children.splice(a.parent.getChildIndex(a),1);this.children.push(a);a.parent=this;a.onAdded();return a};_.removeChild=function(a){this.removeChildAt(this.getChildIndex(a))};_.removeChildAt=function(a){console.log("removeChildAt",a);var b=this.children[a];b.onBeforeRemove();this.children.splice(a,1);b.parent=null;b.onRemove()};
_.removeAllChildren=function(){var a=this.numChildren();if(0!=a){for(var b=this.children,c=0;c<a;c++)this.children[c].onBeforeRemove();this.children=[];for(c=0;c<a;c++)b[c].onRemove(),b[c].parent=null}};_.replaceWith=function(a){var b=this.parent.getChildIndex(this),c=this.parent;c.removeChildAt(b);c.addChildAt(a,b)};_.replaceChildAt=function(a,b){this.removeChildAt(b);this.addChildAt(a,b)};
_.addChildAt=function(a,b){a.parent=this;0==this.numChildren()||b>this.children.length-1?this.children.push(a):this.children.splice(b,0,a);a.onAdded()};_.onAdded=function(){};_.onBeforeRemove=function(){};_.onRemove=function(){};_.getChildIndex=function(a){return a.parent!=this?(alert("the child "+a.name+" is not children of "+this),-1):this.children.indexOf(a)};_.getChildAt=function(a){return this.children[a]};
_.setChildIndex=function(a,b){var c=this.getChildIndex(a);if(-1==c||b==c||0>b||b>this.children.length-1)return!1;this.children.splice(c,1);this.children.splice(b,0,a);return!0};_.getRootGroup=function(){return null==this.parent?this:this.parent.getRootGroup()};_.getChildrenByProperty=function(a,b,c){var d=[],e,f=this.children.length;for(e=0;e<f;e++){var g=this.children[e];if(a in g&&g[a]==b&&(d.push(g),1==c))break;d=d.concat(g.getChildrenByProperty(a,b))}return d};
_.getParentByProperty=function(a,b){return this.parent?this.parent[a]==b?this.parent[a]:getParentByProperty(a,b):null};_.forEachChildren=function(a){for(var b,c,d=this.children.length,e=0;e<d;e++)c=this.children[e],b=a(c),1!=b&&c.forEachChildren(a)};_.getChildByName=function(a){for(var b=this.numChildren(),c=0;c<b;c++)if(this.children[c].name===a)return this.children[c];return null};_.clone=function(a,b){var c=new XNode;this.clonePropertiesTo(c);a&&a.addChild(c);0!=b&&this.cloneChildren(c);return c};
_.clonePropertiesTo=function(a){a.name=this.name;a.type=this.type;a.id=this.id};_.cloneChildren=function(a){for(var b=this.numChildren(),c=0;c<b;c++)this.children[c].clone(a)};_.getType=function(){return"NODE"};var GLOBAL_IDI=0,GLOBAL_TIMESTAMP=(new Date).getTime();function createIDI(){var a=GLOBAL_TIMESTAMP+"_"+GLOBAL_IDI;GLOBAL_IDI++;return a}
function GlobalMouse(){this.mouseDownPt={x:0,y:0};this.mouseUpPt={x:0,y:0};this.mouseMovePt={x:0,y:0};this.isDragAction=this.isMouseButtonPressed=!1;this.lastMouseUpTime;this.snapValue=5;this.globalMouseTargetDelegate=null;this.initEventListeners()}_=GlobalMouse.prototype;
_.initEventListeners=function(){var a=document.getElementsByTagName("html")[0];DEVICE_WITH_TOUCH_EVENTS?(ConnectEvent("touchstart",a,this.onTouchStart,this,!0),ConnectEvent("touchmove",a,this.onTouchMove,this,!0),ConnectEvent("touchend",a,this.onTouchEnd,this,!0)):(ConnectEvent("mousedown",a,this.onMouseDown,this,!0),ConnectEvent("mousemove",a,this.onMouseMove,this,!0),ConnectEvent("mouseup",a,this.onMouseUp,this,!0))};_.onTouchStart=function(a){this.onMouseDown(a)};_.onTouchMove=function(a){this.onMouseMove(a)};
_.onTouchEnd=function(a){if(0==a.targetTouches.length)this.onMouseUp(a)};_.onTouchCancel=function(a){};_.onMouseDown=function(a){Event.isDoubleClick=!1;this.mouseDownPt=a.getMousePoint();this.mouseMovePt.x=this.mouseDownPt.x;this.mouseMovePt.y=this.mouseDownPt.y;if(!(a.srcElement instanceof HTMLUListElement)&&(this.isMouseButtonPressed=!0,this.globalMouseTargetDelegate&&this.globalMouseTargetDelegate.onGlobalMouseDown))this.globalMouseTargetDelegate.onGlobalMouseDown(a)};
_.onMouseUp=function(a){this.mouseUpPt=a.getMousePoint();if(this.globalMouseTargetDelegate&&this.globalMouseTargetDelegate.onGlobalMouseUp)this.globalMouseTargetDelegate.onGlobalMouseUp(a);var b=(new Date).getTime();if(250>b-this.lastMouseUpTime&&(Event.isDoubleClick=!0,this.globalMouseTargetDelegate&&this.globalMouseTargetDelegate.onGlobalMouseDoubleClick))this.globalMouseTargetDelegate.onGlobalMouseDoubleClick(a);this.lastMouseUpTime=b;this.isMouseButtonPressed=!1;if(this.isDragAction)this.onEndDrag(a);
this.resetState()};_.onMouseMove=function(a){DEVICE_WITH_TOUCH_EVENTS&&a.preventPropagation();this.mouseMovePt=a.getMousePoint();if(this.globalMouseTargetDelegate&&this.globalMouseTargetDelegate.onGlobalMouseMove)this.globalMouseTargetDelegate.onGlobalMouseMove(a);if(this.isMouseButtonPressed)if(this.isDragAction)this.onDrag(a);else this.distanceFromPoints(this.mouseMovePt,this.mouseDownPt)>this.snapValue&&this.startDrag(a)};_.startDrag=function(a){this.isDragAction=!0;this.onStartDrag(a)};
_.onStartDrag=function(a){if(this.globalMouseTargetDelegate&&this.globalMouseTargetDelegate.onGlobalMouseStartDrag)this.globalMouseTargetDelegate.onGlobalMouseStartDrag(a)};_.onEndDrag=function(a){if(this.globalMouseTargetDelegate&&this.globalMouseTargetDelegate.onGlobalMouseEndDrag)this.globalMouseTargetDelegate.onGlobalMouseEndDrag(a)};_.onDrag=function(a){if(this.globalMouseTargetDelegate&&this.globalMouseTargetDelegate.onGlobalMouseDrag)this.globalMouseTargetDelegate.onGlobalMouseDrag(a)};
_.onMouseWheel=function(a){};_.resetState=function(){this.isMouseButtonPressed=this.isDragAction=!1;this.globalMouseTargetDelegate=null};_.distanceFromPoints=function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)};var GMOUSE=new GlobalMouse;function UndoRedoHistory(){this.redoList=[];this.undoList=[];this.currentUndoID=-1}
UndoRedoHistory.prototype.addUndoRedoActions=function(a,b){a||(console.log("UndoRedoHistory undoAction azione nulla"),console.log(a));b||(console.log("UndoRedoHistory redoAction azione nulla"),console.log(b));this.currentUndoID<this.undoList.length-1&&(this.undoList.splice(this.currentUndoID+1),this.redoList.splice(this.currentUndoID+1));this.undoList.push(a);this.redoList.push(b);this.currentUndoID=this.undoList.length-1};
UndoRedoHistory.prototype.undo=function(){-1<this.currentUndoID&&(this.undoList[this.currentUndoID]||(console.log(this.currentUndoID),console.log(this.undoList)),console.log("UndoRedoHistory.prototype.undo",this.undoList[this.currentUndoID]),this.undoList[this.currentUndoID].execute(),this.currentUndoID--)};
UndoRedoHistory.prototype.redo=function(){this.currentUndoID<this.undoList.length-1&&(this.currentUndoID++,this.redoList[this.currentUndoID]||(console.log(this.currentUndoID),console.log(this.redoList)),console.log("UndoRedoHistory.prototype.redo",this.redoList[this.currentUndoID]),this.redoList[this.currentUndoID].execute())};function Database(a){this.name=a;this.tables={};this.tableToLoad=0}_=Database.prototype;_.getTableByName=function(a){return this.tables[a]};_.deleteTable=function(a){delete this.tables[a]};
_.createTable=function(a,b){this.tables[a]={};this.tables[a].itemList=b;this.tables[a].databaseRef=this;this.tables[a].name=a;return this.tables[a]};_.loadTable=function(a,b,c,d){d=d||b;var e=this;SendAndLoad(a,"GET",null,function(a){a=e.createTable(d,a.responseToJSON());c&&c(a)})};_.onLoadSpreadSheetTable=function(a){console.log("loaded table:",a.name);this.createUniqueIndexes(a,"id");this.tableToLoad--;if(0===this.tableToLoad)this.onLoadAllTable()};
_.loadSpreadSheetTable=function(a,b,c,d){this.tableToLoad++;d=d||b;var e="";c&&(e="&columnNames="+c);var f=this;c=this.name+"_onLoadJsonpTable_"+this.tableToLoad;window[c]=function(a){a=f.createTable(d,a);f.onLoadSpreadSheetTable(a)};var g=GOOGLE_SHEET_TO_JSON_SERVICE_URL+"sheetId="+a+"&sheetName="+b+e+"&jsonp="+c;setTimeout(function(){IncludeJS(g)},50*this.tableToLoad)};
_.createUniqueIndexes=function(a,b){a.uniqueIndexes=a.uniqueIndexes||{};for(var c=a.itemList,d=c.length,e,f={},g=0;g<d;g++)e=c[g],e.tableRef=a,f[e[b]]=e;a.uniqueIndexes[b]=f};
_.select=function(a,b,c){var d=[],e,f;if(a.uniqueIndexes&&a.uniqueIndexes[b])if(c instanceof Array){var g=c.length;for(f=0;f<g;f++)(e=a.uniqueIndexes[b][c[f]])&&d.push(e)}else(e=a.uniqueIndexes[b][c])&&d.push(e);else{var k=a.itemList,l=k.length;if(c instanceof Array)for(g=c.length,a=0;a<l;a++)for(e=k[a],f=0;f<g;f++)e[b]==c[f]&&d.push(e);else for(a=0;a<l;a++)e=k[a],e[b]==c&&d.push(e)}return d};
_.joinTables=function(a,b,c,d,e){a=this.getTableByName(a);var f=this.getTableByName(b),g=a.itemList,k=g.length,l,h;for(l=0;l<k;l++){var m=g[l];if(h=f.uniqueIndexes[c][m[c]])for(var n in h){var p=n;d&&d[n]&&(p=d[n]);m[p]=h[n];m.tableRef=a}}e&&this.deleteTable(b)};
function ColorPicker(){this.mouseElementTarget=this.onChangeEndFunction=this.onChangeFunction=this.onChangeStartFunction=this.hexColor_input=this.alpha_point=this.alpha_panel=this.saturation_point=this.saturation_panel=this.hue_point=this.hue_panel=null;this.rgb={r:0,g:0,b:0};this.hsv={h:0,s:0,v:0};this.hexColor="#000000";this.alpha=1;this.isChanged=null;this.previous_rgb={r:0,g:0,b:0};this.previous_alpha=this.previous_hexColor=0;this.init()}_=ColorPicker.prototype;
_.init=function(){this.hue_panel=this.querySelector("#HUE_PANEL");this.hue_point=this.querySelector("#HUE_POINT");this.saturation_panel=this.querySelector("#SATURATION_PANEL");this.saturation_point=this.querySelector("#SATURATION_POINT");this.alpha_panel=this.querySelector("#ALPHA_PANEL");this.alpha_point=this.querySelector("#ALPHA_POINT");this.hexColor_input=this.querySelector("#HEX_COLOR_INPUT");this.initEventHandlers()};
_.initEventHandlers=function(){ConnectEvent("mousedown",this,this.onMouseDown,this);ConnectEvent("change",this.hexColor_input,this.onHexColorInputChange,this)};_.showAndSet=function(a,b,c,d,e,f){ShowElement(this,null,a);this.set(b,c,d,e,f)};
_.set=function(a,b,c,d,e){this.setColorAndAlpha(a,b);this.hue_panel.globalPosition=this.hue_panel.getGlobalPosition();this.alpha_panel.globalPosition=this.alpha_panel.getGlobalPosition();this.saturation_panel.globalPosition=this.saturation_panel.getGlobalPosition();this.onChangeFunction=c;this.onChangeStartFunction=d;this.onChangeEndFunction=e};
_.onMouseDown=function(a){console.log(this);this.saveCurrentColorValues();var b=a.srcElement?a.srcElement:a.target;if(b==this.hue_panel||b==this.hue_point)this.mouseElementTarget="HUE_TARGET",GMOUSE.globalMouseTargetDelegate=this,a.preventDefault(),this.dispatchChangeStartEvent();else if(b==this.saturation_panel||b==this.saturation_point)this.mouseElementTarget="SATURATION_TARGET",GMOUSE.globalMouseTargetDelegate=this,a.preventDefault(),this.dispatchChangeStartEvent();else if(b==this.alpha_panel||
b==this.alpha_point)this.mouseElementTarget="ALPHA_TARGET",GMOUSE.globalMouseTargetDelegate=this,a.preventDefault(),this.dispatchChangeStartEvent()};_.onGlobalMouseUp=function(a){if(!GMOUSE.isDragAction){if("HUE_TARGET"==this.mouseElementTarget)this.onChangeHSV_H_ByMouse();else if("SATURATION_TARGET"==this.mouseElementTarget)this.onChangeHSV_SV_ByMouse();else if("ALPHA_TARGET"==this.mouseElementTarget)this.onChangeAlpha_ByMouse();this.dispatchChangeEvent();this.dispatchChangeEndEvent()}};
_.saveCurrentColorValues=function(){this.previous_rgb.r=this.rgb.r;this.previous_rgb.g=this.rgb.g;this.previous_rgb.b=this.rgb.b;this.previous_alpha=this.alpha;this.previous_hexColor=this.hexColor};_.onGlobalMouseStartDrag=function(){};_.onGlobalMouseDrag=function(a){if("HUE_TARGET"==this.mouseElementTarget)this.onChangeHSV_H_ByMouse();else if("SATURATION_TARGET"==this.mouseElementTarget)this.onChangeHSV_SV_ByMouse();else if("ALPHA_TARGET"==this.mouseElementTarget)this.onChangeAlpha_ByMouse();this.dispatchChangeEvent()};
_.onGlobalMouseEndDrag=function(){this.mouseElementTarget=GMOUSE.globalMouseTargetDelegate=null;this.dispatchChangeEndEvent()};_.onChangeAlpha_ByMouse=function(){var a=GMOUSE.mouseMovePt.x-this.alpha_panel.globalPosition.x;0>a?a=0:150<a&&(a=150);this.alpha=a/150;this.colorChanged()};
_.onChangeHSV_H_ByMouse=function(){var a=GMOUSE.mouseMovePt.x-this.hue_panel.globalPosition.x;0>a?a=0:150<a&&(a=150);this.hsv.h=a/150;0==this.hsv.s&&(this.hsv.s=1);0==this.hsv.v&&(this.hsv.v=1);this.rgb=this.hsvToRgb(this.hsv.h,this.hsv.s,this.hsv.v);this.colorChanged()};
_.onChangeHSV_SV_ByMouse=function(){var a=this.saturation_panel.globalPosition,b=GMOUSE.mouseMovePt.x-a.x;0>b?b=0:150<b&&(b=150);a=GMOUSE.mouseMovePt.y-a.y;0>a?a=0:150<a&&(a=150);this.hsv.s=1-a/150;this.hsv.v=b/150;this.rgb=this.hsvToRgb(this.hsv.h,this.hsv.s,this.hsv.v);this.colorChanged()};
_.onHexColorInputChange=function(){this.saveCurrentColorValues();this.dispatchChangeStartEvent(null);this.rgb=this.hexToRgb(this.hexColor_input.value,{r:0,g:0,b:0});this.hsv=this.rgbToHsv(this.rgb.r,this.rgb.g,this.rgb.b);this.colorChanged();this.dispatchChangeEndEvent(null)};_.currentColorAsHtmlStringRGBA=function(){return"rgba("+Math.round(255*this.rgb.r)+","+Math.round(255*this.rgb.g)+","+Math.round(255*this.rgb.b)+","+this.alpha+")"};
_.colorValuesToHtmlStringRGBA=function(a,b,c,d){return"rgba("+Math.round(255*a)+","+Math.round(255*b)+","+Math.round(255*c)+","+d+")"};_.setColorAndAlpha=function(a,b){this.rgb=this.htmlColorDefinitionToRGBA(a);this.hsv=this.rgbToHsv(this.rgb.r,this.rgb.g,this.rgb.b);b&&(this.rgb.a=b);this.alpha=this.rgb.a;this.colorChanged()};_.setAlpha=function(a){this.alpha=a;this.colorChanged()};
_.colorChanged=function(){var a=this.rgbToHex(this.rgb.r,this.rgb.g,this.rgb.b);this.hexColor=a;var b=this.hsvToRgb(this.hsv.h,1,1);b=this.rgbToHex(b.r,b.g,b.b);this.hexColor_input.style.background=a;this.hexColor_input.value=a;this.hexColor_input.style.color=65>(100*this.rgb.r+100*this.rgb.g+100*this.rgb.b)/3?"#FFFFFF":"#000000";this.saturation_panel.parentNode.style.background=b;a=(255*this.rgb.r).toFixed(0)+","+(255*this.rgb.g).toFixed(0)+","+(255*this.rgb.b).toFixed(0);this.alpha_panel.style.cssText=
""+("background: -moz-linear-gradient(left,  rgba("+a+",0) 0%, rgba("+a+",1) 100%);")+("background: -webkit-gradient(linear, left top, right top, color-stop(0%,rgba("+a+",0)), color-stop(100%,rgba("+a+",1)));")+("background: -webkit-linear-gradient(left,  rgba("+a+",0) 0%,rgba("+a+",1) 100%);")+("background: -o-linear-gradient(left,  rgba("+a+",0) 0%,rgba("+a+",1) 100%);")+("background: -ms-linear-gradient(left,  rgba("+a+",0) 0%,rgba("+a+",1) 100%);")+("background: linear-gradient(left,  rgba("+
a+",0) 0%,rgba("+a+",1) 100%);");this.setSaturationPointByPos(150*this.hsv.v,150*(1-this.hsv.s));this.setHuePointByPos(150*this.hsv.h);this.setAlphaPointByPos(150*this.alpha);this.isChanged=!0};_.setAlphaPointByPos=function(a){a-=6;-6>a&&(a=-6);a>this.alpha_panel.offsetWidth-6&&(a=this.alpha_panel.offsetWidth-6);this.alpha_point.setPosition(Math.round(a),0)};
_.setHuePointByPos=function(a){a-=6;-6>a&&(a=-6);a>this.hue_panel.offsetWidth-6&&(a=this.hue_panel.offsetWidth-6);this.hue_point.setPosition(Math.round(a),0)};_.setSaturationPointByPos=function(a,b){a-=4;b-=4;-4>a?a=-4:a>this.saturation_panel.offsetWidth-4&&(a=this.saturation_panel.offsetWidth-4);-4>b?b=-4:b>this.saturation_panel.offsetHeight-4&&(b=this.saturation_panel.offsetHeight-4);this.saturation_point.setPosition(Math.round(a),Math.round(b))};
_.dispatchChangeStartEvent=function(a){if(null!=this.onChangeStartFunction)this.onChangeStartFunction(this)};_.dispatchChangeEvent=function(){if(this.isChanged&&null!=this.onChangeFunction)this.onChangeFunction(this);this.isChanged=!1};_.dispatchChangeEndEvent=function(a){if(null!=this.onChangeEndFunction)this.onChangeEndFunction(this)};
_.hsvToRgb=function(a,b,c){var d,e;if(0==c)var f=e=d=0;else{var g=Math.floor(6*a),k=6*a-g;a=c*(1-b);var l=c*(1-b*k);b=c*(1-b*(1-k));switch(g){case 1:d=l;e=c;f=a;break;case 2:d=a;e=c;f=b;break;case 3:d=a;e=l;f=c;break;case 4:d=b;e=a;f=c;break;case 5:d=c;e=a;f=l;break;case 6:case 0:d=c,e=b,f=a}}return{r:d,g:e,b:f}};
_.rgbToHsv=function(a,b,c){var d=Math.max(Math.max(a,b),c),e=Math.min(Math.min(a,b),c);if(e==d)e=a=0;else{var f=d-e;e=f/d;a=(a==d?(b-c)/f:b==d?2+(c-a)/f:4+(a-b)/f)/6;0>a&&(a+=1);1<a&&--a}return{h:a,s:e,v:d}};
_.hexToRgb=function(a,b){void 0==b&&(b=null);"#"==a.substr(0,1)&&(a=a.substr(1));if(3==a.length){var c=a.substr(0,1);c+=c;var d=a.substr(1,1);d+=d;var e=a.substr(2,1);e+=e}else if(6==a.length)c=a.substr(0,2),d=a.substr(2,2),e=a.substr(4,2);else return b;c=parseInt(c,16);d=parseInt(d,16);e=parseInt(e,16);return isNaN(c)||isNaN(d)||isNaN(e)?b:{r:c/255,g:d/255,b:e/255}};
_.rgbToHex=function(a,b,c,d){a=Math.round(255*a);b=Math.round(255*b);c=Math.round(255*c);void 0==d&&(d=!0);a=a.toString(16);1==a.length&&(a="0"+a);b=b.toString(16);1==b.length&&(b="0"+b);c=c.toString(16);1==c.length&&(c="0"+c);return((d?"#":"")+a+b+c).toUpperCase()};
_.htmlColorDefinitionToRGBA=function(a){var b={r:0,g:0,b:0,a:1},c=a.indexOf("rgb(");if(-1!=c){c+=4;var d=a.indexOf(")",c);a=a.substring(c,d).split(",");b.r=1/255*parseInt(a[0]);b.g=1/255*parseInt(a[1]);b.b=1/255*parseInt(a[2]);b.a=1}else c=a.indexOf("rgba("),-1!=c?(c+=5,d=a.indexOf(")",c),a=a.substring(c,d).split(","),b.r=1/255*parseInt(a[0]),b.g=1/255*parseInt(a[1]),b.b=1/255*parseInt(a[2]),b.a=parseFloat(a[3])):("#"!=a.substr(0,1)&&(a=this.colorNameToHex(a)),b=this.hexToRgb(a),b.a=1);return b};
_.rainbow=function(a,b){var c=b/a,d=~~(6*c);c=6*c-d;var e=1-c;switch(d%6){case 0:var f=1;var g=c;var k=0;break;case 1:f=e;g=1;k=0;break;case 2:f=0;g=1;k=c;break;case 3:f=0;g=e;k=1;break;case 4:f=c;g=0;k=1;break;case 5:f=1,g=0,k=e}return"#"+("00"+(~~(255*f)).toString(16)).slice(-2)+("00"+(~~(255*g)).toString(16)).slice(-2)+("00"+(~~(255*k)).toString(16)).slice(-2)};
function TreeView(){this.selectedNodeClassName="selected";this.expandedNodeClassName="expanded";this.dragOverNodeClassName="dragOver";this.dropNotAllowed="no-drop";this.selectedNodes=[];this.lastMouseUpTime=this.lastMouseDownTime=null;this.urlService="";this.loadingState=this.serviceVars=null;this.enableNodeDrop=this.enableNodeDrag=!1;this.createEventHandlers()}_=TreeView.prototype;
_.createEventHandlers=function(){ConnectEvent("mousedown",this,this.onMouseDown,this);ConnectEvent("mouseup",this,this.onMouseUp,this)};_.onMouseDown=function(a){this.lastMouseDownTime=(new Date).getTime()};
_.onMouseUp=function(a){if("LI"==a.target.parentElement.nodeName){var b=a.target.parentElement;if("A"==a.target.nodeName)this.expandOrCollapseNode(b);else if("DIV"==a.target.nodeName){if(this.isMouseHold())this.onMouseHoldOnNode(a);this.selectNode(a.target.parentElement);if(this.isDoubleClick())this.onDoubleClickOnNodeName(a)}3==a.which&&this.showNodeContextMenu(a)}else this.deselectAllNodes()};_.isMouseHold=function(){return 250<(new Date).getTime()-this.lastMouseDownTime?!0:!1};
_.onMouseHoldOnNode=function(a){-1<this.selectedNodes.indexOf(a.target.parentElement)&&this.editNodeName(a.target)};_.isDoubleClick=function(){var a=(new Date).getTime();if(250>a-this.lastMouseUpTime)return!0;this.lastMouseUpTime=a;return!1};_.onDoubleClickOnNodeName=function(a){this.expandOrCollapseNode(a.target.parentNode)};_.getDropableNodeTarget=function(a){return a.target.getElementOrParentElementByAttribute("dropable","true")};
_.onDragOverNode=function(a){var b=this.getDropableNodeTarget(a);b&&b.classList.add(this.dragOverNodeClassName);a.stopPropagation();a.preventDefault()};_.onDragLeaveNode=function(a){var b=this.getDropableNodeTarget(a);b&&b.classList.remove(this.dragOverNodeClassName);a.stopPropagation();a.preventDefault()};_.onDragStartNode=function(a){SetTransferData(a.target);a.altKey||(a.dataTransfer.effectAllowed="move");a.stopPropagation()};
_.onDropOnNode=function(a){console.log("onDropOnNode treeview",a);var b=this.getDropableNodeTarget(a);this.onDragAndDropEnd(GetTransferData(),b);this.onDragLeaveNode(a);a.stopPropagation();a.preventDefault()};_.onDragAndDropEnd=function(a,b){console.log("onDragAndDropEnd")};_.moveNodes=function(a,b){a.parentNode.removeChild(a);this.getNodeElement_ul(b).appendChild(a)};
_.disableDraggableNodes=function(){for(var a=this.querySelectorAll('li[draggable="true"]'),b=0;b<a.length;b++)a[b].setAttribute("draggable","disabled")};_.enableDraggableNodes=function(){for(var a=this.querySelectorAll('li[draggable="disabled"]'),b=0;b<a.length;b++)a[b].setAttribute("draggable","true")};_.editSelectedNodeName=function(){0!=this.selectedNodes.length&&this.editNodeName(this.selectedNodes[0].querySelector("div"))};_.getNodeName=function(a){return a.querySelector("div").textContent};
_.editNodeName=function(a){this.disableDraggableNodes();var b=a.textContent;a.removeChildren();var c=document.createElement("input");c.setAttribute("type","text");c.setAttribute("class","inputNodeName");c.setAttribute("value",b);c.previousValue=b;var d=this;ConnectEvent("change",c,function(a){this.blur()});ConnectEvent("blur",c,function(b){console.log("onBlur",this);this.value!=this.previousValue&&(a.innerHTML=d.onEndEditNodeName(this));a.innerHTML=this.value});a.appendChild(c);c.focus()};
_.onEndEditNodeName=function(a){this.enableDraggableNodes()};_.showNodeContextMenu=function(a){};_.expandOrCollapseNode=function(a){a.classList.contains(this.expandedNodeClassName)?this.collapseNode(a):this.expandNode(a)};_.expandNode=function(a){var b=this.getNodeElement_ul(a);if(!b)return null;a.classList.add(this.expandedNodeClassName);return b};_.collapseNode=function(a){a.classList.remove(this.expandedNodeClassName)};
_.loadNodeChildren=function(a,b,c){var d=null;a&&(d=this.getNodeElement_ul(a));d||(d=this);d.removeChildren();this.showLoadingState();var e=this;console.log("this.urlService",this.urlService);console.log("this.serviceVars",this.serviceVars);SendAndLoad(b,"POST",c,function(a){a=a.target;console.log(a.responseText);a=window.JSON.parse(a.responseText);e.onLoadNodeChildren(a,d)})};_.onLoadNodeChildren=function(a,b){this.hideLoadingState();this.drawData(b,a)};
_.drawData=function(a,b,c){for(var d,e=0;e<b.length;e++)d=b[e],c=this.createTreeViewNode(d.itemType+"_icon16x16",d.itemTitle,null,d.hasChildren),c.setAttribute("itemType",d.itemType),c.setAttribute("id",d.id),c.data=d,a.appendChild(c),this.onNodeAdded(c)};
_.onNodeAdded=function(a){this.enableNodeDrag&&(a.draggable=!0,a.ondragstart=BindFunction(this,this.onDragStartNode));this.enableNodeDrop&&(a.setAttribute("dropable","true"),a.ondrop=BindFunction(this,this.onDropOnNode),a.ondragover=BindFunction(this,this.onDragOverNode),a.ondragleave=BindFunction(this,this.onDragLeaveNode))};_.getNodeElement_ul=function(a){return a.getElementsByTagName("ul")[0]};_.getSelecteNodes=function(){return this.selectedNodes};
_.selectNode=function(a){this.deselectAllNodes();this.selectedNodes.push(a);a.classList.add(this.selectedNodeClassName)};_.deselectNode=function(a){var b=this.selectedNodes.indexOf(a);-1!=b&&(this.selectedNodes.splice(b,1),a.classList.remove(this.selectedNodeClassName))};_.deselectAllNodes=function(){for(var a=this.selectedNodes.length,b=0;b<a;b++)this.selectedNodes[b].classList.remove(this.selectedNodeClassName);this.selectedNodes=[]};
_.createTreeViewNode=function(a,b,c,d){var e=document.createElement("li");c&&e.setAttribute("title",c);c=document.createElement("div");-1<a.indexOf(".jpg")?c.setAttribute("style",'background-image: url("'+a+'"); background-size: 24px;'):c.className=a;c.appendChild(document.createTextNode(b));e.appendChild(c);1==d&&(a=document.createElement("ul"),e.appendChild(a));a=document.createElement("a");e.appendChild(a);return e};_.showLoadingState=function(){this.loadingState&&this.loadingState.classList.remove("hidden")};
_.hideLoadingState=function(){this.loadingState&&this.loadingState.classList.add("hidden")};
function Panel(a){a.x&&this.setPositionX(a.x);a.y&&this.setPositionY(a.y);a.width&&this.setSizeX(a.width);a.height&&this.setSizeY(a.height);!1===a.closable&&this.classList.add("no-closable");!1===a.collapsable&&this.classList.add("no-collapsable");!1===a.resizable&&this.classList.add("no-resizable");!1===a.fullScreen&&this.classList.add("no-full-screen");a.appRef&&(this.appRef=a.appRef);this.idPanel=this.getIndex();this.panelRepository=null;this.initEvents()}_=Panel.prototype;
_.initEvents=function(a){ConnectEvent("mousedown",this,this.placeInFront,this);ConnectEvent("mousedown",this.querySelector(".head"),this.onClickOnHead,this);ConnectEvent("click",this.querySelector(".close-button"),this.close,this);ConnectEvent("mousedown",this.querySelector(".resize-button"),this.onMouseDownOnResizeButton,this);ConnectEvent("click",this.querySelector(".collapse-button"),this.onClickOnCollapseButton,this);ConnectEvent("click",this.querySelector(".full-screen-button"),this.onClickOnFullScreenButton,
this)};_.setTitle=function(a){this.querySelector(".head>.title").innerHTML=a};
_.close=function(a){if(a&&a.altKey)for(var b=this.parentElement.querySelectorAll("div.panel"),c=0;c<b.length;c++)a=b[c],a.classList.contains("no-closable")||a.close(null);else this.panelRepository?(this.panelRepository.insertBefore(this,this.panelRepository.childNodes[this.idPanel]),this.classList.add("collapsed")):this.classList.contains("closed")||(this.onClose(),this.classList.add("closed"),this.classList.contains("modal")&&this.parentElement.classList.remove("showed"))};
_.onGlobalMouseStartDrag=function(){if(this.parentElement.classList.contains("panel-repository")){this.panelRepository=this.parentElement;var a=window.getComputedStyle(this);this.expand();var b=parseFloat(a.width);a=parseFloat(a.height);this.dragOffset={x:b/2,y:13};this.setPosition(GMOUSE.mouseMovePt.x,GMOUSE.mouseMovePt.y);this.setSize(b,a);document.querySelector("#FLOATING_WINDOWS").appendChild(this);this.placeInFront()}};_.onClose=function(){};
_.onClickOnFullScreenButton=function(){this.classList.remove("collapsed");this.classList.toggle("full-screen")};_.open=function(a){if(this.classList.contains("closed")){this.classList.contains("modal")&&this.parentElement.classList.add("showed");this.onOpen();this.classList.remove("closed");if(1==a){a=window.innerWidth;var b=window.innerHeight,c=this.getSize();this.setPosition(a/2-c.x/2,b/2-c.y/2)}this.placeInFront()}};_.onOpen=function(){};
_.placeInFront=function(){this.parentNode.maxLevel||(this.parentNode.maxLevel=1);this.parentNode.maxLevel++;this.style.zIndex=this.parentNode.maxLevel};_.expand=function(){this.classList.remove("collapsed");this.onExpand()};_.collapse=function(){this.classList.add("collapsed");this.onCollapse()};
_.onClickOnHead=function(){this.dragAction="DRAG_WIN";var a=this.getPosition();this.dragOffset={x:0,y:0};this.dragOffset.x=GMOUSE.mouseMovePt.x-a.x;this.dragOffset.y=GMOUSE.mouseMovePt.y-a.y;GMOUSE.globalMouseTargetDelegate=this};_.onMouseDownOnResizeButton=function(){this.dragAction="RESIZE_WIN";var a=this.getPosition(),b=this.getSize();this.dragOffset={x:0,y:0};this.dragOffset.x=a.x+b.x-GMOUSE.mouseMovePt.x;this.dragOffset.y=a.y+b.y-GMOUSE.mouseMovePt.y;GMOUSE.globalMouseTargetDelegate=this};
_.onClickOnCollapseButton=function(){this.classList.contains("collapsed")?this.expand():this.collapse()};_.onExpand=function(){console.log("onExpand")};_.onCollapse=function(){};_.onGlobalMouseDoubleClick=function(a){console.log(a.target);if(a.target.classList.contains("title"))this.onClickOnCollapseButton()};_.onGlobalMouseEndDrag=function(){this.dragAction=GMOUSE.globalMouseTargetDelegate=null};
_.onGlobalMouseDrag=function(a){"DRAG_WIN"==this.dragAction?this.setPosition(GMOUSE.mouseMovePt.x-this.dragOffset.x,GMOUSE.mouseMovePt.y-this.dragOffset.y):"RESIZE_WIN"==this.dragAction&&(a=this.getPosition(),this.setSize(GMOUSE.mouseMovePt.x-a.x+this.dragOffset.x,GMOUSE.mouseMovePt.y-a.y+this.dragOffset.y))};function Standard_dialog(a){a.appRef&&(this.appRef=a.appRef);this.connectEvents();this.callback_CANCEL=this.callback_OK=null}_=Standard_dialog.prototype;Standard_dialog.beep=new Audio("../XOS-UI/system/sounds/beep.wav");
_.setIcon=function(a){this.querySelector(".icon").className="icon "+a};_.setTitle=function(a){this.querySelector(".title").innerHTML=a};_.setDescription=function(a){this.querySelector(".description").innerHTML=a};_.close=function(){this.classList.remove("showed")};_.open=function(a,b,c,d){this.setTitle(a);this.setDescription(b);this.callback_OK=c;this.callback_CANCEL=d;this.classList.add("showed");Standard_dialog.beep.play()};_.onClick_ok=function(a){this.close();this.callback_OK&&this.callback_OK()};
_.onClick_cancel=function(a){this.close();this.callback_CANCEL&&this.callback_CANCEL()};_.onChange_promptValue=function(a){console.log("onChange_promptValue",a)};_.getPromptValue=function(a){return this.querySelector(".prompt-value").value};_.setPromptValue=function(a,b){var c=this.querySelector(".prompt-value");c.setAttribute("placeholder",b);c.value=a};Extends(Progress_panel,Panel);
function Progress_panel(a){Progress_panel.superConstructor.call(this,a);this.appRef=a.appRef;this.progressBar=this.querySelector("#BAR");this.progressLabel=this.querySelector("#LABEL");this.loaded=this.total=0;this.progressBar.max=100;this.uploadBytePerSeconds=2E4;this.progressListenerList=[]}_=Progress_panel.prototype;_.reset=function(){this.loaded=this.total=0;this.progressListenerList=[]};_.open=function(a){Progress_panel.superClass.open.call(this,a);this.setPositionY(50)};
_.setProgressBarValue=function(a){this.progressLabel.innerHTML=LOCALIZER.translate("Loading:")+" "+a+"%";this.progressBar.value=a};_.setProgressValues=function(a,b){if(0!=a){var c=Math.round(b/a*100);this.setProgressBarValue(c);100==c?(this.close(),this.reset()):this.open(!0)}};
_.onLoadingProgress=function(a){a.lengthComputable&&(-1==this.progressListenerList.indexOf(a.target)&&(this.progressListenerList.push(a.target),this.total+=a.total,a.target.lastLoaded=0),this.loaded+=a.loaded-a.target.lastLoaded,a.target.lastLoaded=a.loaded,this.setProgressValues(this.total,this.loaded))};_.startVirtualProgress=function(a){this.progressState="progress";this.loaded=0;this.total=a;this.startVirtualProgressTime=(new Date).getTime();this.onVirtualProgress()};
_.endVirtualProgress=function(){this.progressState="end";this.endVirtualProgressTime=(new Date).getTime();this.uploadBytePerSeconds=this.total/((this.endVirtualProgressTime-this.startVirtualProgressTime)/200);this.setProgressBarValue(100);var a=this;setTimeout(function(){a.close();a.reset()},500)};
_.onVirtualProgress=function(){if("progress"==this.progressState){this.loaded+this.uploadBytePerSeconds<this.total?this.loaded+=this.uploadBytePerSeconds:(this.loaded-=this.uploadBytePerSeconds,0>this.loaded&&(this.loaded=0));this.setProgressValues(this.total,this.loaded);var a=this;setTimeout(function(){a.onVirtualProgress()},200)}};
function TabbedViews_panel(a){this.appRef=a.appRef;this.tabs=a.tabs;this.tabTemplateName=a.tabTemplateName||"TABBED_PANEL_TAB";this.viewTemplateName=a.viewTemplateName||"TABBED_PANEL_VIEW";ConnectEvent("click",this.tabs,this.onClickOnTabs,this)}_=TabbedViews_panel.prototype;_.onClickOnTabs=function(a){if(a.target!=this.tabs){var b=a.target.getParentInGrandParent(this.tabs).viewRef;"A"==a.target.nodeName&&b.classList.contains("showed")?this.closeView(b):this.showView(b)}};
_.createViewTab=function(a){var b=document.querySelector("#TEMPLATES #"+this.tabTemplateName).cloneNode(!0);this.tabs.appendChild(b);a.tabRef=b;b.viewRef=a};_.updateViewTab=function(a){a.tabRef.querySelector("div").innerHTML=a.getAttribute("name")};_.showView=function(a){SelectElement(a.tabRef);ShowElement(a);this.onShowView(a)};_.onShowView=function(a){};
_.createView=function(a){var b=document.querySelector("#TEMPLATES #"+this.viewTemplateName).cloneNode(!0);this.appendChild(b);this.createViewTab(b);a&&a(b);return b};_.addView=function(a){this.appendChild(a);this.createViewTab(a)};_.closeView=function(a){this.removeView(a)};_.removeView=function(a){var b=a.nextElementSibling||a.previousElementSibling;b&&this.showView(b);a.tabRef.remove();a.remove();a.tabRef.viewRef=null;a.tabRef=null};
function WebView_dialog(a){this.appRef=a.appRef;this.connectEvents();this.content=this.querySelector(".content")}_=WebView_dialog.prototype;_.showLoadingState=function(){this.content.innerHTML='<div class="loading-progress" ></div>';ShowElement(this)};_.loadWebContent=function(a){this.content.innerHTML='<iframe xmlns="http://www.w3.org/1999/xhtml" css="display:block; width:100%; height:100%; " width="100%" height="100%" src="'+a+'" frameborder="0" scrolling="no"></iframe>'};
_.onClick_closeModalDialogButton=function(a){this.content.innerHTML="";HideElements([this])};Extends(TabbedDocuments_panel,TabbedViews_panel);function TabbedDocuments_panel(a){TabbedDocuments_panel.superConstructor.call(this,a);this.onShowViewCallBack=a.onShowView;this.getDocumentFromViewCallBack=a.getDocumentFromView}_=TabbedDocuments_panel.prototype;
_.updateViewTab=function(a){a=a||this.querySelector(".showed");var b=this.getDocumentFromView(a);a=a.tabRef;b.isChanged?a.classList.add("unsaved"):a.classList.remove("unsaved");a.setAttribute("title",b.getFullPath());a.querySelector("div").innerHTML=b.getTitle()};_.closeView=function(a){var b=this;this.getDocumentFromView(a).isChanged?this.appRef.CONFIRM_DIALOG.open(LOCALIZER.translate("Caution"),LOCALIZER.translate("Close the document without saving changes?"),function(){b.removeView(a)}):this.removeView(a)};
_.removeView=function(a){TabbedDocuments_panel.superClass.removeView.call(this,a);0==this.children.length&&this.appRef.createDocument()};_.getDocumentFromView=function(a){return this.getDocumentFromViewCallBack(a)};_.getDocumentByFullPath=function(a){for(var b,c=this.children,d=0;d<c.length;d++)if(b=this.getDocumentFromView(c[d]),b.fullPath==a)return b;return null};
_.areAllDocumentSaved=function(){for(var a,b=this.children,c=0;c<b.length;c++)if(a=this.getDocumentFromView(b[c]),a.isChanged)return!1;return!0};_.onShowView=function(a){this.onShowViewCallBack(a)};function Application(){this.activeEditor=null;this.TABBED_DOCUMENT_TAB_TEMPLATE_NAME="TABBED_DOCUMENT_TAB";this.TABBED_DOCUMENT_VIEW_TEMPLATE_NAME="TABBED_DOCUMENT_VIEW";this.initPanels()}_=Application.prototype;_.onApplicationStart=function(){};
_.initLanguage=function(a){var b=GetCookie("language");b?LANGUAGE=b:SetCookie("language",LANGUAGE,1E3);b="resources/localization/"+LANGUAGE+".js";GOOGLE_LOCALIZER_SERVICE_URL&&(b=GOOGLE_LOCALIZER_SERVICE_URL+"sheetId="+GOOGLE_LOCALIZER_SHEET_ID+"&sheetName=language_strings&columnName="+LANGUAGE+"&callback=onLoadLanguageStrings");LOCALIZER.loadStrings(b,a)};
_.initEvents=function(){window.onresize=BindFunction(this,this.onBrowserResize);DEVICE_WITH_TOUCH_EVENTS&&document.addEventListener("orientationchange",BindFunction(this,this.onOrientationChanged));window.addEventListener("unload",BindFunction(this,this.onExit),!1);window.onbeforeunload=BindFunction(this,this.confirmExit);ConnectEvent("keydown",window,this.onKeyDown,this);ConnectEvent("keyup",window,this.onKeyUp,this);var a=document.querySelector("#CONTENT");ConnectEvent("mousewheel",a,this.onMouseWheel_content,
this);ConnectEvent("DOMMouseScroll",a,this.onMouseWheel_content,this)};_.isValidKeyEvent=function(a){a=a.srcElement?a.srcElement:a.target;return a.hasAttribute("contenteditable")||"INPUT"==a.tagName||"TEXTAREA"==a.tagName?!1:!0};_.onKeyDown=function(a){};_.onKeyUp=function(a){};_.onMouseWheel_content=function(a){if(!GMOUSE.isMouseButtonPressed)this.activeEditor.activeDocument.onMouseWheel(a)};_.confirmExit=function(){if(!this.DOCUMENTS.areAllDocumentSaved())return"Some open documents are not saved!\nDo you really want to exit the application?"};
_.onExit=function(){};_.onOrientationChanged=function(a){this.onBrowserResize()};_.onBrowserResize=function(a){this.activeEditor.activeDocument.onResize()};_.onExit=function(){};_.onDocumentStartChange=function(a){this.DOCUMENTS.updateViewTab(null)};_.onDocumentChange=function(a){};
_.initPanels=function(){this.STAGE=document.querySelector("#STAGE");this.CONTEXT_PANELS=document.querySelector("#CONTEXT_PANELS").connectController(ContextPanels_manager,{appRef:this});this.DOCUMENTS=document.querySelector("#DOCUMENTS").connectController(TabbedDocuments_panel,{appRef:this,tabs:document.querySelector("#TABBED_DOCUMENT_TABS"),tabTemplateName:this.TABBED_DOCUMENT_TAB_TEMPLATE_NAME,viewTemplateName:this.TABBED_DOCUMENT_VIEW_TEMPLATE_NAME,onShowView:BindFunction(this,this.onShowTabbedDocumentView),
getDocumentFromView:BindFunction(this,this.getDocumentFromTabbedDocumentView)});var a={appRef:this};this.ALERT_DIALOG=document.querySelector("#ALERT_DIALOG").connectController(Standard_dialog,a);this.CONFIRM_DIALOG=document.querySelector("#CONFIRM_DIALOG").connectController(Standard_dialog,a);this.PROMPT_DIALOG=document.querySelector("#PROMPT_DIALOG").connectController(Standard_dialog,a);this.PROGRESS_PANEL=document.querySelector("#PROGRESS_PANEL").connectController(Progress_panel,a);this.WEBVIEW_DIALOG=
document.querySelector("#WEBVIEW_DIALOG").connectController(WebView_dialog,a);this.COLOR_PICKER=document.querySelector("#COLOR_PICKER").connectController(ColorPicker,a);document.querySelector("#ARCHIVIE_TOOLBAR").connectEvents(this);this.TIP_MESSAGE=document.querySelector("#TIP_MESSAGE")};_.onShowTabbedDocumentView=function(a){};_.getDocumentFromTabbedDocumentView=function(a){};_.showTip=function(a){null!=LOCALIZER&&(this.TIP_MESSAGE.innerHTML=LOCALIZER.translate(a))};_.showLogin=function(){};
_.validateJSONResponse=function(a){a=a.responseToJSON();return!1===a?!1:"UNLOGGED"==a.result?(this.showLogin(),!1):"ERROR"==a.result?(console.log(a.data),!1):a};
function ContextPanels_manager(a){this.appRef=null;a&&a.appRef&&(this.appRef=a.appRef);var b=this;this.addEventListener("mousedown",function(a){b.hasFocus=!0});a=document.querySelector("#APPLICATION");a.addEventListener("mousedown",function(a){b.hasFocus=!1},!0);a.addEventListener("mousedown",function(a){0==b.hasFocus&&HideElements(b.querySelectorAll(".showed"))})}_=ContextPanels_manager.prototype;
String.prototype.parseFloats=function(a){a=a||/\s+/;var b=[];a=this.split(a);for(var c,d=0,e=a.length;d<e;d++)c=parseFloat(a[d]),isNaN(c)?console.warn("error NaN String.prototype.parseFloats id:"+d+" value:"+a[d]):b.push(c);return b};String.prototype.parseIntegers=function(a){a=a||/\s+/;var b=[];a=this.split(a);for(var c,d=0,e=a.length;d<e;d++)c=parseInt(a[d]),isNaN(c)?console.warn("error NaN String.prototype.parseIntegers id:"+d+" value:"+a[d]):b.push(c);return b};
String.prototype.containsWords=function(a,b){b=b||"AND";var c,d=a.length,e=this.split(/\s+/);if("AND"==b){for(c=0;c<d;c++)if(-1==e.indexOf(a[c]))return!1;return!0}if("OR"==b){for(c=0;c<d;c++)if(-1==e.indexOf(a[c]))return!0;return!1}};String.prototype.isValidFileName=function(){return""==this||/[^a-z0-9\.\s\-_]/gi.test(this)?!1:!0};
Number.prototype.formatMoney=function(a,b,c){var d=this;a=isNaN(a=Math.abs(a))?2:a;b=void 0==b?".":b;c=void 0==c?",":c;var e=0>d?"-":"",f=parseInt(d=Math.abs(+d||0).toFixed(a))+"",g=3<(g=f.length)?g%3:0;return e+(g?f.substr(0,g)+c:"")+f.substr(g).replace(/(\d{3})(?=\d)/g,"$1"+c)+(a?b+Math.abs(d-f).toFixed(a).slice(2):"")};Date.prototype.toInputValue=function(){var a=this.getDate(),b=this.getMonth()+1,c=this.getFullYear();10>b&&(b="0"+b);10>a&&(a="0"+a);return c+"-"+b+"-"+a};
Date.fromMySqlTimestamp=function(a){a=a.split(/[- :]/);return new Date(a[0],a[1]-1,a[2],a[3],a[4],a[5])};function Interpolation(){}Interpolation.adobe_easeout=function(a){return Math.pow(a,1.7)};Interpolation.adobe_easein=function(a){return Math.pow(a,.48)};Interpolation.adobe_easeinout=function(a){if(1==a)return 1;if(0==a)return 0;var b=.48-a/1.04,c=Math.sqrt(.1734+b*b);a=c-b;b=-c-b;a=Math.pow(Math.abs(a),1/3)*(0>a?-1:1)+Math.pow(Math.abs(b),1/3)*(0>b?-1:1)+.5;return 3*(1-a)*a*a+a*a*a};
Interpolation.adobe_elastic=function(a){return a==!!a?a:Math.pow(2,-10*a)*Math.sin(2*(a-.075)*Math.PI/.3)+1};Interpolation.linear=function(a,b,c,d){return a/d*c+b};Interpolation.backEaseIn=function(a,b,c,d){if(void 0==e)var e=1.70158;return c*(a/=d)*a*((e+1)*a-e)+b};Interpolation.backEaseOut=function(a,b,c,d){if(void 0==e)var e=1.70158;return c*((a=a/d-1)*a*((e+1)*a+e)+1)+b};
Interpolation.backEaseInOut=function(a,b,c,d){if(void 0==e)var e=1.70158;return 1>(a/=d/2)?c/2*a*a*(((e*=1.525)+1)*a-e)+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b};Interpolation.elasticEaseIn=function(a,b,c,d,e,f){if(0==a)return b;if(1==(a/=d))return b+c;f||(f=.3*d);!e||e<Math.abs(c)?(e=c,c=f/4):c=f/(2*Math.PI)*Math.asin(c/e);return-(e*Math.pow(2,10*--a)*Math.sin(2*(a*d-c)*Math.PI/f))+b};
Interpolation.elasticEaseOut=function(a,b,c,d,e,f){if(0==a)return b;if(1==(a/=d))return b+c;f||(f=.3*d);if(!e||e<Math.abs(c)){e=c;var g=f/4}else g=f/(2*Math.PI)*Math.asin(c/e);return e*Math.pow(2,-10*a)*Math.sin(2*(a*d-g)*Math.PI/f)+c+b};
Interpolation.elasticEaseInOut=function(a,b,c,d,e,f){if(0==a)return b;if(2==(a/=d/2))return b+c;f||(f=.3*d*1.5);if(!e||e<Math.abs(c)){e=c;var g=f/4}else g=f/(2*Math.PI)*Math.asin(c/e);return 1>a?-.5*e*Math.pow(2,10*--a)*Math.sin(2*(a*d-g)*Math.PI/f)+b:e*Math.pow(2,-10*--a)*Math.sin(2*(a*d-g)*Math.PI/f)*.5+c+b};Interpolation.bounceEaseIn=function(a,b,c,d){return c-Interpolation.bounceEaseOut(d-a,0,c,d)+b};
Interpolation.bounceEaseOut=function(a,b,c,d){return(a/=d)<1/2.75?7.5625*c*a*a+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b};Interpolation.bounceEaseInOut=function(a,b,c,d){return a<d/2?.5*Interpolation.bounceEaseIn(2*a,0,c,d)+b:.5*Interpolation.bounceEaseOut(2*a-d,0,c,d)+.5*c+b};Interpolation.regularEaseIn=function(a,b,c,d){return c*(a/=d)*a+b};
Interpolation.regularEaseOut=function(a,b,c,d){return-c*(a/=d)*(a-2)+b};Interpolation.regularEaseInOut=function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b};Interpolation.strongEaseIn=function(a,b,c,d){return c*(a/=d)*a*a*a*a+b};Interpolation.strongEaseOut=function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b};Interpolation.strongEaseInOut=function(a,b,c,d){return 1>(a/=d/2)?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b};
document.children||Object.defineProperty(Node.prototype,"children",{get:function(){for(var a=[],b=0;b<this.childNodes.length;b++)console.log(this.childNodes[b].nodeType),1==this.childNodes[b].nodeType&&a.push(this.childNodes[b]);return a},enumerable:!1});Extends(FileSystem_treeView,TreeView);
function FileSystem_treeView(a){FileSystem_treeView.superConstructor.call(this);this.appRef=a.appRef;this.loadingState=this.parentElement.querySelector(".progress_icon");this.fullPathDisplay=this.parentElement.querySelector(".full-path-display");this.service=null;this.enableNodeDrop=this.enableNodeDrag=!0;this.data={};this.uploadQueue=[]}_=FileSystem_treeView.prototype;_.selectNode=function(a){FileSystem_treeView.superClass.selectNode.call(this,a);this.fullPathDisplay.innerHTML=a.data.fullPath};
_.deselectAllNodes=function(){FileSystem_treeView.superClass.deselectAllNodes.call(this);this.fullPathDisplay.innerHTML=this.data.fullPath};_.expandNode=function(a){a.data.isDirectory&&(console.log("expandNode",a.data),a.classList.add(this.expandedNodeClassName),this.loadNodeContent(a))};_.loadNodeContent=function(a){};_.refreshNodeContent=function(a){a?this.expandNode(a):this.loadNodeContent()};_.chooseRootDir=function(){};
_.drawNodeContent=function(a){if(a){var b=this.getNodeElement_ul(a);a=a.data}else b=this,a=this.data;this.fullPathDisplay.innerHTML=a.fullPath;b.innerHTML="";if(a.items){for(var c,d,e=0;e<a.items.length;e++)c=a.items[e],c.parent=a,c.isDirectory?(d=this.createTreeViewNode("dir_icon16x16",c.name,c.fullPath,!0),d.setAttribute("itemType","dir")):(c.fileExtension=PathInfo(c.name).fileExtension,d=this.createTreeViewNode(c.fileExtension+"_icon16x16",c.name,c.fullPath,!1),d.setAttribute("itemType",c.fileExtension)),
d.data=c,b.appendChild(d),this.onNodeAdded(d);this.hideLoadingState()}};_.onDoubleClickOnNodeName=function(a){a=a.target.parentNode;if(a.data.isDirectory)this.expandOrCollapseNode(a);else this.onDoubleClickOnDocument(a.data)};_.onDoubleClickOnDocument=function(a){};
_.canOpenDocument=function(a){var b=PathInfo(a.name).fileExtension;if("svg"==b||"htm"==b||"html"==b||"php"==b)return(a=this.appRef.DOCUMENTS.getDocumentByFullPath(a.fullPath))?(this.appRef.DOCUMENTS.showView(a.parentNode),!1):!0;"jpg"==b||"jpeg"==b||"png"==b||"gif"==b?this.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Images Tip"),LOCALIZER.translate("Drag the image and drop it on the document.")):this.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Unsupported file type"),LOCALIZER.translate("You can open only: svg and html files."));
return!1};_.onEndEditNodeName=function(a){var b=a.parentElement.parentElement;console.log("onEndEditNodeName element_li",b);if("LI"==b.nodeName){var c=a.value;console.log("element_input.value",a.value);console.log("element_input.parentElement",a.parentElement);c.isValidFileName()?(console.log("element_li.data.name",b.data.name),this.renameFile(c,b)):(a.value=b.data.name,console.log("file name non valido"),console.log("ripristino il nome con:",b.data.name))}this.enableDraggableNodes()};
_.onDragOverNode=function(a){var b=a.target.getElementOrParentElementByAttribute("itemType","dir");if(b){var c=GetTransferData();c?0==b.data.fullPath.indexOf(c.data.fullPath)?(console.log("non \u00e8 possibile inserire questa cartella qui!"),b.classList.add(this.dropNotAllowed)):b.classList.add(this.dragOverNodeClassName):b.classList.add(this.dragOverNodeClassName)}a.stopPropagation();a.preventDefault()};
_.onDragLeaveNode=function(a){if(a=a.target.getElementOrParentElementByAttribute("itemType","dir"))a.classList.remove(this.dragOverNodeClassName),a.classList.remove(this.dropNotAllowed)};_.onDragStartNode=function(a){GMOUSE.resetState();var b=GetRelativeFilePathFromBaseFilePath(this.appRef.editor2D.activeDocument.fullPath,a.target.data.fullPath);a.dataTransfer.setData("text/plain",b);SetTransferData(a.target);a.stopPropagation()};
_.onDropOnNode=function(a){a.stopPropagation();a.preventDefault();this.onDragLeaveNode(a);var b=GetTransferData();console.log("transferData",b);if(b)this.onDropFileSystemNode(a),SetTransferData(null);else if(0<a.dataTransfer.files.length)this.onDropFiles(a)};
_.onDropFileSystemNode=function(a){var b=GetTransferData();a=a.target.getElementOrParentElementByAttribute("itemType","dir");console.log("source_element_li",b);console.log("target_element_li",a);var c=b.getAttribute("itemType"),d=b.data.parent.fullPath;if(a)var e=a.data.fullPath;else console.log("la dir target sar\u00e0 la root"),e=this.fullPath,a=this;console.log("dirSourceFullPath",d);console.log("dirTargetFullPath",e);if(e==d)console.log("gli elementi sono contenuti dentro lo stesso parent");else if("dir"!=
c||0!=e.indexOf(b.data.fullPath))console.log("sposter\u00f2 il file"),this.moveFile(b,a)};_.onDropFiles=function(a){var b=a.target.getElementOrParentElementByAttribute("itemType","dir");a=a.dataTransfer.files;if(0<a.length){for(var c=0,d;d=a[c];c++)d.targetDir_element=b,this.uploadQueue.push(d);this.uploadFiles()}};_.uploadFiles=function(a){};_.createDir=function(a){};_.renameFile=function(a,b){};
_.onFileRenamed=function(a){var b=a.data.fullPath,c=a.querySelector("div").textContent,d=a.data.fullPath.split("/");d.pop();d=d.join("/")+"/"+c;a.data.name=c;a.data.fullPath=d;console.log("element_li.data",a.data);if(a.data.isDirectory)a.classList.contains("expanded")&&this.refreshNodeContent(a);else if(a.data.fileExtension=c.split(".").pop(),a=this.appRef.DOCUMENTS.getDocumentByFullPath(b))a.fullPath=d,this.appRef.DOCUMENTS.updateViewTab(a.parentNode)};_.moveFile=function(a,b){};
_.onFileMoved=function(a,b){var c=a.data.fullPath;console.log("onFileMoved _source_element_li",a);console.log("onFileMoved _target_element_li",b);if(b==this)this.refreshNodeContent(null);else if(a.remove(),this.selectNode(b),b.classList.contains("expanded")&&this.refreshNodeContent(b),!a.data.isDirectory){var d=b.data.fullPath;var e=c.split("/").pop();if(c=this.appRef.DOCUMENTS.getDocumentByFullPath(c))c.fullPath=d+"/"+e,this.appRef.DOCUMENTS.updateViewTab(c.parent)}};_.removeFile=function(){};
function WindowMessageBridge(a){this.appRef=a;this.callbackFunctions={};this.__window=null;this.__origin="*";this.idCall=0;var b=this;window.addEventListener("message",function(a){b.onReceiveMessage(a)})}_=WindowMessageBridge.prototype;_.sendMessage=function(a){this.__window.postMessage(a,this.__origin);console.log("Sent message:",a)};_.call=function(a,b,c){this.idCall++;var d=a+"_callback_"+this.idCall;this.callbackFunctions[d]=c;this.sendMessage({method:a,data:b,callbackFunctionName:d})};
_.callback=function(a,b){this.sendMessage({callbackFunctionName:a,data:b})};
_.onReceiveMessage=function(a){this.__window=a.source;this.__origin=a.origin;console.log(" _e.source:",a.source);console.log(" _e.origin:",a.origin);console.log("Received message:",a);a.data&&(a.data.method?(console.log("App method: "+a.data.method),this.appRef[a.data.method](a.data)):a.data.callbackFunctionName&&(console.log("CallbackFunctionName "+a.data.callbackFunctionName),this.callbackFunctions[a.data.callbackFunctionName](a.data),delete this.callbackFunctions[a.data.callbackFunctionName]))};
var GoogleAuth;function onLoadGAPI(){gapi.load("client:auth2",initGoogleAuth)}function initGoogleAuth(a){console.log("initGoogleAuth");gapi.client.init({discoveryDocs:[DISCOVERY_URL],clientId:CLIENT_ID,scope:SCOPE}).then(function(){GoogleAuth=gapi.auth2.getAuthInstance();a&&GoogleAuth.isSignedIn.listen(a);updateSigninStatus()})}function isGoogleUserSignedIn(){return GoogleAuth?GoogleAuth.currentUser.get().hasGrantedScopes(SCOPE):!1}
function googleUserSignIn(a){GoogleAuth.isSignedIn.listen(a);GoogleAuth.signIn()}function googleUserSignOut(a){isGoogleUserSignedIn()&&GoogleAuth.signOut().then(a)}function refreshGoogleUserToken(a){console.log("refreshGoogleUserToken");GoogleAuth.isSignedIn.listen(a);GoogleAuth.currentUser.get().reloadAuthResponse().then(a,function(){alert("error")})}
function isGoogleUserTokenExpired(){var a=GoogleAuth.currentUser.get().getAuthResponse(),b=(new Date).getTime();console.log("isGoogleUserTokenExpired",b>a.expires_at);return b>a.expires_at?!0:!1}function updateSigninStatus(){isGoogleUserSignedIn()?console.log("You are currently signed in and have granted access to this app."):console.log("You have not authorized this app or you are signed out.")}
function whenGoogleUserWillBeAuthorizedCall(a){function b(b){console.log("onUserSignInResponse",b);a()}function c(b){console.log("onRefreshTokenResponse",b);a()}isGoogleUserSignedIn()?isGoogleUserTokenExpired()?refreshGoogleUserToken(c):a():googleUserSignIn(b)}function GDriveFileSystem_service(){}_=GDriveFileSystem_service.prototype;
_.getDirContent=function(a,b,c){function d(a,b){return a.name<b.name?-1:a.name>b.name?1:0}function e(c){c=c.result.files;a.items=c;for(var e=0;e<c.length;e++){var f=c[e];f.parent=a;f.fullPath=a.fullPath+"/"+f.name;"application/vnd.google-apps.folder"==f.mimeType&&(f.isDirectory=!0)}c.sort(d);b(a)}function f(a){console.error("Error: Dir content not available!",a);c&&c(a)}whenGoogleUserWillBeAuthorizedCall(function(){var b="'"+a.id+"' in parents and trashed = false";"sharedWithMe"==a.id&&(b="sharedWithMe");
gapi.client.drive.files.list({pageSize:1E3,fields:"nextPageToken, files(id,name,mimeType,modifiedTime,size,parents,iconLink,thumbnailLink,webContentLink,webViewLink)",q:b}).then(e,f)})};
_.getFileContent=function(a,b,c,d){whenGoogleUserWillBeAuthorizedCall(function(){var e=GoogleAuth.currentUser.get().getAuthResponse().access_token,f=new XMLHttpRequest;f.open("GET","https://www.googleapis.com/drive/v3/files/"+a.id+"?alt=media",!0);f.setRequestHeader("Authorization","Bearer "+e);f.onload=function(a){b(a)};f.onerror=function(a){console.error("Error: File content not available!",a);c&&c(a)};if(d){var g={target:f,total:a.size,loaded:0,lengthComputable:!0};f.onprogress=function(a){g.loaded=
a.loaded;console.log("progressEvent",g);d(g)}}f.send()})};_.createDir=function(a,b,c,d){function e(a){c(a)}function f(a){console.error("Error: Dir not created!",a);d&&d(a)}whenGoogleUserWillBeAuthorizedCall(function(){gapi.client.drive.files.create({resource:{name:a,mimeType:"application/vnd.google-apps.folder",parents:[b]},fields:"id"}).then(e,f)})};
_.renameFile=function(a,b,c,d){function e(a){c(a)}function f(a){console.error("Error: File not renamed!",a);d&&d(a)}whenGoogleUserWillBeAuthorizedCall(function(){gapi.client.drive.files.update({resource:{name:b},fileId:a}).then(e,f)})};
_.moveFile=function(a,b,c,d){function e(a){c(a)}function f(a){console.error("Error: File not moved!",a);d&&d(a)}whenGoogleUserWillBeAuthorizedCall(function(){gapi.client.drive.files.update({fileId:a.id,addParents:b.id,removeParents:a.parent.id,fields:"id, parents"}).then(e,f)})};
_.deleteFile=function(a,b,c){function d(a){b(a)}function e(a){console.error("Error: File not deleted!",a);c&&c(a)}whenGoogleUserWillBeAuthorizedCall(function(){gapi.client.drive.files["delete"]({fileId:a.id,fields:"id"}).then(d,e)})};
_.getFileInFolder=function(a,b,c,d){function e(a){c(a)}function f(a){console.error("Error: on check for file in folder !",a);d&&d(a)}whenGoogleUserWillBeAuthorizedCall(function(){gapi.client.drive.files.list({pageSize:1,fields:"files(id,name,mimeType,modifiedTime,size,parents)",q:"'"+b+"' in parents and name = '"+a+"' and trashed = false"}).then(e,f)})};
_.updateFileContent=function(a,b,c,d,e,f,g){function k(){var g=GoogleAuth.currentUser.get().getAuthResponse().access_token,k=new XMLHttpRequest;k.responseType="json";k.onreadystatechange=function(){k.readyState!=XMLHttpRequest.DONE?console.log("onreadystatechange",k):!k.response||k.response.error?e(k):d(k.response)};k.open("PATCH","https://www.googleapis.com/upload/drive/v3/files/"+a+"?uploadType=media");k.setRequestHeader("Authorization","Bearer "+g);k.setRequestHeader("Content-Type",b);k.upload.addEventListener("progress",
function(a){f(a)},!1);k.send(c)}g?whenGoogleUserWillBeAuthorizedCall(function(){ValidateUserAccount(k)}):whenGoogleUserWillBeAuthorizedCall(k)};_.createFile=function(a,b,c,d,e,f){function g(){gapi.client.drive.files.create({name:c,parents:[a],mimeType:b}).then(function(a){console.log("createFile onSuccess",a);d(a)},function(a){e&&e(a)})}a=a||"root";f?whenGoogleUserWillBeAuthorizedCall(function(){ValidateUserAccount(g)}):whenGoogleUserWillBeAuthorizedCall(g)};Extends(GDriveFileSystem_treeView,FileSystem_treeView);
function GDriveFileSystem_treeView(a){GDriveFileSystem_treeView.superConstructor.call(this,a);this.service=GDRIVE_SERVICE;this.data.id="root";this.data.fullPath="gdrive"}_=GDriveFileSystem_treeView.prototype;_.setRootDir=function(a,b){this.data.id=a||"root";this.data.fullPath=b||"gdrive";this.loadNodeContent()};_.getSelectedDirNode=function(){var a=null;1==this.selectedNodes.length&&(a=this.selectedNodes[0],a.data.isDirectory||(a=a.getParentElementByAttribute("itemType","dir")));return a};
_.loadNodeContent=function(a,b){var c=this;GDRIVE_SERVICE.getDirContent(a?a.data:this.data,function(d){c.hideLoadingState();c.drawNodeContent(a);b&&b(d)});this.showLoadingState()};
_.drawNodeContent=function(a){if(a){var b=this.getNodeElement_ul(a);a=a.data}else b=this,a=this.data;this.fullPathDisplay.innerHTML=a.fullPath;b.innerHTML="";if(a.items){for(var c,d,e=0;e<a.items.length;e++){c=a.items[e];c.parent=a;if(c.isDirectory)d=this.createTreeViewNode("dir_icon16x16",c.name,c.fullPath,!0),d.setAttribute("itemType","dir");else if(c.fileExtension=PathInfo(c.name).fileExtension,d=this.createTreeViewNode(c.fileExtension+"_icon16x16",c.name,c.fullPath,!1),d.setAttribute("itemType",
c.fileExtension),c.thumbnailLink){var f=document.createElement("div");f.classList.add("thumbnail");d.appendChild(f);var g=document.createElement("img");g.setAttribute("src",c.thumbnailLink);f.appendChild(g)}d.data=c;b.appendChild(d);this.onNodeAdded(d)}this.hideLoadingState()}};
_.onDoubleClickOnDocument=function(a){if(this.canOpenDocument(a)){var b=this,c=this.appRef.PROGRESS_PANEL;c.setProgressBarValue(1);c.open(!0);GDRIVE_SERVICE.getFileContent(a,function(d){-1<a.name.indexOf("template")?b.appRef.createDocument(null,d.target.responseText,{parsePageSettings:!0,renameReferences:!0}):b.appRef.createDocument(a.fullPath,d.target.responseText).idFile=a.id;c.close()},function(c){b.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("An error occured during loading file")+
": "+a.name)},function(a){console.log("loading total: "+a.total+"   loaded: "+a.loaded);c.setProgressValues(a.total,a.loaded)})}};
_.createDir=function(a){function b(){var a="new directory";0<GDRIVE_SERVICE.requestCounter&&(a+=" "+GDRIVE_SERVICE.requestCounter);return a}function c(){l.hideLoadingState();l.refreshNodeContent(g)}function d(){l.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The directory was not created, the server has generated an error."));l.hideLoadingState()}function e(a){0<a.result.files.length?(GDRIVE_SERVICE.requestCounter++,f()):GDRIVE_SERVICE.createDir(b(),k.id,c,d)}function f(){10<
GDRIVE_SERVICE.requestCounter||GDRIVE_SERVICE.getFileInFolder(b(),k.id,e)}var g=this.getSelectedDirNode(),k=this.data;g&&(k=g.data);var l=this;GDRIVE_SERVICE.requestCounter=0;f();l.showLoadingState()};
_.renameFile=function(a,b){function c(a){e.hideLoadingState();e.onFileRenamed(b)}function d(){b.querySelector("div").innerHTML=f;e.hideLoadingState();e.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("An error occurred during the rename file operation."))}var e=this,f=b.data.name,g=b.data.parent;GDRIVE_SERVICE.getFileInFolder(a,g.id,function(k){0<k.result.files.length?(e.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The folder")+' "'+g.name+'" '+
LOCALIZER.translate("already contains a file named")+": "+a),b.querySelector("div").innerHTML=f,e.hideLoadingState()):GDRIVE_SERVICE.renameFile(b.data.id,a,c,d)});this.showLoadingState()};
_.moveFile=function(a,b){function c(c){e.hideLoadingState();e.onFileMoved(a,b)}function d(){e.hideLoadingState();e.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("An error occurred during the move file operation."))}var e=this;GDRIVE_SERVICE.getFileInFolder(a.data.name,b.data.id,function(f){0<f.result.files.length?(e.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The folder")+' "'+b.data.name+'" '+LOCALIZER.translate("already contains a file named")+
' "'+a.data.name+'"'),e.hideLoadingState()):GDRIVE_SERVICE.moveFile(a.data,b.data,c,d)});this.showLoadingState()};
_.removeFile=function(){if(0!=this.selectedNodes.length){var a=this.selectedNodes[0],b=this;this.appRef.CONFIRM_DIALOG.open("Remove file","Are you sure want to remove the file/folder: "+a.data.fullPath,function(){GDRIVE_SERVICE.deleteFile(a.data,function(c){console.log("onRemoveFile",c);b.hideLoadingState();a.remove()},function(){b.hideLoadingState();b.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("An error occurred during the remove file operation."))});b.showLoadingState()})}};
_.uploadFiles=function(a){function b(){f.appRef.PROGRESS_PANEL.endVirtualProgress();f.appRef.CONFIRM_DIALOG.open("Error!",'An error occured during the upload of file named "'+h+'".\nDo you want to continue?',function(){f.uploadFiles()})}function c(){f.appRef.PROGRESS_PANEL.endVirtualProgress();f.refreshNodeContent(g.targetDir_element);f.uploadFiles()}function d(a){f.appRef.PROGRESS_PANEL.onLoadingProgress(a)}function e(a){var e=new FileReader;e.readAsArrayBuffer(g);e.onload=function(m){var n=g.type||
"application/octet-stream",p=new Blob([e.result],{type:n});console.log("fileToUpload",g);a?f.service.updateFileContent(a,n,p,c,b,d):f.service.createFile(k,n,h,function(a){console.log("onFileCreateSuccess",a);f.service.updateFileContent(a.result.id,n,p,c,b,d)})}}if(0!=this.uploadQueue.length){this.appRef.PROGRESS_PANEL.open(!0);this.appRef.PROGRESS_PANEL.setProgressBarValue(1,100);var f=this,g=this.uploadQueue.pop(),k=g.targetDir_element.data.id,l=g.targetDir_element.data.name,h=g.name;console.log("fileToUpload",
g);this.service.getFileInFolder(h,k,function(a){0<a.result.files.length?a.result.files[0].isDirectory?(f.appRef.PROGRESS_PANEL.close(),f.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Alert"),LOCALIZER.translate("A folder named")+": "+l+" "+LOCALIZER.translate("can't be replaced with the file")+": "+h)):f.appRef.CONFIRM_DIALOG.open(LOCALIZER.translate("File exists"),LOCALIZER.translate("The folder")+' "'+l+'" '+LOCALIZER.translate("already contains a file named")+' "'+h+'".\n'+LOCALIZER.translate("Do you want to replace it?"),
function(){e(a.result.files[0].id)}):e()})}};Extends(GDriveFileSystem_panel,Panel);function GDriveFileSystem_panel(a){GDriveFileSystem_panel.superConstructor.call(this,a);this.treeView=this.querySelector(".treeView").connectController(GDriveFileSystem_treeView,a);this.connectEvents()}_=GDriveFileSystem_panel.prototype;_.onClick_loadGDriveDir=function(){this.treeView.setRootDir("root","gdrive")};_.onClick_loadSharedWithMe=function(){this.treeView.setRootDir("sharedWithMe","sharedWithMe")};
_.onOpen=function(){0==this.treeView.childNodes.length&&this.treeView.loadNodeContent()};_.onExpand=function(){};_.onClick_reload=function(a){this.treeView.reloadSelectedNode(a)};_.onClick_chooseRootDir=function(a){0==this.treeView.selectedNodes.length?this.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Alert"),LOCALIZER.translate("Select the folder that you want as root.")):(a=this.treeView.selectedNodes[0],this.treeView.setRootDir(a.data.id,a.data.fullPath))};
_.onClick_createDir=function(a){console.log("onClick_createDir");this.treeView.createDir(a)};_.onClick_removeSelectedFile=function(a){this.treeView.removeFile(a)};_.onClick_renameSelectedFile=function(a){this.treeView.editSelectedNodeName(a)};_.onClick_logout=function(a){var b=this;googleUserSignOut(function(){b.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Logout"),LOCALIZER.translate("You are signed out from Google Drive."))})};Extends(GDriveFileSystemSave_panel,Panel);
function GDriveFileSystemSave_panel(a){GDriveFileSystemSave_panel.superConstructor.call(this,a);this.loadingState=this.querySelector(".progress_icon");this.fileListDisplay=this.querySelector(".file-list");this.fullPathDisplay=this.querySelector(".full-path-display");this.fileNameInputField=this.querySelector(".file-name-display input");this.connectEvents();this.validFileExtensionList=this.onClickOkCallback=null;this.service=GDRIVE_SERVICE;this.data={};this.data.id="root";this.data.fullPath="gdrive";
this.currentDirData=this.data;ConnectEvent("mousedown",this.fileListDisplay,this.onMouseDownOnFileList,this)}_=GDriveFileSystemSave_panel.prototype;_.showLoadingState=function(){this.loadingState&&this.loadingState.classList.remove("hidden")};_.hideLoadingState=function(){this.loadingState&&this.loadingState.classList.add("hidden")};_.onClick_save=function(a){if(this.onClickOkCallback)this.onClickOkCallback()};
_.onClick_cancel=function(a){if(this.onClickCancelCallback)this.onClickCancelCallback();this.close()};_.onClick_gotoParentDir=function(a){this.currentDirData.parent&&this.loadDirContent(this.currentDirData.parent)};_.onChange_fileNameInputField=function(a){this.fileNameInputField.value=this.validateFileExtension(this.fileNameInputField.value)};_.getTargetFileFullPath=function(a){return this.currentDirData.fullPath+"/"+this.fileNameInputField.value};
_.onMouseDownOnFileList=function(a){a.target.data&&(a.target.data.isDirectory?this.loadDirContent(a.target.data):this.fileNameInputField.value=a.target.data.name)};_.validateFileExtension=function(a){a=PathInfo(a);console.log("PathInfo",a);if(""==a.fileExtension||-1==this.validFileExtensionList.indexOf(a.fileExtension))a.fileExtension=this.validFileExtensionList[0];return a.fileNameNoExtension+"."+a.fileExtension};
_.loadDirContent=function(a){var b=this;GDRIVE_SERVICE.getDirContent(a,function(a){b.hideLoadingState();b.drawDirContent(a)});this.showLoadingState()};
_.drawDirContent=function(a){this.currentDirData=a;this.fullPathDisplay.innerHTML=this.currentDirData.fullPath;this.fileListDisplay.innerHTML="";if(a.items)for(var b,c,d=0;d<a.items.length;d++)b=a.items[d],b.isDirectory?(c=this.createFileItem("dir_icon16x16",b.name,b.fullPath,!0),c.setAttribute("itemType","dir")):(b.fileExtension=PathInfo(b.name).fileExtension,c=this.createFileItem(b.fileExtension+"_icon16x16",b.name,b.fullPath,!1),c.setAttribute("itemType",b.fileExtension)),c.data=b,this.fileListDisplay.appendChild(c)};
_.createFileItem=function(a,b,c){var d=document.createElement("li");c&&d.setAttribute("title",c);c=document.createElement("div");-1<a.indexOf(".jpg")?c.setAttribute("style",'background-image: url("'+a+'"); background-size: 24px;'):c.className=a;c.appendChild(document.createTextNode(b));d.appendChild(c);return d};
_.open=function(a,b,c,d,e){GDriveFileSystemSave_panel.superClass.open.call(this,!0);this.validFileExtensionList=c;this.fullPath=a||"root";this.fileNameInputField.value=this.validateFileExtension(b);this.onClickOkCallback=d;this.onClickCancelCallback=e;this.loadDirContent(this.currentDirData)};
SVGPathElement.prototype.getPathData&&SVGPathElement.prototype.setPathData||function(){var a={Z:"Z",M:"M",L:"L",C:"C",Q:"Q",A:"A",H:"H",V:"V",S:"S",T:"T",z:"Z",m:"m",l:"l",c:"c",q:"q",a:"a",h:"h",v:"v",s:"s",t:"t"},b=function(a){this._string=a;this._currentIndex=0;this._endIndex=this._string.length;this._prevCommand=null;this._skipOptionalSpaces()},c=-1!==window.navigator.userAgent.indexOf("MSIE ");b.prototype={parseSegment:function(){var b=this._string[this._currentIndex],c=a[b]?a[b]:null;if(null===
c){if(null===this._prevCommand)return null;c=("+"===b||"-"===b||"."===b||"0"<=b&&"9">=b)&&"Z"!==this._prevCommand?"M"===this._prevCommand?"L":"m"===this._prevCommand?"l":this._prevCommand:null;if(null===c)return null}else this._currentIndex+=1;this._prevCommand=c;b=null;var d=c.toUpperCase();"H"===d||"V"===d?b=[this._parseNumber()]:"M"===d||"L"===d||"T"===d?b=[this._parseNumber(),this._parseNumber()]:"S"===d||"Q"===d?b=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber()]:
"C"===d?b=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseNumber()]:"A"===d?b=[this._parseNumber(),this._parseNumber(),this._parseNumber(),this._parseArcFlag(),this._parseArcFlag(),this._parseNumber(),this._parseNumber()]:"Z"===d&&(this._skipOptionalSpaces(),b=[]);return null===b||0<=b.indexOf(null)?null:new SVGPathSegment(c,b)},hasMoreData:function(){return this._currentIndex<this._endIndex},peekSegmentType:function(){var b=this._string[this._currentIndex];
return a[b]?a[b]:null},initialCommandIsMoveTo:function(){if(!this.hasMoreData())return!0;var a=this.peekSegmentType();return"M"===a||"m"===a},_isCurrentSpace:function(){var a=this._string[this._currentIndex];return" ">=a&&(" "===a||"\n"===a||"\t"===a||"\r"===a||"\f"===a)},_skipOptionalSpaces:function(){for(;this._currentIndex<this._endIndex&&this._isCurrentSpace();)this._currentIndex+=1;return this._currentIndex<this._endIndex},_skipOptionalSpacesOrDelimiter:function(){if(this._currentIndex<this._endIndex&&
!this._isCurrentSpace()&&","!==this._string[this._currentIndex])return!1;this._skipOptionalSpaces()&&this._currentIndex<this._endIndex&&","===this._string[this._currentIndex]&&(this._currentIndex+=1,this._skipOptionalSpaces());return this._currentIndex<this._endIndex},_parseNumber:function(){var a=0,b=0,c=1,d=0,e=1,f=1,g=this._currentIndex;this._skipOptionalSpaces();this._currentIndex<this._endIndex&&"+"===this._string[this._currentIndex]?this._currentIndex+=1:this._currentIndex<this._endIndex&&"-"===
this._string[this._currentIndex]&&(this._currentIndex+=1,e=-1);if(this._currentIndex===this._endIndex||("0">this._string[this._currentIndex]||"9"<this._string[this._currentIndex])&&"."!==this._string[this._currentIndex])return null;for(var m=this._currentIndex;this._currentIndex<this._endIndex&&"0"<=this._string[this._currentIndex]&&"9">=this._string[this._currentIndex];)this._currentIndex+=1;if(this._currentIndex!==m)for(var k=this._currentIndex-1,h=1;k>=m;)b+=h*(this._string[k]-0),--k,h*=10;if(this._currentIndex<
this._endIndex&&"."===this._string[this._currentIndex]){this._currentIndex+=1;if(this._currentIndex>=this._endIndex||"0">this._string[this._currentIndex]||"9"<this._string[this._currentIndex])return null;for(;this._currentIndex<this._endIndex&&"0"<=this._string[this._currentIndex]&&"9">=this._string[this._currentIndex];)c*=10,d+=(this._string.charAt(this._currentIndex)-0)/c,this._currentIndex+=1}if(this._currentIndex!==g&&this._currentIndex+1<this._endIndex&&("e"===this._string[this._currentIndex]||
"E"===this._string[this._currentIndex])&&"x"!==this._string[this._currentIndex+1]&&"m"!==this._string[this._currentIndex+1]){this._currentIndex+=1;"+"===this._string[this._currentIndex]?this._currentIndex+=1:"-"===this._string[this._currentIndex]&&(this._currentIndex+=1,f=-1);if(this._currentIndex>=this._endIndex||"0">this._string[this._currentIndex]||"9"<this._string[this._currentIndex])return null;for(;this._currentIndex<this._endIndex&&"0"<=this._string[this._currentIndex]&&"9">=this._string[this._currentIndex];)a*=
10,a+=this._string[this._currentIndex]-0,this._currentIndex+=1}b=(b+d)*e;a&&(b*=Math.pow(10,f*a));if(g===this._currentIndex)return null;this._skipOptionalSpacesOrDelimiter();return b},_parseArcFlag:function(){if(this._currentIndex>=this._endIndex)return null;var a=this._string[this._currentIndex];this._currentIndex+=1;if("0"===a)a=0;else if("1"===a)a=1;else return null;this._skipOptionalSpacesOrDelimiter();return a}};var d=function(a){if(!a||0===a.length)return[];a=new b(a);var c=[];if(a.initialCommandIsMoveTo())for(;a.hasMoreData();){var d=
a.parseSegment();if(null===d)break;else c.push(d)}return c},e=SVGPathElement.prototype.setAttribute,f=SVGPathElement.prototype.removeAttribute;$jscomp.initSymbol();var g=window.Symbol?Symbol():"__cachedPathData";$jscomp.initSymbol();var k=window.Symbol?Symbol():"__cachedNormalizedPathData",l=function(a,b,c,d,e,f,g,m,k,h){var n=function(a,b,c){return{x:a*Math.cos(c)-b*Math.sin(c),y:a*Math.sin(c)+b*Math.cos(c)}},q=Math.PI*g/180,p=[];if(h){var v=h[0];m=h[1];var A=h[2];var y=h[3]}else{b=n(a,b,-q);a=b.x;
b=b.y;d=n(c,d,-q);c=d.x;d=d.y;v=(a-c)/2;A=(b-d)/2;y=v*v/(e*e)+A*A/(f*f);1<y&&(y=Math.sqrt(y),e*=y,f*=y);y=e*e;var F=f*f;m=(m===k?-1:1)*Math.sqrt(Math.abs((y*F-y*A*A-F*v*v)/(y*A*A+F*v*v)));A=m*e*A/f+(a+c)/2;y=m*-f*v/e+(b+d)/2;v=Math.asin(((b-y)/f).toFixed(9));m=Math.asin(((d-y)/f).toFixed(9));a<A&&(v=Math.PI-v);c<A&&(m=Math.PI-m);0>v&&(v=2*Math.PI+v);0>m&&(m=2*Math.PI+m);k&&v>m&&(v-=2*Math.PI);!k&&m>v&&(m-=2*Math.PI)}if(Math.abs(m-v)>120*Math.PI/180){F=m;var r=c,u=d;m=k&&m>v?v+120*Math.PI/180*1:v+
120*Math.PI/180*-1;c=A+e*Math.cos(m);d=y+f*Math.sin(m);p=l(c,d,r,u,e,f,g,0,k,[m,F,A,y])}g=Math.tan((m-v)/4);e=4/3*e*g;g*=4/3*f;f=[a,b];a=[a+e*Math.sin(v),b-g*Math.cos(v)];b=[c+e*Math.sin(m),d-g*Math.cos(m)];c=[c,d];a[0]=2*f[0]-a[0];a[1]=2*f[1]-a[1];if(h)return[a,b,c].concat(p);p=[a,b,c].concat(p).join().split(",");var B=[],U=[];p.forEach(function(a,b){b%2?U.push(n(p[b-1],p[b],q).y):U.push(n(p[b],p[b+1],q).x);6===U.length&&(B.push(U),U=[])});return B},h=function(a){var b=[],c=null,d=null,e=null,f=
null;a.forEach(function(a){var m=a.type;if("M"===m){m=a.values[0];var g=a.values[1];b.push(SVGPathSegment.createSegment("M",[m,g]));e=m;f=g;c=m;d=g}else if("m"===m)m=c+a.values[0],g=d+a.values[1],b.push(SVGPathSegment.createSegment("M",[m,g])),e=m,f=g,c=m,d=g;else if("L"===m)m=a.values[0],g=a.values[1],b.push(SVGPathSegment.createSegment("L",[m,g])),c=m,d=g;else if("l"===m)m=c+a.values[0],g=d+a.values[1],b.push(SVGPathSegment.createSegment("L",[m,g])),c=m,d=g;else if("C"===m){var k=a.values[0],n=
a.values[1],h=a.values[2],q=a.values[3];m=a.values[4];g=a.values[5];b.push(SVGPathSegment.createSegment("C",[k,n,h,q,m,g]));c=m;d=g}else if("c"===m)k=c+a.values[0],n=d+a.values[1],h=c+a.values[2],q=d+a.values[3],m=c+a.values[4],g=d+a.values[5],b.push(SVGPathSegment.createSegment("C",[k,n,h,q,m,g])),c=m,d=g;else if("Q"===m)k=a.values[0],n=a.values[1],m=a.values[2],g=a.values[3],b.push(SVGPathSegment.createSegment("Q",[k,n,m,g])),c=m,d=g;else if("q"===m)k=c+a.values[0],n=d+a.values[1],m=c+a.values[2],
g=d+a.values[3],b.push(SVGPathSegment.createSegment("Q",[k,n,m,g])),c=m,d=g;else if("A"===m)m=a.values[5],g=a.values[6],b.push(SVGPathSegment.createSegment("A",[a.values[0],a.values[1],a.values[2],a.values[3],a.values[4],m,g])),c=m,d=g;else if("a"===m)m=c+a.values[5],g=d+a.values[6],b.push(SVGPathSegment.createSegment("A",[a.values[0],a.values[1],a.values[2],a.values[3],a.values[4],m,g])),c=m,d=g;else if("H"===m)m=a.values[0],b.push(SVGPathSegment.createSegment("H",[m])),c=m;else if("h"===m)m=c+a.values[0],
b.push(SVGPathSegment.createSegment("H",[m])),c=m;else if("V"===m)g=a.values[0],b.push(SVGPathSegment.createSegment("V",[g])),d=g;else if("v"===m)g=d+a.values[0],b.push(SVGPathSegment.createSegment("V",[g])),d=g;else if("S"===m)h=a.values[0],q=a.values[1],m=a.values[2],g=a.values[3],b.push(SVGPathSegment.createSegment("S",[h,q,m,g])),c=m,d=g;else if("s"===m)h=c+a.values[0],q=d+a.values[1],m=c+a.values[2],g=d+a.values[3],b.push(SVGPathSegment.createSegment("S",[h,q,m,g])),c=m,d=g;else if("T"===m)m=
a.values[0],g=a.values[1],b.push(SVGPathSegment.createSegment("T",[m,g])),c=m,d=g;else if("t"===m)m=c+a.values[0],g=d+a.values[1],b.push(SVGPathSegment.createSegment("T",[m,g])),c=m,d=g;else if("Z"===m||"z"===m)b.push(SVGPathSegment.createSegment("Z",[])),c=e,d=f});return b},m=function(a){var b=[],c=null,d=null,e=null,f=null,m=null,g=null,k=null;a.forEach(function(a){if("M"===a.type){var n=a.values[0],h=a.values[1];b.push(SVGPathSegment.createSegment("M",[n,h]));g=n;k=h;f=n;m=h}else if("C"===a.type){var q=
a.values[0],p=a.values[1],v=a.values[2],A=a.values[3];n=a.values[4];h=a.values[5];b.push(SVGPathSegment.createSegment("C",[q,p,v,A,n,h]));d=v;e=A;f=n;m=h}else if("L"===a.type)n=a.values[0],h=a.values[1],b.push(SVGPathSegment.createSegment("L",[n,h])),f=n,m=h;else if("H"===a.type)n=a.values[0],b.push(SVGPathSegment.createSegment("L",[n,m])),f=n;else if("V"===a.type)h=a.values[0],b.push(SVGPathSegment.createSegment("L",[f,h])),m=h;else if("S"===a.type){v=a.values[0];A=a.values[1];n=a.values[2];h=a.values[3];
if("C"===c||"S"===c){var y=f+(f-d);var r=m+(m-e)}else y=f,r=m;b.push(SVGPathSegment.createSegment("C",[y,r,v,A,n,h]));d=v;e=A;f=n;m=h}else"T"===a.type?(n=a.values[0],h=a.values[1],"Q"===c||"T"===c?(q=f+(f-d),p=m+(m-e)):(q=f,p=m),y=f+2*(q-f)/3,r=m+2*(p-m)/3,b.push(SVGPathSegment.createSegment("C",[y,r,n+2*(q-n)/3,h+2*(p-h)/3,n,h])),d=q,e=p,f=n,m=h):"Q"===a.type?(q=a.values[0],p=a.values[1],n=a.values[2],h=a.values[3],y=f+2*(q-f)/3,r=m+2*(p-m)/3,b.push(SVGPathSegment.createSegment("C",[y,r,n+2*(q-n)/
3,h+2*(p-h)/3,n,h])),d=q,e=p,f=n,m=h):"A"===a.type?(q=a.values[0],p=a.values[1],v=a.values[2],A=a.values[3],y=a.values[4],n=a.values[5],h=a.values[6],0===q||0===p?(b.push(SVGPathSegment.createSegment("C",[f,m,n,h,n,h])),f=n,m=h):f===n&&m===h||l(f,m,n,h,q,p,v,A,y).forEach(function(a){b.push(SVGPathSegment.createSegment("C",a));f=n;m=h})):"Z"===a.type&&(b.push(SVGPathSegment.createSegment("Z",[])),f=g,m=k);c=a.type});return b};SVGPathElement.prototype.setAttribute=function(a,b){e.call(this,a,b)};SVGPathElement.prototype.removeAttribute=
function(a,b){"d"===a&&(this[g]=null,this[k]=null);f.call(this,a)};SVGPathElement.prototype.onChangePathSegment=function(){this.renderRequest()};SVGPathElement.prototype.onChangePathSegmentList=function(){this.renderRequest()};SVGPathElement.prototype.cloneNode=function(a){!0===this.waitForRendering&&this.renderRequest(!0);return this.__cloneNode(a)};SVGPathElement.prototype.getPathData=function(a){var b;if(a&&a.normalize)a=d(this.getAttribute("d")||""),a=m(h(a)),this.setPathData(a);else if(!this[g]){a=
d(this.getAttribute("d")||"");var c=0;for(b=a.length;c<b;c++)a[c].pathOwner=this;this[g]=a}return this[g]};SVGPathElement.prototype.setPathData=function(a){this[g]=a;var b;var c=0;for(b=a.length;c<b;c++)a[c].pathOwner=this;this.drawPathData()};SVGPathElement.prototype.render=function(){this.drawPathData()};SVGPathElement.prototype.drawPathData=function(a){a=a||this[g];if(0===a.length)c?this.setAttribute("d",""):this.removeAttribute("d");else{for(var b="",d=0,e=a.length;d<e;d+=1){var f=a[d];0<d&&(b+=
" ");b+=f.type;f.values&&0<f.values.length&&(b+=" "+f.values.join(" "))}this.setAttribute("d",b)}};SVGRectElement.prototype.getPathData=function(a){var b=this.x.baseVal.value,c=this.y.baseVal.value,d=this.width.baseVal.value,e=this.height.baseVal.value,f;var g=f=this.rx.baseVal.value;f=this.hasAttribute("ry")?this.ry.baseVal.value:this.rx.baseVal.value;g>d/2&&(g=d/2);f>e/2&&(f=e/2);b=[{type:"M",values:[b+g,c]},{type:"H",values:[b+d-g]},{type:"A",values:[g,f,0,0,1,b+d,c+f]},{type:"V",values:[c+e-f]},
{type:"A",values:[g,f,0,0,1,b+d-g,c+e]},{type:"H",values:[b+g]},{type:"A",values:[g,f,0,0,1,b,c+e-f]},{type:"V",values:[c+f]},{type:"A",values:[g,f,0,0,1,b+g,c]},{type:"Z",values:[]}];b=b.filter(function(a){return"A"!==a.type||0!==a.values[0]&&0!==a.values[1]?!0:!1});a&&!0===a.normalize&&(b=m(b));return b};SVGCircleElement.prototype.getPathData=function(a){var b=this.cx.baseVal.value,c=this.cy.baseVal.value,d=this.r.baseVal.value;b=[{type:"M",values:[b+d,c]},{type:"A",values:[d,d,0,0,1,b,c+d]},{type:"A",
values:[d,d,0,0,1,b-d,c]},{type:"A",values:[d,d,0,0,1,b,c-d]},{type:"A",values:[d,d,0,0,1,b+d,c]},{type:"Z",values:[]}];a&&!0===a.normalize&&(b=m(b));return b};SVGEllipseElement.prototype.getPathData=function(a){var b=this.cx.baseVal.value,c=this.cy.baseVal.value,d=this.rx.baseVal.value,e=this.ry.baseVal.value;b=[{type:"M",values:[b+d,c]},{type:"A",values:[d,e,0,0,1,b,c+e]},{type:"A",values:[d,e,0,0,1,b-d,c]},{type:"A",values:[d,e,0,0,1,b,c-e]},{type:"A",values:[d,e,0,0,1,b+d,c]},{type:"Z",values:[]}];
a&&!0===a.normalize&&(b=m(b));return b};SVGLineElement.prototype.getPathData=function(a){var b=[{type:"M",values:[this.x1.baseVal.value,this.y1.baseVal.value]},{type:"L",values:[this.x2.baseVal.value,this.y2.baseVal.value]}];a&&!0===a.normalize&&(b=m(b));return b};SVGPolylineElement.prototype.getPathData=function(){for(var a=[],b=0;b<this.points.numberOfItems;b+=1){var c=this.points.getItem(b);a.push({type:0===b?"M":"L",values:[c.x,c.y]})}return a};SVGPolygonElement.prototype.getPathData=function(){for(var a=
[],b=0;b<this.points.numberOfItems;b+=1){var c=this.points.getItem(b);a.push({type:0===b?"M":"L",values:[c.x,c.y]})}a.push({type:"Z",values:[]});return a}}();Object.defineProperty(SVGPathElement.prototype,"pathSegList",{get:function(){var a=this.getPathData();a.pathOwner=this;a.isSVGPathSegmentSequence||(a=SVGPathSegmentSequence.fromArray(a));return a},set:function(a){a.pathOwner=this;a.isSVGPathSegmentSequence||(a=SVGPathSegmentSequence.fromArray(a));this.setPathData(a)},enumerable:!0});
Object.defineProperty(Array.prototype,"numberOfItems",{get:function(){return this.length}});window.SVGPathSegmentSequence=function(){};
SVGPathSegmentSequence.fromArray=function(a){a.isSVGPathSegmentSequence=!0;a.initialize=SVGPathSegmentSequence.prototype.initialize;a.getItem=SVGPathSegmentSequence.prototype.getItem;a.replaceItem=SVGPathSegmentSequence.prototype.replaceItem;a.appendItem=SVGPathSegmentSequence.prototype.appendItem;a.removeItem=SVGPathSegmentSequence.prototype.removeItem;a.insertItemBefore=SVGPathSegmentSequence.prototype.insertItemBefore;a.onChange=SVGPathSegmentSequence.prototype.onChange;return a};
SVGPathSegmentSequence.prototype.initialize=function(a){this.splice(0,this.length);a&&this.appendItem(a)};SVGPathSegmentSequence.prototype.getItem=function(a){return this[a]};SVGPathSegmentSequence.prototype.replaceItem=function(a,b){a.pathOwner=this.pathOwner;var c=this[b];this.splice(b,1,a);this.onChange();return c};SVGPathSegmentSequence.prototype.appendItem=function(a){a.pathOwner=this.pathOwner;this.push(a);this.onChange();return a};
SVGPathSegmentSequence.prototype.removeItem=function(a){var b=this[a];this.splice(a,1);this.onChange();return b};SVGPathSegmentSequence.prototype.insertItemBefore=function(a,b){a.pathOwner=this.pathOwner;this.splice(b,0,a);this.onChange();return a};SVGPathSegmentSequence.prototype.onChange=function(){this.pathOwner.onChangePathSegmentList()};window.SVGPathSegment||(window.SVGPathSegment=function(a,b){this.type=a||"M";this.values=b||[0,0];this.pathOwner=null});
SVGPathSegment.createSegment=function(a,b){return new SVGPathSegment(a,b)};
Object.defineProperty(SVGPathSegment.prototype,"x",{get:function(){if("M"===this.type||"L"===this.type)return this.values[0];if("Q"===this.type)return this.values[2];if("C"===this.type)return this.values[4];console.error("x is not found")},set:function(a){if("M"===this.type||"L"===this.type)this.values[0]=a;else if("Q"===this.type)this.values[2]=a;else if("C"===this.type)this.values[4]=a;else{console.error("x is not found");return}if(this.pathOwner)this.pathOwner.onChangePathSegment()},enumerable:!0});
Object.defineProperty(SVGPathSegment.prototype,"y",{get:function(){if("M"===this.type||"L"===this.type)return this.values[1];if("Q"===this.type)return this.values[3];if("C"===this.type)return this.values[5];console.error("y is not found")},set:function(a){if("M"===this.type||"L"===this.type)this.values[1]=a;else if("Q"===this.type)this.values[3]=a;else if("C"===this.type)this.values[5]=a;else{console.error("y is not found");return}if(this.pathOwner)this.pathOwner.onChangePathSegment()},enumerable:!0});
Object.defineProperty(SVGPathSegment.prototype,"x1",{get:function(){if("Q"===this.type||"C"===this.type)return this.values[0];console.error("x1 is not found")},set:function(a){if("Q"===this.type||"C"===this.type){if(this.values[0]=a,this.pathOwner)this.pathOwner.onChangePathSegment()}else console.error("x1 is not found")},enumerable:!0});
Object.defineProperty(SVGPathSegment.prototype,"y1",{get:function(){if("Q"===this.type||"C"===this.type)return this.values[1];console.error("y1 is not found")},set:function(a){if("Q"===this.type||"C"===this.type){if(this.values[1]=a,this.pathOwner)this.pathOwner.onChangePathSegment()}else console.error("y1 is not found")},enumerable:!0});
Object.defineProperty(SVGPathSegment.prototype,"x2",{get:function(){if("C"===this.type)return this.values[2];console.error("x2 is not found")},set:function(a){if("C"===this.type){if(this.values[2]=a,this.pathOwner)this.pathOwner.onChangePathSegment()}else console.error("x2 is not found")},enumerable:!0});
Object.defineProperty(SVGPathSegment.prototype,"y2",{get:function(){if("C"===this.type)return this.values[3];console.error("y2 is not found")},set:function(a){if("C"===this.type){if(this.values[3]=a,this.pathOwner)this.pathOwner.onChangePathSegment()}else console.error("y2 is not found")},enumerable:!0});Object.defineProperty(SVGPathSegment.prototype,"pathSegType",{get:function(){return this.type}});SVGPathSeg=SVGPathSegment;SVGPathSeg.PATHSEG_UNKNOWN=0;SVGPathSeg.PATHSEG_CLOSEPATH="Z";
SVGPathSeg.PATHSEG_MOVETO_ABS="M";SVGPathSeg.PATHSEG_MOVETO_REL="m";SVGPathSeg.PATHSEG_LINETO_ABS="L";SVGPathSeg.PATHSEG_LINETO_REL="l";SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS="C";SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL="c";SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS="Q";SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL="q";SVGPathSeg.PATHSEG_ARC_ABS="A";SVGPathSeg.PATHSEG_ARC_REL="a";SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS="H";SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL="h";SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS="V";
SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL="v";SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS="S";SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL="s";SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS="T";SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL="t";SVGPathElement.prototype.createSVGPathSegClosePath=function(){return SVGPathSegment.createSegment("Z",[])};SVGPathElement.prototype.createSVGPathSegMovetoAbs=function(a,b){return SVGPathSegment.createSegment("M",[a,b])};
SVGPathElement.prototype.createSVGPathSegMovetoRel=function(a,b){return SVGPathSegment.createSegment("m",[a,b])};SVGPathElement.prototype.createSVGPathSegLinetoAbs=function(a,b){return SVGPathSegment.createSegment("L",[a,b])};SVGPathElement.prototype.createSVGPathSegLinetoRel=function(a,b){return SVGPathSegment.createSegment("l",[a,b])};SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs=function(a,b,c,d,e,f){return SVGPathSegment.createSegment("C",[c,d,e,f,a,b])};
SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel=function(a,b,c,d,e,f){return SVGPathSegment.createSegment("c",[c,d,e,f,a,b])};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs=function(a,b,c,d){return SVGPathSegment.createSegment("Q",[c,d,a,b])};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel=function(a,b,c,d){return SVGPathSegment.createSegment("q",[c,d,a,b])};
SVGPathElement.prototype.createSVGPathSegArcAbs=function(a,b,c,d,e,f,g){return SVGPathSegment.createSegment("A",[c,d,e,f,g,a,b])};SVGPathElement.prototype.createSVGPathSegArcRel=function(a,b,c,d,e,f,g){return SVGPathSegment.createSegment("a",[c,d,e,f,g,a,b])};SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs=function(a){return SVGPathSegment.createSegment("H",[a])};SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel=function(a){return SVGPathSegment.createSegment("h",[a])};
SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs=function(a){return SVGPathSegment.createSegment("V",[a])};SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel=function(a){return SVGPathSegment.createSegment("v",[a])};SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs=function(a,b,c,d){return SVGPathSegment.createSegment("S",[c,d,a,b])};SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel=function(a,b,c,d){return SVGPathSegment.createSegment("s",[c,d,a,b])};
SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs=function(a,b){return SVGPathSegment.createSegment("T",[a,b])};SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel=function(a,b){return SVGPathSegment.createSegment("t",[a,b])};
(function(a){"object"===typeof exports&&"undefined"!==typeof module?module.exports=a():"function"===typeof define&&define.amd?define([],a):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).DxfParser=a()})(function(){return function e(b,c,d){function f(k,h){if(!c[k]){if(!b[k]){var m="function"==typeof require&&require;if(!h&&m)return m(k,!0);if(g)return g(k,!0);m=Error("Cannot find module '"+k+"'");throw m.code="MODULE_NOT_FOUND",m;}m=c[k]=
{exports:{}};b[k][0].call(m.exports,function(c){var d=b[k][1][c];return f(d?d:c)},m,m.exports,e,b,c,d)}return c[k].exports}for(var g="function"==typeof require&&require,k=0;k<d.length;k++)f(d[k]);return f}({1:[function(b,c,d){c.exports=[0,16711680,16776960,65280,65535,255,16711935,16777215,8421504,12632256,16711680,16744319,13369344,13395558,10027008,10046540,8323072,8339263,4980736,4990502,16727808,16752511,13382400,13401958,10036736,10051404,8331008,8343359,4985600,4992806,16744192,16760703,13395456,
13408614,10046464,10056268,8339200,8347455,4990464,4995366,16760576,16768895,13408512,13415014,10056192,10061132,8347392,8351551,4995328,4997670,16776960,16777087,13421568,13421670,10000384,10000460,8355584,8355647,5000192,5000230,12582656,14679935,10079232,11717734,7510016,8755276,6258432,7307071,3755008,4344870,8388352,12582783,6736896,10079334,5019648,7510092,4161280,6258495,2509824,3755046,4194048,10485631,3394560,8375398,2529280,6264908,2064128,5209919,1264640,3099686,65280,8388479,52224,6736998,
38912,5019724,32512,4161343,19456,2509862,65343,8388511,52275,6737023,38950,5019743,32543,4161359,19475,2509871,65407,8388543,52326,6737049,38988,5019762,32575,4161375,19494,2509881,65471,8388575,52377,6737074,39026,5019781,32607,4161391,19513,2509890,65535,8388607,52428,6737100,39064,5019800,32639,4161407,19532,2509900,49151,8380415,39372,6730444,29336,5014936,24447,4157311,14668,2507340,32767,8372223,26316,6724044,19608,5010072,16255,4153215,9804,2505036,16383,8364031,13260,6717388,9880,5005208,
8063,4149119,4940,2502476,255,8355839,204,6710988,152,5000344,127,4145023,76,2500172,4129023,10452991,3342540,8349388,2490520,6245528,2031743,5193599,1245260,3089996,8323327,12550143,6684876,10053324,4980888,7490712,4128895,6242175,2490444,3745356,12517631,14647295,10027212,11691724,7471256,8735896,6226047,7290751,3735628,4335180,16711935,16744447,13369548,13395660,9961624,9981080,8323199,8339327,4980812,4990540,16711871,16744415,13369497,13395634,9961586,9981061,8323167,8339311,4980793,4990530,16711807,
16744383,13369446,13395609,9961548,9981042,8323135,8339295,4980774,4990521,16711743,16744351,13369395,13395583,9961510,9981023,8323103,8339279,4980755,4990511,3355443,5987163,8684676,11382189,14079702,16777215]},{}],2:[function(b,c,d){function e(b){this._pointer=0;this._data=b;this._eof=!1}function f(b,c){if(9>=b)return c;if(10<=b&&59>=b)return parseFloat(c);if(60<=b&&99>=b)return parseInt(c);if(100<=b&&109>=b)return c;if(110<=b&&149>=b)return parseFloat(c);if(160<=b&&179>=b)return parseInt(c);if(210<=
b&&239>=b)return parseFloat(c);if(270<=b&&289>=b)return parseInt(c);if(290<=b&&299>=b){if("0"===c)var d=!1;else if("1"===c)d=!0;else throw TypeError("String '"+c+"' cannot be cast to Boolean type");return d}if(300<=b&&369>=b)return c;if(370<=b&&389>=b)return parseInt(c);if(390<=b&&399>=b)return c;if(400<=b&&409>=b)return parseInt(c);if(410<=b&&419>=b)return c;if(420<=b&&429>=b)return parseInt(c);if(430<=b&&439>=b)return c;if(440<=b&&459>=b)return parseInt(c);if(460<=b&&469>=b)return parseFloat(c);
if(470<=b&&481>=b||999===b||1E3<=b&&1009>=b)return c;if(1010<=b&&1059>=b)return parseFloat(c);if(1060<=b&&1071>=b)return parseInt(c);console.log("WARNING: Group code does not have a defined type: %j",{code:b,value:c});return c}e.prototype.next=function(){if(!this.hasNext()){if(this._eof)throw Error("Cannot call 'next' after EOF group has been read");throw Error("Unexpected end of input: EOF group not read before end of file. Ended on code "+this._data[this._pointer]);}var b={code:parseInt(this._data[this._pointer])};
this._pointer++;b.value=f(b.code,this._data[this._pointer].trim());this._pointer++;0===b.code&&"EOF"===b.value&&(this._eof=!0);return b};e.prototype.hasNext=function(){return this._eof||this._pointer>this._data.length-2?!1:!0};e.prototype.isEOF=function(){return this._eof};c.exports=e},{}],3:[function(b,c,d){function e(b){}function f(b){l.debug("unhandled group "+(b.code+":"+b.value))}var g=b("./DxfArrayScanner.js"),k=b("./AutoCadColorIndex"),l=b("loglevel");l.setLevel("error");e.prototype.parse=
function(b,c){throw Error("read() not implemented. Use readSync()");};e.prototype.parseSync=function(b){if("string"===typeof b)return this._parse(b);console.error("Cannot read dxf source of type `"+typeof b);return null};e.prototype.parseStream=function(b,c){var d="",e=this;b.on("data",function(b){d+=b});b.on("end",function(){try{var b=e._parse(d)}catch(u){return c(u)}c(null,b)});b.on("error",function(b){c(b)})};e.prototype._parse=function(b){var c,d={},e=0;b=b.split(/\r\n|\r|\n/g);var h=new g(b);
if(!h.hasNext())throw Error("Empty file");var u=function(b,d){return c.code===b&&c.value===d};b=function(){var b=null,d=null,e={};for(c=h.next();;){if(u(0,"ENDSEC")){b&&(e[b]=d);break}else 9===c.code?(b&&(e[b]=d),b=c.value):10===c.code?d={x:c.value}:20===c.code?d.y=c.value:30===c.code?d.z=c.value:d=c.value;c=h.next()}c=h.next();return e};var r=function(){var b={};for(c=h.next();"EOF"!==c.value&&!u(0,"ENDSEC");)if(u(0,"BLOCK")){l.debug("block {");var d={};for(c=h.next();"EOF"!==c.value;){switch(c.code){case 1:d.xrefPath=
c.value;c=h.next();break;case 2:d.name=c.value;c=h.next();break;case 3:d.name2=c.value;c=h.next();break;case 5:d.handle=c.value;c=h.next();break;case 8:d.layer=c.value;c=h.next();break;case 10:d.position=w();break;case 67:d.paperSpace=c.value&&1==c.value?!0:!1;c=h.next();break;case 70:0!=c.value&&(d.type=c.value);c=h.next();break;case 100:c=h.next();break;case 330:d.ownerHandle=c.value;c=h.next();break;case 0:if("ENDBLK"==c.value)break;d.entities=y(!0);break;default:f(c),c=h.next()}if(u(0,"ENDBLK")){c=
h.next();break}}l.debug("}");x(d);d.name?b[d.name]=d:l.error('block with handle "'+d.handle+'" is missing a name.')}else f(c),c=h.next();return b},v=function(){var b={};for(c=h.next();"EOF"!==c.value&&!u(0,"ENDSEC");)if(u(0,"TABLE"))if(c=h.next(),A[c.value]){l.debug(c.value+" Table {");var d=A[c.value].tableName,e=void 0,g=A[c.value],k={},n=0;for(c=h.next();!u(0,"ENDTAB");)switch(c.code){case 5:k.handle=c.value;c=h.next();break;case 330:k.ownerHandle=c.value;c=h.next();break;case 100:"AcDbSymbolTable"!==
c.value&&f(c);c=h.next();break;case 70:n=c.value;c=h.next();break;case 0:c.value===g.dxfSymbolName?k[g.tableRecordsProperty]=g.parseTableRecords():(f(c),c=h.next());break;default:f(c),c=h.next()}var m=k[g.tableRecordsProperty];m&&(m.constructor===Array?e=m.length:"object"===typeof m&&(e=Object.keys(m).length),n!==e&&l.warn("Parsed "+e+" "+g.dxfSymbolName+"'s but expected "+n));c=h.next();b[d]=k;l.debug("}")}else l.debug("Unhandled Table "+c.value);else c=h.next();c=h.next();return b},A={VPORT:{tableRecordsProperty:"viewPorts",
tableName:"viewPort",dxfSymbolName:"VPORT",parseTableRecords:function(){var b=[],d={};l.debug("ViewPort {");for(c=h.next();!u(0,"ENDTAB");)switch(c.code){case 2:d.name=c.value;c=h.next();break;case 10:d.lowerLeftCorner=w();break;case 11:d.upperRightCorner=w();break;case 12:d.center=w();break;case 13:d.snapBasePoint=w();break;case 14:d.snapSpacing=w();break;case 15:d.gridSpacing=w();break;case 16:d.viewDirectionFromTarget=w();break;case 17:d.viewTarget=w();break;case 42:d.lensLength=c.value;c=h.next();
break;case 43:d.frontClippingPlane=c.value;c=h.next();break;case 44:d.backClippingPlane=c.value;c=h.next();break;case 45:d.viewHeight=c.value;c=h.next();break;case 50:d.snapRotationAngle=c.value;c=h.next();break;case 51:d.viewTwistAngle=c.value;c=h.next();break;case 79:d.orthographicType=c.value;c=h.next();break;case 110:d.ucsOrigin=w();break;case 111:d.ucsXAxis=w();break;case 112:d.ucsYAxis=w();break;case 110:d.ucsOrigin=w();break;case 281:d.renderMode=c.value;c=h.next();break;case 281:d.defaultLightingType=
c.value;c=h.next();break;case 292:d.defaultLightingOn=c.value;c=h.next();break;case 330:d.ownerHandle=c.value;c=h.next();break;case 63:case 421:case 431:d.ambientColor=c.value;c=h.next();break;case 0:"VPORT"===c.value&&(l.debug("}"),b.push(d),l.debug("ViewPort {"),d={},c=h.next());break;default:f(c),c=h.next()}l.debug("}");b.push(d);return b}},LTYPE:{tableRecordsProperty:"lineTypes",tableName:"lineType",dxfSymbolName:"LTYPE",parseTableRecords:function(){var b={},d={};l.debug("LType {");for(c=h.next();!u(0,
"ENDTAB");)switch(c.code){case 2:var e=d.name=c.value;c=h.next();break;case 3:d.description=c.value;c=h.next();break;case 73:var f=c.value;0<f&&(d.pattern=[]);c=h.next();break;case 40:d.patternLength=c.value;c=h.next();break;case 49:d.pattern.push(c.value);c=h.next();break;case 0:l.debug("}");0<f&&f!==d.pattern.length&&l.warn("lengths do not match on LTYPE pattern");b[e]=d;d={};l.debug("LType {");c=h.next();break;default:c=h.next()}l.debug("}");b[e]=d;return b}},LAYER:{tableRecordsProperty:"layers",
tableName:"layer",dxfSymbolName:"LAYER",parseTableRecords:function(){var b={},d={};l.debug("Layer {");for(c=h.next();!u(0,"ENDTAB");)switch(c.code){case 2:var e=d.name=c.value;c=h.next();break;case 62:d.visible=0>=c.value;d.color=k[Math.abs(c.value)];c=h.next();break;case 0:"LAYER"===c.value&&(l.debug("}"),b[e]=d,l.debug("Layer {"),d={},e=void 0,c=h.next());break;default:f(c),c=h.next()}l.debug("}");b[e]=d;return b}}},y=function(b){var d=[],e=b?"ENDBLK":"ENDSEC";for(b||(c=h.next());;)if(0===c.code){if(c.value===
e)break;if("LWPOLYLINE"===c.value){l.debug("LWPOLYLINE {");b={type:c.value,vertices:[]};var f=0;for(c=h.next();"EOF"!==c&&0!==c.code;)switch(c.code){case 38:b.elevation=c.value;c=h.next();break;case 39:b.depth=c.value;c=h.next();break;case 70:b.shape=1===c.value;c=h.next();break;case 90:f=c.value;c=h.next();break;case 10:var g,k=f;if(!k||0>=k)throw Error("n must be greater than 0 verticies");var n=[],m=!1,p=!1;for(g=0;g<k;g++){for(var v={};"EOF"!==c&&0!==c.code&&!p;){switch(c.code){case 10:if(m){p=
!0;continue}v.x=c.value;m=!0;break;case 20:v.y=c.value;break;case 30:v.z=c.value;break;case 40:v.startWidth=c.value;break;case 41:v.endWidth=c.value;break;case 42:0!=c.value&&(v.bulge=c.value);break;default:c=h.next();continue}c=h.next()}n.push(v);p=m=!1}b.vertices=n;break;case 43:0!==c.value&&(b.width=c.value);c=h.next();break;default:F(b)}l.debug("}")}else if("POLYLINE"===c.value){l.debug("POLYLINE {");b={type:c.value,vertices:[]};for(c=h.next();"EOF"!==c&&0!==c.code;)switch(c.code){case 10:case 20:case 30:case 39:b.thickness=
c.value;c=h.next();break;case 40:case 41:c=h.next();break;case 70:b.shape=0!==(c.value&1);b.includesCurveFitVertices=0!==(c.value&2);b.includesSplineFitVertices=0!==(c.value&4);b.is3dPolyline=0!==(c.value&8);b.is3dPolygonMesh=0!==(c.value&16);b.is3dPolygonMeshClosed=0!==(c.value&32);b.isPolyfaceMesh=0!==(c.value&64);b.hasContinuousLinetypePattern=0!==(c.value&128);c=h.next();break;case 71:case 72:case 73:case 74:case 75:c=h.next();break;case 210:extrusionDirection=w();break;default:F(b)}for(f=[];"EOF"!==
c;)if(0===c.code)if("VERTEX"===c.value)f.push(B());else if("SEQEND"===c.value){g={type:c.value};for(c=h.next();"EOF"!=c&&0!=c.code;)F(g);break}b.vertices=f;l.debug("}")}else if("LINE"===c.value){l.debug("LINE {");b={type:c.value,vertices:[]};for(c=h.next();"EOF"!==c&&0!==c.code;)switch(c.code){case 10:b.vertices.unshift(w());break;case 11:b.vertices.push(w());break;case 210:b.extrusionDirection=w();break;case 100:if("AcDbLine"==c.value){c=h.next();break}default:F(b)}l.debug("}")}else if("CIRCLE"===
c.value)l.debug("CIRCLE {"),b=E(),l.debug("}");else if("ARC"===c.value)l.debug("ARC {"),b=E(),l.debug("}");else if("TEXT"===c.value){l.debug("TEXT {");b={type:c.value};for(c=h.next();"EOF"!==c&&0!==c.code;)switch(c.code){case 10:b.startPoint=w();break;case 11:b.endPoint=w();break;case 40:b.textHeight=c.value;c=h.next();break;case 41:b.xScale=c.value;c=h.next();break;case 1:b.text=c.value;c=h.next();break;case 72:b.halign=c.value;c=h.next();break;case 73:b.valign=c.value;c=h.next();break;default:F(b)}l.debug("}")}else if("DIMENSION"===
c.value){l.debug("DIMENSION {");b={type:c.value};for(c=h.next();"EOF"!==c&&0!==c.code;)switch(c.code){case 2:b.block=c.value;c=h.next();break;case 10:b.anchorPoint=w();break;case 11:b.middleOfText=w();break;case 71:b.attachmentPoint=c.value;c=h.next();break;case 42:b.actualMeasurement=c.value;c=h.next();break;case 1:b.text=c.value;c=h.next();break;case 50:b.angle=c.value;c=h.next();break;default:F(b)}l.debug("}")}else if("SOLID"===c.value){l.debug("SOLID {");b={type:c.value,points:[]};for(c=h.next();"EOF"!==
c&&0!==c.code;)switch(c.code){case 10:b.points[0]=w();break;case 11:b.points[1]=w();break;case 12:b.points[2]=w();break;case 13:b.points[3]=w();break;case 210:b.extrusionDirection=w();c=h.next();break;default:F(b)}l.debug("}")}else if("POINT"===c.value){l.debug("POINT {");b={type:c.value};for(c=h.next();"EOF"!==c&&0!==c.code;)switch(c.code){case 10:b.position=w();break;case 39:b.thickness=c.value;c=h.next();break;case 210:b.extrusionDirection=w();break;case 100:if("AcDbPoint"==c.value){c=h.next();
break}default:F(b)}l.debug("}")}else if("MTEXT"===c.value){l.debug("MTEXT {");b={type:c.value};for(c=h.next();"EOF"!==c&&0!==c.code;)switch(c.code){case 1:b.text=c.value;c=h.next();break;case 3:b.text+=c.value;c=h.next();break;case 10:b.position=w();break;case 40:b.height=c.value;c=h.next();break;case 41:b.width=c.value;c=h.next();break;case 71:b.attachmentPoint=c.value;c=h.next();break;case 72:b.drawingDirection=c.value;c=h.next();break;default:F(b)}l.debug("}")}else if("ATTDEF"===c.value){l.debug("ATTDEF {");
b={type:c.value,scale:1,textStyle:"STANDARD"};for(c=h.next();"EOF"!==c&&0!==c.code;)switch(c.code){case 1:b.text=c.value;c=h.next();break;case 2:b.tag=c.value;c=h.next();break;case 3:b.prompt=c.value;c=h.next();break;case 7:b.textStyle=c.value;c=h.next();break;case 10:b.x=c.value;c=h.next();break;case 20:b.y=c.value;c=h.next();break;case 30:b.z=c.value;c=h.next();break;case 39:b.thickness=c.value;c=h.next();break;case 40:b.textHeight=c.value;c=h.next();break;case 41:b.scale=c.value;c=h.next();break;
case 50:b.rotation=c.value;c=h.next();break;case 51:b.obliqueAngle=c.value;c=h.next();break;case 70:b.invisible=!!(c.value&1);b.constant=!!(c.value&2);b.verificationRequired=!!(c.value&4);b.preset=!!(c.value&8);c=h.next();break;case 71:b.backwards=!!(c.value&2);b.mirrored=!!(c.value&4);c=h.next();break;case 72:b.horizontalJustification=c.value;c=h.next();break;case 73:b.fieldLength=c.value;c=h.next();break;case 74:b.verticalJustification=c.value;c=h.next();break;case 100:c=h.next();break;case 210:b.extrusionDirectionX=
c.value;c=h.next();break;case 220:b.extrusionDirectionY=c.value;c=h.next();break;case 230:b.extrusionDirectionZ=c.value;c=h.next();break;default:F(b)}l.debug("}")}else if("INSERT"===c.value){l.debug("INSERT {");b={type:c.value};for(c=h.next();"EOF"!==c&&0!==c.code;)switch(c.code){case 2:b.name=c.value;c=h.next();break;case 41:b.xScale=c.value;c=h.next();break;case 42:b.yScale=c.value;c=h.next();break;case 43:b.zScale=c.value;c=h.next();break;case 10:b.position=w();break;case 50:b.rotation=c.value;
c=h.next();break;case 70:b.columnCount=c.value;c=h.next();break;case 71:b.rowCount=c.value;c=h.next();break;case 44:b.columnSpacing=c.value;c=h.next();break;case 45:b.rowSpacing=c.value;c=h.next();break;case 210:b.extrusionDirection=w();break;default:F(b)}l.debug("}")}else{l.warn("Unhandled entity "+c.value);c=h.next();continue}x(b);d.push(b)}else c=h.next();"ENDSEC"==e&&(c=h.next());return d},F=function(b){switch(c.code){case 0:b.type=c.value;c=h.next();break;case 5:b.handle=c.value;c=h.next();break;
case 6:b.lineType=c.value;c=h.next();break;case 8:b.layer=c.value;c=h.next();break;case 48:b.lineTypeScale=c.value;c=h.next();break;case 60:b.visible=0===c.value;c=h.next();break;case 62:b.colorIndex=c.value;b.color=k[Math.abs(c.value)];c=h.next();break;case 67:b.inPaperSpace=0!==c.value;c=h.next();break;case 330:b.ownerHandle=c.value;c=h.next();break;case 347:b.materialObjectHandle=c.value;c=h.next();break;case 370:b.lineweight=c.value;c=h.next();break;case 420:b.color=c.value;c=h.next();break;case 100:c=
h.next();break;default:f(c),c=h.next()}},B=function(){var b={type:c.value};for(c=h.next();"EOF"!==c&&0!==c.code;)switch(c.code){case 10:b.x=c.value;c=h.next();break;case 20:b.y=c.value;c=h.next();break;case 30:b.z=c.value;c=h.next();break;case 40:case 41:case 42:c=h.next();break;case 70:b.curveFittingVertex=0!==(c.value&1);b.curveFitTangent=0!==(c.value&2);b.splineVertex=0!==(c.value&8);b.splineControlPoint=0!==(c.value&16);b.threeDPolylineVertex=0!==(c.value&32);b.threeDPolylineMesh=0!==(c.value&
64);b.polyfaceMeshVertex=0!==(c.value&128);c=h.next();break;case 50:case 71:case 72:case 73:case 74:c=h.next();break;default:F(b)}return b},w=function(){var b={},d=c.code;b.x=c.value;d+=10;c=h.next();if(c.code!=d)throw Error("Expected code for point value to be "+d+" but got "+c.code+".");b.y=c.value;d+=10;c=h.next();if(c.code!=d)return b;b.z=c.value;c=h.next();return b},E=function(){var b={type:c.value};for(c=h.next();"EOF"!==c&&0!==c.code;)switch(c.code){case 10:b.center=w();break;case 40:b.radius=
c.value;c=h.next();break;case 50:b.startAngle=Math.PI/180*c.value;c=h.next();break;case 51:var d=Math.PI/180*c.value;b.angleLength=d<b.startAngle?d+2*Math.PI-b.startAngle:d-b.startAngle;b.endAngle=d;c=h.next();break;default:F(b)}return b},x=function(b){if(!b)throw new TypeError("entity cannot be undefined or null");b.handle||(b.handle=e++)};for(c=h.next();!h.isEOF();)0===c.code&&"SECTION"===c.value?(c=h.next(),2!==c.code?(console.error("Unexpected code %s after 0:SECTION",c.code+":"+c.value),c=h.next()):
"HEADER"===c.value?(l.debug("> HEADER"),d.header=b(),l.debug("<")):"BLOCKS"===c.value?(l.debug("> BLOCKS"),d.blocks=r(),l.debug("<")):"ENTITIES"===c.value?(l.debug("> ENTITIES"),d.entities=y(!1),l.debug("<")):"TABLES"===c.value?(l.debug("> TABLES"),d.tables=v(),l.debug("<")):"EOF"===c.value?l.debug("EOF"):l.warn("Skipping section '%s'",c.value)):c=h.next();return d};c.exports=e},{"./AutoCadColorIndex":1,"./DxfArrayScanner.js":2,loglevel:4}],4:[function(b,c,d){(function(d,f){"object"===typeof c&&c.exports&&
"function"===typeof b?c.exports=f():d.log=f()})(this,function(){function b(b,c){var d=b[c];if("function"===typeof d.bind)return d.bind(b);try{return Function.prototype.bind.call(d,b)}catch(u){return function(){return Function.prototype.apply.apply(d,[b,arguments])}}}function c(b,c){return function(){"undefined"!==typeof console&&(d(c),k[b].apply(k,arguments))}}function d(b){for(var c=0;c<h.length;c++){var d=h[c];k[d]=c<b?l:k.methodFactory(d,b)}}var k={},l=function(){},h=["trace","debug","info","warn",
"error"];k.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5};k.methodFactory=function(d,e){return("undefined"===typeof console?!1:void 0!==console[d]?b(console,d):void 0!==console.log?b(console,"log"):l)||c(d,e)};k.setLevel=function(b,c){"string"===typeof b&&void 0!==k.levels[b.toUpperCase()]&&(b=k.levels[b.toUpperCase()]);if("number"===typeof b&&0<=b&&b<=k.levels.SILENT){if(!1!==c)a:{var e=(h[b]||"silent").toUpperCase();try{window.localStorage.loglevel=e;break a}catch(u){}try{window.document.cookie=
"loglevel="+e+";"}catch(u){}}d(b);if("undefined"===typeof console&&b<k.levels.SILENT)return"No console available for logging"}else throw"log.setLevel() called with invalid level: "+b;};k.enableAll=function(b){k.setLevel(k.levels.TRACE,b)};k.disableAll=function(b){k.setLevel(k.levels.SILENT,b)};var m="undefined"!==typeof window?window.log:void 0;k.noConflict=function(){"undefined"!==typeof window&&window.log===k&&(window.log=m);return k};(function(){try{var b=window.localStorage.loglevel}catch(p){}if("undefined"===
typeof b)try{b=/loglevel=([^;]+)/.exec(window.document.cookie)[1]}catch(p){}void 0===k.levels[b]&&(b="WARN");k.setLevel(k.levels[b],!1)})();return k})},{}]},{},[3])(3)});function DXF2D_Parser(a){this.displayRef=a;this.activeLayer=this.contentNode=this.svgDocument=null;this.scale=1;this.parsedEntities=this.totalEntities=this.createdEementsNum=0}_=DXF2D_Parser.prototype;
_.parseModel=function(a,b,c){this.svgDocument=b;this.contentNode=this.svgDocument.querySelector("#jvs-content");this.contentNode||(this.contentNode=this.svgDocument);this.scale=c||this.scale;b=new DxfParser;this.dxf=null;c=(new Date).getTime();try{this.dxf=b.parseSync(a)}catch(d){return console.error(d.stack)}this.parsedEntities=0;this.totalEntities=this.dxf.entities.length;console.log("this.totalEntities",this.totalEntities);this.parseEntitiesInLayerList(this.groupEntitiesByLayer(this.dxf.entities),
this.contentNode);console.log("end dxf parse sec",((new Date).getTime()-c)/1E3);console.log("DXF",this.dxf)};_.parseBlocks=function(a){var b=this.svgDocument.querySelector("defs"),c;for(c in a){var d=a[c];var e=this.svgDocument.createSymbol("symbol_"+c);b.appendChild(e);d.entities&&this.parseEntitiesInLayerList(this.groupEntitiesByLayer(d.entities),e)}};
_.parseEntitiesInLayerList=function(a,b,c){this.scale=c||this.scale;var d,e;for(d in a){c=this.svgDocument.createGroup(0,0,"layer_"+d);c.setAttribute("name",d);"symbol"!=b.nodeName&&c.setAttribute("class","jvs-layer");b.appendChild(c);var f=a[d];var g=f.length;for(e=0;e<g;e++)this.parseEntity(f[e],c),this.parsedEntities++}};
_.parseEntity=function(a,b){switch(a.type){case "POLYLINE":a.includesCurveFitVertices&&console.log("-------includesCurveFitVertices-----------",a);a.includesSplineFitVertices&&console.log("-------includesSplineFitVertices-----------",a);this.parsePolyline(a,b);break;case "LINE":this.parseLine(a,b);break;case "LWPOLYLINE":this.parsePolyline(a,b);break;case "CIRCLE":this.parseCircle(a,b);break;case "ARC":this.parseArc(a,b);break;case "INSERT":this.parseInsertBlockInline(a,b);break;default:console.log("entity",
a)}this.createdEementsNum++};_.groupEntitiesByLayer=function(a){for(var b,c={},d,e=a.length,f=0;f<e;f++)d=a[f],b=d.layer,c[b]||(c[b]=[]),c[b].push(d);return c};
_.parsePolyline=function(a,b){var c=a.vertices,d=this.svgDocument.createPath();var e=c[0];d.pathSegList.appendItem(d.createSVGPathSegMovetoAbs(e.x*this.scale,-e.y*this.scale));for(var f=1;f<c.length;f++)e=c[f],d.pathSegList.appendItem(d.createSVGPathSegLinetoAbs(e.x*this.scale,-e.y*this.scale));d.setAttribute("stroke",this.colorToRGB(a.color));d.setAttribute("fill","none");b.appendChild(d)};
_.parseCircle=function(a,b){var c=this.svgDocument.createCircle(a.center.x*this.scale,-a.center.y*this.scale,a.radius*this.scale);c.setAttribute("stroke",this.colorToRGB(a.color));c.setAttribute("fill","none");b.appendChild(c)};_.parseLine=function(a,b){var c=this.svgDocument.createLine(a.vertices[0].x*this.scale,-a.vertices[0].y*this.scale,a.vertices[1].x*this.scale,-a.vertices[1].y*this.scale);c.setAttribute("stroke",this.colorToRGB(a.color));b.appendChild(c)};
_.parseInsertBlockInline=function(a,b){var c=this.dxf.blocks[a.name];if(c.entities){var d=this.svgDocument.createGroup(a.position.x*this.scale,-a.position.y*this.scale,a.name);b.appendChild(d);this.parseEntitiesInLayerList(this.groupEntitiesByLayer(c.entities),d)}a.rotation&&d.getTransform().setMatrix(d.getTransform().matrix.rotate(-a.rotation));a.xScale&&d.getTransform().setMatrix(d.getTransform().matrix.scaleNonUniform(a.xScale,a.yScale))};
_.parseArc=function(a,b){var c=a.radius*this.scale,d=a.startAngle,e=a.endAngle,f=0,g=a.center.x*this.scale,k=-a.center.y*this.scale,l=-d,h=-e,m=Math.cos(l)*c+g;l=Math.sin(l)*c+k;g=Math.cos(h)*c+g;k=Math.sin(h)*c+k;e>d&&e-d>Math.PI&&(f=1);d=this.svgDocument.createPath();d.setPathData([{type:"M",values:[m,l]},{type:"A",values:[c,c,0,f,0,g,k]}]);d.setPathData(d.getPathData({normalize:!0}));d.setAttribute("stroke",this.colorToRGB(a.color));d.setAttribute("fill","none");b.appendChild(d)};
_.colorToRGB=function(a){a>>>=0;return"rgba("+[(a&16711680)>>>16,(a&65280)>>>8,a&255,1].join()+")"};SVGElement.SVG_NS="http://www.w3.org/2000/svg";SVGElement.XLINK_NS="http://www.w3.org/1999/xlink";SVGElement.prototype.__appendChild=SVGElement.prototype.appendChild;SVGElement.prototype.__insertBefore=SVGElement.prototype.insertBefore;SVGElement.prototype.__replaceChild=SVGElement.prototype.replaceChild;SVGElement.prototype.__removeChild=SVGElement.prototype.removeChild;
SVGElement.prototype.__setAttribute=SVGElement.prototype.setAttribute;SVGElement.prototype.removeChild=function(a){a=this.__removeChild(a);if(a.onRemoved)a.onRemoved();return a};SVGElement.prototype.appendChild=function(a){a=this.__appendChild(a);if(a.onAdded)a.onAdded();return a};SVGElement.prototype.insertBefore=function(a,b){var c=this.__insertBefore(a,b);if(c.onAdded)c.onAdded();return c};
SVGElement.prototype.replaceChild=function(a,b){var c=this.__replaceChild(a,b);if(c.onAdded)c.onAdded();if(b.onRemoved)b.onRemoved();return c};SVGElement.prototype.setAttribute=function(a,b){this.__setAttribute(a,b);this.onAttributeChanged(a)};SVGElement.prototype.onAttributeChanged=function(a){};SVGElement.prototype.onGeometryChanged=function(a){console.log("onGeometryChanged",this)};SVGElement.prototype.onStyleChanged=function(a){console.log("onStyleChanged",this)};
SVGElement.prototype.renderRequest=function(a){if(!0===a)this.render();else if(1!=this.waitForRendering){this.waitForRendering=!0;var b=this;setTimeout(function(){!0===b.waitForRendering&&(b.render(),b.waitForRendering=!1)},0)}};SVGElement.prototype.render=function(){};
SVGElement.prototype.setStrokeAndFill=function(a,b,c,d){a=a||"none";b=b||"none";this.setAttribute("stroke",a);this.setAttribute("fill",b);"none"!=a&&(this.setAttribute("stroke-width",c||1),d=d||"none","none"!=d&&this.setAttribute("stroke-dasharray",d))};
SVGElement.prototype.createUniqueDefReferences=function(){if(this.ownerSVGElement){var a;this.hasAttribute("fill")&&-1<this.getAttribute("fill").indexOf("url(#")&&(a=this.ownerSVGElement.getElementFromDefs(this.getAttribute("fill")))&&this.setAttribute("fill",this.ownerSVGElement.addElementToDefs(a.cloneNode(!0)));this.hasAttribute("stroke")&&-1<this.getAttribute("stroke").indexOf("url(#")&&(a=this.ownerSVGElement.getElementFromDefs(this.getAttribute("stroke")))&&this.setAttribute("stroke",this.ownerSVGElement.addElementToDefs(a.cloneNode(!0)));
a=this.children.length;for(var b=0;b<a;b++)this.children[b].createUniqueDefReferences()}};
SVGElement.prototype.copyAttributeFromElement=function(a){a.hasAttribute("stroke")&&this.setAttribute("stroke",a.getAttribute("stroke"));a.hasAttribute("stroke-width")&&this.setAttribute("stroke-width",a.getAttribute("stroke-width"));a.hasAttribute("stroke-dasharray")&&this.setAttribute("stroke-dasharray",a.getAttribute("stroke-dasharray"));a.hasAttribute("marker-start")&&this.setAttribute("marker-start",a.getAttribute("marker-start"));a.hasAttribute("marker-end")&&this.setAttribute("marker-end",
a.getAttribute("marker-end"));a.hasAttribute("marker-mid")&&this.setAttribute("marker-mid",a.getAttribute("marker-mid"))};
SVGElement.prototype.stylePropertiesToAttributes=function(){var a=this.style;a.opacity&&(this.setAttribute("opacity",a.opacity),this.style.removeProperty("opacity"));a.fill&&(this.setAttribute("fill",a.fill),this.style.removeProperty("fill"));a.stroke&&(this.setAttribute("stroke",a.stroke),this.style.removeProperty("stroke"));a["stroke-width"]&&(this.setAttribute("stroke-width",a["stroke-width"]),this.style.removeProperty("stroke-width"));a["stroke-linecap"]&&(this.setAttribute("stroke-linecap",a["stroke-linecap"]),
this.style.removeProperty("stroke-linecap"));a["stroke-linejoin"]&&(this.setAttribute("stroke-linejoin",a["stroke-linejoin"]),this.style.removeProperty("stroke-linejoin"));a["stroke-miterlimit"]&&(this.setAttribute("stroke-miterlimit",a["stroke-miterlimit"]),this.style.removeProperty("stroke-miterlimit"));a["marker-start"]&&("none"!=a["marker-start"]&&this.setAttribute("marker-start",a["marker-start"]),this.style.removeProperty("marker-start"));a["marker-end"]&&("none"!=a["marker-end"]&&this.setAttribute("marker-end",
a["marker-end"]),this.style.removeProperty("marker-end"));a["marker-mid"]&&("none"!=a["marker-mid"]&&this.setAttribute("marker-mid",a["marker-mid"]),this.style.removeProperty("marker-mid"));a["font-family"]&&(this.setAttribute("font-family",a["font-family"].replace(/"/g,"")),this.style.removeProperty("font-family"));a["font-weight"]&&(this.setAttribute("font-weight",a["font-weight"]),this.style.removeProperty("font-weight"));a["font-size"]&&(this.setAttribute("font-size",parseFloat(a["font-size"])),
this.style.removeProperty("font-size"))};SVGElement.prototype.distanceFromPoints=function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)};SVGElement.prototype.getTransform=function(){if(0==this.transform.baseVal.numberOfItems){var a=SVGElement.svgUtils.createSVGTransformFromMatrix(SVGElement.svgUtils.createSVGMatrix());this.transform.baseVal.appendItem(a)}return this.transform.baseVal.getItem(0)};
SVGElement.prototype.globalMatrixToLocalMatrix=function(a){var b=this.parentNode;b instanceof SVGMaskElement&&(b=b.parentNode);return this.ownerSVGElement.getTransformToElement(b).multiply(a)};SVGElement.prototype.rotateAroundGlobalPt=function(a,b){var c=this.parentNode.globalToLocal(b.x,b.y),d=this.ownerSVGElement.createSVGMatrix();d=d.translate(-c.x,-c.y);var e=d.multiply(this.getTransform().matrix);d.identity();d=d.rotate(a);e=d.multiply(e);d.identity();d=d.translate(c.x,c.y);e=d.multiply(e);this.getTransform().setMatrix(e)};
SVGElement.prototype.scaleAroundGlobalPt=function(a,b,c,d){if(1==d){c=this.globalToLocal(c.x,c.y);d=this.getTransform();var e=d.matrix;e=e.translate(c.x,c.y);e=e.scaleNonUniform(a,b);e=e.translate(-c.x,-c.y);d.setMatrix(e)}else d=this.getCTM(),e=SVGElement.svgUtils.createSVGMatrix(),e=e.translate(-c.x,-c.y),d=e.multiply(d),e.identity(),e=e.scaleNonUniform(a,b),d=e.multiply(d),e.identity(),e=e.translate(c.x,c.y),d=e.multiply(d),this.getTransform().setMatrix(this.globalMatrixToLocalMatrix(d))};
SVGElement.prototype.translateInGlobal=function(a,b){var c=SVGElement.svgUtils.createSVGMatrix();c=c.translate(a,b);this.getTransform().setMatrix(this.globalMatrixToLocalMatrix(c.multiply(this.getCTM())))};
SVGElement.prototype.globalRectToLocalPolygon=function(a){var b=this.ownerSVGElement.getTransformToElement(this),c=this.ownerSVGElement.createSVGPoint();c.x=a.x;c.y=a.y;var d=c.matrixTransform(b);c.x=a.x+a.width;c.y=a.y;var e=c.matrixTransform(b);c.x=a.x+a.width;c.y=a.y+a.height;var f=c.matrixTransform(b);c.x=a.x;c.y=a.y+a.height;a=c.matrixTransform(b);return[d,e,f,a,d]};
SVGElement.prototype.localRectToGlobalPolygon=function(a){var b=this.getTransformToElement(this.ownerSVGElement),c=this.ownerSVGElement.createSVGPoint();c.x=a.x;c.y=a.y;var d=c.matrixTransform(b);c.x=a.x+a.width;c.y=a.y;var e=c.matrixTransform(b);c.x=a.x+a.width;c.y=a.y+a.height;var f=c.matrixTransform(b);c.x=a.x;c.y=a.y+a.height;a=c.matrixTransform(b);return[d,e,f,a,d]};
SVGElement.prototype.getLocalBBox=function(){var a=this.getBBox();a.center={x:a.x+a.width/2,y:a.y+a.height/2};a.min={x:a.x,y:a.y};a.max={x:a.x+a.width,y:a.y+a.height};return a};SVGElement.prototype.getGlobalBBox=function(){var a=this.getBoundingClientRect(),b={};b.y=b.top=a.top-40;b.x=b.left=a.left;b.width=a.width;b.height=a.height;b.min={x:b.x,y:b.y};b.max={x:b.x+b.width,y:b.y+b.height};b.center={x:b.x+b.width/2,y:b.y+b.height/2};b.right=b.max.x;b.bottom=b.max.y;return b};
SVGElement.prototype.getLocalCenter=function(){var a=this.getBBox();return{x:a.x+a.width/2,y:a.y+a.height/2}};SVGElement.prototype.getTransformToElement||(SVGElement.prototype.getTransformToElement=function(a){return a.getScreenCTM().inverse().multiply(this.getScreenCTM())});SVGElement.prototype.globalToLocal=function(a,b){if(!this.ownerSVGElement)return{x:a,y:b};var c=this.ownerSVGElement.createSVGPoint(a,b),d=this.ownerSVGElement.getTransformToElement(this);return c.matrixTransform(d)};
SVGElement.prototype.localToGlobal=function(a,b){var c=this.ownerSVGElement.createSVGPoint();c.x=a;c.y=b;return c.matrixTransform(this.getCTM())};SVGElement.prototype.screenValueInLocal=function(a){return this.getScreenCTM().inverse().getScale().x*a};SVGElement.prototype.screenToLocal=function(a,b){return SVGElement.svgUtils.createSVGPoint(a,b).matrixTransform(this.getScreenCTM().inverse())};SVGElement.prototype.localToScreen=function(a,b){var c=this.ownerSVGElement.createSVGPoint();c.x=a;c.y=b;return c.matrixTransform(this.getScreenCTM())};
SVGElement.prototype.prepareToNormalizeScale=function(a){};SVGElement.prototype.scaleAttributeNumber=function(a,b){this.hasAttribute(a)&&this.setAttribute(a,parseFloat(this.getAttribute(a))*b)};SVGElement.prototype.normalizeScale=function(a){};SVGElement.prototype.isContainedInGlobalRect=function(a){var b=this.getGlobalBBox();return b.left>a.left&&b.right<a.right&&b.top>a.top&&b.bottom<a.bottom?!0:!1};
SVGElement.prototype.isPointInRect=function(a,b){return a.x>b.left&&a.x<b.right&&a.y>b.top&&a.y<b.bottom?!0:!1};SVGElement.prototype.isPointInPoly=function(a,b){for(var c=!1,d=-1,e=a.length,f=e-1;++d<e;f=d)(a[d].y<=b.y&&b.y<a[f].y||a[f].y<=b.y&&b.y<a[d].y)&&b.x<(a[f].x-a[d].x)*(b.y-a[d].y)/(a[f].y-a[d].y)+a[d].x&&(c=!c);return c};SVGElement.prototype.intersectGlobalRect=function(a){var b=this.getGlobalBBox();return!(b.left>a.right||b.right<a.left||b.top>a.bottom||b.bottom<a.top)};
SVGElement.prototype.toSVGPathElement=function(){if(!this.getBBox)return null;var a=this.getLocalBBox();a=SVGElement.svgUtils.createRect(a.x,a.y,a.width,a.height);var b=SVGElement.svgUtils.createPath();b.setPathData(a.getPathData({normalize:!0}));return b};SVGElement.prototype.getGradient=function(a){if(!this.hasAttribute(a))return null;a=this.getAttribute(a);return(a=this.getElementFromDocumentByIRI(a))&&(a instanceof SVGLinearGradientElement||a instanceof SVGRadialGradientElement)?a:null};
SVGElement.prototype.getElementFromDocumentByIRI=function(a){return-1!=a.indexOf("url")&&(a=a.split("#")[1].split(")")[0],a=a.split('"')[0],a=document.querySelector('defs [id="'+a+'"]'))?a:null};
SVGElement.prototype.normalizeGradientScale=function(a){if(a instanceof SVGRadialGradientElement){var b=SVGElement.svgUtils.createSVGPoint(a.cx.baseVal.value,a.cy.baseVal.value);b=b.matrixTransform(this.normalizationData.previousGlobalMatrix);var c=this.ownerSVGElement.getTransformToElement(this);b=b.matrixTransform(c);a.cx.baseVal.value=b.x;a.cy.baseVal.value=b.y;c=this.normalizationData.previousGlobalMatrix.getScale();a.r.baseVal.value*=Math.sqrt(Math.abs(c.x)*Math.abs(c.y))}else if(a instanceof
SVGLinearGradientElement){b=SVGElement.svgUtils.createSVGPoint(a.x1.baseVal.value,a.y1.baseVal.value);var d=SVGElement.svgUtils.createSVGPoint(a.x2.baseVal.value,a.y2.baseVal.value);b=b.matrixTransform(this.normalizationData.previousGlobalMatrix);d=d.matrixTransform(this.normalizationData.previousGlobalMatrix);c=this.ownerSVGElement.getTransformToElement(this);b=b.matrixTransform(c);d=d.matrixTransform(c);a.x1.baseVal.value=b.x;a.y1.baseVal.value=b.y;a.x2.baseVal.value=d.x;a.y2.baseVal.value=d.y}};
SVGElement.svgUtils=document.createElementNS(SVGElement.SVG_NS,"svg");SVGElement.elementFromString=function(a){return(new DOMParser).parseFromString(a,"text/xml").documentElement.firstChild};
SVGGraphicsElement.prototype.prepareToNormalizeScale=function(a){this.normalizationData={};var b=this.getCTM();this.normalizationData.previousGlobalMatrix=b;this.normalizationData.globalPosition=SVGElement.svgUtils.createSVGPoint(0,0).matrixTransform(b);this.normalizationData.localRotation=this.getTransform().matrix.getRotation();b=this.childNodes.length;for(var c=0;c<b;c++)this.childNodes[c].prepareToNormalizeScale&&this.childNodes[c].prepareToNormalizeScale(a)};
SVGGraphicsElement.prototype.normalizeScale=function(a){var b=this.globalMatrixToLocalMatrix(this.normalizationData.previousGlobalMatrix);this.getTransform().setMatrix(b);b=this.childNodes.length;for(var c=0;c<b;c++)this.childNodes[c].normalizeScale&&this.childNodes[c].normalizeScale(a)};
SVGGraphicsElement.prototype.createElementPreview=function(a){if(!this.hasAttribute("no-preview")){var b=this.toSVGPathElement();if(!b)return null;b.elementRef=this;this.interactiveElement=b;b.classList.add("interactive-path");b.setAttribute("vector-effect","non-scaling-stroke");a=a||this.getScreenCTM();b.getTransform().setMatrix(a);return b}};SVGPoint.prototype.clone=function(){return SVGElement.svgUtils.createSVGPoint(this.x,this.y)};
SVGPoint.prototype.getAngleFromPoint=function(a,b){for(var c=Math.atan2(a.y-this.y,a.x-this.x);0>c;)c+=2*Math.PI;1==b&&(c=180*c/Math.PI);return c};SVGPoint.prototype.set=function(a,b){this.x=a;this.y=b};SVGPoint.prototype.getDistanceFromPoint=function(a){var b=a.x-this.x;a=a.y-this.y;return Math.sqrt(b*b+a*a)};SVGPoint.prototype.getDistance=function(a,b){var c=a.x-this.x,d=a.y-this.y;c=c*c+d*d;return b?c:Math.sqrt(c)};SVGPoint.prototype.getLength=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};
SVGPoint.prototype.normalize=function(a){void 0===a&&(a=1);var b=this.getLength();a=0!=b?a/b:0;return SVGElement.svgUtils.createSVGPoint(this.x*a,this.y*a)};SVGPoint.prototype.scale=function(a,b){this.x*=a;this.y*=b};SVGPoint.prototype.translate=function(a,b){this.x+=a;this.y+=b};SVGPoint.prototype.isZero=function(){return 0==this.x&&0==this.y};SVGPoint.prototype.equals=function(a){return this.x==a.x&&this.y==a.y};
SVGPoint.prototype.add=function(a){return void 0===a.x?SVGElement.svgUtils.createSVGPoint(this.x+a,this.y+a):SVGElement.svgUtils.createSVGPoint(this.x+a.x,this.y+a.y)};SVGPoint.prototype.subtract=function(a){return void 0===a.x?SVGElement.svgUtils.createSVGPoint(this.x-a,this.y-a):SVGElement.svgUtils.createSVGPoint(this.x-a.x,this.y-a.y)};
SVGPoint.prototype.multiply=function(a){return void 0===a.x?SVGElement.svgUtils.createSVGPoint(this.x*a,this.y*a):SVGElement.svgUtils.createSVGPoint(this.x*a.x,this.y*a.y)};SVGPoint.prototype.divide=function(a){return void 0===a.x?SVGElement.svgUtils.createSVGPoint(this.x/a,this.y/a):SVGElement.svgUtils.createSVGPoint(this.x/a.x,this.y/a.y)};
SVGPoint.prototype.modulo=function(a){return void 0===a.x?SVGElement.svgUtils.createSVGPoint(this.x%a,this.y%a):SVGElement.svgUtils.createSVGPoint(this.x%a.x,this.y%a.y)};SVGPoint.prototype.negate=function(a){return SVGElement.svgUtils.createSVGPoint(-this.x,-this.y)};SVGPoint.prototype.dot=function(a){return this.x*a.x+this.y*a.y};SVGPoint.prototype.cross=function(a){return this.x*a.y-this.y*a.x};SVGMatrix.prototype.identity=function(){this.a=1;this.c=this.b=0;this.d=1;this.f=this.e=0;return this};
SVGMatrix.prototype.toHTML=function(a){return a?"matrix("+[this.a.toFixed(a),this.b.toFixed(a),this.c.toFixed(a),this.d.toFixed(a),this.e.toFixed(a),this.f.toFixed(a)].join()+")":"matrix("+[this.a,this.b,this.c,this.d,this.e,this.f].join()+")"};SVGMatrix.prototype.clone=function(){var a=SVGElement.svgUtils.createSVGMatrix();this.copyTo(a);return a};SVGMatrix.prototype.removeScale=function(){var a=this.getScale();a=SVGElement.svgUtils.createSVGMatrix().scaleNonUniform(a.x,a.y).inverse();return this.multiply(a)};
SVGMatrix.prototype.rotateAroundPt=function(a,b){var c=this.translate(b.x,b.y);c=c.rotate(a);return c=c.translate(-b.x,-b.y)};SVGMatrix.prototype.scaleAroundPt=function(a,b,c){var d=this.translate(c.x,c.y);d=d.scaleNonUniform(a,b);return d=d.translate(-c.x,-c.y)};SVGMatrix.prototype.copyTo=function(a){a.a=this.a;a.b=this.b;a.c=this.c;a.d=this.d;a.e=this.e;a.f=this.f};
SVGMatrix.prototype.transformPointList=function(a,b){var c=a.length,d=a;b&&(d=[]);for(var e=0;e<c;e++)d[e]=a[e].matrixTransform(this);return d};SVGMatrix.prototype.deltaTransformPoint=function(a){return{x:a.x*this.a+a.y*this.c+0,y:a.x*this.b+a.y*this.d+0}};SVGMatrix.prototype.getRotation=function(){var a=this.deltaTransformPoint({x:0,y:1});return 180/Math.PI*Math.atan2(a.y,a.x)-90};
SVGMatrix.prototype.getScale=function(){return{x:Math.sqrt(this.a*this.a+this.b*this.b),y:Math.sqrt(this.c*this.c+this.d*this.d)}};SVGMatrix.prototype.getTranslation=function(){return{x:this.e,y:this.f}};
SVGMatrix.prototype.decompose=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=a*d-b*c,f=Math.sqrt,g=Math.atan2,k=180/Math.PI;if(0!==a||0!==b){var l=f(a*a+b*b);f=Math.acos(a/l)*(0<b?1:-1);e=[l,e/l];a=[g(a*c+b*d,l*l),0]}else 0!==c||0!==d?(l=f(c*c+d*d),f=Math.asin(c/l)*(0<d?1:-1),e=[e/l,l],a=[0,g(a*c+b*d,l*l)]):(f=0,a=e=[0,0]);return{translateX:this.e,translateY:this.f,scaleX:e[0],scaleY:e[1],skewX:a[0]*k,skewY:a[1]*k,rotation:f*k}};
SVGGradientElement.prototype.getTransform=function(){if(0==this.gradientTransform.baseVal.numberOfItems){var a=SVGElement.svgUtils.createSVGTransformFromMatrix(SVGElement.svgUtils.createSVGMatrix());this.gradientTransform.baseVal.appendItem(a)}return this.gradientTransform.baseVal.getItem(0)};
SVGGradientElement.prototype.stopColorsToHtml=function(){function a(a){return-1!=a.indexOf("rgb")?a.split(":")[1].split(")")[0]+")":-1!=a.indexOf("#")?a.split(":")[1].split(";")[0]:""}var b=this.children.length;if(0!=b){var c=this.children[0];var d=""+(a(c.getAttribute("style"))+" "+100*c.offset.baseVal+"%");for(var e=1;e<b;e++)c=this.children[e],d+=", "+a(c.getAttribute("style"))+" "+100*c.offset.baseVal+"%";console.log(d);return d}};
SVGLinearGradientElement.prototype.toHtml=function(){return 0==this.children.length?"background-image: -webkit-linear-gradient(bottom, rgb(246,187,238) 44%, rgb(255,225,255) 72%);":"background-image: -webkit-linear-gradient(left, "+this.stopColorsToHtml()+");"};
SVGRadialGradientElement.prototype.toHtml=function(){return 0==this.children.length?"background-image:  -webkit-radial-gradient(center, ellipse cover, rgb(246,187,238) 44%, rgb(255,225,255) 72%);":"background-image: -webkit-radial-gradient(center, ellipse cover, "+this.stopColorsToHtml()+");"};
SVGLinearGradientElement.prototype.copyPointsTo=function(a){if(a instanceof SVGRadialGradientElement){var b=this.x2.baseVal.value-this.x1.baseVal.value,c=this.y2.baseVal.value-this.y1.baseVal.value,d=Math.sqrt(b*b+c*c)/2;c=this.y1.baseVal.value+c/2;a.cx.baseVal.value=this.x1.baseVal.value+b/2;a.cy.baseVal.value=c;a.r.baseVal.value=d}else a instanceof SVGLinearGradientElement&&(console.log("_targetGradient instanceof SVGLinearGradientElement"),console.log(this),console.log(a),a.x1.baseVal.value=this.x1.baseVal.value,
a.y1.baseVal.value=this.y1.baseVal.value,a.x2.baseVal.value=this.x2.baseVal.value,a.y2.baseVal.value=this.y2.baseVal.value)};
SVGRadialGradientElement.prototype.copyPointsTo=function(a){if(a instanceof SVGRadialGradientElement)a.cx.baseVal.value=this.cx.baseVal.value,a.cy.baseVal.value=this.cy.baseVal.value,a.r.baseVal.value=this.r.baseVal.value;else if(a instanceof SVGLinearGradientElement){var b=this.cy.baseVal.value-this.r.baseVal.value,c=this.cx.baseVal.value+this.r.baseVal.value,d=this.cy.baseVal.value+this.r.baseVal.value;a.x1.baseVal.value=this.cx.baseVal.value-this.r.baseVal.value;a.y1.baseVal.value=b;a.x2.baseVal.value=
c;a.y2.baseVal.value=d}};SVGGradientElement.prototype.setPointsFromBBox=function(a){this instanceof SVGRadialGradientElement?(this.cx.baseVal.value=a.center.x,this.cy.baseVal.value=a.center.y,this.r.baseVal.value=a.width/2):this instanceof SVGLinearGradientElement&&(this.x1.baseVal.value=a.center.x,this.y1.baseVal.value=a.min.y,this.x2.baseVal.value=a.center.x,this.y2.baseVal.value=a.max.y)};
SVGGradientElement.prototype.sortStopColors=function(){var a=[],b,c=this.children.length;for(b=0;b<c;b++)a.push(this.children[b]);a.sort(function(a,b){return a.offset.baseVal-b.offset.baseVal});this.removeChildren();for(b=0;b<c;b++)this.appendChild(a[b])};
SVGStopElement.prototype.stylePropertiesToAttributes=function(){var a=this.style;if(a["stop-opacity"]){if(a["stop-color"])if(console.log("stop-color",a["stop-color"]),-1<a["stop-color"].indexOf("rgb(")){var b=a["stop-color"].split("rgb(")[1];b=b.split(")")[0];a["stop-color"]="rgba("+b+","+a["stop-opacity"]+")"}else if(b=SVGElement.svgUtils.colorNameToHex(a["stop-color"]))b=SVGElement.svgUtils.colorHexToRgb(b),a["stop-color"]="rgba("+b.r+","+b.g+","+b.b+","+a["stop-opacity"]+")";this.style.removeProperty("stop-opacity")}};
SVGPatternElement.prototype.getTransform=function(){if(0==this.patternTransform.baseVal.numberOfItems){var a=SVGElement.svgUtils.createSVGTransformFromMatrix(SVGElement.svgUtils.createSVGMatrix());this.patternTransform.baseVal.appendItem(a)}return this.patternTransform.baseVal.getItem(0)};
SVGPatternElement.prototype.toHtml=function(){return 0==this.children.length?"background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAIAAABvFaqvAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADZJREFUeNpiZGBg+P//P5BkZGSkiAGhKAdMDFQCTEC3QViUMka9Nuq1Ua+Nem3Ua0PGawABBgCMajC1OPqsUwAAAABJRU5ErkJggg==); background-repeat: repeat;":1==this.children.length&&"image"==this.children[0].nodeName?"background-image: url( "+this.children[0].getAttributeNS(SVGElement.XLINK_NS,"href")+" ); background-repeat: repeat;":
"background-color:white; background-repeat:repeat; background-image: url(data:image/svg+xml;base64,"+window.btoa('<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" >'+this.innerHTML+"</svg>")+")"};
SVGSVGElement.prototype.colorNameToHex=function(a){var b={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",
darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",
gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",
lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",
oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",
skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return"undefined"!=typeof b[a.toLowerCase()]?b[a.toLowerCase()]:!1};
SVGSVGElement.prototype.colorHexToRgb=function(a,b){void 0==b&&(b=null);"#"==a.substr(0,1)&&(a=a.substr(1));if(3==a.length){var c=a.substr(0,1);c+=c;var d=a.substr(1,1);d+=d;var e=a.substr(2,1);e+=e}else if(6==a.length)c=a.substr(0,2),d=a.substr(2,2),e=a.substr(4,2);else return b;c=parseInt(c,16);d=parseInt(d,16);e=parseInt(e,16);return isNaN(c)||isNaN(d)||isNaN(e)?b:{r:c,g:d,b:e}};
SVGSVGElement.prototype.elementListFromIntersection=function(a){var b=[],c=this.getIntersectionList(a,null);console.log("elementListFromIntersection",c);for(var d,e=0;e<c.length;e++)d=c[e],d.intersectGlobalRect(a)&&b.push(d);console.log("resultList",b);return b};
SVGSVGElement.prototype.createSVGLinearGradient=function(a,b,c,d,e){var f=document.createElementNS(SVGElement.SVG_NS,"linearGradient");f.setAttribute("id",a);f.setAttribute("x1",b);f.setAttribute("y1",c);f.setAttribute("x2",d);f.setAttribute("y2",e);f.setAttribute("gradientUnits","userSpaceOnUse");f.setAttribute("gradientTransform","matrix(1 0 0 1 0 0)");return f};
SVGSVGElement.prototype.createSVGRadialGradient=function(a,b,c,d){var e=document.createElementNS(SVGElement.SVG_NS,"radialGradient");e.setAttribute("id",a);e.setAttribute("cx",b);e.setAttribute("cy",c);e.setAttribute("r",d);e.setAttribute("gradientUnits","userSpaceOnUse");e.setAttribute("gradientTransform","matrix(1 0 0 1 0 0)");return e};
SVGSVGElement.prototype.createSVGStopColor=function(a,b){var c=document.createElementNS(SVGElement.SVG_NS,"stop");c.setAttribute("offset",a);c.setAttribute("style","stop-color:"+b);return c};
SVGSVGElement.prototype.createSVGStopColorsFromCSS=function(a){var b=[],c=a.indexOf("("),d=a.lastIndexOf(")");a=a.substring(c+1,d);c=a.indexOf("rgb");-1==c&&(c=a.indexOf("rgba"));for(-1==c&&(c=a.indexOf("#"));-1!=c;){d=a.indexOf(")",c+1);var e=a.substring(c,d+1);c=d+1;d=a.indexOf("%",c+1);c=Number(a.substring(c,d))/100;var f=this.createSVGStopColor(c,e);console.log("offsetValue: "+c+"  colorValue "+e);console.log(f);b.push(f);c=a.indexOf("rgb",d+1);-1==c&&(c=a.indexOf("rgba",d+1));-1==c&&(c=a.indexOf("#",
d+1))}return b};SVGSVGElement.prototype.createSVGGradientFromCSS=function(a,b){b=b||"__"+(new Date).getTime()+"__";var c=-1!=a.indexOf("linear")?this.createSVGLinearGradient(b,0,0,100,100):this.createSVGRadialGradient(b,0,0,100);c.appendChildren(this.createSVGStopColorsFromCSS(a));return c};
SVGSVGElement.prototype.createSVGImage=function(a,b,c,d,e,f){b=b||0;c=c||0;var g=document.createElementNS(SVGElement.SVG_NS,"image");g.setAttribute("x",b);g.setAttribute("y",c);d&&e?(g.setAttributeNS(SVGElement.XLINK_NS,"href",a),g.setAttribute("width",d),g.setAttribute("height",e)):(b=new Image,b.src=a,b.onload=function(){g.setAttributeNS(SVGElement.XLINK_NS,"href",a);g.setAttribute("width",this.width);g.setAttribute("height",this.height);f&&f()});return g};
SVGSVGElement.prototype.createSVGPattern=function(a,b,c,d,e,f,g,k){var l=document.createElementNS(SVGElement.SVG_NS,"pattern");a=a||"__"+(new Date).getTime()+"__";l.setAttribute("id",a);c=c||0;d=d||100;e=e||100;f=f||0;g=g||1;k=k||"userSpaceOnUse";l.setAttribute("x",b||0);l.setAttribute("y",c);l.setAttribute("patternTransform","rotate("+f+") scale("+g+") ");l.setAttribute("patternUnits",k);l.setAttribute("width",d);l.setAttribute("height",e);return l};
SVGSVGElement.prototype.createSVGPatternFromImageUrl=function(a,b,c,d,e,f){b=b||"__"+(new Date).getTime()+"__";c=c||0;d=d||0;var g=this.createSVGPattern(b,0,0,e,f);g.appendChild(this.createSVGImage(a,c,d,e,f));console.log("_width",e);console.log("_height",f);e||f||(console.log("carico image"),c=new Image,c.onload=function(a){console.log("onLoad image");g.setAttribute("width",this.naturalWidth);g.setAttribute("height",this.naturalHeight)},c.onload(a));return g};
SVGSVGElement.prototype.createSVGPatternFromImage=function(a,b,c,d,e,f){b=b||"__"+(new Date).getTime()+"__";c=c||0;d=d||0;e=e||a.naturalWidth;f=f||a.naturalHeight;b=this.createSVGPattern(b,0,0,e,f);b.appendChild(this.createSVGImage(a.src,c,d,e,f));return b};
SVGSVGElement.prototype.createMarker=function(a,b,c,d,e,f,g,k){var l=document.createElementNS(SVGElement.SVG_NS,"marker");b=b||"__"+(new Date).getTime()+"__";l.setAttribute("id",b);d=d||0;g=g||"auto";k=k||"strokeWidth";l.setAttribute("refX",c||0);l.setAttribute("refY",d);l.setAttribute("orient",g);l.setAttribute("markerUnits",k);l.setAttribute("style","overflow:visible;");e&&l.setAttribute("markerWidth",e);f&&l.setAttribute("markerHeight",f);b=a.cloneNode(!0);b.getTransform().matrix.identity();a&&
l.appendChild(b);return l};SVGSVGElement.prototype.__createSVGPoint=SVGSVGElement.prototype.createSVGPoint;SVGSVGElement.prototype.createSVGPoint=function(a,b){var c=this.__createSVGPoint();c.x=a||0;c.y=b||0;return c};SVGSVGElement.prototype.createSVGPointPolar=function(a,b){var c=this.__createSVGPoint();c.x=a*Math.cos(b);c.y=a*Math.sin(b);return c};
SVGSVGElement.prototype.createRect=function(a,b,c,d,e){var f=document.createElementNS(SVGElement.SVG_NS,"rect");e?f.setAttribute("transform","matrix(1,0,0,1,"+a+","+b+")"):(f.setAttribute("x",a),f.setAttribute("y",b));c&&f.setAttribute("width",c);d&&f.setAttribute("height",d);return f};SVGSVGElement.prototype.createCircle=function(a,b,c){var d=document.createElementNS(SVGElement.SVG_NS,"circle");d.setAttribute("cx",a);d.setAttribute("cy",b);d.setAttribute("r",c);return d};
SVGSVGElement.prototype.createTextBox=function(a,b,c,d,e,f,g,k,l){var h=document.createElementNS(SVGElement.SVG_NS,"text");h.setAttribute("controller-class","Text_box");h.setAttribute("transform","matrix(1,0,0,1,"+a+","+b+")");h.setAttribute("width",c);h.setAttribute("height",d);l=l||"left";k=k||"12";g=g||"regular";h.setAttribute("font-family",f||"arial");h.setAttribute("font-size",k);h.setAttribute("font-style",g);h.setAttribute("text-align",l);a="start";"left"==l?a="start":"center"==l?a="middle":
"right"==l&&(a="end");h.setAttribute("text-anchor",a);l=document.createElementNS(SVGElement.SVG_NS,"tspan");e=document.createTextNode(e);l.appendChild(e);h.appendChild(l);return h};
SVGSVGElement.prototype.createForeingObject=function(a,b,c,d,e){var f=document.createElementNS(SVGElement.SVG_NS,"foreignObject");f.setAttribute("requiredFeatures","http://www.w3.org/TR/SVG11/feature#Extensibility");f.setAttribute("x",a);f.setAttribute("y",b);f.setAttribute("width",c);f.setAttribute("height",d);f.innerHTML=e;return f};SVGSVGElement.prototype.createClipPath=function(a){var b=document.createElementNS(SVGElement.SVG_NS,"clipPath");b.setAttribute("id",a);return b};
SVGSVGElement.prototype.createMask=function(a){var b=document.createElementNS(SVGElement.SVG_NS,"mask");b.setAttribute("id",a);return b};SVGSVGElement.prototype.createEllipse=function(a,b,c,d){var e=document.createElementNS(SVGElement.SVG_NS,"ellipse");e.setAttribute("cx",a);e.setAttribute("cy",b);e.setAttribute("rx",c);e.setAttribute("ry",d);return e};
SVGSVGElement.prototype.createGroup=function(a,b,c){var d=document.createElementNS(SVGElement.SVG_NS,"g");d.setAttribute("transform","matrix(1,0,0,1,"+(a||0)+","+(b||0)+")");c&&d.setAttribute("id",c);return d};SVGSVGElement.prototype.createPath=function(){return document.createElementNS(SVGElement.SVG_NS,"path")};SVGSVGElement.prototype.createSymbol=function(a){var b=document.createElementNS(SVGElement.SVG_NS,"symbol");b.setAttribute("id",a);return b};
SVGSVGElement.prototype.addElementToDefs=function(a,b){this.IDI||(this.IDI=0);a.id=b||"__"+((new Date).getTime()+this.IDI)+"__";this.querySelector("defs").appendChild(a);this.IDI++;return"url(#"+a.id+")"};SVGSVGElement.prototype.getElementFromDefs=function(a){a=this.extractIdFromUrl(a);return this.querySelector('defs [id="'+a+'"]')};SVGSVGElement.prototype.extractIdFromUrl=function(a){a=a.split("#")[1].split(")")[0];return a=a.split('"')[0]};
SVGSVGElement.prototype.removeUnusedDefsItems=function(){for(var a,b,c=this.querySelectorAll("defs>*[id]"),d=0;d<c.length;d++)b=c[d],a=b.getAttribute("id"),a=this.querySelectorAll('*[fill="url(#'+a+')"],*[stroke="url(#'+a+')"],*[filter="url(#'+a+')"],*[clip-path="url(#'+a+')"],*[*|href="#'+a+'"],*[marker-start="url(#'+a+')"],*[marker-mid="url(#'+a+')"],*[marker-end="url(#'+a+')"]'),0==a.length&&b.remove()};
SVGSVGElement.prototype.renameDynamicReferences=function(){for(var a=0,b=(new Date).getTime(),c=this.querySelectorAll("*[id]"),d=0;d<c.length;d++){var e=c[d],f=e.getAttribute("id");if(0==f.indexOf("_")){a++;var g="__"+b+"$"+a+"__";e.setAttribute("id",g);e=this.querySelectorAll('*[fill="url(#'+f+')"]');for(var k=0;k<e.length;k++)e[k].setAttribute("fill","url(#"+g+")");e=this.querySelectorAll('*[stroke="url(#'+f+')"]');for(k=0;k<e.length;k++)e[k].setAttribute("stroke","url(#"+g+")");e=this.querySelectorAll('*[filter="url(#'+
f+')"]');for(k=0;k<e.length;k++)e[k].setAttribute("filter","url(#"+g+")");e=this.querySelectorAll('*[clip-path="url(#'+f+')"]');for(k=0;k<e.length;k++)e[k].setAttribute("clip-path","url(#"+g+")");e=this.querySelectorAll('*[mask="url(#'+f+')"]');for(k=0;k<e.length;k++)e[k].setAttribute("mask","url(#"+g+")");e=this.querySelectorAll('*[*|href="url(#'+f+')"]');for(k=0;k<e.length;k++)e[k].setAttribute("href","#"+g);e=this.querySelectorAll('*[marker-start="url(#'+f+')"]');for(k=0;k<e.length;k++)e[k].setAttribute("marker-start",
"url(#"+g+")");e=this.querySelectorAll('*[marker-mid="url(#'+f+')"]');for(k=0;k<e.length;k++)e[k].setAttribute("marker-mid","url(#"+g+")");e=this.querySelectorAll('*[marker-end="url(#'+f+')"]');for(k=0;k<e.length;k++)e[k].setAttribute("marker-end","url(#"+g+")")}}};
SVGSVGElement.prototype.createUse=function(a,b,c,d,e){var f=document.createElementNS(SVGElement.SVG_NS,"use");b=b||0;c=c||0;d=d||1;e=e||0;var g=SVGElement.svgUtils.createSVGMatrix();g=g.translate(b,c).scale(d).rotate(e);f.getTransform().setMatrix(g);f.setAttributeNS(SVGElement.XLINK_NS,"href","#"+a);return f};SVGSVGElement.prototype.createXlink=function(a,b){var c=document.createElementNS(SVGElement.SVG_NS,"a");c.setAttribute("xlink:href",a);b&&c.setAttribute("target",b);return c};
SVGSVGElement.prototype.createLine=function(a,b,c,d){var e=document.createElementNS(SVGElement.SVG_NS,"line");e.setAttribute("x1",a);e.setAttribute("y1",b);e.setAttribute("x2",c);e.setAttribute("y2",d);return e};SVGSVGElement.prototype.createSVG=function(a,b){var c=document.createElementNS(SVGElement.SVG_NS,"svg");c.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink");c.setAttribute("width",a);c.setAttribute("height",b);return c};
SVGSVGElement.prototype.interpolatePoints=function(a,b,c){"undefined"===typeof c&&(c=.5);return{x:a.x+(b.x-a.x)*c,y:a.y+(b.y-a.y)*c}};SVGSVGElement.prototype.getLineAngle=function(a,b,c){for(a=Math.atan2(b.y-a.y,b.x-a.x);0>a;)a+=2*Math.PI;1==c&&(a=180*a/Math.PI);return a};SVGSVGElement.prototype.getLineLength=function(a,b){var c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)};
SVGSVGElement.prototype.getLineLineIntersection=function(a,b,c,d){var e=d.x-c.x;var f=d.y-c.y;d=b.x-a.x;b=b.y-a.y;var g=a.y-c.y,k=a.x-c.x;c=f*d-e*b;e=(e*g-f*k)/c;f=(d*g-b*k)/c;return 0<=e&&1>=e&&0<=f&&1>=f?(f=a.y+e*b,e=a.x+e*d,{x:e,y:f}):null};
SVGSVGElement.prototype.getPolygonLineIntersection=function(a,b,c,d){console.log(a);for(var e,f=[],g=a.length-1,k=0;k<g;k++)if(e=this.getLineLineIntersection(a[k],a[k+1],b,c),console.log("intersectionPt"),console.log(e),e){if(d)return!0;f.push(e)}return d?!1:e};
SVGSVGElement.prototype.parseTransformString=function(a){var b={rotate:{value:0,x:0,y:0},scale:{x:1,y:1}};if(!a)return b;var c=a.indexOf("rotate");if(-1<c){c=a.indexOf("(",c+6);var d=a.indexOf(")",c);c=a.substring(c+1,d);console.log("rotate properties",c);b.rotate={value:0,x:0,y:0};c=c.split(",");c[0]&&(b.rotate.value=parseFloat(c[0]));c[1]&&(b.rotate.x=parseFloat(c[1]));c[2]&&(b.rotate.y=parseFloat(c[2]))}c=a.indexOf("scale");-1<c&&(c=a.indexOf("(",c+5),d=a.indexOf(")",c),c=a.substring(c+1,d),console.log("scale properties",
c),b.scale={x:1,y:1},c=c.split(","),c[0]&&(b.scale.x=parseFloat(c[0])),c[1]&&(b.scale.y=parseFloat(c[1])));return b};
SVGClipPathElement.prototype.normalizeScale=SVGGElement.prototype.normalizeScale=function(a){var b=this.parentNode;b instanceof SVGMaskElement&&(b=b.parentNode);b=b.globalToLocal(this.normalizationData.globalPosition.x,this.normalizationData.globalPosition.y);var c=this.getTransform().matrix.identity().rotate(this.normalizationData.localRotation);this.getTransform().setMatrix(this.ownerSVGElement.createSVGMatrix().translate(b.x,b.y).multiply(c));b=this.childNodes.length;for(c=0;c<b;c++)this.childNodes[c].normalizeScale&&
this.childNodes[c].normalizeScale(a)};SVGClipPathElement.prototype.toSVGPathElement=SVGGElement.prototype.toSVGPathElement=function(){return null};SVGGElement.prototype.getLocalBBox=function(){var a=this.getBBox();if(this.hasAttribute("clip-path")){var b=this.querySelector("clipPath");b&&(a=b.getBBox())}a.center={x:a.x+a.width/2,y:a.y+a.height/2};a.min={x:a.x,y:a.y};a.max={x:a.x+a.width,y:a.y+a.height};return a};
SVGGElement.prototype.getGlobalBBox=function(){var a=this.getBoundingClientRect();if(this.hasAttribute("clip-path")){var b=this.querySelector("clipPath");b&&(a=b.getBoundingClientRect())}b={};b.y=b.top=a.top-40;b.x=b.left=a.left;b.width=a.width;b.height=a.height;b.min={x:b.x,y:b.y};b.max={x:b.x+b.width,y:b.y+b.height};b.center={x:b.x+b.width/2,y:b.y+b.height/2};b.right=b.max.x;b.bottom=b.max.y;return b};
SVGRectElement.prototype.normalizeScale=function(a){var b=this.globalMatrixToLocalMatrix(this.normalizationData.previousGlobalMatrix),c=b.getScale(),d=Math.sqrt(Math.abs(c.x)*Math.abs(c.y));a.scaleStrokeWidth&&this.scaleAttributeNumber("stroke-width",d);this.scaleAttributeNumber("x",c.x);this.scaleAttributeNumber("y",c.y);this.scaleAttributeNumber("width",c.x);this.scaleAttributeNumber("height",c.y);a=this.ownerSVGElement.createSVGMatrix().scaleNonUniform(c.x,c.y).inverse();this.getTransform().setMatrix(b.multiply(a));
(b=this.getGradient("fill"))&&this.normalizeGradientScale(b);(b=this.getGradient("stroke"))&&this.normalizeGradientScale(b)};SVGRectElement.prototype.toSVGPathElement=function(){var a=SVGElement.svgUtils.createPath();a.setPathData(this.getPathData({normalize:!0}));return a};SVGRectElement.prototype.updateGeometry=function(a,b,c,d){this.x.baseVal.value=a;this.y.baseVal.value=b;c&&(this.width.baseVal.value=c);d&&(this.height.baseVal.value=d)};
SVGImageElement.prototype.initializeWithOriginalSize=function(a){var b=this,c=new Image;c.src=b.getAttributeNS(SVGElement.XLINK_NS,"href");c.onload=function(){b.setAttribute("width",this.width);b.setAttribute("height",this.height);var c=b.getTransform().matrix.getScale();c=b.ownerSVGElement.createSVGMatrix().scaleNonUniform(c.x,c.y).inverse();b.getTransform().setMatrix(b.getTransform().matrix.multiply(c));a&&a()}};
SVGEllipseElement.prototype.normalizeScale=function(a){var b=this.globalMatrixToLocalMatrix(this.normalizationData.previousGlobalMatrix),c=b.getScale(),d=Math.sqrt(Math.abs(c.x)*Math.abs(c.y));a.scaleStrokeWidth&&this.scaleAttributeNumber("stroke-width",d);this.scaleAttributeNumber("cx",c.x);this.scaleAttributeNumber("cy",c.y);this.scaleAttributeNumber("rx",c.x);this.scaleAttributeNumber("ry",c.y);a=this.ownerSVGElement.createSVGMatrix().scaleNonUniform(c.x,c.y).inverse();this.getTransform().setMatrix(b.multiply(a));
(b=this.getGradient("fill"))&&this.normalizeGradientScale(b);(b=this.getGradient("stroke"))&&this.normalizeGradientScale(b)};SVGEllipseElement.prototype.updateGeometry=function(a,b,c,d){this.cx.baseVal.value=a;this.cy.baseVal.value=b;this.rx.baseVal.value=c;this.ry.baseVal.value=d};SVGEllipseElement.prototype.toSVGPathElement=function(){var a=SVGElement.svgUtils.createPath();a.setPathData(this.getPathData({normalize:!0}));return a};
SVGLineElement.prototype.removeTransformation=function(){var a=this.getTransformToElement(this.parentElement),b=SVGElement.svgUtils.createSVGPoint(this.getAttribute("x1"),this.getAttribute("y1")),c=SVGElement.svgUtils.createSVGPoint(this.getAttribute("x2"),this.getAttribute("y2"));this.getTransform().matrix.identity();b=b.matrixTransform(a);c=c.matrixTransform(a);this.setAttribute("x1",b.x);this.setAttribute("y1",b.y);this.setAttribute("x2",c.x);this.setAttribute("y2",c.y)};
SVGLineElement.prototype.normalizeScale=function(a){a.scaleStrokeWidth&&(a=this.normalizationData.previousGlobalMatrix.getScale(),this.scaleAttributeNumber("stroke-width",Math.sqrt(Math.abs(a.x)*Math.abs(a.y))));a=SVGElement.svgUtils.createSVGPoint(this.x1.baseVal.value,this.y1.baseVal.value);var b=SVGElement.svgUtils.createSVGPoint(this.x2.baseVal.value,this.y2.baseVal.value);a=a.matrixTransform(this.normalizationData.previousGlobalMatrix);b=b.matrixTransform(this.normalizationData.previousGlobalMatrix);
var c=this.parentNode.globalToLocal(this.normalizationData.globalPosition.x,this.normalizationData.globalPosition.y),d=this.getTransform().matrix.identity().rotate(this.normalizationData.localRotation);this.getTransform().setMatrix(this.ownerSVGElement.createSVGMatrix().translate(c.x,c.y).multiply(d));a=this.globalToLocal(a.x,a.y);b=this.globalToLocal(b.x,b.y);this.x1.baseVal.value=a.x;this.y1.baseVal.value=a.y;this.x2.baseVal.value=b.x;this.y2.baseVal.value=b.y;(gradient=this.getGradient("stroke"))&&
this.normalizeGradientScale(gradient)};SVGLineElement.prototype.intersectGlobalRect=function(a){if(this.isContainedInGlobalRect(a))return!0;a=this.globalRectToLocalPolygon(a);return SVGElement.svgUtils.getPolygonLineIntersection(a,{x:this.x1.baseVal.value,y:this.y1.baseVal.value},{x:this.x2.baseVal.value,y:this.y2.baseVal.value},!0)};
Object.defineProperty(SVGLineElement.prototype,"width",{get:function(){var a=SVGElement.svgUtils.createSVGPoint(this.getAttribute("x1"),this.getAttribute("y1"));return SVGElement.svgUtils.createSVGPoint(this.getAttribute("x2"),this.getAttribute("y2")).getDistanceFromPoint(a)},set:function(a){var b=SVGElement.svgUtils.createSVGPoint(this.getAttribute("x1"),this.getAttribute("y1")),c=SVGElement.svgUtils.createSVGPoint(this.getAttribute("x2"),this.getAttribute("y2"));a/=c.getDistanceFromPoint(b);c.x=
b.x+(c.x-b.x)*a;c.y=b.y+(c.y-b.y)*a;this.setAttribute("x2",c.x);this.setAttribute("y2",c.y)},enumerable:!0});
Object.defineProperty(SVGLineElement.prototype,"orientation",{get:function(){var a=SVGElement.svgUtils.createSVGPoint(this.getAttribute("x1"),this.getAttribute("y1")),b=SVGElement.svgUtils.createSVGPoint(this.getAttribute("x2"),this.getAttribute("y2"));return a.getAngleFromPoint(b,!0)},set:function(a){var b=SVGElement.svgUtils.createSVGPoint(this.getAttribute("x1"),this.getAttribute("y1")),c=SVGElement.svgUtils.createSVGPoint(this.getAttribute("x2"),this.getAttribute("y2"));c=c.getDistanceFromPoint(b);
c=SVGElement.svgUtils.createSVGPointPolar(c,Math.PI/180*a);this.setAttribute("x2",b.x+c.x);this.setAttribute("y2",b.y+c.y)},enumerable:!0});SVGLineElement.prototype.toSVGPathElement=function(){var a=SVGElement.svgUtils.createPath();a.setPathData(this.getPathData({normalize:!0}));return a};SVGLineElement.prototype.updateGeometry=function(a,b,c,d){this.x1.baseVal.value=a;this.y1.baseVal.value=b;this.x2.baseVal.value=c;this.y2.baseVal.value=d};_=SVGTextElement.prototype;
_.__defineGetter__("textData",function(){return this.getTextData()});_.__defineSetter__("textData",function(a){this.setTextData(a);this.redrawText()});_.__defineGetter__("textAlign",function(){return this.getAttribute("text-align")||"left"});_.__defineSetter__("textAlign",function(a){this.setAttribute("text-align",a);this.redrawText()});_.__defineGetter__("fontSize",function(){return this.getAttribute("font-size")});_.__defineSetter__("fontSize",function(a){this.setAttribute("font-size",a);this.redrawText()});
_.__defineGetter__("lineHeight",function(){return this.getAttribute("line-height")||"normal"});_.__defineSetter__("lineHeight",function(a){this.setAttribute("line-height",a);this.redrawText()});_.__defineGetter__("fontFamily",function(){return this.getAttribute("font-family")});_.__defineSetter__("fontFamily",function(a){this.setAttribute("font-family",a);this.redrawText()});_.__defineGetter__("letterSpacing",function(){return this.getAttribute("letter-spacing")||0});
_.__defineSetter__("letterSpacing",function(a){this.setAttribute("letter-spacing",a);this.redrawText()});_.__defineGetter__("wordSpacing",function(){return this.getAttribute("word-spacing")||0});_.__defineSetter__("wordSpacing",function(a){this.setAttribute("word-spacing",a);this.redrawText()});_.__defineGetter__("textBoxWidth",function(){return this.getAttribute("width")||100});_.__defineSetter__("textBoxWidth",function(a){this.setAttribute("width",a);this.redrawText()});
_.__defineGetter__("textBoxHeight",function(){return this.getAttribute("height")||100});_.__defineSetter__("textBoxHeight",function(a){this.setAttribute("height",a);this.redrawText()});SVGTextPathElement.prototype.normalizeScale=function(a){};SVGTextPathElement.prototype.prepareToNormalizeScale=function(a){};SVGTSpanElement.prototype.__getComputedTextLength=SVGTSpanElement.prototype.getComputedTextLength;
SVGTSpanElement.prototype.getComputedTextLength=function(a){var b=this.__getComputedTextLength();if(a&&(a.letterSpacing&&(b+=a.letterSpacing*(this.firstChild.data.length-1)),a.wordSpacing)){var c=this.firstChild.data.split(" ").length;b+=a.wordSpacing*(c-1)}return b};SVGTSpanElement.prototype.setText=function(a,b){var c=this.firstChild.data;this.firstChild.data=a;return this.getBBox().width>b?(this.firstChild.data=c,!1):!0};
SVGTSpanElement.prototype.addWord=function(a,b){var c=this.firstChild.data.length;if(0==c)return this.firstChild.data+=a,!0;this.firstChild.data+=" "+a;return this.getBBox().width>b?(this.firstChild.data=this.firstChild.data.slice(0,c),!1):!0};SVGPathElement.prototype.setAttribute=function(a,b){this.__setAttribute(a,b);this.onAttributeChanged(a)};
SVGPathElement.prototype.normalizeScale=function(a){a.scaleStrokeWidth&&(a=this.normalizationData.previousGlobalMatrix.getScale(),this.scaleAttributeNumber("stroke-width",Math.sqrt(Math.abs(a.x)*Math.abs(a.y))));this.segListMatrixTransform(this.normalizationData.previousGlobalMatrix);a=this.parentNode.globalToLocal(this.normalizationData.globalPosition.x,this.normalizationData.globalPosition.y);var b=this.getTransform().matrix.identity().rotate(this.normalizationData.localRotation);this.getTransform().setMatrix(this.ownerSVGElement.createSVGMatrix().translate(a.x,
a.y).multiply(b));this.segListMatrixTransform(this.ownerSVGElement.getTransformToElement(this));(a=this.getGradient("fill"))&&this.normalizeGradientScale(a);(a=this.getGradient("stroke"))&&this.normalizeGradientScale(a)};
SVGPathElement.prototype.createSubPathList=function(){var a=[],b=this.pathSegList;var c=b.numberOfItems;for(var d=0;d<c;d++){var e=b.getItem(d);e.pathOwner=this;if(e.pathSegType==SVGPathSeg.PATHSEG_MOVETO_ABS){var f={rootPathOwner:this,pathSegList:[],isClose:!1};a.push(f)}else e.pathSegType==SVGPathSeg.PATHSEG_CLOSEPATH&&(f.isClose=!0);e.subPathOwner=f;f.pathSegList.push(e)}e=a.length;for(var g=0;g<e;g++){f=a[g];b=f.pathSegList;c=b.length-1;b[0].previousSegment=null;b[0].nextSegment=b[1];for(d=1;d<
c;d++)b[d].previousSegment=b[d-1],b[d].nextSegment=b[d+1];b[c].previousSegment=b[c-1];b[c].nextSegment=null}this.subPathList=a};
SVGPathElement.prototype.segListMatrixTransform=function(a,b){for(var c=SVGElement.svgUtils.createSVGPoint(),d,e,f=this.pathSegList.numberOfItems,g=0;g<f;g++)d=this.pathSegList.getItem(g),e=b?b.getItem(g):d,d.pathSegType!=SVGPathSeg.PATHSEG_CLOSEPATH&&(c.x=e.x,c.y=e.y,c=c.matrixTransform(a),d.x=c.x,d.y=c.y,d.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS?(c.x=e.x1,c.y=e.y1,c=c.matrixTransform(a),d.x1=c.x,d.y1=c.y):d.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS&&(c.x=e.x1,c.y=e.y1,c=c.matrixTransform(a),
d.x1=c.x,d.y1=c.y,c.x=e.x2,c.y=e.y2,c=c.matrixTransform(a),d.x2=c.x,d.y2=c.y))};SVGPathElement.prototype.cloneSegment=function(a){a=this.pathSegList.getItem(a);var b=null;switch(a.pathSegType){case SVGPathSeg.PATHSEG_LINETO_ABS:b=this.createSVGPathSegLinetoAbs(a.x,a.y);break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:b=this.createSVGPathSegCurvetoQuadraticAbs(a.x,a.y,a.x1,a.y1);break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:b=this.createSVGPathSegCurvetoCubicAbs(a.x,a.y,a.x1,a.y1,a.x2,a.y2)}return b};
SVGPathElement.prototype.revertSegments=function(){this.subPathList||this.createSubPathList();for(var a=[],b,c,d,e,f,g=0;g<this.subPathList.length;g++){e=this.subPathList[g].pathSegList;c=e.length-1;b=e[c];if("Z"==b.type||"z"==b.type)c--,b=e[c];a.push(this.createSVGPathSegMovetoAbs(b.x,b.y));for(var k=c;0<k;k--)c=e[k],d=e[k-1],c=SVGPathSegment.createSegment(c.type,c.values.clone()),a.push(c),c.x=d.x,c.y=d.y,c.type==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS&&(d=c.x1,f=c.y1,c.x1=c.x2,c.y1=c.y2,c.x2=d,c.y2=
f);"Z"!=b.type&&"z"!=b.type||a.push(this.createSVGPathSegClosePath())}b=SVGElement.svgUtils.createPath();this.hasAttribute("id")&&b.setAttribute("id",this.getAttribute("id"));b.getTransform().setMatrix(this.getTransform().matrix.clone());b.setAttribute("stroke-width",this.getAttribute("stroke-width"));b.setAttribute("stroke",this.getAttribute("stroke"));b.setAttribute("fill",this.getAttribute("fill"));console.log("newSegmentList",a);b.setPathData(a);return b};
SVGPathElement.prototype.closePath=function(){this.subPathList||this.createSubPathList();for(var a=[],b,c,d,e=0;e<this.subPathList.length;e++)d=this.subPathList[e].pathSegList,b=d[0],c=d[d.length-1],"Z"!=c.type&&"z"!=c.type&&(b.x==c.x&&b.y==c.y||d.push(this.createSVGPathSegLinetoAbs(b.x,b.y)),d.push(this.createSVGPathSegClosePath())),a=a.concat(d);this.setPathData(a);this.subPathList=null};
SVGPathElement.prototype.closestPoint=function(a){function b(b){var c=b.x-a.x;b=b.y-a.y;return c*c+b*b}for(var c=this.getTotalLength(),d=c/this.pathSegList.numberOfItems*.125,e,f,g=Infinity,k,l=0,h;l<=c;l+=d)(h=b(k=this.getPointAtLength(l)))<g&&(e=k,f=l,g=h);for(d*=.5;.5<d;){var m,n,p,q,u,r;0<=(p=f-d)&&(u=b(m=this.getPointAtLength(p)))<g?(e=m,f=p,g=u):(q=f+d)<=c&&(r=b(n=this.getPointAtLength(q)))<g?(e=n,f=q,g=r):d*=.5}return{x:e.x,y:e.y,distance:Math.sqrt(g),length:f}};
SVGPathElement.prototype.splitAtSegment=function(a){var b,c=!1;var d=this.pathSegList.getItem(a);var e=this.cloneNode(!0);var f=e.findEndPathSegmentFrom(d);f.pathSegType==SVGPathSeg.PATHSEG_CLOSEPATH&&(c=e.getPathSegIndex(f),e.pathSegList.removeItem(c),c=!0);f=e.cloneNode(!0);var g=e.pathSegList.numberOfItems;for(b=a+1;b<g;b++)e.pathSegList.removeItem(e.pathSegList.numberOfItems-1);for(b=1;b<=a;b++)f.pathSegList.removeItem(1);a=f.pathSegList.getItem(0);a.x=d.x;a.y=d.y;return c?[f.joinPathSegments(e)]:
[e,f]};SVGPathElement.prototype.joinPathSegments=function(a){for(var b=this.cloneNode(!0),c=a.pathSegList.numberOfItems,d=1;d<c;d++)b.pathSegList.appendItem(a.pathSegList.getItem(d));return b};SVGPathElement.prototype.unifyPathSegments=function(a){var b=a.getTransformToElement(this);a=a.cloneNode();a.segListMatrixTransform(b);b=a.pathSegList.numberOfItems;for(var c=0;c<b;c++)this.pathSegList.appendItem(a.pathSegList.getItem(c))};
SVGPathElement.prototype.separateSubPaths=function(){this.subPathList||this.createSubPathList();for(var a=[],b,c,d,e=0;e<this.subPathList.length;e++)d=SVGElement.svgUtils.createPath(),d.getTransform().setMatrix(this.getTransform().matrix.clone()),d.setAttribute("stroke-width",this.getAttribute("stroke-width")),d.setAttribute("stroke",this.getAttribute("stroke")),d.setAttribute("fill",this.getAttribute("fill")),c=this.subPathList[e].pathSegList,d.setPathData(c),b=c[0],c=c[c.length-1],console.log("firstSegment",
b),console.log("lastSegment",c),"Z"!=c.type&&"z"!=c.type&&b.x==c.x&&b.y==c.y&&d.pathSegList.appendItem(d.createSVGPathSegClosePath()),a.push(d);return a};
SVGPathElement.prototype.joinPath=function(a){console.log("_pathToJoin",a);if(a==this){a=a.cloneNode();var b=a.pathSegList.getItem(0),c=a.pathSegList.getItem(a.pathSegList.numberOfItems-1);return c.pathSegType==SVGPathSeg.PATHSEG_CLOSEPATH?null:5>this.distanceFromPoints(b,c)?(c.x=b.x,c.y=b.y,a.pathSegList.appendItem(a.createSVGPathSegClosePath()),a):null}b=a.getTransformToElement(this);a=a.cloneNode();a.segListMatrixTransform(b);b=this.pathSegList.getItem(0);c=this.pathSegList.getItem(this.pathSegList.numberOfItems-
1);var d=a.pathSegList.getItem(0),e=a.pathSegList.getItem(a.pathSegList.numberOfItems-1);return 5>this.distanceFromPoints(c,d)?this.joinPathSegments(a):5>this.distanceFromPoints(c,e)?this.joinPathSegments(a.revertSegments()):5>this.distanceFromPoints(b,e)?this.revertSegments().joinPathSegments(a.revertSegments()):5>this.distanceFromPoints(b,d)?this.revertSegments().joinPathSegments(a):null};
SVGPathElement.prototype.convertQuadraticCurvesToCubicCurves=function(){var a=this.cloneNode(!0);console.log(a);for(var b=a.pathSegList.numberOfItems,c=0;c<b;c++){var d=a.pathSegList.getItem(c);console.log(d);d.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS&&(d=this.quadraticCurveToCubicCurve(a.pathSegList.getItem(c-1),d),a.pathSegList.replaceItem(d,c))}return a};
SVGPathElement.prototype.splitAtClosestPoint=function(a,b){var c=this.convertQuadraticCurvesToCubicCurves(),d=c.closestPoint(a),e=c.getPathSegAtLength(d.length);var f=c.pathSegList.getItem(e-1);var g=c.pathSegList.getItem(e);if(g.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS)d=jsBezier.nearestPointOnCurve(d,[{x:f.x,y:f.y},{x:g.x1,y:g.y1},{x:g.x2,y:g.y2},{x:g.x,y:g.y}]),g=(new Bezier(f.x,f.y,g.x1,g.y1,g.x2,g.y2,g.x,g.y)).split(d.location),f=c.createSVGPathSegCurvetoCubicAbs(g.left.points[3].x,
g.left.points[3].y,g.left.points[1].x,g.left.points[1].y,g.left.points[2].x,g.left.points[2].y),g=c.createSVGPathSegCurvetoCubicAbs(g.right.points[3].x,g.right.points[3].y,g.right.points[1].x,g.right.points[1].y,g.right.points[2].x,g.right.points[2].y);else if(g.pathSegType==SVGPathSeg.PATHSEG_LINETO_ABS)f=c.createSVGPathSegLinetoAbs(d.x,d.y),g=c.createSVGPathSegLinetoAbs(g.x,g.y);else return null;c.pathSegList.insertItemBefore(f,e);c.pathSegList.insertItemBefore(g,e+1);c.pathSegList.removeItem(e+
2);return 0!=b?c.splitAtSegment(e):c};SVGPathElement.prototype.getLengthAtSegment=function(a){var b=this.cloneNode(!0),c=b.pathSegList.numberOfItems;for(a+=1;a<c;a++)b.pathSegList.removeItem(b.pathSegList.length-1);c=b.getTotalLength();b.pathSegList.removeItem(b.pathSegList.length-1);b=b.getTotalLength();return{segmentLength:c-b,lengthWithSegment:c,lengthWithoutSegment:b}};
SVGPathElement.prototype.getPointAndRotationAtLength=function(a){var b=this.getTotalLength();if(a+3>b){var c=this.getPointAtLength(b-3);a=this.getPointAtLength(b)}else c=this.getPointAtLength(a),a=this.getPointAtLength(a+3);return{x:c.x,y:c.y,angle:Math.atan2(c.y-a.y,c.x-a.x)}};SVGPathElement.prototype.quadraticCurveToCubicCurve=function(a,b){return this.createSVGPathSegCurvetoCubicAbs(b.x,b.y,a.x+2/3*(b.x1-a.x),a.y+2/3*(b.y1-a.y),b.x1+1/3*(b.x-b.x1),b.y1+1/3*(b.y-b.y1))};
SVGPathElement.prototype.splitCubicCurveAtPercent=function(a,b){for(var c,d=[];0<a.length;){for(c=0;c<a.length-1;c++)d.unshift(a[c]),a[c]=SVGElement.svgUtils.interpolatePoints(a[c],a[c+1],b);d.unshift(a.pop())}return{b1:[{x:d[5].x,y:d[5].y},{x:d[2].x,y:d[2].y},{x:d[0].x,y:d[0].y}],b2:[{x:d[1].x,y:d[1].y},{x:d[3].x,y:d[3].y},{x:d[6].x,y:d[6].y}]}};
SVGPathElement.prototype.isClosed=function(a){a=a||0;var b=this.pathSegList.numberOfItems;for(a;a<b;a++)if(this.pathSegList.getItem(a).pathSegType==SVGPathSeg.PATHSEG_CLOSEPATH)return!0;return!1};SVGPathElement.prototype.getPathSegIndex=function(a){for(var b=this.pathSegList.numberOfItems,c=0;c<b;c++)if(this.pathSegList.getItem(c)==a)return c;return null};SVGPathElement.prototype.getPreviousSegmentOf=function(a){a=this.getPathSegIndex(a);return-1<a-1?this.pathSegList.getItem(a-1):null};
SVGPathElement.prototype.getNextSegmentOf=function(a){a=this.getPathSegIndex(a);return a+1<this.pathSegList.numberOfItems?this.pathSegList.getItem(a+1):null};SVGPathElement.prototype.findStartPathSegmentFrom=function(a){a=this.getPathSegIndex(a);for(var b;0<=a;){b=this.pathSegList.getItem(a);if(b.pathSegType==SVGPathSeg.PATHSEG_MOVETO_ABS)break;a--}return b};
SVGPathElement.prototype.findEndPathSegmentFrom=function(a){console.log("_segment",a);a=this.getPathSegIndex(a);console.log("idSeg",a);var b=this.pathSegList.numberOfItems;console.log("max",b);for(var c;a<b;){c=this.pathSegList.getItem(a);console.log("idSeg",a);console.log("endSegment",c);if(c&&c.pathSegType==SVGPathSeg.PATHSEG_CLOSEPATH)break;a++}return c};
SVGPathElement.prototype.hasPointInPolygon=function(a){for(var b,c=this.pathSegList.numberOfItems,d=0;d<c;d++)if(b=this.pathSegList.getItem(d),"Z"!=b.type&&this.isPointInPoly(a,b))return!0;return!1};SVGPathElement.prototype.intersectGlobalRect=function(a){if(this.isContainedInGlobalRect(a))return!0;a=this.globalRectToLocalPolygon(a);if(this.hasPointInPolygon(a))return!0;for(var b=this.getTotalLength(),c,d=0;d<b;){c=this.getPointAtLength(d);if(this.isPointInPoly(a,c))return!0;d+=3}return!1};
SVGPathElement.prototype.toPolygonPath=function(a){a=a||3;var b=this.getTotalLength(),c=0,d=b/(b/a);for(a=[];c<=b;){var e=this.getPointAtLength(c);a.push({type:"L",values:[e.x,e.y]});c+=d}b=SVGElement.svgUtils.createPath();b.getTransform().setMatrix(this.getTransform().matrix.clone());b.setAttribute("stroke-width",this.getAttribute("stroke-width"));b.setAttribute("stroke",this.getAttribute("stroke"));b.setAttribute("fill",this.getAttribute("fill"));a[0].type="M";b.setPathData(a);b.getPathData({normalize:!0});
return b};
SVGPathElement.prototype.createContour2=function(a){a=a||parseFloat(this.getAttribute("stroke-width"));for(var b=this.getTotalLength(),c=0,d=b/(b/3),e,f,g=[],k=[];c<=b;)e=this.getPointAndRotationAtLength(c),f=SVGElement.svgUtils.createSVGPointPolar(a/2,e.angle+Math.PI/2),g.push({type:"L",values:[e.x+f.x,e.y+f.y]}),k.push({type:"L",values:[e.x-f.x,e.y-f.y]}),c+=d;a=SVGElement.svgUtils.createPath();a.setAttribute("stroke","none");a.setAttribute("fill",this.getAttribute("stroke"));a.matrix=this.getTransform().matrix.clone();
g[0].type="M";k=k.reverse();this.isClosed()&&(g.push({type:"Z",values:[]}),k[0].type="M");k.push({type:"Z",values:[]});g=g.concat(k);a.setPathData(g);a.getPathData({normalize:!0});g={};paper.install(g);paper.setup([640,480]);g=g.project.importSVG(a);g.simplify(0);a=g.exportSVG();a.getPathData({normalize:!0});return a};
SVGPathElement.prototype.createContour=function(a,b){b=b||parseFloat(this.getAttribute("stroke-width"));b/=2;var c=[],d=this.pathSegList.numberOfItems;var e=this.pathSegList.getItem(0);var f=this.getPointAndRotationAtLength(0);var g=SVGElement.svgUtils.createSVGPointPolar(b,f.angle-Math.PI/2);c.push({type:"M",values:[e.x+g.x,e.y+g.y]});for(var k,l=1;l<d;l++){f=this.pathSegList.getItem(l);if(f.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS)for(e=[e.x,e.y],e=e.concat(f.values),e=new Bezier(e),e=
e.offset(b),g=0;g<e.length;g++)k=e[g],k=k.points,c.push({type:"C",values:[k[1].x,k[1].y,k[2].x,k[2].y,k[3].x,k[3].y]});else if(f.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS)for(e=[e.x,e.y],e=e.concat(f.values),e=new Bezier(e),e=e.offset(b),g=0;g<e.length;g++)k=e[g],k=k.points,c.push({type:"Q",values:[k[1].x,k[1].y,k[2].x,k[2].y]});else f.pathSegType==SVGPathSeg.PATHSEG_LINETO_ABS&&(g=SVGElement.svgUtils.createSVGPointPolar(b,Math.atan2(e.y-f.y,e.x-f.x)-Math.PI/2),c.push({type:"L",values:[f.x+
g.x,f.y+g.y]}));e=f}d=SVGElement.svgUtils.createPath();d.setAttribute("stroke","none");d.setAttribute("fill",this.getAttribute("stroke"));d.matrix=this.getTransform().matrix.clone();d.setPathData(c);d.getPathData({normalize:!0});return d};SVGPathElement.prototype.toSVGPathElement=function(){console.log("SVGPathElement.prototype.toSVGPathElement");return this.cloneNode(!0)};_=SVGForeignObjectElement.prototype;
_.normalizeScale=function(a){a=this.globalMatrixToLocalMatrix(this.normalizationData.previousGlobalMatrix);var b=a.getScale();this.scaleAttributeNumber("x",b.x);this.scaleAttributeNumber("y",b.y);this.scaleAttributeNumber("width",b.x);this.scaleAttributeNumber("height",b.y);b=this.ownerSVGElement.createSVGMatrix().scaleNonUniform(b.x,b.y).inverse();this.getTransform().setMatrix(a.multiply(b))};
_.toSVGPathElement=function(){var a=SVGElement.svgUtils.createRect(this.x.baseVal.value,this.y.baseVal.value,this.width.baseVal.value,this.height.baseVal.value);a.getTransform().setMatrix(this.getTransform().matrix.clone());var b=SVGElement.svgUtils.createPath();b.setPathData(a.getPathData({normalize:!0}));return b};
_.getGlobalBBox=function(){var a=this.getCTM(),b=this.ownerSVGElement.createSVGPoint();var c=this.getLocalBBox();b.x=c.x;b.y=c.y;var d=b.matrixTransform(a);b.x=c.x+c.width;b.y=c.y;var e=b.matrixTransform(a);b.x=c.x+c.width;b.y=c.y+c.height;var f=b.matrixTransform(a);b.x=c.x;b.y=c.y+c.height;var g=b.matrixTransform(a);a=Math.min(d.x,e.x,f.x,g.x);b=Math.max(d.x,e.x,f.x,g.x);var k=Math.min(d.y,e.y,f.y,g.y);d=Math.max(d.y,e.y,f.y,g.y);c.min={x:a,y:k};c.max={x:b,y:d};c.x=a;c.y=k;c.width=b-a;c.height=d-
k;c.left=a;c.right=b;c.top=k;c.bottom=d;c.center={x:c.x+c.width/2,y:c.y+c.height/2};return c};_.updateGeometry=function(a,b,c,d){this.x.baseVal.value=a;this.y.baseVal.value=b;c&&(this.width.baseVal.value=c);d&&(this.height.baseVal.value=d)};_.createUniqueDefReferences=function(){};SVGMaskElement.prototype.getScreenCTM=function(a){return this.parentNode.getScreenCTM()};
SVGMaskElement.prototype.prepareToNormalizeScale=function(a){this.normalizationData=this.parentNode.normalizationData;for(var b=this.childNodes.length,c=0;c<b;c++)this.childNodes[c].prepareToNormalizeScale&&this.childNodes[c].prepareToNormalizeScale(a)};SVGMaskElement.prototype.normalizeScale=function(a){for(var b=this.childNodes.length,c=0;c<b;c++)this.childNodes[c].normalizeScale&&this.childNodes[c].normalizeScale(a)};
function Base2D_tool(a){this.editorRef=a;this.endPenInfo=this.currentPenInfo=this.startPenInfo=null;this.previousScreenPositionSnapped={x:0,y:0};this.currentOffsetScreenPositionSnapped={x:0,y:0};this.defaultTipMessage="Click";this.onMouseDownTipMessage="Drag";this.onMouseStartDragTipMessage="Continue drag"}_=Base2D_tool.prototype;
_.onActivate=function(){this.editorRef.activeDocument&&(this.editorRef.activeDocument.isHTMLTextEditing||this.editorRef.activeDocument.isTextEditing)&&this.editorRef.activeDocument.exitFromTextEditing();this.editorRef.disableInteraction()};_.onDeactivate=function(){};_.onKeyDown=function(a){console.log("tools onKeyDown")};_.onKeyUp=function(a){};_.onUndo=function(){};_.onRedo=function(){};
_.onMouseWheel=function(a){"undefined"==typeof a&&(a=window.event);if(!(30>Math.abs(void 0!=a.wheelDelta?a.wheelDelta:-a.detail))){this.wheelingTimeout||(console.log("start wheeling!"),this.onMouseWheelChangeStart(a));var b=this;clearTimeout(this.wheelingTimeout);this.wheelingTimeout=setTimeout(function(){console.log("stop wheeling!");b.wheelingTimeout=void 0;b.onMouseWheelChangeEnd(a)},250);this.onMouseWheelChange(a);a.preventPropagation()}};
_.onMouseWheelChange=function(a){"undefined"==typeof a&&(a=window.event);var b=1;b=0<(void 0!=a.wheelDelta?a.wheelDelta:-a.detail)?b+.05:b-.05;this.editorRef.activeDocument.zoom(b,GMOUSE.mouseMovePt.x,GMOUSE.mouseMovePt.y)};_.onMouseWheelChangeStart=function(a){this.editorRef.activeDocument.removeAllInteractions()};_.onMouseWheelChangeEnd=function(a){this.editorRef.activeDocument.createInteractionFromSelection()};
_.onMouseDown=function(a){this.currentPenInfo=this.startPenInfo=this.editorRef.activeDocument.screenPointToPenInfo(GMOUSE.mouseDownPt);GMOUSE.globalMouseTargetDelegate=this};_.onMouseUp=function(a){if(Event.isDoubleClick)this.onMouseDoubleClick(a)};_.onMouseMove=function(a){this.currentPenInfo=this.editorRef.activeDocument.screenPointToPenInfo(GMOUSE.mouseMovePt)};_.onMouseDoubleClick=function(a){};_.onTouchStart=function(a){this.onMouseDown(a)};
_.onGlobalMouseStartDrag=function(a){this.previousScreenPositionSnapped.x=this.currentPenInfo.screenPositionSnapped.x=this.startPenInfo.screenPositionSnapped.x;this.previousScreenPositionSnapped.y=this.currentPenInfo.screenPositionSnapped.y=this.startPenInfo.screenPositionSnapped.y;this.currentOffsetScreenPositionSnapped={x:0,y:0};this.editorRef.activeDocument.removeAllInteractions()};_.onGlobalMouseDrag=function(a){this.evalPanOrZoomAction(a);this.calculateMouseDragPenOffset()};
_.onGlobalMouseEndDrag=function(a){this.endPenInfo=this.currentPenInfo;this.editorRef.activeDocument.createInteractionFromSelection();this.editorRef.activeDocument.showSelectionProperties()};_.snapMouseDragToAngle=function(){GMOUSE.mouseMovePt=this.editorRef.activeDocument.pointToSnap_angle(GMOUSE.mouseMovePt,this.startPenInfo.screenPositionSnapped)};
_.calculateMouseDragPenOffset=function(a){1!=a?(Event.isShiftKeyPressed&&this.snapMouseDragToAngle(),this.currentPenInfo=this.editorRef.activeDocument.screenPointToPenInfo(GMOUSE.mouseMovePt)):this.currentPenInfo=this.editorRef.activeDocument.screenPointToPenInfo(GMOUSE.mouseMovePt,!0);this.currentOffsetScreenPositionSnapped.x=this.currentPenInfo.screenPositionSnapped.x-this.previousScreenPositionSnapped.x;this.currentOffsetScreenPositionSnapped.y=this.currentPenInfo.screenPositionSnapped.y-this.previousScreenPositionSnapped.y;
this.previousScreenPositionSnapped.x=this.currentPenInfo.screenPositionSnapped.x;this.previousScreenPositionSnapped.y=this.currentPenInfo.screenPositionSnapped.y};
_.evalPanOrZoomAction=function(a){if(Event.isSpaceBarKeyPressed){this.calculateMouseDragPenOffset(!0);if(Event.isAltKeyPressed){a=Math.abs(1+.005*this.currentOffsetScreenPositionSnapped.y);var b=this.editorRef.activeDocument.screenPointToGlobal(this.currentPenInfo.screenPosition);this.editorRef.activeDocument.zoom(a,b.x,b.y)}else this.editorRef.activeDocument.pan(this.currentOffsetScreenPositionSnapped.x,this.currentOffsetScreenPositionSnapped.y);this.startPenInfo.screenPositionSnapped=this.editorRef.activeDocument.content.localToScreen(this.startPenInfo.pointInContentSnapped.x,
this.startPenInfo.pointInContentSnapped.y);return!0}return!1};_.createInteractiveRectangle=function(a,b){this.interactiveRectangle=SVGElement.svgUtils.createRect(this.startPenInfo.screenPositionSnapped.x,this.startPenInfo.screenPositionSnapped.y,1,1);this.interactiveRectangle.setStrokeAndFill(a||"#0047FF","none",2,b||"none");this.interactiveRectangle.setAttribute("style","mix-blend-mode:exclusion;");this.editorRef.INTERACTION_SVG.appendChild(this.interactiveRectangle)};
_.updateInteractiveRectangle=function(){this.interactiveRectangle.updateGeometry(Math.min(this.currentPenInfo.screenPositionSnapped.x,this.startPenInfo.screenPositionSnapped.x),Math.min(this.currentPenInfo.screenPositionSnapped.y,this.startPenInfo.screenPositionSnapped.y),Math.abs(this.currentPenInfo.screenPositionSnapped.x-this.startPenInfo.screenPositionSnapped.x),Math.abs(this.currentPenInfo.screenPositionSnapped.y-this.startPenInfo.screenPositionSnapped.y))};
_.createInteractiveLine=function(a,b){this.interactiveLine=SVGElement.svgUtils.createLine(this.startPenInfo.screenPositionSnapped.x,this.startPenInfo.screenPositionSnapped.y,this.currentPenInfo.screenPositionSnapped.x,this.currentPenInfo.screenPositionSnapped.y);this.interactiveLine.setStrokeAndFill(a||"#0047FF","none",1,b||"none");this.editorRef.INTERACTION_SVG.appendChild(this.interactiveLine)};
_.updateInteractiveLine=function(){this.interactiveLine.updateGeometry(this.startPenInfo.screenPositionSnapped.x,this.startPenInfo.screenPositionSnapped.y,this.currentPenInfo.screenPositionSnapped.x,this.currentPenInfo.screenPositionSnapped.y)};Extends(Selection_tool,Base2D_tool);function Selection_tool(a){Selection_tool.superConstructor.call(this,a);this.hitRect=this.clickedElement=null;this.selectionMode=this.editorRef.GLOBAL_BBOX_SELECTION;this.interactiveRectangle=null}_=Selection_tool.prototype;
_.onActivate=function(){Selection_tool.superClass.onActivate.call(this);this.editorRef.selectionMode=this.selectionMode;this.editorRef.activeDocument&&this.editorRef.activeDocument.createInteractionFromSelection();this.editorRef.enableInteraction()};_.setSelectionMode=function(a){this.selectionMode=a};
_.onKeyDown=function(a){a=a.keyCode;var b=this.editorRef.activeDocument,c=b.unitToValue(b.arrowKeysTranslateValue);c*=b.content.getScreenCTM().getScale().x;switch(a){case 37:b.translateElementList_undable(b.selectionList,-c,0);break;case 38:b.translateElementList_undable(b.selectionList,0,-c);break;case 39:b.translateElementList_undable(b.selectionList,c,0);break;case 40:b.translateElementList_undable(b.selectionList,0,c)}console.log("Selection_tool onKeyDown",a)};
_.onMouseDown=function(a){Selection_tool.superClass.onMouseDown.call(this,a);Event.isSpaceBarKeyPressed||(this.clickedElement=this.startPenInfo.element,console.log("this.clickedElement",this.startPenInfo.element),this.clickedElement?this.editorRef.activeDocument.isLockedElement(this.clickedElement)||(0==this.editorRef.activeDocument.isGroupEditing&&this.editorRef.selectionMode==this.editorRef.GLOBAL_BBOX_SELECTION&&(a=this.editorRef.activeDocument.getLayerFromElement(this.clickedElement),a.classList.contains("jvs-layer")&&
this.editorRef.activeDocument.setActiveLayer(a),this.clickedElement=this.clickedElement.getParentInGrandParent(a)),this.clickedElement instanceof SVGTSpanElement&&(this.clickedElement=this.clickedElement.parentElement),this.clickedElement instanceof SVGTextPathElement&&(this.clickedElement=this.clickedElement.parentElement),console.log("this.clickedElement 2",this.clickedElement),Event.isShiftKeyPressed?this.clickedElement.isSelected?this.editorRef.activeDocument.deselectElement(this.clickedElement):
this.editorRef.activeDocument.selectElement(this.clickedElement):this.clickedElement.isSelected?(this.editorRef.activeDocument.currentEditableElement=this.clickedElement,this.editorRef.activeDocument.showSelectionProperties()):(this.editorRef.activeDocument.deselectAllElements(),this.editorRef.activeDocument.selectElement(this.clickedElement))):Event.isShiftKeyPressed||this.editorRef.activeDocument.deselectAllElements())};
_.onGlobalMouseUp=function(a){GMOUSE.isDragAction||(console.log("Selection2D_tool onGlobalMouseUp"),this.editorRef.activeDocument.createInteractionFromSelection(),this.editorRef.activeDocument.showSelectionProperties())};
_.onMouseDoubleClick=function(a){this.clickedElement?this.clickedElement instanceof SVGPathElement?this.editorRef.selectionMode!=this.editorRef.POINTS_SELECTION&&this.editorRef.activateTool("selectLocal_tool"):this.clickedElement instanceof SVGGElement?this.clickedElement.hasAttribute("jvs-class")&&-1<this.clickedElement.getAttribute("jvs-class").indexOf("not-editable")||this.editorRef.activeDocument.enterTo_isolateLayerEditing(this.clickedElement):this.clickedElement instanceof SVGTextElement?this.clickedElement.hasAttribute("controller-class")&&
"Text_box"==this.clickedElement.getAttribute("controller-class")&&this.editorRef.activeDocument.enterTo_TextEditing(this.clickedElement):this.clickedElement instanceof SVGForeignObjectElement&&this.editorRef.activeDocument.enterTo_HTMLTextEditing(this.clickedElement):(this.editorRef.selectionMode!=this.editorRef.GLOBAL_BBOX_SELECTION&&this.editorRef.activateTool("selectGlobal_tool"),this.editorRef.activeDocument.exitFrom_GroupEditing(),this.editorRef.activeDocument.exitFrom_isolateLayerEditing())};
_.onGlobalMouseStartDrag=function(a){Selection_tool.superClass.onGlobalMouseStartDrag.call(this,a);this.editorRef.activeDocument.classList.add("mouse-drag-event");this.dragAction=null;if(!Event.isSpaceBarKeyPressed){var b=this.startPenInfo.element;if(!b||Event.isAltKeyPressed&&Event.isShiftKeyPressed)this.dragAction="drawInteractiveRectangle",this.createInteractiveRectangle("#303030","2,2");else{var c=this.editorRef.activeDocument;console.log("elementToDrag",b);b instanceof SVGTSpanElement&&(b=b.parentElement);
b instanceof SVGTextPathElement&&(b=b.parentElement);var d=this.editorRef.activeDocument.getLayerFromElement(b);b.isSelected?(Event.isAltKeyPressed&&(c.duplicateElementList_undable(c.selectionList,0,0),c.removeAllInteractions()),this.dragAction="translateElements",this.onStartTranslateElements(a)):(0==this.editorRef.activeDocument.isGroupEditing&&this.editorRef.selectionMode==this.editorRef.GLOBAL_BBOX_SELECTION&&(b=b.getParentInGrandParent(d)),b.isSelected&&(Event.isAltKeyPressed&&(c.duplicateElementList_undable(c.selectionList,
0,0),c.removeAllInteractions()),this.dragAction="translateElements",this.onStartTranslateElements(a)))}}};_.onGlobalMouseDrag=function(a){this.evalPanOrZoomAction(a);this.currentPenInfo=this.editorRef.activeDocument.penInfo;"drawInteractiveRectangle"==this.dragAction?(this.calculateMouseDragPenOffset(!0),this.updateInteractiveRectangle()):"translateElements"==this.dragAction&&(this.calculateMouseDragPenOffset(),this.onTranslateElements(a))};
_.onGlobalMouseEndDrag=function(a){this.editorRef.activeDocument.classList.remove("mouse-drag-event");this.endPenInfo=this.currentPenInfo;if(Event.isSpaceBarKeyPressed)this.editorRef.activeDocument.createInteractionFromSelection(),this.editorRef.activeDocument.showSelectionProperties();else if("translateElements"==this.dragAction)this.onEndTranslateElements(a),this.editorRef.activeDocument.createInteractionFromSelection(),this.editorRef.activeDocument.showSelectionProperties();else if("drawInteractiveRectangle"==
this.dragAction){a=this.editorRef.activeDocument.screenPointToGlobal({x:this.interactiveRectangle.x.baseVal.value,y:this.interactiveRectangle.y.baseVal.value});var b=this.editorRef.activeDocument.screenPointToGlobal({x:this.interactiveRectangle.x.baseVal.value+this.interactiveRectangle.width.baseVal.value,y:this.interactiveRectangle.y.baseVal.value+this.interactiveRectangle.height.baseVal.value}),c=this.editorRef.activeDocument.createSVGRect();c.x=a.x;c.y=a.y;c.width=b.x-a.x;c.height=b.y-a.y;c.left=
c.x;c.top=c.y;c.right=c.x+c.width;c.bottom=c.y+c.height;var d=this.editorRef.activeDocument.elementListFromIntersection(c);if(0==d.length)Event.isShiftKeyPressed||this.editorRef.activeDocument.deselectAllElements(),this.editorRef.activeDocument.createInteractionFromSelection(),this.editorRef.activeDocument.showSelectionProperties();else if(Event.isShiftKeyPressed||this.editorRef.activeDocument.deselectAllElements(),this.editorRef.selectionMode==this.editorRef.GLOBAL_BBOX_SELECTION){c=[];var e;b=d.length;
for(a=0;a<b;a++)!1===this.editorRef.activeDocument.isLockedElement(d[a])&&(e=this.editorRef.activeDocument.getLayerFromElement(d[a]))&&(e=d[a].getParentInGrandParent(e),-1==c.indexOf(e)&&c.push(e));if(Event.isShiftKeyPressed)for(b=c.length,a=0;a<b;a++)e=c[a],e.isSelected?this.editorRef.activeDocument.deselectElement(e):this.editorRef.activeDocument.selectElement(e);else this.editorRef.activeDocument.selectElementList(c);this.editorRef.activeDocument.createInteractionFromSelection();this.editorRef.activeDocument.showSelectionProperties()}else{e=
[];b=d.length;for(a=0;a<b;a++)!1===this.editorRef.activeDocument.isLockedElement(d[a])&&e.push(d[a]);this.editorRef.activeDocument.selectElementList(e);this.editorRef.activeDocument.createInteractionFromSelection();this.editorRef.activeDocument.showSelectionProperties();c.x=this.interactiveRectangle.x.baseVal.value;c.y=this.interactiveRectangle.y.baseVal.value;c.width=this.interactiveRectangle.width.baseVal.value;c.height=this.interactiveRectangle.height.baseVal.value;d=this.editorRef.INTERACTION_SVG.getIntersectionList(c,
null);b=d.length;for(a=0;a<b;a++)d[a].segRef.isSelected?(d[a].classList.remove("selected"),this.editorRef.activeDocument.deselectPoint(d[a].segRef)):(d[a].classList.add("selected"),this.editorRef.activeDocument.selectPoint(d[a].segRef))}}};_.onStartTranslateElements=function(a){console.log("onStartTranslateElements");a=this.editorRef.activeDocument;a.disableSelectionPointerEvents();a.removeAllInteractions();this.undoTranslationAction=new SetMatrix_action(a);this.undoTranslationAction.addElements(a.selectionList)};
_.onTranslateElements=function(a){a=this.editorRef.activeDocument.selectionList;for(var b=0;b<a.length;b++)a[b].translateInGlobal(this.currentOffsetScreenPositionSnapped.x,this.currentOffsetScreenPositionSnapped.y)};
_.onEndTranslateElements=function(a){a=this.editorRef.activeDocument;this.redoTranslationAction=new SetMatrix_action(a);this.redoTranslationAction.addElements(a.selectionList);a.history.addUndoRedoActions(this.undoTranslationAction,this.redoTranslationAction);var b=this.endPenInfo.screenPositionSnapped.x-this.startPenInfo.screenPositionSnapped.x,c=this.endPenInfo.screenPositionSnapped.y-this.startPenInfo.screenPositionSnapped.y;a.applyLastTransformAction=function(a){this.translateElementList(a,b,
c)};a.dispatchGeometryChangedEvent(a.selectionList);a.onChange();a.enableSelectionPointerEvents()};Extends(PanView_tool,Base2D_tool);function PanView_tool(a){PanView_tool.superConstructor.call(this,a)}_=PanView_tool.prototype;_.onGlobalMouseDrag=function(a){PanView_tool.superClass.onGlobalMouseDrag.call(this,a);this.editorRef.activeDocument.pan(this.currentOffsetScreenPositionSnapped.x,this.currentOffsetScreenPositionSnapped.y)};Extends(ZoomView_tool,Base2D_tool);
function ZoomView_tool(a){ZoomView_tool.superConstructor.call(this,a)}_=ZoomView_tool.prototype;_.onMouseDoubleClick=function(a){this.editorRef.activeDocument.fitPageToView()};_.onGlobalMouseDrag=function(a){ZoomView_tool.superClass.onGlobalMouseDrag.call(this,a);a=Math.abs(1+.005*this.currentOffsetScreenPositionSnapped.y);var b=this.editorRef.activeDocument.screenPointToGlobal(this.startPenInfo.screenPositionSnapped);this.editorRef.activeDocument.zoom(a,b.x,b.y)};Extends(DrawLine_tool,Base2D_tool);
function DrawLine_tool(a){DrawLine_tool.superConstructor.call(this,a)}_=DrawLine_tool.prototype;_.onActivate=function(){DrawLine_tool.superClass.onActivate.call(this);this.editorRef.activeDocument.deselectAllElements();this.editorRef.activeDocument.removeAllInteractions()};
_.onMouseDown=function(a){this.editorRef.activeDocument.isLockedElement(this.editorRef.activeDocument.activeLayer)?this.editorRef.appRef.ALERT_DIALOG.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):DrawLine_tool.superClass.onMouseDown.call(this,a)};
_.onGlobalMouseStartDrag=function(a){DrawLine_tool.superClass.onGlobalMouseStartDrag.call(this,a);this.interactiveLine=null;Event.isSpaceBarKeyPressed||(this.editorRef.activeDocument.deselectAllElements(),this.createInteractiveLine("#0047FF"))};_.onGlobalMouseDrag=function(a){DrawLine_tool.superClass.onGlobalMouseDrag.call(this,a);this.interactiveLine&&this.updateInteractiveLine(a)};
_.onGlobalMouseEndDrag=function(a){DrawLine_tool.superClass.onGlobalMouseEndDrag.call(this,a);this.interactiveLine&&this.createLine()};
_.createLine=function(){var a=this.editorRef.activeDocument,b=this.startPenInfo.pointInContentSnapped,c=this.endPenInfo.pointInContentSnapped;"none"==a.defaultDrawingProperties.stroke&&(a.defaultDrawingProperties.stroke="#000000");var d=SVGElement.svgUtils.createPath();d.pathSegList.appendItem(d.createSVGPathSegMovetoAbs(b.x,b.y));d.pathSegList.appendItem(d.createSVGPathSegLinetoAbs(c.x,c.y));a.activeLayer.appendChild(d);a.applyDefaultDrawingProperties(d);b=new RemoveElements_action(a);b.addElements([d]);
c=new AddElements_action(a);c.addElements([d]);a.history.addUndoRedoActions(b,c);a.selectElement(d);a.createInteractionFromSelection();a.showSelectionProperties();a.onChange()};Extends(DrawRectangle_tool,Base2D_tool);function DrawRectangle_tool(a){DrawRectangle_tool.superConstructor.call(this,a)}_=DrawRectangle_tool.prototype;_.onActivate=function(){DrawRectangle_tool.superClass.onActivate.call(this);this.editorRef.activeDocument.deselectAllElements();this.editorRef.activeDocument.removeAllInteractions()};
_.onMouseDown=function(a){this.editorRef.activeDocument.isLockedElement(this.editorRef.activeDocument.activeLayer)?this.editorRef.appRef.ALERT_DIALOG.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):DrawRectangle_tool.superClass.onMouseDown.call(this,a)};
_.onGlobalMouseStartDrag=function(a){DrawRectangle_tool.superClass.onGlobalMouseStartDrag.call(this,a);this.interactiveRectangle=null;Event.isSpaceBarKeyPressed||(this.editorRef.activeDocument.deselectAllElements(),this.createInteractiveRectangle("#0047FF"))};_.onGlobalMouseDrag=function(a){DrawRectangle_tool.superClass.onGlobalMouseDrag.call(this,a);this.interactiveRectangle&&this.updateInteractiveRectangle(a)};
_.onGlobalMouseEndDrag=function(a){DrawRectangle_tool.superClass.onGlobalMouseEndDrag.call(this,a);this.interactiveRectangle&&this.createRectangle()};_.snapMouseDragToAngle=function(){GMOUSE.mouseMovePt=this.editorRef.activeDocument.pointToSnap_angle45(GMOUSE.mouseMovePt,this.startPenInfo.screenPositionSnapped)};
_.createRectangle=function(){var a=this.editorRef.activeDocument,b=this.startPenInfo.pointInContentSnapped,c=this.endPenInfo.pointInContentSnapped;b=SVGElement.svgUtils.createRect(Math.min(b.x,c.x),Math.min(b.y,c.y),Math.abs(c.x-b.x),Math.abs(c.y-b.y),!0);a.activeLayer.appendChild(b);a.applyDefaultDrawingProperties(b);c=new RemoveElements_action(a);c.addElements([b]);var d=new AddElements_action(a);d.addElements([b]);a.history.addUndoRedoActions(c,d);a.selectElement(b);a.createInteractionFromSelection();
a.showSelectionProperties();a.onChange()};Extends(DrawEllipse_tool,Base2D_tool);function DrawEllipse_tool(a){DrawEllipse_tool.superConstructor.call(this,a)}_=DrawEllipse_tool.prototype;_.onActivate=function(){DrawEllipse_tool.superClass.onActivate.call(this);this.editorRef.activeDocument.deselectAllElements();this.editorRef.activeDocument.removeAllInteractions()};
_.onMouseDown=function(a){this.editorRef.activeDocument.isLockedElement(this.editorRef.activeDocument.activeLayer)?this.editorRef.appRef.ALERT_DIALOG.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):DrawEllipse_tool.superClass.onMouseDown.call(this,a)};
_.onGlobalMouseStartDrag=function(a){DrawEllipse_tool.superClass.onGlobalMouseStartDrag.call(this,a);this.interactiveEllipse=null;Event.isSpaceBarKeyPressed||(this.editorRef.activeDocument.deselectAllElements(),this.createInteractiveEllipse("#0047FF"))};_.onGlobalMouseDrag=function(a){DrawEllipse_tool.superClass.onGlobalMouseDrag.call(this,a);this.interactiveEllipse&&this.updateInteractiveEllipse(a)};
_.onGlobalMouseEndDrag=function(a){DrawEllipse_tool.superClass.onGlobalMouseEndDrag.call(this,a);this.interactiveEllipse&&this.createEllipse()};_.snapMouseDragToAngle=function(){GMOUSE.mouseMovePt=this.editorRef.activeDocument.pointToSnap_angle45(GMOUSE.mouseMovePt,this.startPenInfo.screenPositionSnapped)};
_.createInteractiveEllipse=function(a,b){this.interactiveEllipse=SVGElement.svgUtils.createEllipse(0,0,1,1);this.interactiveEllipse.setStrokeAndFill(a||"#0047FF","none",1,b||"none");this.updateInteractiveEllipse();this.editorRef.INTERACTION_SVG.appendChild(this.interactiveEllipse)};
_.updateInteractiveEllipse=function(){var a=this.startPenInfo.screenPositionSnapped,b=this.currentPenInfo.screenPositionSnapped,c=Math.abs(b.x-a.x)/2,d=Math.abs(b.y-a.y)/2;this.interactiveEllipse.updateGeometry(Math.min(a.x,b.x)+Math.abs(c),Math.min(a.y,b.y)+Math.abs(d),c,d)};
_.createEllipse=function(){var a=this.editorRef.activeDocument,b=this.startPenInfo.pointInContentSnapped,c=this.endPenInfo.pointInContentSnapped,d=Math.abs(c.x-b.x)/2,e=Math.abs(c.y-b.y)/2;b=SVGElement.svgUtils.createEllipse(Math.min(b.x,c.x)+Math.abs(d),Math.min(b.y,c.y)+Math.abs(e),d,e);a.activeLayer.appendChild(b);a.applyDefaultDrawingProperties(b);c=new RemoveElements_action(a);c.addElements([b]);d=new AddElements_action(a);d.addElements([b]);a.history.addUndoRedoActions(c,d);a.selectElement(b);
a.createInteractionFromSelection();a.showSelectionProperties();a.onChange()};Extends(DrawTextBox_tool,Base2D_tool);function DrawTextBox_tool(a){DrawTextBox_tool.superConstructor.call(this,a)}_=DrawTextBox_tool.prototype;_.onActivate=function(){DrawTextBox_tool.superClass.onActivate.call(this);this.editorRef.activeDocument.deselectAllElements();this.editorRef.activeDocument.removeAllInteractions()};
_.onMouseDown=function(a){this.interactiveRectangle=null;this.editorRef.activeDocument.isLockedElement(this.editorRef.activeDocument.activeLayer)?this.editorRef.appRef.ALERT_DIALOG.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):DrawTextBox_tool.superClass.onMouseDown.call(this,a)};
_.onMouseUp=function(a){if(!this.interactiveRectangle&&this.currentPenInfo.element&&this.currentPenInfo.element instanceof SVGTSpanElement){a=this.editorRef.activeDocument;a.deselectAllElements();var b=this.currentPenInfo.element.parentNode;a.selectElement(b);a.createInteractionFromSelection();a.showSelectionProperties();a.enterTo_TextEditing(b);a.onChange()}};
_.onGlobalMouseStartDrag=function(a){DrawTextBox_tool.superClass.onGlobalMouseStartDrag.call(this,a);Event.isSpaceBarKeyPressed||(this.editorRef.activeDocument.deselectAllElements(),this.createInteractiveRectangle("#0047FF"))};_.onGlobalMouseDrag=function(a){DrawTextBox_tool.superClass.onGlobalMouseDrag.call(this,a);this.interactiveRectangle&&this.updateInteractiveRectangle(a)};
_.onGlobalMouseEndDrag=function(a){DrawTextBox_tool.superClass.onGlobalMouseEndDrag.call(this,a);this.interactiveRectangle&&(Event.isAltKeyPressed?this.createHtmlTextBox():this.createTextBox())};_.snapMouseDragToAngle=function(){GMOUSE.mouseMovePt=this.editorRef.activeDocument.pointToSnap_angle45(GMOUSE.mouseMovePt,this.startPenInfo.screenPositionSnapped)};
_.createTextBox=function(){var a=this.editorRef.activeDocument,b=this.startPenInfo.pointInContentSnapped,c=this.endPenInfo.pointInContentSnapped;b=SVGElement.svgUtils.createTextBox(Math.min(b.x,c.x),Math.min(b.y,c.y),Math.abs(c.x-b.x),Math.abs(c.y-b.y),"Hello Text!","Open Sans","regular",20);b.connectController(Text_box,{document:a});a.activeLayer.appendChild(b);a.applyDefaultDrawingProperties(b);b.redrawText();c=new RemoveElements_action(a);c.addElements([b]);var d=new AddElements_action(a);d.addElements([b]);
a.history.addUndoRedoActions(c,d);a.selectElement(b);a.createInteractionFromSelection();a.showSelectionProperties();a.enterTo_TextEditing(b,!0);a.onChange()};
_.createHtmlTextBox=function(){var a=this.editorRef.activeDocument,b=this.startPenInfo.pointInContentSnapped,c=this.endPenInfo.pointInContentSnapped;b=SVGElement.svgUtils.createForeingObject(Math.min(b.x,c.x),Math.min(b.y,c.y),Math.abs(c.x-b.x),Math.abs(c.y-b.y),'<div class="text-box" style="font-family:arial,sans-serif;" ><div>Hello Text!</div></div>');a.activeLayer.appendChild(b);c=new RemoveElements_action(a);c.addElements([b]);var d=new AddElements_action(a);d.addElements([b]);a.history.addUndoRedoActions(c,
d);a.selectElement(b);a.createInteractionFromSelection();a.showSelectionProperties();a.onChange()};Extends(EditGradientPoints_tool,Base2D_tool);function EditGradientPoints_tool(a){EditGradientPoints_tool.superConstructor.call(this,a)}_=EditGradientPoints_tool.prototype;_.onGlobalMouseStartDrag=function(a){EditGradientPoints_tool.superClass.onGlobalMouseStartDrag.call(this,a);this.interactiveLine=null;Event.isSpaceBarKeyPressed||this.createInteractiveLine("#0047FF")};
_.onGlobalMouseDrag=function(a){EditGradientPoints_tool.superClass.onGlobalMouseDrag.call(this,a);this.interactiveLine&&this.updateInteractiveLine(a)};_.onGlobalMouseEndDrag=function(a){EditGradientPoints_tool.superClass.onGlobalMouseEndDrag.call(this,a);this.interactiveLine&&this.changeGradientPoints()};
_.changeGradientPoints=function(){var a=this.editorRef.activeDocument,b=a.screenPointToGlobal(this.startPenInfo.screenPositionSnapped),c=a.screenPointToGlobal(this.endPenInfo.screenPositionSnapped);a.setElementListGradientsPoints_undable(a.selectionList,a.editableGraphicSide,b,c)};Extends(EyeDropper_tool,Base2D_tool);function EyeDropper_tool(a){EyeDropper_tool.superConstructor.call(this,a)}_=EyeDropper_tool.prototype;
_.onMouseUp=function(a){0!=this.editorRef.activeDocument.selectionList.length&&this.startPenInfo.element&&this.copyPropertiesTo(this.editorRef.activeDocument.selectionList,this.startPenInfo.element,"vertices"==this.startPenInfo.snapClassName||"contour"==this.startPenInfo.snapClassName?"stroke":"fill")};_.onGlobalMouseStartDrag=function(a){EyeDropper_tool.superClass.onGlobalMouseStartDrag.call(this,a);this.interactiveLine=null;Event.isSpaceBarKeyPressed||this.createInteractiveLine("#0047FF")};
_.onGlobalMouseDrag=function(a){EyeDropper_tool.superClass.onGlobalMouseDrag.call(this,a);this.interactiveLine&&this.updateInteractiveLine(a)};_.onGlobalMouseEndDrag=function(a){EyeDropper_tool.superClass.onGlobalMouseEndDrag.call(this,a)};
_.copyPropertiesTo=function(a,b,c){var d=this.editorRef.activeDocument,e={};-1<c.indexOf("stroke")?(e.stroke=b.getAttribute("stroke")||"none",e["stroke-width"]=b.getAttribute("stroke-width")||"0",e["stroke-dasharray"]=b.getAttribute("stroke-dasharray")||""):(-1<c.indexOf("fill")||(e.stroke=b.getAttribute("stroke")||"none",e["stroke-width"]=b.getAttribute("stroke-width")||"0",e["stroke-dasharray"]=b.getAttribute("stroke-dasharray")||""),e.fill=b.getAttribute("fill")||"none");e.opacity=b.getAttribute("opacity")||
1;c=new SetAttributes_action(d);b=new SetAttributes_action(d);d.history.addUndoRedoActions(c,b);c.addElements(a,e);c=a.length;for(var f=0;f<c;f++)d.copyPropertiesTo(a[f],e);b.addElements(a,e);d.showSelectionProperties()};Extends(DrawPath_tool,Base2D_tool);
function DrawPath_tool(a){DrawPath_tool.superConstructor.call(this,a);this.interactiveCtrlPoint1=this.createInteractiveHandle("ctrl1");this.interactiveCtrlPoint2=this.createInteractiveHandle("ctrl2");this.handleSize=6;this.halfHandleSize=this.handleSize/2;this.newPath=null;this.isClosePathAction=!1;this.interactivePath=null}_=DrawPath_tool.prototype;
_.onActivate=function(){DrawPath_tool.superClass.onActivate.call(this);this.editorRef.selectionMode!=this.editorRef.POINTS_SELECTION&&(this.editorRef.selectionMode=this.editorRef.POINTS_SELECTION,this.editorRef.activeDocument.createInteractionFromSelection())};_.onDeactivate=function(){this.resetState()};_.onKeyDown=function(a){a=a.keyCode;switch(a){case 27:this.resetState()}console.log("DrawPath_tool onKeyDown",a)};
_.onUndo=function(){this.newPath&&this.newPath.parentNode?this.createInteractivePath():this.resetState()};_.onRedo=function(){this.newPath&&this.newPath.parentNode&&this.createInteractivePath()};_.resetState=function(){if(this.newPath)this.onEndDraw();this.interactivePath=this.newPath=null;this.isClosePathAction=!1};
_.onEndDraw=function(){var a=this.editorRef.activeDocument;this.newPath&&this.newPath.parentNode&&a.selectElement(this.newPath);a.createInteractionFromSelection();a.showSelectionProperties();a.onChange()};_.onMouseWheelChangeEnd=function(a){this.newPath&&this.createInteractivePath()};
_.onMouseDown=function(a){this.editorRef.activeDocument.isLockedElement(this.editorRef.activeDocument.activeLayer)?this.editorRef.appRef.ALERT_DIALOG.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):(DrawPath_tool.superClass.onMouseDown.call(this,a),Event.isSpaceBarKeyPressed)||(this.newPath?this.isPointOnFirstPathSegment(this.startPenInfo.pointInContentSnapped)&&(this.isClosePathAction=!0):(this.createNewPath(this.startPenInfo.pointInContentSnapped),
this.createInteractivePath()))};
_.onMouseMove=function(a){if(Event.isShiftKeyPressed){if(this.interactivePath&&1<this.interactivePath.pathSegList.numberOfItems){var b=this.interactivePath.pathSegList.getItem(this.interactivePath.pathSegList.numberOfItems-2);b=this.interactivePath.localToScreen(b.x,b.y);this.startPenInfo.screenPositionSnapped.x=b.x;this.startPenInfo.screenPositionSnapped.y=b.y}GMOUSE.mouseMovePt=this.editorRef.activeDocument.pointToSnap_angle(GMOUSE.mouseMovePt,this.startPenInfo.screenPositionSnapped)}DrawPath_tool.superClass.onMouseMove.call(this,a);
this.newPath&&(a=this.interactivePath.screenToLocal(this.currentPenInfo.screenPositionSnapped.x,this.currentPenInfo.screenPositionSnapped.y),this.updateInteractiveSegmentPoint(a))};_.onGlobalMouseStartDrag=function(a){Event.isSpaceBarKeyPressed?DrawPath_tool.superClass.onGlobalMouseStartDrag.call(this,a):this.newPath&&(a=this.currentInteractiveSegmentToCurve(),this.updateInteractiveSegmentCtrlPoint(a),this.addInteractiveHandles())};
_.onGlobalMouseDrag=function(a){this.newPath&&this.interactiveCtrlPoint1.parentNode?(Event.isShiftKeyPressed&&this.snapMouseDragToAngle(),this.currentPenInfo=this.editorRef.activeDocument.screenPointToPenInfo(GMOUSE.mouseMovePt),this.currentOffsetScreenPositionSnapped.x=this.currentPenInfo.screenPositionSnapped.x-this.previousScreenPositionSnapped.x,this.currentOffsetScreenPositionSnapped.y=this.currentPenInfo.screenPositionSnapped.y-this.previousScreenPositionSnapped.y,this.previousScreenPositionSnapped.x=
this.currentPenInfo.screenPositionSnapped.x,this.previousScreenPositionSnapped.y=this.currentPenInfo.screenPositionSnapped.y,a=this.interactivePath.screenToLocal(this.currentPenInfo.screenPositionSnapped.x,this.currentPenInfo.screenPositionSnapped.y),this.updateInteractiveSegmentCtrlPoint(a),this.updateInteractiveHandles()):DrawPath_tool.superClass.onGlobalMouseDrag.call(this,a)};_.onGlobalMouseEndDrag=function(a){this.newPath&&(this.removeInteractiveHandles(),this.createInteractivePath())};
_.onGlobalMouseUp=function(a){Event.isSpaceBarKeyPressed||(a=this.interactivePath.screenToLocal(this.currentPenInfo.screenPositionSnapped.x,this.currentPenInfo.screenPositionSnapped.y),this.isPointOnLastAddedPathSegment(a)?(console.log("stop alla continuit\u00e0 della curva"),this.newPath.pathSegList.getItem(this.newPath.pathSegList.numberOfItems-1).smooth=!1,this.createInteractivePath()):this.isClosePathAction?(this.addPathSegmentFromLastAddedInteractiveSegment(),this.createClosePathSegment(),this.resetState()):
(this.addPathSegmentFromLastAddedInteractiveSegment(),this.createInteractivePath(),a=this.interactivePath.screenToLocal(this.currentPenInfo.screenPositionSnapped.x,this.currentPenInfo.screenPositionSnapped.y),this.updateInteractiveSegmentPoint(a)))};
_.onClickOnSelectionHandle=function(a){console.log("onClickOnSelectionHandle segRef",a.segRef);var b=a.segRef.pathOwner.findEndPathSegmentFrom(a.segRef);if(!b||b.pathSegType!=SVGPathSeg.PATHSEG_CLOSEPATH){if(a.segRef.pathSegType==SVGPathSeg.PATHSEG_MOVETO_ABS){this.newPath=a.segRef.pathOwner.revertSegments();b=this.editorRef.activeDocument;var c=new ReplaceElements_action(b),d=new ReplaceElements_action(b);b.history.addUndoRedoActions(d,c);c.addElementsToRemove([a.segRef.pathOwner]);d.addElementsToAdd([a.segRef.pathOwner]);
a.segRef.pathOwner.parentNode.replaceChild(this.newPath,a.segRef.pathOwner);c.addElementsToAdd([this.newPath]);d.addElementsToRemove([this.newPath])}else this.newPath=a.segRef.pathOwner;this.editorRef.activeDocument.deselectAllElements();this.editorRef.activeDocument.removeAllInteractions();this.createInteractivePath();a=this.interactivePath.screenToLocal(GMOUSE.mouseMovePt.x,GMOUSE.mouseMovePt.y);this.updateInteractiveSegmentPoint(a);this.isClosePathAction=!1}};
_.isPointOnLastAddedPathSegment=function(a){if(2>this.interactivePath.pathSegList.numberOfItems)return!1;var b=this.interactivePath.pathSegList.getItem(this.interactivePath.pathSegList.numberOfItems-2);console.log("distanceFromPoints",Math.abs(this.interactivePath.distanceFromPoints(b,a)));return Math.abs(5>this.interactivePath.distanceFromPoints(b,a))?!0:!1};
_.isPointOnFirstPathSegment=function(a){var b=this.interactivePath.pathSegList.getItem(0);return 5>Math.abs(this.interactivePath.distanceFromPoints(b,a))?!0:!1};
_.createNewPath=function(a){var b=this.editorRef.activeDocument;b.deselectAllElements();b.removeAllInteractions();this.isClosePathAction=!1;this.newPath=SVGElement.svgUtils.createPath();this.newPath.pathSegList.appendItem(this.newPath.createSVGPathSegMovetoAbs(a.x,a.y));this.newPath.matrix=SVGElement.svgUtils.createSVGMatrix();b.activeLayer.appendChild(this.newPath);b.applyDefaultDrawingProperties(this.newPath);a=new RemoveElements_action(b);a.addElements([this.newPath]);var c=new AddElements_action(b);
c.addElements([this.newPath]);b.history.addUndoRedoActions(a,c)};
_.addPathSegmentFromLastAddedInteractiveSegment=function(a){a=this.interactivePath.getTransformToElement(this.newPath);var b=this.interactivePath.pathSegList.getItem(this.interactivePath.pathSegList.numberOfItems-1),c=SVGElement.svgUtils.createSVGPoint(b.x,b.y).matrixTransform(a);switch(b.pathSegType){case SVGPathSeg.PATHSEG_LINETO_ABS:var d=this.newPath.createSVGPathSegLinetoAbs(c.x,c.y);this.newPath.pathSegList.appendItem(d);break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:d=SVGElement.svgUtils.createSVGPoint(b.x1,
b.y1).matrixTransform(a);d=this.newPath.createSVGPathSegCurvetoQuadraticAbs(c.x,c.y,d.x,d.y);this.newPath.pathSegList.appendItem(d);break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:d=SVGElement.svgUtils.createSVGPoint(b.x1,b.y1).matrixTransform(a);var e=SVGElement.svgUtils.createSVGPoint(b.x2,b.y2).matrixTransform(a);d=this.newPath.createSVGPathSegCurvetoCubicAbs(c.x,c.y,d.x,d.y,e.x,e.y);this.newPath.pathSegList.appendItem(d)}d.pathOwner=this.newPath;d.smooth=b.smooth;b=this.editorRef.activeDocument;
c=new RemovePathSegment_action(b);c.addElements([d]);e=new AddPathSegment_action(b);e.addElements([d]);b.history.addUndoRedoActions(c,e);if(this.isClosePathAction&&d.smooth){var f=this.newPath.pathSegList.getItem(1);if(f.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS||f.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS)c=new SetPathSegmentPos_action(b),e=new SetPathSegmentPos_action(b),c.addElementAndProperties(f,{x1:f.x1,y1:f.y1}),d=this.interactivePath.pathSegList.getItem(1),d=SVGElement.svgUtils.createSVGPoint(d.x1,
d.y1).matrixTransform(a),f.x1=d.x,f.y1=d.y,e.addElementAndProperties(f,{x1:d.x,y1:d.y}),b.history.addUndoRedoActions(c,e)}};_.createClosePathSegment=function(a){a=this.newPath.createSVGPathSegClosePath();this.newPath.pathSegList.appendItem(a);a.pathOwner=this.newPath;var b=this.editorRef.activeDocument,c=new RemovePathSegment_action(b);c.addElements([a]);var d=new AddPathSegment_action(b);d.addElements([a]);b.history.addUndoRedoActions(c,d)};
_.createInteractivePath=function(){this.interactivePath&&this.interactivePath.parentNode&&this.editorRef.INTERACTION_SVG.removeChild(this.interactivePath);this.interactivePath=this.newPath.createElementPreview();this.editorRef.INTERACTION_SVG.appendChild(this.interactivePath);this.createNewDefaultInteractiveSegment()};
_.createNewDefaultInteractiveSegment=function(a){var b=null,c=this.newPath.pathSegList.getItem(this.newPath.pathSegList.numberOfItems-1).smooth;console.log("smooth",c);a=this.interactivePath.screenToLocal(this.startPenInfo.screenPositionSnapped.x,this.startPenInfo.screenPositionSnapped.y);if(c)switch(c=this.interactivePath.pathSegList.getItem(this.interactivePath.pathSegList.numberOfItems-1),console.log("lastAddedSegment",c),console.log("lastAddedSegment.pathSegType",c.pathSegType),c.pathSegType){case SVGPathSeg.PATHSEG_MOVETO_ABS:b=
this.interactivePath.createSVGPathSegLinetoAbs(a.x,a.y);break;case SVGPathSeg.PATHSEG_LINETO_ABS:b=this.interactivePath.createSVGPathSegLinetoAbs(a.x,a.y);break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:b=c.x-(c.x1-c.x);c=c.y-(c.y1-c.y);b=this.interactivePath.createSVGPathSegCurvetoQuadraticAbs(a.x,a.y,b,c);break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:b=c.x-(c.x2-c.x),c=c.y-(c.y2-c.y),b=this.interactivePath.createSVGPathSegCurvetoQuadraticAbs(a.x,a.y,b,c)}else b=this.interactivePath.createSVGPathSegLinetoAbs(a.x,
a.y);b&&this.interactivePath.pathSegList.appendItem(b);console.log("createNewDefaultInteractiveSegment",b)};
_.currentInteractiveSegmentToCurve=function(a){a=this.interactivePath.pathSegList.removeItem(this.interactivePath.pathSegList.numberOfItems-1);console.log("currentInteractiveSegmentToCurve lastAddedSegment",a);var b=null;switch(a.pathSegType){case SVGPathSeg.PATHSEG_MOVETO_ABS:b=this.interactivePath.createSVGPathSegCurvetoQuadraticAbs(a.x,a.y,a.x,a.y);break;case SVGPathSeg.PATHSEG_LINETO_ABS:b=this.interactivePath.createSVGPathSegCurvetoQuadraticAbs(a.x,a.y,a.x,a.y);break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:b=
this.interactivePath.createSVGPathSegCurvetoCubicAbs(a.x,a.y,a.x1,a.y1,a.x1,a.y1);break;case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:b=this.interactivePath.createSVGPathSegCurvetoCubicAbs(a.x,a.y,a.x1,a.y1,a.x1,a.y1)}b&&(this.interactivePath.pathSegList.appendItem(b),b.smooth=!0);console.log("currentInteractiveSegmentToCurve newSegment",b);return b};
_.updateInteractiveSegmentPoint=function(a){var b=this.interactivePath.pathSegList.getItem(this.interactivePath.pathSegList.numberOfItems-1);b.x=a.x;b.y=a.y};
_.updateInteractiveSegmentCtrlPoint=function(a){if(!(2>this.interactivePath.pathSegList.numberOfItems)){var b=this.interactivePath.pathSegList.getItem(this.interactivePath.pathSegList.numberOfItems-1),c=b.x-(a.x-b.x),d=b.y-(a.y-b.y);switch(b.pathSegType){case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS:b.x2=c;b.y2=d;break;case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:b.x1=c,b.y1=d}if(this.isClosePathAction){var e=this.interactivePath.pathSegList.getItem(1);if(e.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS||
e.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS)c=b.x+(a.x-b.x),d=b.y+(a.y-b.y),e.x1=c,e.y1=d}}};_.createInteractiveHandle=function(a){var b=SVGElement.svgUtils.createEllipse(0,0,3,3);b.setStrokeAndFill("#0052FF","#FFFFFF");b.id=a;b.classList.add("handle");b.classList.add("control-point");a=SVGElement.svgUtils.createLine(0,0,1,1);a.setStrokeAndFill("#0052FF");b.line=a;a=SVGElement.svgUtils.createRect(0,0,6,6);a.setStrokeAndFill("#0052FF","#FFFFFF");b.rectangle=a;return b};
_.addInteractiveHandles=function(a,b){this.editorRef.INTERACTION_SVG.appendChild(this.interactiveCtrlPoint1);this.editorRef.INTERACTION_SVG.appendChild(this.interactiveCtrlPoint1.line);this.editorRef.INTERACTION_SVG.appendChild(this.interactiveCtrlPoint2);this.editorRef.INTERACTION_SVG.appendChild(this.interactiveCtrlPoint2.line);this.editorRef.INTERACTION_SVG.appendChild(this.interactiveCtrlPoint2.rectangle);this.updateInteractiveHandles()};
_.removeInteractiveHandles=function(a){this.interactiveCtrlPoint1.parentNode&&(this.editorRef.INTERACTION_SVG.removeChild(this.interactiveCtrlPoint1),this.editorRef.INTERACTION_SVG.removeChild(this.interactiveCtrlPoint1.line),this.editorRef.INTERACTION_SVG.removeChild(this.interactiveCtrlPoint2),this.editorRef.INTERACTION_SVG.removeChild(this.interactiveCtrlPoint2.line),this.editorRef.INTERACTION_SVG.removeChild(this.interactiveCtrlPoint2.rectangle))};
_.updateInteractiveHandles=function(){var a=this.interactivePath.pathSegList.getItem(this.interactivePath.pathSegList.numberOfItems-1);console.log("lastAddedSegment",a);var b=this.interactivePath.localToScreen(a.x,a.y);this.interactiveCtrlPoint1.line.x1.baseVal.value=this.interactiveCtrlPoint1.cx.baseVal.value=b.x;this.interactiveCtrlPoint1.line.y1.baseVal.value=this.interactiveCtrlPoint1.cy.baseVal.value=b.y;this.interactiveCtrlPoint2.line.x1.baseVal.value=this.interactiveCtrlPoint2.cx.baseVal.value=
b.x;this.interactiveCtrlPoint2.line.y1.baseVal.value=this.interactiveCtrlPoint2.cy.baseVal.value=b.y;this.interactiveCtrlPoint2.rectangle.x.baseVal.value=b.x-3;this.interactiveCtrlPoint2.rectangle.y.baseVal.value=b.y-3;a.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS?(a=this.interactivePath.localToScreen(a.x1,a.y1),this.interactiveCtrlPoint1.line.x2.baseVal.value=this.interactiveCtrlPoint1.cx.baseVal.value=a.x,this.interactiveCtrlPoint1.line.y2.baseVal.value=this.interactiveCtrlPoint1.cy.baseVal.value=
a.y,this.interactiveCtrlPoint2.line.x2.baseVal.value=this.interactiveCtrlPoint2.cx.baseVal.value=b.x-(a.x-b.x),this.interactiveCtrlPoint2.line.y2.baseVal.value=this.interactiveCtrlPoint2.cy.baseVal.value=b.y-(a.y-b.y)):a.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS&&(a=this.interactivePath.localToScreen(a.x2,a.y2),this.interactiveCtrlPoint1.line.x2.baseVal.value=this.interactiveCtrlPoint1.cx.baseVal.value=a.x,this.interactiveCtrlPoint1.line.y2.baseVal.value=this.interactiveCtrlPoint1.cy.baseVal.value=
a.y,this.interactiveCtrlPoint2.line.x2.baseVal.value=this.interactiveCtrlPoint2.cx.baseVal.value=b.x-(a.x-b.x),this.interactiveCtrlPoint2.line.y2.baseVal.value=this.interactiveCtrlPoint2.cy.baseVal.value=b.y-(a.y-b.y))};Extends(SplitPath_tool,Base2D_tool);function SplitPath_tool(a){SplitPath_tool.superConstructor.call(this,a)}_=SplitPath_tool.prototype;
_.onActivate=function(){SplitPath_tool.superClass.onActivate.call(this);this.editorRef.selectionMode!=this.editorRef.POINTS_SELECTION&&(this.editorRef.selectionMode=this.editorRef.POINTS_SELECTION,this.editorRef.activeDocument.createInteractionFromSelection())};
_.onMouseDown=function(a){SplitPath_tool.superClass.onMouseDown.call(this,a);if((a=this.currentPenInfo.element)&&a instanceof SVGPathElement){var b=null;this.currentPenInfo.idSegment&&(b=a.pathSegList.getItem(this.currentPenInfo.idSegment));this.splitPath(a,b)}};
_.splitPath=function(a,b){var c=this.editorRef.activeDocument;if(b){var d=a.getPathSegIndex(b);d=a.splitAtSegment(d)}else d=a.screenToLocal(this.currentPenInfo.screenPositionSnapped.x,this.currentPenInfo.screenPositionSnapped.y),d=a.splitAtClosestPoint(d);var e=new ReplaceElements_action(c),f=new ReplaceElements_action(c);c.history.addUndoRedoActions(f,e);e.addElementsToRemove([a]);f.addElementsToAdd([a]);a.parentNode.insertChildrenBeforeElement(d,a);c.removeElementList([a]);e.addElementsToAdd(d);
f.addElementsToRemove(d);c.deselectAllElements();c.selectElementList([d[0]]);c.createInteractionFromSelection();console.log("resultPaths",d)};Extends(AddPathSegment_tool,Base2D_tool);function AddPathSegment_tool(a){AddPathSegment_tool.superConstructor.call(this,a)}_=AddPathSegment_tool.prototype;_.onActivate=function(){AddPathSegment_tool.superClass.onActivate.call(this);this.editorRef.selectionMode!=this.editorRef.POINTS_SELECTION&&(this.editorRef.selectionMode=this.editorRef.POINTS_SELECTION,this.editorRef.activeDocument.createInteractionFromSelection())};
_.onMouseDown=function(a){AddPathSegment_tool.superClass.onMouseDown.call(this,a);if((a=this.currentPenInfo.element)&&a instanceof SVGPathElement){var b=this.editorRef.activeDocument,c=a.screenToLocal(this.currentPenInfo.screenPosition.x,this.currentPenInfo.screenPosition.y);c=a.splitAtClosestPoint(c,!1);var d=new ReplaceElements_action(b),e=new ReplaceElements_action(b);b.history.addUndoRedoActions(e,d);d.addElementsToRemove([a]);e.addElementsToAdd([a]);a.parentNode.replaceChild(c,a);d.addElementsToAdd([c]);
e.addElementsToRemove([c]);b.deselectAllElements();b.selectElementList([c]);b.createInteractionFromSelection()}};Extends(RemovePathSegment_tool,Base2D_tool);function RemovePathSegment_tool(a){RemovePathSegment_tool.superConstructor.call(this,a)}_=RemovePathSegment_tool.prototype;_.onActivate=function(){RemovePathSegment_tool.superClass.onActivate.call(this);this.editorRef.selectionMode!=this.editorRef.POINTS_SELECTION&&(this.editorRef.selectionMode=this.editorRef.POINTS_SELECTION,this.editorRef.activeDocument.createInteractionFromSelection())};
_.onMouseDown=function(a){RemovePathSegment_tool.superClass.onMouseDown.call(this,a);a=this.currentPenInfo.element;console.log(a);a&&a instanceof SVGPathElement&&this.currentPenInfo.idSegment&&this.removeSegment(a,a.pathSegList.getItem(this.currentPenInfo.idSegment))};
_.removeSegment=function(a,b){var c=this.editorRef.activeDocument,d={},e={};if(b){var f=a.getPathSegIndex(b),g=a.getNextSegmentOf(b),k=a.getPreviousSegmentOf(b),l=a.findEndPathSegmentFrom(b),h=a.findStartPathSegmentFrom(b);console.log("moveToSegment",h);console.log("lastPathSegment",l);console.log("segmentToRemove",b);console.log("previousSegment",k);console.log("nextSegment",g);var m=b.x;var n=b.y;var p=h.x;var q=h.y;if(b.pathSegType==SVGPathSeg.PATHSEG_MOVETO_ABS)b=g,f=a.getPathSegIndex(b),m=b.x,
n=b.y,d.execute=function(){h.x=p;h.y=q;a.pathSegList.insertItemBefore(b,f);c.selectElementList([a]);c.createInteractionFromSelection();c.showSelectionProperties()},e.execute=function(){h.x=m;h.y=n;a.pathSegList.removeItem(f);c.selectElementList([a]);c.createInteractionFromSelection();c.showSelectionProperties()};else if(g&&g.pathSegType==SVGPathSeg.PATHSEG_CLOSEPATH){k=b;var u=k.x;var r=k.y;b=a.getNextSegmentOf(h);f=a.getPathSegIndex(b);m=b.x;n=b.y;d.execute=function(){k.x=u;k.y=r;h.x=p;h.y=q;a.pathSegList.insertItemBefore(b,
f);c.selectElementList([a]);c.createInteractionFromSelection();c.showSelectionProperties()};e.execute=function(){h.x=k.x=m;h.y=k.y=n;a.pathSegList.removeItem(f);c.selectElementList([a]);c.createInteractionFromSelection();c.showSelectionProperties()}}else d.execute=function(){a.pathSegList.insertItemBefore(b,f);c.selectElementList([a]);c.createInteractionFromSelection();c.showSelectionProperties()},e.execute=function(){a.pathSegList.removeItem(f);c.selectElementList([a]);c.createInteractionFromSelection();
c.showSelectionProperties()};e.execute();c.history.addUndoRedoActions(d,e)}};Extends(DrawFreehand_tool,Base2D_tool);function DrawFreehand_tool(a){DrawFreehand_tool.superConstructor.call(this,a)}_=DrawFreehand_tool.prototype;_.onActivate=function(){DrawFreehand_tool.superClass.onActivate.call(this);this.editorRef.activeDocument.deselectAllElements();this.editorRef.activeDocument.removeAllInteractions();this.editorRef.selectionMode!=this.editorRef.POINTS_SELECTION&&(this.editorRef.selectionMode=this.editorRef.POINTS_SELECTION)};
_.onMouseDown=function(a){this.editorRef.activeDocument.isLockedElement(this.editorRef.activeDocument.activeLayer)?this.editorRef.appRef.ALERT_DIALOG.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):(DrawFreehand_tool.superClass.onMouseDown.call(this,a),this.editorRef.activeDocument.deselectAllElements(),this.interactivePath=null,Event.isSpaceBarKeyPressed||this.createInteractivePath(GMOUSE.mouseDownPt))};
_.onGlobalMouseStartDrag=function(a){this.interactivePath||DrawFreehand_tool.superClass.onGlobalMouseStartDrag.call(this,a)};_.onGlobalMouseDrag=function(a){this.interactivePath?(this.editorRef.activeDocument.showPenLocation(GMOUSE.mouseMovePt),this.interactivePath.pathSegList.appendItem(this.interactivePath.createSVGPathSegLinetoAbs(GMOUSE.mouseMovePt.x,GMOUSE.mouseMovePt.y))):(DrawFreehand_tool.superClass.onGlobalMouseDrag.call(this,a),this.evalPanOrZoomAction(a))};
_.onGlobalMouseEndDrag=function(a){this.interactivePath&&this.createSmoothedPath();DrawFreehand_tool.superClass.onGlobalMouseEndDrag.call(this,a)};
_.createInteractivePath=function(a){this.interactivePath=SVGElement.svgUtils.createPath();this.interactivePath.setAttribute("stroke","#0047FF");this.interactivePath.setAttribute("fill","none");this.interactivePath.pathSegList.appendItem(this.interactivePath.createSVGPathSegMovetoAbs(a.x,a.y));this.interactivePath.matrix=SVGElement.svgUtils.createSVGMatrix();this.editorRef.INTERACTION_SVG.appendChild(this.interactivePath)};
_.createSmoothedPath=function(){var a=this.editorRef.activeDocument,b={};paper.install(b);paper.setup([640,480]);b=b.project.importSVG(this.interactivePath);b.simplify(10);b=b.exportSVG();b.getPathData({normalize:!0});b.segListMatrixTransform(a.content.getScreenCTM().inverse());var c=b.joinPath(b);c&&(b=c);a.activeLayer.appendChild(b);a.applyDefaultDrawingProperties(b);c=new RemoveElements_action(a);c.addElements([b]);var d=new AddElements_action(a);d.addElements([b]);a.history.addUndoRedoActions(c,
d);a.selectElement(b);a.createInteractionFromSelection();a.showSelectionProperties();a.onChange()};Extends(DrawBrush_tool,DrawFreehand_tool);function DrawBrush_tool(a){DrawBrush_tool.superConstructor.call(this,a)}_=DrawBrush_tool.prototype;
_.createSmoothedPath=function(){var a=this.editorRef.activeDocument,b={};paper.install(b);paper.setup([640,480]);b=b.project.importSVG(this.interactivePath);b.simplify(50);var c=b.exportSVG();c.getPathData({normalize:!0});c.segListMatrixTransform(a.content.getScreenCTM().inverse());(b=c.joinPath(c))&&(c=b);b=SVGElement.svgUtils.createGroup(0,0);b.matrix=c.getTransform().matrix.clone();b.setAttribute("stroke-width",a.defaultDrawingProperties["stroke-width"]);b.setAttribute("stroke",a.defaultDrawingProperties.stroke);
b.appendChild(c);b.connectController(Brush_element);b.setAttribute("controller-class","Brush_element");a.activeLayer.appendChild(b);b.update();c=new RemoveElements_action(a);c.addElements([b]);var d=new AddElements_action(a);d.addElements([b]);a.history.addUndoRedoActions(c,d)};Extends(DrawIFrameInForeignObject_tool,Base2D_tool);function DrawIFrameInForeignObject_tool(a){DrawIFrameInForeignObject_tool.superConstructor.call(this,a)}_=DrawIFrameInForeignObject_tool.prototype;
_.onActivate=function(){DrawIFrameInForeignObject_tool.superClass.onActivate.call(this);this.editorRef.activeDocument.deselectAllElements();this.editorRef.activeDocument.removeAllInteractions()};
_.onMouseDown=function(a){this.editorRef.activeDocument.isLockedElement(this.editorRef.activeDocument.activeLayer)?this.editorRef.appRef.ALERT_DIALOG.open(LOCALIZER.translate("The active layer is locked!"),LOCALIZER.translate("Unlock the active layer to draw in it.")):DrawIFrameInForeignObject_tool.superClass.onMouseDown.call(this,a)};
_.onGlobalMouseStartDrag=function(a){DrawIFrameInForeignObject_tool.superClass.onGlobalMouseStartDrag.call(this,a);this.interactiveRectangle=null;Event.isSpaceBarKeyPressed||(this.editorRef.activeDocument.deselectAllElements(),this.createInteractiveRectangle("#0047FF"))};_.onGlobalMouseDrag=function(a){DrawIFrameInForeignObject_tool.superClass.onGlobalMouseDrag.call(this,a);this.interactiveRectangle&&this.updateInteractiveRectangle(a)};
_.onGlobalMouseEndDrag=function(a){DrawIFrameInForeignObject_tool.superClass.onGlobalMouseEndDrag.call(this,a);this.interactiveRectangle&&this.createIframeInForeignObject()};_.snapMouseDragToAngle=function(){GMOUSE.mouseMovePt=this.editorRef.activeDocument.pointToSnap_angle45(GMOUSE.mouseMovePt,this.startPenInfo.screenPositionSnapped)};
_.createIframeInForeignObject=function(){var a=this.editorRef.activeDocument,b=this.startPenInfo.pointInContentSnapped,c=this.endPenInfo.pointInContentSnapped;b=SVGElement.svgUtils.createForeingObject(Math.min(b.x,c.x),Math.min(b.y,c.y),Math.abs(c.x-b.x),Math.abs(c.y-b.y),'<div style="width:100%; height:100%;" ><iframe src="https://www.youtube.com/embed/rA25YKu2SNg?ecver=2" width="100%" height="100%" frameborder="0" style="width:100%; height:100%;"></iframe></div>');b.setAttribute("controller-class",
"IFrameInForeignObject");b.connectController(IFrameInForeignObject,{document:a});a.activeLayer.appendChild(b);a.applyDefaultDrawingProperties(b);c=new RemoveElements_action(a);c.addElements([b]);var d=new AddElements_action(a);d.addElements([b]);a.history.addUndoRedoActions(c,d);a.selectElement(b);a.createInteractionFromSelection();a.showSelectionProperties();a.onChange();this.editorRef.activateTool("selectGlobal_tool")};
function BBoxInteraction2D(a){this.editorRef=a;this.directMode=!1;this.handleSize=7;this.boundsPoints=[];for(a=0;4>a;a++)this.boundsPoints[a]=SVGElement.svgUtils.createSVGPoint(0,0);this.svgElement=document.querySelector("#TEMPLATES #INTERACTION_TEMPLATES #BBOX_2D_interaction").cloneNode(!0);this.svgElement.controller=this;this.startAngle=this.max=this.min=this.sourceScreenMatrix=null;this.center=SVGElement.svgUtils.createSVGPoint(0,0);this.centerInScreen=null;this.pivotPt=SVGElement.svgUtils.createSVGPoint(0,
0);this.localOrigin=SVGElement.svgUtils.createSVGPoint(0,0);this.mousePt=SVGElement.svgUtils.createSVGPoint(0,0);ConnectEvent("mousedown",this.svgElement,this.onMouseDown,this)}_=BBoxInteraction2D.prototype;_.onMouseDown=function(a){this.clickedHandle=a.target;if(-1!=this.clickedHandle.id.indexOf("rotate"))this.onClickOnRotationHandle(a);else this.onClickOnResizeHandle(a)};
_.onGlobalMouseStartDrag=function(a){this.editorRef.activeDocument.classList.add("mouse-drag-event");this.editorRef.activeDocument.disableSelectionPointerEvents();this.editorRef.disableInteraction();this.directMode&&this.previewsContainer.removeChildren();if(-1!=this.clickedHandle.id.indexOf("rotate"))this.onStartDragToRotate(a);else this.onStartDragToResize(a)};
_.onStartDragToRotate=function(a){this.editorRef.hideInteractionHandles(a);this.undoMatrixAction=new SetMatrix_action(this.editorRef.activeDocument);this.undoMatrixAction.addElements(this.editorRef.activeDocument.selectionList)};_.onStartDragToResize=function(a){};
_.onGlobalMouseDrag=function(a){this.currentPenInfo=this.editorRef.activeDocument.screenPointToPenInfo(GMOUSE.mouseMovePt);this.mousePt.x=this.currentPenInfo.screenPositionSnapped.x;this.mousePt.y=this.currentPenInfo.screenPositionSnapped.y;if(-1!=this.clickedHandle.id.indexOf("rotate"))this.onDragToRotate(a);else this.onDragToResize(a)};
_.onGlobalMouseEndDrag=function(a){var b=this.editorRef.activeDocument;b.classList.remove("mouse-drag-event");if(-1!=this.clickedHandle.id.indexOf("rotate"))this.onEndDragToRotate(a);else this.onEndDragToResize(a);b.onChange();if(b.asyncRedraw){var c=this;setTimeout(function(){c.createBBoxInteraction(b.selectionList);c.editorRef.showInteractionHandles();b.showSelectionProperties()},0);b.asyncRedraw=!1}else this.createBBoxInteraction(b.selectionList),this.editorRef.showInteractionHandles(),b.showSelectionProperties();
b.enableSelectionPointerEvents();this.editorRef.enableInteraction()};_.onEndDragToRotate=function(){var a=this.editorRef.activeDocument;0==this.directMode&&a.rotateElementList(a.selectionList,this.previousRotation,this.pivotPt);this.redoMatrixAction=new SetMatrix_action(a);this.redoMatrixAction.addElements(a.selectionList);a.history.addUndoRedoActions(this.undoMatrixAction,this.redoMatrixAction)};
_.onEndDragToResize=function(a){a=this.editorRef.activeDocument;var b=this.getScaledX();var c=this.getScaledY();var d={scaleText:!0};d.scaleStrokeWidth=a.defaultDrawingProperties.scaleStrokeWidth;if(this.isLocal){var e=a.selectionList[0];"text"==e.nodeName&&(d.scaleText=!1);var f=e.localToGlobal(this.pivotPt.x,this.pivotPt.y);if(Infinity==b||-Infinity==b||isNaN(b))b=1;if(Infinity==c||-Infinity==c||isNaN(c))c=1;console.log("scaleX",b);console.log("scaleY",c);0==this.directMode&&e.scaleAroundGlobalPt(b,
c,f,!0)}else f=a.screenPointToGlobal(this.svgElement.localToScreen(this.pivotPt.x,this.pivotPt.y)),0==this.directMode&&a.scaleElementList(a.selectionList,b,c,f);a.createScaleUndoRedoAction(a.selectionList,b,c,f,this.isLocal,d);a.normalizeScaleElementList(a.selectionList,d);a.dispatchGeometryChangedEvent(a.selectionList)};
_.getCenter=function(){return{x:this.boundsPoints[0].x+(this.boundsPoints[2].x-this.boundsPoints[0].x)/2,y:this.boundsPoints[0].y+(this.boundsPoints[2].y-this.boundsPoints[0].y)/2}};_.getCenterTop=function(){return{x:this.boundsPoints[0].x+(this.boundsPoints[1].x-this.boundsPoints[0].x)/2,y:this.boundsPoints[0].y+(this.boundsPoints[1].y-this.boundsPoints[0].y)/2}};
_.getCenterLeft=function(){return{x:this.boundsPoints[0].x+(this.boundsPoints[3].x-this.boundsPoints[0].x)/2,y:this.boundsPoints[0].y+(this.boundsPoints[3].y-this.boundsPoints[0].y)/2}};_.getCenterRight=function(){return{x:this.boundsPoints[1].x+(this.boundsPoints[2].x-this.boundsPoints[1].x)/2,y:this.boundsPoints[1].y+(this.boundsPoints[2].y-this.boundsPoints[1].y)/2}};
_.getCenterBottom=function(){return{x:this.boundsPoints[2].x+(this.boundsPoints[3].x-this.boundsPoints[2].x)/2,y:this.boundsPoints[2].y+(this.boundsPoints[3].y-this.boundsPoints[2].y)/2}};_.getScaledX=function(){return.001>this.savedWidth?1:(this.max.x-this.min.x)/this.savedWidth};_.getScaledY=function(){return.001>this.savedHeight?1:(this.max.y-this.min.y)/this.savedHeight};
_.createBBoxInteraction=function(a){this.editorRef.activeDocument.createElementListPreviews(null,a);if(1==a.length){this.isLocal=!0;var b=a[0];a=b.getLocalBBox();this.min=a.min;this.max=a.max;this.sourceScreenMatrix=b.getScreenCTM()}else this.isLocal=!1,a=this.editorRef.activeDocument.getElementListGlobalBBox(this.editorRef.activeDocument.selectionList),this.min=this.editorRef.activeDocument.globalPointToScreen(a.min),this.max=this.editorRef.activeDocument.globalPointToScreen(a.max),this.sourceScreenMatrix=
this.svgElement.getTransform().matrix.identity();this.center.x=this.min.x+(this.max.x-this.min.x)/2;this.center.y=this.min.y+(this.max.y-this.min.y)/2;this.savedWidth=this.max.x-this.min.x;this.savedHeight=this.max.y-this.min.y;console.log("this.savedWidth",this.savedWidth);console.log("this.savedHeight",this.savedHeight);this.editorRef.INTERACTION_SVG.appendChild(this.svgElement);console.log("createBBoxInteraction selection bbox",a);this.update()};
_.update=function(){this.boundsPoints[0].set(this.min.x,this.min.y);this.boundsPoints[1].set(this.max.x,this.min.y);this.boundsPoints[2].set(this.max.x,this.max.y);this.boundsPoints[3].set(this.min.x,this.max.y);this.isLocal&&(this.boundsPoints=this.sourceScreenMatrix.transformPointList(this.boundsPoints));var a=this.boundsPoints[0].x;var b=this.boundsPoints[0].y;var c=this.boundsPoints[1].x;var d=this.boundsPoints[1].y;var e=this.boundsPoints[2].x;var f=this.boundsPoints[2].y;var g=this.boundsPoints[3].x;
var k=this.boundsPoints[3].y;var l=this.handleSize/2,h=3*this.handleSize,m=h/2;this.svgElement.querySelector("#top_line").updateGeometry(a,b,c,d);this.svgElement.querySelector("#right_line").updateGeometry(c,d,e,f);this.svgElement.querySelector("#bottom_line").updateGeometry(e,f,g,k);this.svgElement.querySelector("#left_line").updateGeometry(g,k,a,b);var n=this.getCenter();this.svgElement.querySelector("#pivotX_line").updateGeometry(n.x-5,n.y,n.x+5,n.y);this.svgElement.querySelector("#pivotY_line").updateGeometry(n.x,
n.y-5,n.x,n.y+5);this.svgElement.querySelector("#rotate_nw").updateGeometry(a-m,b-m,h,h);this.svgElement.querySelector("#rotate_ne").updateGeometry(c-m,d-m,h,h);this.svgElement.querySelector("#rotate_se").updateGeometry(e-m,f-m,h,h);this.svgElement.querySelector("#rotate_sw").updateGeometry(g-m,k-m,h,h);this.svgElement.querySelector("#resize_nw").updateGeometry(a-l,b-l,this.handleSize,this.handleSize);this.svgElement.querySelector("#resize_ne").updateGeometry(c-l,d-l,this.handleSize,this.handleSize);
this.svgElement.querySelector("#resize_se").updateGeometry(e-l,f-l,this.handleSize,this.handleSize);this.svgElement.querySelector("#resize_sw").updateGeometry(g-l,k-l,this.handleSize,this.handleSize);a=this.getCenterTop();this.svgElement.querySelector("#resize_n").updateGeometry(a.x-l,a.y-l,this.handleSize,this.handleSize);a=this.getCenterRight();this.svgElement.querySelector("#resize_e").updateGeometry(a.x-l,a.y-l,this.handleSize,this.handleSize);a=this.getCenterBottom();this.svgElement.querySelector("#resize_s").updateGeometry(a.x-
l,a.y-l,this.handleSize,this.handleSize);a=this.getCenterLeft();this.svgElement.querySelector("#resize_w").updateGeometry(a.x-l,a.y-l,this.handleSize,this.handleSize)};
_.onClickOnRotationHandle=function(){this.mousePt.x=GMOUSE.mouseMovePt.x;this.mousePt.y=GMOUSE.mouseMovePt.y;var a=this.editorRef.activeDocument;this.isLocal?(this.centerInScreen=this.center.matrixTransform(this.sourceScreenMatrix),this.pivotPt=a.screenPointToGlobal(this.centerInScreen)):(this.centerInScreen=this.center.clone(),this.pivotPt=a.screenPointToGlobal(this.svgElement.localToScreen(this.center.x,this.center.y)));this.startAngle=this.mousePt.getAngleFromPoint(this.centerInScreen,!0);this.previousRotation=
0;GMOUSE.globalMouseTargetDelegate=this};
_.onClickOnResizeHandle=function(a){this.resizeFromCenter=!1;if(a.altKey)this.pivotPt.x=this.center.x,this.pivotPt.y=this.center.y,this.resizeFromCenter=!0;else{if("resize_nw"===this.clickedHandle.id||"resize_w"===this.clickedHandle.id||"resize_sw"===this.clickedHandle.id)this.pivotPt.x=this.max.x;else if("resize_ne"===this.clickedHandle.id||"resize_e"===this.clickedHandle.id||"resize_se"===this.clickedHandle.id)this.pivotPt.x=this.min.x;else if("resize_n"===this.clickedHandle.id||"resize_s"===this.clickedHandle.id)this.pivotPt.x=
this.center.x;if("resize_nw"===this.clickedHandle.id||"resize_n"===this.clickedHandle.id||"resize_ne"===this.clickedHandle.id)this.pivotPt.y=this.max.y;else if("resize_sw"===this.clickedHandle.id||"resize_s"===this.clickedHandle.id||"resize_se"===this.clickedHandle.id)this.pivotPt.y=this.min.y;else if("resize_e"===this.clickedHandle.id||"resize_w"===this.clickedHandle.id)this.pivotPt.y=this.center.y}this.previousScaledY=this.previousScaledX=1;GMOUSE.globalMouseTargetDelegate=this};
_.onDragToRotate=function(a){var b=this.editorRef.activeDocument,c=this.mousePt.getAngleFromPoint(this.centerInScreen,!0)-this.startAngle;a.shiftKey&&(c=b.snapAngle*Math.round(c/b.snapAngle));this.directMode?b.rotateElementList(b.selectionList,c-this.previousRotation,this.pivotPt):this.svgElement.parentElement.querySelector("#interactive-elements").rotateAroundGlobalPt(c-this.previousRotation,this.centerInScreen);this.previousRotation=c};
_.onDragToResize=function(a){var b=!1;this.isLocal&&(this.mousePt=this.mousePt.matrixTransform(this.sourceScreenMatrix.inverse()),"true"==this.editorRef.activeDocument.selectionList[0].dataset.mantainAspectRatio&&(b=!0));1==this.editorRef.TRANSFORM_2D_PANEL.mantainAspectRatio&&(b=!0);a.shiftKey&&(b=!0);if("resize_nw"===this.clickedHandle.id||"resize_w"===this.clickedHandle.id||"resize_sw"===this.clickedHandle.id)this.min.x=this.mousePt.x,this.resizeFromCenter&&(this.max.x=this.pivotPt.x+(this.pivotPt.x-
this.min.x));else if("resize_ne"===this.clickedHandle.id||"resize_e"===this.clickedHandle.id||"resize_se"===this.clickedHandle.id)this.max.x=this.mousePt.x,this.resizeFromCenter&&(this.min.x=this.pivotPt.x-(this.max.x-this.pivotPt.x));if("resize_nw"===this.clickedHandle.id||"resize_n"===this.clickedHandle.id||"resize_ne"===this.clickedHandle.id)this.min.y=this.mousePt.y,this.resizeFromCenter&&(this.max.y=this.pivotPt.y+(this.pivotPt.y-this.min.y));else if("resize_sw"===this.clickedHandle.id||"resize_s"===
this.clickedHandle.id||"resize_se"===this.clickedHandle.id)this.max.y=this.mousePt.y,this.resizeFromCenter&&(this.min.y=this.pivotPt.y-(this.max.y-this.pivotPt.y));if(b)if("resize_n"==this.clickedHandle.id||"resize_s"==this.clickedHandle.id)a=this.savedWidth/this.savedHeight,a=(this.max.y-this.min.y)*a/2,this.min.x=this.center.x-a,this.max.x=this.center.x+a;else if("resize_e"==this.clickedHandle.id||"resize_w"==this.clickedHandle.id)a=this.savedHeight/this.savedWidth,a=(this.max.x-this.min.x)*a/2,
this.min.y=this.center.y-a,this.max.y=this.center.y+a;else if("resize_se"==this.clickedHandle.id||"resize_ne"==this.clickedHandle.id)a=this.savedWidth/this.savedHeight,this.resizeFromCenter?(a=(this.max.y-this.min.y)*a/2,this.min.x=this.center.x-a,this.max.x=this.center.x+a):this.max.x=this.min.x+(this.max.y-this.min.y)*a;else if("resize_sw"==this.clickedHandle.id||"resize_nw"==this.clickedHandle.id)a=this.savedWidth/this.savedHeight,this.resizeFromCenter?(a=(this.max.y-this.min.y)*a/2,this.min.x=
this.center.x-a,this.max.x=this.center.x+a):this.min.x=this.max.x-(this.max.y-this.min.y)*a;var c=this.editorRef.activeDocument;b=this.getScaledX()/this.previousScaledX;var d=this.getScaledY()/this.previousScaledY;if(Infinity==b||-Infinity==b||isNaN(b))b=1;if(Infinity==d||-Infinity==d||isNaN(d))d=1;console.log("scaleX",b);console.log("scaleY",d);this.directMode?this.isLocal?(c=c.selectionList[0],a=c.localToGlobal(this.pivotPt.x,this.pivotPt.y),c.scaleAroundGlobalPt(b,d,a,!0)):(a=c.screenPointToGlobal(this.svgElement.localToScreen(this.pivotPt.x,
this.pivotPt.y)),c.scaleElementList(c.selectionList,b,d,a)):(this.isLocal?(c=this.svgElement.parentElement.querySelector("#interactive-elements > *"),a=c.localToScreen(this.pivotPt.x,this.pivotPt.y)):(c=this.svgElement.parentElement.querySelector("#interactive-elements"),a=this.svgElement.localToScreen(this.pivotPt.x,this.pivotPt.y)),c.scaleAroundGlobalPt(b,d,a,this.isLocal));this.previousScaledX=this.getScaledX();this.previousScaledY=this.getScaledY();this.update()};
function PointInteraction2D(a){this.editorRef=a;this.directMode=!1;this.handleSize=7;this.halfHandleSize=this.handleSize/2;this.currentPenInfo=null;this.previousScreenPositionSnapped={x:0,y:0};this.clickedCtrlHandle=this.clickedHandle=null;this.onDragCursor="default_cur";this.svgElement=SVGElement.svgUtils.createGroup(0,0,"POINTS_interaction");this.svgElement.controller=this;this.redoAction=this.undoAction=null;ConnectEvent("mousedown",this.svgElement,this.onMouseDown,this)}_=PointInteraction2D.prototype;
_.onMouseDown=function(a){if(this.clickedHandle=a.target){if("handle_x_y"===this.clickedHandle.id){if(a.altKey&&a.shiftKey){this.editorRef.activeDocument.deselectAllPoints();a=this.convertSegmentToCorner(this.clickedHandle.segRef);this.editorRef.activeDocument.selectPoint(a.editableSegment);this.createPointsInteraction(this.editorRef.activeDocument.selectionList);this.clickedHandle=null;return}this.hideAllSegmentCtrlHandles();this.clickedHandle.classList.contains("selected")?a.shiftKey?(this.clickedHandle.classList.remove("selected"),
this.editorRef.activeDocument.deselectPoint(this.clickedHandle.segRef),this.clickedCtrlHandle=this.activeSegment=this.activeHandle=null):(this.activeHandle=this.clickedHandle,this.activeSegment=this.activeHandle.segRef,this.showSegmentCtrlHandles(this.activeSegment)):(a.shiftKey||this.deselectAllHandles(),this.activeHandle=this.clickedHandle,this.activeSegment=this.activeHandle.segRef,this.activeHandle.classList.add("selected"),this.showSegmentCtrlHandles(this.activeSegment),this.editorRef.activeDocument.selectPoint(this.activeHandle.segRef))}else this.clickedCtrlHandle=
this.clickedHandle;GMOUSE.globalMouseTargetDelegate=this}else this.clickedCtrlHandle=this.activeSegment=this.activeHandle=null};
_.onGlobalMouseStartDrag=function(a){this.editorRef.activeDocument.disableSelectionPointerEvents();this.editorRef.activeDocument.classList.add("mouse-drag-event");this.startPenInfo=this.editorRef.activeDocument.screenPointToPenInfo(GMOUSE.mouseDownPt);this.startPenInfo.screenPositionSnapped=this.clickedHandle.segRef.pathOwner.localToScreen(this.clickedHandle.segRef.x,this.clickedHandle.segRef.y);this.previousScreenPositionSnapped.x=this.startPenInfo.screenPositionSnapped.x;this.previousScreenPositionSnapped.y=
this.startPenInfo.screenPositionSnapped.y;switch(this.clickedHandle.id){case "handle_x_y":if(a.altKey)this.editorRef.activeDocument.deselectAllPoints(),this.activeSegment=this.convertSegmentToCurve(this.clickedHandle.segRef).editableSegment,this.editorRef.activeDocument.selectPoint(this.activeSegment),this.createPointsInteraction(this.editorRef.activeDocument.selectionList),this.clickedHandle=this.clickedCtrlHandle=this.svgElement.querySelector(".handle.control-point");else this.onStartDrag_handle_x_y(a);
break;case "handle_x1_y1":case "handle_x2_y2":this.onStartDrag_ctrlHandle(a)}};_.snapMouseDragToAngle=function(){var a=this.editorRef.activeDocument.pointToSnap_angle(this.currentPenInfo.screenPosition,this.startPenInfo.screenPositionSnapped);this.currentPenInfo.screenPositionSnapped.x=a.x;this.currentPenInfo.screenPositionSnapped.y=a.y};
_.onGlobalMouseDrag=function(a){this.currentPenInfo=this.editorRef.activeDocument.screenPointToPenInfo(GMOUSE.mouseMovePt);Event.isShiftKeyPressed&&this.snapMouseDragToAngle();switch(this.clickedHandle.id){case "handle_x_y":this.onDrag_handle_x_y(a);break;case "handle_x1_y1":case "handle_x2_y2":this.onDrag_ctrlHandle(a)}this.previousScreenPositionSnapped.x=this.currentPenInfo.screenPositionSnapped.x;this.previousScreenPositionSnapped.y=this.currentPenInfo.screenPositionSnapped.y};
_.onGlobalMouseEndDrag=function(a){switch(this.clickedHandle.id){case "handle_x_y":this.onEndDrag_handle_x_y(a);break;case "handle_x1_y1":case "handle_x2_y2":this.onEndDrag_ctrlHandle(a)}this.dispatchGeometryChangedEvent();this.editorRef.activeDocument.classList.remove("mouse-drag-event");this.editorRef.activeDocument.enableSelectionPointerEvents();this.editorRef.activeDocument.createInteractionFromSelection()};
_.onStartDrag_handle_x_y=function(a){this.editorRef.activeDocument.removeAllInteractions();this.dataToDrag=[];var b=this.editorRef.activeDocument.selectionList,c,d,e=b.length;for(d=0;d<e;d++){var f=b[d];if(f instanceof SVGPathElement){a={path:f,selectedSegmentDataList:[],screenMatrixInverted:f.getScreenCTM().inverse()};f=f.pathSegList;var g=f.numberOfItems;for(c=0;c<g;c++){var k=f.getItem(c);k.id=c;if(k.isSelected){var l={segment:k,x_y:!0};a.selectedSegmentDataList.push(l);k.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS?
l.x1_y1=!0:k.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS&&(l.x2_y2=!0);k.nextSegment&&((k=k.nextSegment,k.pathSegType===SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS)?k.isSelected||(l={segment:k,x1_y1:!0},a.selectedSegmentDataList.push(l)):k.pathSegType===SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS?(l={segment:k,x1_y1:!0},a.selectedSegmentDataList.push(l)):k.pathSegType!==SVGPathSeg.PATHSEG_CLOSEPATH||(l=k.previousSegment,k=k.subPathOwner.pathSegList[0],l.x!=k.x||l.y!=k.y||k.isSelected||(l={segment:k,x_y:!0},
a.selectedSegmentDataList.push(l),k=k.subPathOwner.pathSegList[1],k.pathSegType!=SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS&&k.pathSegType!=SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS))||(l={segment:k,x1_y1:!0},a.selectedSegmentDataList.push(l)))}}0<a.selectedSegmentDataList.length&&this.dataToDrag.push(a)}}console.log("this.dataToDrag",this.dataToDrag);this.undoAction=new SetPathSegmentPos_action(this.editorRef.activeDocument);this.setUndoRedoAction_translate_state(this.undoAction)};
_.onStartDrag_ctrlHandle=function(a){this.dataToDrag=null;this.undoAction=new SetPathSegmentPos_action(this.editorRef.activeDocument);this.setUndoRedoAction_translateCtrl_state(this.undoAction);this.showOnlyActiveSegmentCtrlHandles();a.altKey&&(this.clickedCtrlHandle.smooth=!1)};
_.onDrag_handle_x_y=function(a){var b=this.dataToDrag.length,c=SVGElement.svgUtils.createSVGPoint(this.previousScreenPositionSnapped.x,this.previousScreenPositionSnapped.y),d=SVGElement.svgUtils.createSVGPoint(this.currentPenInfo.screenPositionSnapped.x,this.currentPenInfo.screenPositionSnapped.y);for(a=0;a<b;a++){var e=this.dataToDrag[a];var f=e.screenMatrixInverted;e=e.selectedSegmentDataList;var g=c.matrixTransform(f);var k=d.matrixTransform(f);f=k.x-g.x;g=k.y-g.y;var l=e.length;for(k=0;k<l;k++){var h=
e[k];var m=h.segment;h.x_y&&(m.x+=f,m.y+=g);h.x1_y1?(m.x1+=f,m.y1+=g):h.x2_y2&&(m.x2+=f,m.y2+=g)}}};
_.onDrag_ctrlHandle=function(a){this.updateCtrlHandlePosition(this.clickedCtrlHandle,this.currentPenInfo.screenPositionSnapped.x,this.currentPenInfo.screenPositionSnapped.y);var b=this.clickedCtrlHandle.segRef.pathOwner.getScreenCTM().inverse(),c=SVGElement.svgUtils.createSVGPoint(this.currentPenInfo.screenPositionSnapped.x,this.currentPenInfo.screenPositionSnapped.y);c=c.matrixTransform(b);"handle_x1_y1"==this.clickedCtrlHandle.id?(this.clickedCtrlHandle.segRef.x1=c.x,this.clickedCtrlHandle.segRef.y1=
c.y):(this.clickedCtrlHandle.segRef.x2=c.x,this.clickedCtrlHandle.segRef.y2=c.y);if(this.clickedCtrlHandle.smooth){var d=this.clickedCtrlHandle.oppositeCtrlHandle;c=SVGElement.svgUtils.createSVGPoint(this.clickedCtrlHandle.line.x1.baseVal.value,this.clickedCtrlHandle.line.y1.baseVal.value);var e=SVGElement.svgUtils.createSVGPoint(c.x-this.clickedCtrlHandle.cx.baseVal.value,c.y-this.clickedCtrlHandle.cy.baseVal.value),f=e.normalize(),g=SVGElement.svgUtils.createSVGPoint(d.cx.baseVal.value,d.cy.baseVal.value);
a.altKey?this.updateCtrlHandlePosition(d,c.x+e.x,c.y+e.y):(a=g.getDistanceFromPoint(c),this.updateCtrlHandlePosition(d,c.x+f.x*a,c.y+f.y*a));c=SVGElement.svgUtils.createSVGPoint(d.cx.baseVal.value,d.cy.baseVal.value);c=c.matrixTransform(b);"handle_x1_y1"==d.id?(d.segRef.x1=c.x,d.segRef.y1=c.y):(d.segRef.x2=c.x,d.segRef.y2=c.y)}};
_.onEndDrag_handle_x_y=function(a){this.redoAction=new SetPathSegmentPos_action(this.editorRef.activeDocument);this.setUndoRedoAction_translate_state(this.redoAction);this.editorRef.activeDocument.history.addUndoRedoActions(this.undoAction,this.redoAction)};
_.onEndDrag_ctrlHandle=function(a){this.undoAction&&(this.redoAction=new SetPathSegmentPos_action(this.editorRef.activeDocument),this.setUndoRedoAction_translateCtrl_state(this.redoAction),this.editorRef.activeDocument.history.addUndoRedoActions(this.undoAction,this.redoAction))};_.dispatchGeometryChangedEvent=function(a){if(this.dataToDrag){var b=this.dataToDrag.length,c=[];for(a=0;a<b;a++)c.push(this.dataToDrag[a].path);this.editorRef.activeDocument.dispatchGeometryChangedEvent(c)}else this.editorRef.activeDocument.dispatchGeometryChangedEvent([this.clickedCtrlHandle.segRef.pathOwner])};
_.setUndoRedoAction_translate_state=function(a){var b,c;var d=this.dataToDrag.length;for(b=0;b<d;b++){var e=this.dataToDrag[b];var f=e.selectedSegmentDataList;e=f.length;for(c=0;c<e;c++){var g=f[c];var k=f[c].segment;var l={};g.x_y&&(l.x=k.x,l.y=k.y);g.x1_y1?(l.x1=k.x1,l.y1=k.y1):g.x2_y2&&(l.x2=k.x2,l.y2=k.y2);a.addElementAndProperties(k,l)}}};
_.setUndoRedoAction_translateCtrl_state=function(a){var b={};"handle_x1_y1"==this.clickedCtrlHandle.id?(b.x1=this.clickedCtrlHandle.segRef.x1,b.y1=this.clickedCtrlHandle.segRef.y1):(b.x2=this.clickedCtrlHandle.segRef.x2,b.y2=this.clickedCtrlHandle.segRef.y2);a.addElementAndProperties(this.clickedCtrlHandle.segRef,b);if(this.clickedCtrlHandle.smooth){b={};var c=this.clickedCtrlHandle.oppositeCtrlHandle;"handle_x1_y1"==c.id?(b.x1=c.segRef.x1,b.y1=c.segRef.y1):(b.x2=c.segRef.x2,b.y2=c.segRef.y2);a.addElementAndProperties(c.segRef,
b)}};_.updateCtrlHandlePosition=function(a,b,c){a.line.x2.baseVal.value=a.cx.baseVal.value=b;a.line.y2.baseVal.value=a.cy.baseVal.value=c};
_.createCtrlHandle=function(a,b,c,d,e,f,g){b=SVGElement.svgUtils.createSVGPoint(b,c);d=SVGElement.svgUtils.createSVGPoint(d,e);e=f.pathOwner.getScreenCTM();b=b.matrixTransform(e);d=d.matrixTransform(e);e=SVGElement.svgUtils.createLine(b.x,b.y,d.x,d.y);e.setStrokeAndFill("#0052FF");this.svgElement.appendChild(e);d=SVGElement.svgUtils.createEllipse(d.x,d.y,this.halfHandleSize,this.halfHandleSize);d.setStrokeAndFill("#0052FF","#FFFFFF");d.id=a;d.classList.add("handle");d.classList.add("control-point");
d.line=e;d.segRef=f;g&&(d.oppositeCtrlHandle=g,g.oppositeCtrlHandle=d);this.svgElement.appendChild(d);return d};_.createHandle=function(a,b,c,d){b=SVGElement.svgUtils.createRect(b-this.halfHandleSize,c-this.halfHandleSize,this.handleSize,this.handleSize);b.setStrokeAndFill("#0052FF","#FFFFFF");b.id=a;b.classList.add("handle");d.isSelected&&b.classList.add("selected");b.segRef=d;this.svgElement.appendChild(b)};
_.isSmoothedCurve=function(a,b,c,d,e){b-=a.x;c-=a.y;d-=a.x;a=e-a.y;return b==d||c==a||.1>Math.abs(c/b-a/d)?!0:!1};_.deselectAllHandles=function(){for(var a=this.svgElement.querySelectorAll(".handle.selected"),b=a.length,c=0;c<b;c++)a[c].classList.remove("selected");this.editorRef.activeDocument.deselectAllPoints();this.activeSegment=null};
_.hideAllSegmentCtrlHandles=function(){for(var a=this.svgElement.querySelectorAll(".handle.control-point"),b=a.length,c=0;c<b;c++)this.svgElement.removeChild(a[c]),this.svgElement.removeChild(a[c].line)};_.showOnlyActiveSegmentCtrlHandles=function(){for(var a=this.svgElement.querySelectorAll("#handle_x_y, .interactive-path"),b=a.length,c=0;c<b;c++)a[c].segRef!=this.activeSegment&&this.svgElement.removeChild(a[c])};
_.showSegmentCtrlHandles=function(a){var b,c;if(a.pathSegType===SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS||a.pathSegType===SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS)if(a.pathSegType===SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS?c=this.createCtrlHandle("handle_x2_y2",a.x,a.y,a.x2,a.y2,a):a.pathSegType===SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS&&(c=this.createCtrlHandle("handle_x1_y1",a.x,a.y,a.x1,a.y1,a)),b=a.nextSegment)if(b.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS||b.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS){var d=
a.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS?this.isSmoothedCurve(a,a.x2,a.y2,b.x1,b.y1):this.isSmoothedCurve(a,a.x1,a.y1,b.x1,b.y1);c.smooth=d;c=this.createCtrlHandle("handle_x1_y1",a.x,a.y,b.x1,b.y1,b,c);c.smooth=d}else b.pathSegType===SVGPathSeg.PATHSEG_CLOSEPATH&&(d=b.previousSegment,b=b.subPathOwner.pathSegList[0],d.x==b.x&&d.y==b.y&&(b=b.subPathOwner.pathSegList[1],b.pathSegType==SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS||b.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS))&&(d=a.pathSegType==
SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS?this.isSmoothedCurve(a,a.x2,a.y2,b.x1,b.y1):this.isSmoothedCurve(a,a.x1,a.y1,b.x1,b.y1),c.smooth=d,c=this.createCtrlHandle("handle_x1_y1",a.x,a.y,b.x1,b.y1,b,c),c.smooth=d)};
_.convertSegmentToCurve=function(a){var b=a.pathOwner,c=b.getPathSegIndex(a),d=a.nextSegment,e=c+1;d&&d.pathSegType==SVGPathSeg.PATHSEG_CLOSEPATH&&(d=a.subPathOwner.pathSegList[1],e=d.id);var f=a.pathSegType==SVGPathSeg.PATHSEG_LINETO_ABS?b.createSVGPathSegCurvetoQuadraticAbs(a.x,a.y,a.x,a.y):b.cloneSegment(c);var g=d.pathSegType==SVGPathSeg.PATHSEG_LINETO_ABS?b.createSVGPathSegCurvetoQuadraticAbs(d.x,d.y,a.x,a.y):b.cloneSegment(e);var k=this.editorRef.activeDocument,l={},h={};l.execute=function(){console.log("undo path",
b);b.pathSegList.replaceItem(a,c);b.pathSegList.replaceItem(d,e);k.deselectAllElements();k.selectElementList([b]);k.createInteractionFromSelection();k.showSelectionProperties()};h.execute=function(){console.log("redo path",b);b.pathSegList.replaceItem(f,c);b.pathSegList.replaceItem(g,e);k.deselectAllElements();k.selectElementList([b]);k.createInteractionFromSelection();k.showSelectionProperties()};k.history.addUndoRedoActions(l,h);b.pathSegList.replaceItem(f,c);b.pathSegList.replaceItem(g,e);f.pathSegType==
SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS?(f.x2=a.x,f.y2=a.y):(f.x1=a.x,f.y1=a.y);g.x1=a.x;g.y1=a.y;return{editableSegment:f,nextEditableSegment:g}};
_.convertSegmentToCorner=function(a){var b=a.pathOwner,c=b.getPathSegIndex(a);console.log("path",b.subPathList);var d=a.nextSegment,e=b.getPathSegIndex(d);if(d&&d.pathSegType==SVGPathSeg.PATHSEG_CLOSEPATH){var f=b.findStartPathSegmentFrom(a);d=b.getNextSegmentOf(f);e=b.getPathSegIndex(d)}var g=a.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS?b.createSVGPathSegCurvetoQuadraticAbs(a.x,a.y,a.x1,a.y1):b.createSVGPathSegLinetoAbs(a.x,a.y);var k=d.pathSegType==SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS?b.createSVGPathSegCurvetoQuadraticAbs(d.x,
d.y,d.x2,d.y2):b.createSVGPathSegLinetoAbs(d.x,d.y);var l=this.editorRef.activeDocument;f={};var h={};f.execute=function(){b.pathSegList.replaceItem(a,c);b.pathSegList.replaceItem(d,e);l.selectElementList([b]);l.createInteractionFromSelection();l.showSelectionProperties()};h.execute=function(){b.pathSegList.replaceItem(g,c);b.pathSegList.replaceItem(k,e);l.selectElementList([b]);l.createInteractionFromSelection();l.showSelectionProperties()};l.history.addUndoRedoActions(f,h);b.pathSegList.replaceItem(g,
c);b.pathSegList.replaceItem(k,e);return{editableSegment:g,nextEditableSegment:k}};
_.createInteractionElements=function(a){var b,c=SVGElement.svgUtils.createSVGPoint();var d=a.length;for(var e=0;e<d;e++){var f=a[e];f.createElementPreview&&(b=f.createElementPreview())&&this.svgElement.appendChild(b);if(f instanceof SVGPathElement){f.createSubPathList();b=f.pathSegList;var g=f.getScreenCTM();f=b.numberOfItems;for(var k=0;k<f;k++){var l=b.getItem(k);l.pathSegType!=SVGPathSeg.PATHSEG_CLOSEPATH&&(c.x=l.x,c.y=l.y,c=c.matrixTransform(g),this.createHandle("handle_x_y",c.x,c.y,l))}}else f instanceof
SVGGElement&&this.createInteractionElements(f.childNodes)}this.activeSegment&&this.activeSegment.isSelected&&this.showSegmentCtrlHandles(this.activeSegment)};_.createPointsInteraction=function(a){this.svgElement.removeChildren();this.editorRef.INTERACTION_SVG.appendChild(this.svgElement);this.createInteractionElements(a)};
function RulersAndGrid_manager(a){this.editorRef=a;this.horizontalRulerCanvas=document.querySelector("#HORIZONTAL_RULER canvas");this.verticalRulerCanvas=document.querySelector("#VERTICAL_RULER canvas");this.gridPattern=document.querySelector("#GLOBAL_DEFS #jvs-grid-pattern");this.gridPattern.image=this.gridPattern.querySelector("image");this.gridPattern.canvas=document.createElement("canvas");this.updateRulerSize()}_=RulersAndGrid_manager.prototype;
_.updateRulerSize=function(){this.horizontalRulerCanvas.width=this.horizontalRulerCanvas.parentNode.offsetWidth;this.horizontalRulerCanvas.height=this.horizontalRulerCanvas.parentNode.offsetHeight;this.verticalRulerCanvas.width=this.verticalRulerCanvas.parentNode.offsetWidth;this.verticalRulerCanvas.height=this.verticalRulerCanvas.parentNode.offsetHeight};
_.update=function(a,b,c){var d=this.editorRef.activeDocument,e=d.workspace.getTransform().matrix;a=a||e.e;b=b||e.f;c=c||d.content.getTransform().matrix.getScale().x;c*=1/d.drawingScale;e=this.drawRuler(this.horizontalRulerCanvas,a-16,1/d.unitValue,c,!1);c=this.drawRuler(this.verticalRulerCanvas,b-16,1/d.unitValue,c,!0);this.drawGrid(e.markersDistance,c.markersDistance,a,b,e.divisors)};
_.drawRuler=function(a,b,c,d,e){d=d||1;var f=c*d,g=1,k=10;if(40>f){g=(Math.floor(40/f/k)+1)*k;f=c*d*g;var l=Math.floor(f/40);1<l&&(k=5<l?2:5,g=(Math.round(40/f/k)+1)*k,f=c*d*g)}c=a.getContext("2d");c.setTransform(1,0,0,1,0,0);c.clearRect(0,0,a.width,a.height);c.lineWidth=1;c.strokeStyle="#666";c.fillStyle="#c6c6c6";c.font="8px arial";c.beginPath();d=a.width;e&&(d=a.height,c.translate(16,0),c.rotate(.5*Math.PI));a=b-Math.ceil(b/f)*f;var h;for(e=f/k;a<d;){l=~~a+.5;c.moveTo(l,3);c.lineTo(l,16);c.fillText(Math.round((a-
b)/f*g),l+4,10);for(h=1;h<k;h++)l=~~a+e*h+.5,h%2?c.moveTo(l,12):c.moveTo(l,9),c.lineTo(l,16);a+=f}c.stroke();return{markersDistance:f,divisors:k}};
_.drawGrid=function(a,b,c,d,e){var f=this.gridPattern.canvas;f.width=a;f.height=b;var g=f.getContext("2d");g.lineWidth=.5;g.strokeStyle="#888888";g.globalAlpha=".15";g.beginPath();g.rect(.5,.5,Math.floor(a)-.5,Math.floor(b)-.5);g.stroke();for(var k=a/e,l=b/e,h,m=1;m<e;m++)h=~~(k*m)+.5,g.moveTo(h,1),g.lineTo(h,b-1),h=~~(l*m)+.5,g.moveTo(1,h),g.lineTo(a-1,h);g.stroke();this.gridPattern.setAttribute("width",a);this.gridPattern.setAttribute("height",b);this.gridPattern.image.setAttribute("width",a);this.gridPattern.image.setAttribute("height",
b);this.gridPattern.image.setAttributeNS(SVGElement.XLINK_NS,"href",f.toDataURL("image/png"));a=this.gridPattern.getTransform().matrix;a.e=c;a.f=d};
(function(){var a=Math.abs,b=Math.min,c=Math.max,d=Math.cos,e=Math.sin,f=Math.acos,g=Math.atan2,k=Math.sqrt,l=function(a){return 0>a?-Math.pow(-a,1/3):Math.pow(a,1/3)},h=Math.PI,m=2*h,n=h/2,p={x:0,y:0,z:0},q={Tvalues:[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,
-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213],Cvalues:[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,
.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872],arcfn:function(a,b){var c=b(a),d=c.x*c.x+c.y*c.y;"undefined"!==typeof c.z&&(d+=c.z*c.z);return k(d)},length:function(a){var b=0,c=this.Tvalues.length,d;for(d=0;d<c;d++){var e=.5*this.Tvalues[d]+.5;b+=this.Cvalues[d]*this.arcfn(e,a)}return.5*b},map:function(a,b,c,d,e){return d+(a-b)/(c-b)*(e-d)},lerp:function(a,b,c){var d={x:b.x+a*(c.x-b.x),y:b.y+a*(c.y-b.y)};b.z&&c.z&&(d.z=b.z+a*(c.z-b.z));return d},pointToString:function(a){var b=
a.x+"/"+a.y;"undefined"!==typeof a.z&&(b+="/"+a.z);return b},pointsToString:function(a){return"["+a.map(this.pointToString).join(", ")+"]"},copy:function(a){return JSON.parse(JSON.stringify(a))},angle:function(a,b,c){var d=b.x-a.x;b=b.y-a.y;var e=c.x-a.x;a=c.y-a.y;c=d*a-b*e;var f=k(d*d+b*b),h=k(e*e+a*a);return g(c,d/f*(e/h)+b/f*(a/h))},dist:function(a,b){var c=a.x-b.x,d=a.y-b.y;return k(c*c+d*d)},lli8:function(a,b,c,d,e,f,g,h){var k=(a-c)*(f-h)-(b-d)*(e-g);return 0==k?!1:{x:((a*d-b*c)*(e-g)-(a-c)*
(e*h-f*g))/k,y:((a*d-b*c)*(f-h)-(b-d)*(e*h-f*g))/k}},lli4:function(a,b,c,d){return this.lli8(a.x,a.y,b.x,b.y,c.x,c.y,d.x,d.y)},lli:function(a,b){return this.lli4(a,a.c,b,b.c)},makeline:function(a,b){var c=a.x,d=a.y,e=b.x,f=b.y,g=(e-c)/3,h=(f-d)/3;return new r(c,d,c+g,d+h,c+2*g,d+2*h,e,f)},findbbox:function(a){var b=99999999,c=b,d=-b,e=d;a.forEach(function(a){a=a.bbox();b>a.x.min&&(b=a.x.min);c>a.y.min&&(c=a.y.min);d<a.x.max&&(d=a.x.max);e<a.y.max&&(e=a.y.max)});return{x:{min:b,mid:(b+d)/2,max:d,size:d-
b},y:{min:c,mid:(c+e)/2,max:e,size:e-c}}},shapeintersections:function(a,b,c,d){if(!this.bboxoverlap(b,d))return[];var e=[],f=[c.startcap,c.forward,c.back,c.endcap];[a.startcap,a.forward,a.back,a.endcap].forEach(function(b){b.virtual||f.forEach(function(d){if(!d.virtual){var f=b.intersects(d);0<f.length&&(f.c1=b,f.c2=d,f.s1=a,f.s2=c,e.push(f))}})});return e},makeshape:function(a,b){var c=a.points.length,d=this.makeline(b.points[b.points.length-1],a.points[0]);c=this.makeline(a.points[c-1],b.points[0]);
var e={startcap:d,forward:a,back:b,endcap:c,bbox:this.findbbox([d,a,b,c])},f=this;e.intersections=function(a){return f.shapeintersections(e,e.bbox,a,a.bbox)};return e},getminmax:function(a,b,c){if(!c)return{min:0,max:0};var d=1.8446744073709552E19,e=-d;-1===c.indexOf(0)&&(c=[0].concat(c));-1===c.indexOf(1)&&c.push(1);for(var f=0,g=c.length;f<g;f++){var h=c[f];h=a.get(h);h[b]<d&&(d=h[b]);h[b]>e&&(e=h[b])}return{min:d,mid:(d+e)/2,max:e,size:e-d}},align:function(a,b){var c=b.p1.x,f=b.p1.y,h=-g(b.p2.y-
f,b.p2.x-c);return a.map(function(a){return{x:(a.x-c)*d(h)-(a.y-f)*e(h),y:(a.x-c)*e(h)+(a.y-f)*d(h)}})},roots:function(a,b){b=b||{p1:{x:0,y:0},p2:{x:1,y:0}};var c=a.length-1,e=this.align(a,b),g=function(a){return 0<=a&&1>=a};if(2===c){c=e[0].y;var h=e[1].y;e=e[2].y;var n=c-2*h+e;return 0!==n?(e=-k(h*h-c*e),c=-c+h,[-(e+c)/n,-(-e+c)/n].filter(g)):h!==e&&0===n?[(2*h-e)/2*(h-e)].filter(g):[]}var p=e[0].y;h=e[1].y;c=e[2].y;n=-p+3*h-3*c+e[3].y;c=(3*p-6*h+3*c)/n;h=(-3*p+3*h)/n;e=(3*h-c*c)/3;var v=e/3;n=
(2*c*c*c-9*c*h+p/n*27)/27;h=n/2;p=h*h+v*v*v;if(0>p)return e=-e/3,e=k(e*e*e),n=-n/(2*e),h=f(-1>n?-1:1<n?1:n),p=2*l(e),e=p*d(h/3)-c/3,n=p*d((h+m)/3)-c/3,c=p*d((h+2*m)/3)-c/3,[e,n,c].filter(g);if(0===p)return e=0>h?l(-h):-l(h),[2*e-c/3,-e-c/3].filter(g);n=k(p);e=l(-h+n);n=l(h+n);return[e-n-c/3].filter(g)},droots:function(a){if(3===a.length){var b=a[0],c=a[1],d=a[2];a=b-2*c+d;return 0!==a?(d=-k(c*c-b*d),b=-b+c,[-(d+b)/a,-(-d+b)/a]):c!==d&&0===a?[(2*c-d)/(2*(c-d))]:[]}if(2===a.length)return b=a[0],c=a[1],
b!==c?[b/(b-c)]:[]},bboxoverlap:function(b,c){var d=["x","y"],e=d.length,f;for(f=0;f<e;f++){var g=d[f];var h=b[g].mid;var k=c[g].mid;g=(b[g].size+c[g].size)/2;if(a(h-k)>=g)return!1}return!0},expandbox:function(a,b){b.x.min<a.x.min&&(a.x.min=b.x.min);b.y.min<a.y.min&&(a.y.min=b.y.min);b.z&&b.z.min<a.z.min&&(a.z.min=b.z.min);b.x.max>a.x.max&&(a.x.max=b.x.max);b.y.max>a.y.max&&(a.y.max=b.y.max);b.z&&b.z.max>a.z.max&&(a.z.max=b.z.max);a.x.mid=(a.x.min+a.x.max)/2;a.y.mid=(a.y.min+a.y.max)/2;a.z&&(a.z.mid=
(a.z.min+a.z.max)/2);a.x.size=a.x.max-a.x.min;a.y.size=a.y.max-a.y.min;a.z&&(a.z.size=a.z.max-a.z.min)},pairiteration:function(a,b){var c=a.bbox(),d=b.bbox();if(.5>c.x.size+c.y.size&&.5>d.x.size+d.y.size)return[(1E5*(a._t1+a._t2)/2|0)/1E5+"/"+(1E5*(b._t1+b._t2)/2|0)/1E5];c=a.split(.5);d=b.split(.5);c=[{left:c.left,right:d.left},{left:c.left,right:d.right},{left:c.right,right:d.right},{left:c.right,right:d.left}];c=c.filter(function(a){return q.bboxoverlap(a.left.bbox(),a.right.bbox())});var e=[];
if(0===c.length)return e;c.forEach(function(a){e=e.concat(q.pairiteration(a.left,a.right))});return e=e.filter(function(a,b){return e.indexOf(a)===b})},getccenter:function(a,b,c){var f=b.x-a.x,h=b.y-a.y,k=c.x-b.x,l=c.y-b.y,p=f*d(n)-h*e(n);f=f*e(n)+h*d(n);h=k*d(n)-l*e(n);k=k*e(n)+l*d(n);l=(a.x+b.x)/2;var v=(a.y+b.y)/2,A=(b.x+c.x)/2,r=(b.y+c.y)/2;p=q.lli8(l,v,l+p,v+f,A,r,A+h,r+k);f=q.dist(p,a);a=g(a.y-p.y,a.x-p.x);b=g(b.y-p.y,b.x-p.x);c=g(c.y-p.y,c.x-p.x);if(a<c){if(a>b||b>c)a+=m;a>c&&(b=c,c=a,a=b)}else c<
b&&b<a?(b=c,c=a,a=b):c+=m;p.s=a;p.e=c;p.r=f;return p}},u=function(a){this.curves=[];this._3d=!1;a&&(this.curves=a,this._3d=this.curves[0]._3d)};u.prototype={valueOf:function(){return this.toString()},toString:function(){return q.pointsToString(this.points)},addCurve:function(a){this.curves.push(a);this._3d=this._3d||a._3d},length:function(){return this.curves.map(function(a){return a.length()}).reduce(function(a,b){return a+b})},curve:function(a){return this.curves[a]},bbox:function(){for(var a=this.curves,
b=a[0].bbox(),c=1;c<a.length;c++)q.expandbox(b,a[c].bbox());return b},offset:function(a){var b=[];this.curves.forEach(function(c){b=b.concat(c.offset(a))});return new u(b)}};var r=function(b){var c=b&&b.forEach?b:arguments;if("object"===typeof c[0]){c=[];for(var d=0;d<b.length;d++)["x","y","z"].forEach(function(a){"undefined"!==typeof b[d][a]&&c.push(b[d][a])})}var e=c.length;if(6!==e&&8!==e&&9!==e&&12!==e)throw console.log(b),Error("This Bezier curve library only supports quadratic and cubic curves (in 2d and 3d)");
var f=9===e||12===e;this._3d=f;for(var g=[],h=0,k=f?3:2;h<e;h+=k){var n={x:c[h],y:c[h+1]};f&&(n.z=c[h+2]);g.push(n)}this.order=g.length-1;this.points=g;e=["x","y"];f&&e.push("z");this.dims=e;this.dimlen=e.length;(function(b){for(var c=q.align(g,{p1:g[0],p2:g[b.order]}),d=0;d<c.length;d++)if(1E-4<a(c[d].y)){b._linear=!1;return}b._linear=!0})(this);this._t1=0;this._t2=1;this.update()};r.fromSVG=function(a){var b=a.match(/[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/g).map(parseFloat);if(!/[cq]/.test(a))return new r(b);
b=b.map(function(a,c){return 2>c?a:a+b[c%2]});return new r(b)};r.utils=q;r.prototype={valueOf:function(){return this.toString()},toString:function(){return q.pointsToString(this.points)},toSVG:function(a){if(this._3d)return!1;a=this.points;for(var b=["M",a[0].x,a[0].y,2===this.order?"Q":"C"],c=1,d=a.length;c<d;c++)b.push(a[c].x),b.push(a[c].y);return b.join(" ")},update:function(){this.dpoints=[];for(var a=this.points,b=a.length,c=b-1;1<b;b--,c--){for(var d=[],e=0,f;e<c;e++)f={x:c*(a[e+1].x-a[e].x),
y:c*(a[e+1].y-a[e].y)},this._3d&&(f.z=c*(a[e+1].z-a[e].z)),d.push(f);this.dpoints.push(d);a=d}this.computedirection()},computedirection:function(){var a=this.points;this.clockwise=0<q.angle(a[0],a[this.order],a[1])},length:function(){return q.length(this.derivative.bind(this))},getLUT:function(a){a=a||100;for(var b=[],c=0;c<=a;c++)b.push(this.compute(c/a));return b},get:function(a){return this.compute(a)},point:function(a){return this.points[a]},compute:function(a){if(0===a)return this.points[0];
if(1===a)return this.points[this.order];var b=1-a,c=b*b,d=a*a,e=0,f=this.points;if(2===this.order){f=[f[0],f[1],f[2],p];var g=c;var h=b*a*2;var k=d}3===this.order&&(g=c*b,h=c*a*3,k=b*d*3,e=a*d);a={x:g*f[0].x+h*f[1].x+k*f[2].x+e*f[3].x,y:g*f[0].y+h*f[1].y+k*f[2].y+e*f[3].y};this._3d&&(a.z=g*f[0].z+h*f[1].z+k*f[2].z+e*f[3].z);return a},raise:function(){var a=this.points,b=[a[0]],c,d=a.length;for(c=1;c<d;c++){var e=a[c];var f=a[c-1];b[c]={x:(d-c)/d*e.x+c/d*f.x,y:(d-c)/d*e.y+c/d*f.y}}b[d]=a[d-1];return new r(b)},
derivative:function(a){var b=1-a,c=0,d=this.dpoints[0];if(2===this.order){d=[d[0],d[1],p];var e=b;var f=a}3===this.order&&(e=b*b,f=b*a*2,c=a*a);a={x:e*d[0].x+f*d[1].x+c*d[2].x,y:e*d[0].y+f*d[1].y+c*d[2].y};this._3d&&(a.z=e*d[0].z+f*d[1].z+c*d[2].z);return a},normal:function(a){return this._3d?this.__normal3(a):this.__normal2(a)},__normal2:function(a){a=this.derivative(a);var b=k(a.x*a.x+a.y*a.y);return{x:-a.y/b,y:a.x/b}},__normal3:function(){var a=this.derivative(t),b=this.derivative(t+.01),c=k(a.x*
a.x+a.y*a.y+a.z*a.z),d=k(b.x*b.x+b.y*b.y+b.z*b.z);a.x/=c;a.y/=c;a.z/=c;b.x/=d;b.y/=d;b.z/=d;c=b.y*a.z-b.z*a.y;d=b.z*a.x-b.x*a.z;b=b.x*a.y-b.y*a.x;var e=k(c*c+d*d+b*b);c/=e;d/=e;b/=e;b=[c*c,c*d-b,c*b+d,c*d+b,d*d,d*b-c,c*b-d,d*b+c,b*b];return{x:b[0]*a.x+b[1]*a.y+b[2]*a.z,y:b[3]*a.x+b[4]*a.y+b[5]*a.z,z:b[6]*a.x+b[7]*a.y+b[8]*a.z}},split:function(a,b){if(0===a&&b)return this.split(b).left;if(1===b)return this.split(a).right;var c=this.points,d=[],e=0,f;d[e++]=c[0];d[e++]=c[1];d[e++]=c[2];for(3===this.order&&
(d[e++]=c[3]);1<c.length;){var g=[];var h=0;for(f=c.length-1;h<f;h++){var k=q.lerp(a,c[h],c[h+1]);d[e++]=k;g.push(k)}c=g}c={left:2===this.order?new r([d[0],d[3],d[5]]):new r([d[0],d[4],d[7],d[9]]),right:2===this.order?new r([d[5],d[4],d[2]]):new r([d[9],d[8],d[6],d[3]]),span:d};c.left._t1=q.map(0,0,1,this._t1,this._t2);c.left._t2=q.map(a,0,1,this._t1,this._t2);c.right._t1=q.map(a,0,1,this._t1,this._t2);c.right._t2=q.map(1,0,1,this._t1,this._t2);if(!b)return c;b=q.map(b,a,1,0,1);return c.right.split(b).left},
inflections:function(){var a={},b=[],c,d;this.dims.forEach(function(e){d=function(a){return a[e]};c=this.dpoints[0].map(d);a[e]=q.droots(c);3===this.order&&(c=this.dpoints[1].map(d),a[e]=a[e].concat(q.droots(c)));a[e]=a[e].filter(function(a){return 0<=a&&1>=a});b=b.concat(a[e].sort())}.bind(this));b.sort();a.values=b;return a},bbox:function(){var a=this.inflections(),b={};this.dims.forEach(function(c){b[c]=q.getminmax(this,c,a[c])}.bind(this));return b},overlaps:function(a){var b=this.bbox();a=a.bbox();
return q.bboxoverlap(b,a)},offset:function(a,b){if("undefined"!==typeof b){var c=this.get(a),d=this.normal(a),e={c:c,n:d,x:c.x+d.x*b,y:c.y+d.y*b};this._3d&&(e.z=c.z+d.z*b);return e}if(this._linear){var f=this.normal(0);c=this.points.map(function(b){var c={x:b.x+a*f.x,y:b.y+a*f.y};b.z&&d.z&&(c.z=b.z+a*f.z);return c});return[new r(c)]}return this.reduce().map(function(b){return b.scale(a)})},simple:function(){if(3===this.order){var b=q.angle(this.points[0],this.points[3],this.points[1]),c=q.angle(this.points[0],
this.points[3],this.points[2]);if(0<b&&0>c||0>b&&0<c)return!1}b=this.normal(0);c=this.normal(1);var d=b.x*c.x+b.y*c.y;this._3d&&(d+=b.z*c.z);return a(f(d))<h/3},reduce:function(){var b,c=0,d=0,e=[],f=[],g=this.inflections().values;-1===g.indexOf(0)&&(g=[0].concat(g));-1===g.indexOf(1)&&g.push(1);c=g[0];for(b=1;b<g.length;b++){d=g[b];var h=this.split(c,d);h._t1=c;h._t2=d;e.push(h);c=d}e.forEach(function(b){for(d=c=0;1>=d;)for(d=c+.01;1.01>=d;d+=.01)if(h=b.split(c,d),!h.simple()){d-=.01;if(.01>a(c-
d))return[];h=b.split(c,d);h._t1=q.map(c,0,1,b._t1,b._t2);h._t2=q.map(d,0,1,b._t1,b._t2);f.push(h);c=d;break}1>c&&(h=b.split(c,1),h._t1=q.map(c,0,1,b._t1,b._t2),h._t2=b._t2,f.push(h))});return f},scale:function(a){var b=this.order,c=!1;"function"===typeof a&&(c=a);if(c&&2===b)return this.raise().scale(c);var d=this.clockwise,e=c?c(0):a,f=c?c(1):a,g=[this.offset(0,10),this.offset(1,10)],h=q.lli4(g[0],g[0].c,g[1],g[1].c);if(!h)throw"cannot scale this curve. Try reducing it first.";var n=this.points,
m=[];[0,1].forEach(function(a){var c=m[a*b]=q.copy(n[a*b]);c.x+=(a?f:e)*g[a].n.x;c.y+=(a?f:e)*g[a].n.y}.bind(this));if(!c)return[0,1].forEach(function(a){if(2!==this.order||!a){var c=m[a*b],d=this.derivative(a);m[a+1]=q.lli4(c,{x:c.x+d.x,y:c.y+d.y},h,n[a+1])}}.bind(this)),new r(m);[0,1].forEach(function(e){if(2!==this.order||!e){var f=n[e+1],g=f.x-h.x,l=f.y-h.y,p=c?c((e+1)/b):a;c&&!d&&(p=-p);var q=k(g*g+l*l);m[e+1]={x:f.x+g/q*p,y:f.y+l/q*p}}}.bind(this));return new r(m)},outline:function(a,b,c,d){function e(a,
b,c,d,e){return function(f){var g=b-a;return q.map(f,0,1,a+d/c*g,a+(d+e)/c*g)}}b="undefined"===typeof b?a:b;var f=this.reduce(),g=f.length,h=[],k=[],n,m=0,l=this.length(),p="undefined"!==typeof c&&"undefined"!==typeof d;f.forEach(function(f){v=f.length();p?(h.push(f.scale(e(a,c,l,m,v))),k.push(f.scale(e(-b,-d,l,m,v)))):(h.push(f.scale(a)),k.push(f.scale(-b)));m+=v});k=k.map(function(a){n=a.points;a.points=n[3]?[n[3],n[2],n[1],n[0]]:[n[2],n[1],n[0]];return a}).reverse();f=h[g-1].points[h[g-1].points.length-
1];var r=k[0].points[0];g=q.makeline(k[g-1].points[k[g-1].points.length-1],h[0].points[0]);f=q.makeline(f,r);g=[g].concat(h).concat([f]).concat(k);var v=g.length;return new u(g)},outlineshapes:function(a,b){for(var c=this.outline(a,b||a).curves,d=[],e=1,f=c.length;e<f/2;e++){var g=q.makeshape(c[e],c[f-e]);g.startcap.virtual=1<e;g.endcap.virtual=e<f/2-1;d.push(g)}return d},intersects:function(a){if(!a)return this.selfintersects();if(a.p1&&a.p2)return this.lineIntersects(a);a instanceof r&&(a=a.reduce());
return this.curveintersects(this.reduce(),a)},lineIntersects:function(a){var d=b(a.p1.x,a.p2.x),e=b(a.p1.y,a.p2.y),f=c(a.p1.x,a.p2.x),g=c(a.p1.y,a.p2.y),h=this;return q.roots(this.points,a).filter(function(a){a=h.get(a);return d<=a.x&&a.x<=f&&e<=a.y&&a.y<=g})},selfintersects:function(){var a=this.reduce(),b,c=a.length-2,d=[];for(b=0;b<c;b++){var e=a.slice(b,b+1);var f=a.slice(b+2);e=this.curveintersects(e,f);d=d.concat(e)}return d},curveintersects:function(a,b){var c=[];a.forEach(function(a){b.forEach(function(b){a.overlaps(b)&&
c.push({left:a,right:b})})});var d=[];c.forEach(function(a){a=q.pairiteration(a.left,a.right);0<a.length&&(d=d.concat(a))});return d},arcs:function(a){return this._iterate(a||.5,[])},_error:function(b,c,d,e){var f=(e-d)/4;d=this.get(d+f);e=this.get(e-f);c=q.dist(b,c);d=q.dist(b,d);b=q.dist(b,e);return a(d-c)+a(b-c)},_iterate:function(a,b){var c=0;do{var d=0;var e=1;var f=this.get(c);var g=!1;var h=1,k=0;do{var n=g;var m=p;var l=(c+e)/2;k++;var p=this.get(l);g=this.get(e);p=q.getccenter(f,p,g);g=this._error(p,
f,c,e)<=a;(n=n&&!g)||(h=e);if(g){if(1<=e){h=1;m=p;break}e+=(e-c)/2}else e=l}while(!n&&100>d++);if(100<=d){console.error("arc abstraction somehow failed...");break}m=m?m:p;b.push(m);c=h}while(1>e);return b}};"undefined"!==typeof module&&module.exports?module.exports=r:"undefined"!==typeof define?define(function(){return r}):"undefined"!==typeof window&&(window.Bezier=r)})();
(function(){"undefined"==typeof Math.sgn&&(Math.sgn=function(a){return 0==a?0:0<a?1:-1});var a={subtract:function(a,b){return{x:a.x-b.x,y:a.y-b.y}},dotProduct:function(a,b){return a.x*b.x+a.y*b.y},square:function(a){return Math.sqrt(a.x*a.x+a.y*a.y)},scale:function(a,b){return{x:a.x*b,y:a.y*b}}},b=Math.pow(2,-65),c=function(b,c){for(var f=[],g=c.length-1,h=2*g-1,k=[],n=[],m=[],l=[],p=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],w=0;w<=g;w++)k[w]=a.subtract(c[w],b);for(w=0;w<=g-1;w++)n[w]=a.subtract(c[w+
1],c[w]),n[w]=a.scale(n[w],3);for(w=0;w<=g-1;w++)for(var E=0;E<=g;E++)m[w]||(m[w]=[]),m[w][E]=a.dotProduct(n[w],k[E]);for(w=0;w<=h;w++)l[w]||(l[w]=[]),l[w].y=0,l[w].x=parseFloat(w)/h;h=g-1;for(k=0;k<=g+h;k++)for(n=Math.min(k,g),w=Math.max(0,k-h);w<=n;w++)j=k-w,l[w+j].y+=m[j][w]*p[j][w];g=c.length-1;l=d(l,2*g-1,f,0);h=a.subtract(b,c[0]);m=a.square(h);for(w=p=0;w<l;w++)h=a.subtract(b,e(c,g,f[w],null,null)),h=a.square(h),h<m&&(m=h,p=f[w]);h=a.subtract(b,c[g]);h=a.square(h);h<m&&(m=h,p=1);return{location:p,
distance:m}},d=function(a,c,f,g){var h=[],k=[],n=[],m=[],l=0;var p=Math.sgn(a[0].y);for(var q=1;q<=c;q++){var u=Math.sgn(a[q].y);u!=p&&l++;p=u}switch(l){case 0:return 0;case 1:if(64<=g)return f[0]=(a[0].x+a[c].x)/2,1;var x;l=a[0].y-a[c].y;u=a[c].x-a[0].x;p=a[0].x*a[c].y-a[c].x*a[0].y;q=max_distance_below=0;for(x=1;x<c;x++){var D=l*a[x].x+u*a[x].y+p;D>q?q=D:D<max_distance_below&&(max_distance_below=D)}x=u;q=1/(0*x-1*l)*(1*(p-q)-0*x);x=u;u=p-max_distance_below;l=1/(0*x-1*l)*(1*u-0*x);if(Math.max(q,
l)-Math.min(q,l)<b)return n=a[c].x-a[0].x,m=a[c].y-a[0].y,f[0]=0+1/(0*n-1*m)*1*(n*(a[0].y-0)-m*(a[0].x-0)),1}e(a,c,.5,h,k);a=d(h,c,n,g+1);c=d(k,c,m,g+1);for(g=0;g<a;g++)f[g]=n[g];for(g=0;g<c;g++)f[g+a]=m[g];return a+c},e=function(a,b,c,d,e){for(var f=[[]],g=0;g<=b;g++)f[0][g]=a[g];for(a=1;a<=b;a++)for(g=0;g<=b-a;g++)f[a]||(f[a]=[]),f[a][g]||(f[a][g]={}),f[a][g].x=(1-c)*f[a-1][g].x+c*f[a-1][g+1].x,f[a][g].y=(1-c)*f[a-1][g].y+c*f[a-1][g+1].y;if(null!=d)for(g=0;g<=b;g++)d[g]=f[g][0];if(null!=e)for(g=
0;g<=b;g++)e[g]=f[b-g][g];return f[b][0]},f={},g=function(a){var b=f[a];if(!b){b=[];var c=function(a){return function(b){return a}},d=function(){return function(a){return a}},e=function(){return function(a){return 1-a}},g=function(a){return function(b){for(var c=1,d=0;d<a.length;d++)c*=a[d](b);return c}};b.push(new function(){return function(b){return Math.pow(b,a)}});for(var h=1;h<a;h++){for(var k=[new c(a)],n=0;n<a-h;n++)k.push(new d);for(n=0;n<h;n++)k.push(new e);b.push(new g(k))}b.push(new function(){return function(b){return Math.pow(1-
b,a)}});f[a]=b}return b},k=function(a,b){for(var c=g(a.length-1),d=0,e=0,f=0;f<a.length;f++)d+=a[f].x*c[f](b),e+=a[f].y*c[f](b);return{x:d,y:e}},l=function(a,b){return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(a.y-b.y,2))},h=function(a,b,c){for(var d=k(a,b),e=0,f=0<c?1:-1,g=null;e<Math.abs(c);)b+=.005*f,g=k(a,b),e+=l(g,d),d=g;return{point:g,location:b}},m=function(a,b){var c=k(a,b),d=k(a.slice(0,a.length-1),b),e=d.y-c.y;c=d.x-c.x;return 0==e?Infinity:Math.atan(e/c)};window.jsBezier={distanceFromCurve:c,
gradientAtPoint:m,gradientAtPointAlongCurveFrom:function(a,b,c){b=h(a,b,c);1<b.location&&(b.location=1);0>b.location&&(b.location=0);return m(a,b.location)},nearestPointOnCurve:function(a,b){var d=c(a,b);return{point:e(b,b.length-1,d.location,null,null),location:d.location}},pointOnCurve:k,pointAlongCurveFrom:function(a,b,c){return h(a,b,c).point},perpendicularToCurveAt:function(a,b,c,d){b=h(a,b,null==d?0:d);a=m(a,b.location);d=Math.atan(-1/a);a=c/2*Math.sin(d);c=c/2*Math.cos(d);return[{x:b.point.x+
c,y:b.point.y+a},{x:b.point.x-c,y:b.point.y-a}]},locationAlongCurveFrom:function(a,b,c){return h(a,b,c).location},getLength:function(a){for(var b=k(a,0),c=0,d=0,e;1>d;)d+=.005,e=k(a,d),c+=l(e,b),b=e;return c}}})();
var paper=function(a,b){var c=a?a.window:require("./node/window"),d=c&&c.document;a=a||c;var e=new function(){function a(a,b,c,d,g){function h(f,h){h=h||(h=m(b,f))&&(h.get?h:h.value);"string"==typeof h&&"#"===h[0]&&(h=a[h.substring(1)]||h);var k,n="function"==typeof h,Z=h,I=g||n&&!h.base?h&&h.get?f in a:a[f]:null;g&&I||(n&&I&&(h.base=I),n&&!1!==d&&(k=f.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(M[k[3].toLowerCase()+k[4]]=k[2]),Z&&!n&&Z.get&&"function"==typeof Z.get&&e.isPlainObject(Z)||(Z={value:Z,writable:!0}),
(m(a,f)||{configurable:!0}).configurable&&(Z.configurable=!0,Z.enumerable=c),l(a,f,Z))}var M={};if(b){for(var k in b)b.hasOwnProperty(k)&&!f.test(k)&&h(k);for(k in M){var n=M[k],Z=a["set"+n];n=a["get"+n]||Z&&a["is"+n];!n||!0!==d&&0!==n.length||h(k,{get:n,set:Z})}}return a}function c(a,b,c){return a&&("length"in a&&!a.getLength&&"number"==typeof a.length?g:h).call(a,b,c=c||a),c}function d(a,b,c){for(var d=b.length;c<d;c++){var e=b[c],f;for(f in e)e.hasOwnProperty(f)&&(a[f]=e[f])}return a}var f=/^(statics|enumerable|beans|preserve)$/,
g=[].forEach||function(a,b){for(var c=0,d=this.length;c<d;c++)a.call(b,this[c],c,this)},h=function(a,b){for(var c in this)this.hasOwnProperty(c)&&a.call(b,this[c],c,this)},k=Object.create||function(a){return{__proto__:a}},m=Object.getOwnPropertyDescriptor||function(a,b){var c=a.__lookupGetter__&&a.__lookupGetter__(b);return c?{get:c,set:a.__lookupSetter__(b),enumerable:!0,configurable:!0}:a.hasOwnProperty(b)?{value:a[b],enumerable:!0,configurable:!0,writable:!0}:null},n=Object.defineProperty||function(a,
b,c){return(c.get||c.set)&&a.__defineGetter__?(c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)):a[b]=c.value,a},l=function(a,b,c){return delete a[b],n(a,b,c)};return a(function(){d(this,arguments,0)},{inject:function(b){if(b){var c=!0===b.statics?b:b.statics,d=b.beans,e=b.preserve;c!==b&&a(this.prototype,b,b.enumerable,d,e);a(this,c,!0,d,e)}c=1;for(d=arguments.length;c<d;c++)this.inject(arguments[c]);return this},extend:function(){for(var b,c,d,e=this,f=0,g=arguments.length;f<
g&&(!b||!c);f++)d=arguments[f],b=b||d.initialize,c=c||d.prototype;return b=b||function(){e.apply(this,arguments)},c=b.prototype=c||k(this.prototype),l(c,"constructor",{value:b,writable:!0,configurable:!0}),a(b,this,!0),arguments.length&&this.inject.apply(b,arguments),b.base=e,b}},!0).inject({inject:function(){for(var b=0,c=arguments.length;b<c;b++){var d=arguments[b];d&&a(this,d,d.enumerable,d.beans,d.preserve)}return this},extend:function(){var a=k(this);return a.inject.apply(a,arguments)},each:function(a,
b){return c(this,a,b)},set:function(){return d(this,arguments,0)},clone:function(){return new this.constructor(this)},statics:{each:c,create:k,define:l,describe:m,set:function(a){return d(a,arguments,1)},clone:function(a){return d(new a.constructor,arguments,0)},isPlainObject:function(a){return(a=null!=a&&a.constructor)&&(a===Object||a===e||"Object"===a.name)},pick:function(a,c){return a!==b?a:c}}})};"undefined"!=typeof module&&(module.exports=e);e.inject({toString:function(){return null!=this._id?
(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+e.each(this,function(a,b){if(!/^_/.test(b)){var c=typeof a;this.push(b+": "+("number"===c?l.instance.number(a):"string"===c?"'"+a+"'":a))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(a){return e.importJSON(a,this)},exportJSON:function(a){return e.exportJSON(this,a)},toJSON:function(){return e.serialize(this)},_set:function(a){if(a&&e.isPlainObject(a))return e.filter(this,a)},statics:{exports:{enumerable:!0},
extend:function Wb(){var a=Wb.base.apply(this,arguments),b=a.prototype._class;return b&&!e.exports[b]&&(e.exports[b]=a),a},equals:function(a,b){if(a===b)return!0;if(a&&a.equals)return a.equals(b);if(b&&b.equals)return b.equals(a);if(a&&b&&"object"==typeof a&&"object"==typeof b){if(Array.isArray(a)&&Array.isArray(b)){var c=a.length;if(c!==b.length)return!1;for(;c--;)if(!e.equals(a[c],b[c]))return!1}else{var d=Object.keys(a);c=d.length;if(c!==Object.keys(b).length)return!1;for(;c--;){var f=d[c];if(!b.hasOwnProperty(f)||
!e.equals(a[f],b[f]))return!1}}return!0}return!1},read:function(a,c,d,f){if(this===e)return d=this.peek(a,c),a.__index++,d;var g=this.prototype._readIndex;c=c||g&&a.__index||0;f||(f=a.length-c);var h=a[c];return h instanceof this||d&&d.readNull&&null==h&&1>=f?(g&&(a.__index=c+1),h&&d&&d.clone?h.clone():h):(h=e.create(this.prototype),g&&(h.__read=!0),h=h.initialize.apply(h,0<c||f<a.length?Array.prototype.slice.call(a,c,c+f):a)||h,g&&(a.__index=c+h.__read,h.__read=b),h)},peek:function(a,b){return a[a.__index=
b||a.__index||0]},remain:function(a){return a.length-(a.__index||0)},readAll:function(a,b,c){var d,e=[];b=b||0;for(var f=a.length;b<f;b++)e.push(Array.isArray(d=a[b])?this.read(d,0,c):this.read(a,b,c,1));return e},readNamed:function(a,c,d,f,g){var h=this.getNamed(a,c),k=h!==b;if(k){var n=a._filtered;n||(n=a._filtered=e.create(a[0]),n._filtering=a[0]);n[c]=b}return this.read(k?[h]:a,d,f,g)},getNamed:function(a,c){var d=a[0];if(a._hasObject===b&&(a._hasObject=1===a.length&&e.isPlainObject(d)),a._hasObject)return c?
d[c]:a._filtered||d},hasNamed:function(a,b){return!!this.getNamed(a,b)},filter:function(a,c,d){for(var e=Object.keys(c._filtering||c),f=0,g=e.length;f<g;f++){var h=e[f];if(!d||!d[h]){var k=c[h];k!==b&&(a[h]=k)}}return a},isPlainValue:function(a,b){return this.isPlainObject(a)||Array.isArray(a)||b&&"string"==typeof a},serialize:function(a,b,c,d){b=b||{};var f=!d;if(f&&(b.formatter=new l(b.precision),d={length:0,definitions:{},references:{},add:function(a,b){var c="#"+a._id,d=this.references[c];if(!d){this.length++;
d=b.call(a);var e=a._class;e&&d[0]!==e&&d.unshift(e);this.definitions[c]=d;d=this.references[c]=[c]}return d}}),a&&a._serialize){var g=a._serialize(b,d);b=a._class;!b||a._compactSerialize||!f&&c||g[0]===b||g.unshift(b)}else if(Array.isArray(a)){g=[];for(var h=0,k=a.length;h<k;h++)g[h]=e.serialize(a[h],b,c,d)}else if(e.isPlainObject(a)){g={};var n=Object.keys(a);h=0;for(k=n.length;h<k;h++){var m=n[h];g[m]=e.serialize(a[m],b,c,d)}}else g="number"==typeof a?b.formatter.number(a,b.precision):a;return f&&
0<d.length?[["dictionary",d.definitions],g]:g},deserialize:function(a,b,c,d,f){var g=a,h=!c,k=h&&a&&a.length&&"dictionary"===a[0][0];if(c=c||{},Array.isArray(a)){d=a[0];var n="dictionary"===d;if(1==a.length&&/^#/.test(d))return c.dictionary[d];d=e.exports[d];g=[];for(var m=d?1:0,l=a.length;m<l;m++)g.push(e.deserialize(a[m],b,c,n,k));d&&(a=g,b?g=b(d,a,h||f):(g=e.create(d.prototype),d.apply(g,a)))}else if(e.isPlainObject(a))for(n in g={},d&&(c.dictionary=g),a)g[n]=e.deserialize(a[n],b,c);return k?g[1]:
g},exportJSON:function(a,b){var c=e.serialize(a,b);return b&&!1===b.asString?c:JSON.stringify(c)},importJSON:function(a,b){return e.deserialize("string"==typeof a?JSON.parse(a):a,function(a,c,d){var f=(d=d&&b&&b.constructor===a)?b:e.create(a.prototype);if(1===c.length&&f instanceof B&&(d||!(f instanceof E))){var g=c[0];e.isPlainObject(g)&&(g.insert=!1)}return(d?f._set:a).apply(f,c),d&&(b=null),f})},splice:function(a,c,d,e){var f=c&&c.length,g=d===b;d=g?a.length:d;d>a.length&&(d=a.length);for(var h=
0;h<f;h++)c[h]._index=d+h;if(g)return a.push.apply(a,c),[];h=[d,e];c&&h.push.apply(h,c);c=a.splice.apply(a,h);h=0;for(e=c.length;h<e;h++)c[h]._index=b;h=d+f;for(e=a.length;h<e;h++)a[h]._index=h;return c},capitalize:function(a){return a.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},camelize:function(a){return a.replace(/-(.)/g,function(a,b){return b.toUpperCase()})},hyphenate:function(a){return a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var f={on:function(a,b){if("string"!=typeof a)e.each(a,
function(a,b){this.on(b,a)},this);else{var c=this._eventTypes;c=c&&c[a];var d=this._callbacks=this._callbacks||{};d=d[a]=d[a]||[];-1===d.indexOf(b)&&(d.push(b),c&&c.install&&1===d.length&&c.install.call(this,a))}return this},off:function(a,b){if("string"!=typeof a)return void e.each(a,function(a,b){this.off(b,a)},this);var c,d=this._eventTypes;d=d&&d[a];var f=this._callbacks&&this._callbacks[a];return f&&(!b||-1!==(c=f.indexOf(b))&&1===f.length?(d&&d.uninstall&&d.uninstall.call(this,a),delete this._callbacks[a]):
-1!==c&&f.splice(c,1)),this},once:function(a,b){return this.on(a,function(){b.apply(this,arguments);this.off(a,b)})},emit:function(a,b){var c=this._callbacks&&this._callbacks[a];if(!c)return!1;var d=[].slice.call(arguments,1),e=b&&b.target&&!b.currentTarget;c=c.slice();e&&(b.currentTarget=this);for(var f=0,g=c.length;f<g;f++)if(!1===c[f].apply(this,d)){b&&b.stop&&b.stop();break}return e&&delete b.currentTarget,!0},responds:function(a){return!(!this._callbacks||!this._callbacks[a])},attach:"#on",detach:"#off",
fire:"#emit",_installEvents:function(a){var b=this._eventTypes,c=this._callbacks;a=a?"install":"uninstall";if(b)for(var d in c)if(0<c[d].length){var e=b[d];(e=e&&e[a])&&e.call(this,d)}},statics:{inject:function Za(a){var b=a._events;if(b){var c={};e.each(b,function(b,d){var f="string"==typeof b,g=f?b:d,h=e.capitalize(g),k=g.substring(2).toLowerCase();c[k]=f?{}:b;g="_"+g;a["get"+h]=function(){return this[g]};a["set"+h]=function(a){var b=this[g];b&&this.off(k,b);a&&this.on(k,a);this[g]=a}});a._eventTypes=
c}return Za.base.apply(this,arguments)}}},g=e.extend({_class:"PaperScope",initialize:function Za(){paper=this;this.settings=new e({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0});this.project=null;this.projects=[];this.tools=[];this.palettes=[];this._id=Za._id++;Za._scopes[this._id]=this;var b=Za.prototype;if(!this.support){var c=R.getContext(1,1)||{};b.support={nativeDash:"setLineDash"in c||"mozDash"in c,nativeBlendModes:Qa.nativeModes};R.release(c)}if(!this.agent){c=a.navigator.userAgent.toLowerCase();
var d=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(c)||[])[0];d="darwin"===d?"mac":d;var f=b.agent=b.browser={platform:d};d&&(f[d]=!0);c.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv:v?([.\d]+))?/g,function(a,b,c,d,e){f.chrome||(a="opera"===b?d:/^(node|trident)$/.test(b)?e:c,f.version=a,f.versionNumber=parseFloat(a),b="trident"===b?"msie":b,f.name=b,f[b]=!0)});f.chrome&&delete f.webkit;f.atom&&delete f.chrome}},version:"0.10.2-develop",
getView:function(){var a=this.project;return a&&a._view},getPaper:function(){return this},execute:function(a,b){paper.PaperScript.execute(a,this,b);ea.updateFocus()},install:function(a){var b=this;e.each(["project","view","tool"],function(c){e.define(a,c,{configurable:!0,get:function(){return b[c]}})});for(var c in this)!/^_/.test(c)&&this[c]&&(a[c]=this[c])},setup:function(a){return paper=this,this.project=new F(a),this},createCanvas:function(a,b){return R.getCanvas(a,b)},activate:function(){paper=
this},clear:function(){for(var a=this.projects,b=this.tools,c=this.palettes,d=a.length-1;0<=d;d--)a[d].remove();for(d=b.length-1;0<=d;d--)b[d].remove();for(d=c.length-1;0<=d;d--)c[d].remove()},remove:function(){this.clear();delete g._scopes[this._id]},statics:new function(){function a(a){return a+="Attribute",function(b,c){return b[a](c)||b[a]("data-paper-"+c)}}return{_scopes:{},_id:0,get:function(a){return this._scopes[a]||null},getAttribute:a("get"),hasAttribute:a("has")}}}),k=e.extend(f,{initialize:function(a){this._scope=
paper;this._index=this._scope[this._list].push(this)-1;!a&&this._scope[this._reference]||this.activate()},activate:function(){if(!this._scope)return!1;var a=this._scope[this._reference];return a&&a!==this&&a.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",a),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null!=this._index&&(e.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=
null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),l=e.extend({initialize:function(a){this.precision=e.pick(a,5);this.multiplier=Math.pow(10,this.precision)},number:function(a){return 16>this.precision?Math.round(a*this.multiplier)/this.multiplier:a},pair:function(a,b,c){return this.number(a)+(c||",")+this.number(b)},point:function(a,b){return this.number(a.x)+(b||",")+this.number(a.y)},size:function(a,b){return this.number(a.width)+(b||",")+this.number(a.height)},rectangle:function(a,
b){return this.point(a,b)+(b||",")+this.size(a,b)}});l.instance=new l;var h=new function(){function a(a,b,c){return a<b?b:a>c?c:a}function b(a,b,c){function d(a){var b=134217729*a;b=a-b+b;return[b,a-b]}var e=b*b-a*c,g=b*b+a*c;if(3*f(e)<g){e=d(a);g=d(b);var h=d(c);b*=b;a*=c;e=b-a+(g[0]*g[0]-b+2*g[0]*g[1]+g[1]*g[1]-(e[0]*h[0]-a+e[0]*h[1]+e[1]*h[0]+e[1]*h[1]))}return e}function c(){var a=Math.max.apply(Math,arguments);return a&&(1E-8>a||1E8<a)?k(2,-Math.round(n(a))):0}var d=[[.5773502691896257],[0,.7745966692414834],
[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,
.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,
.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],e=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,
.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],
[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],f=Math.abs,g=Math.sqrt,k=Math.pow,n=Math.log2||function(a){return Math.log(a)*
Math.LOG2E};return{TOLERANCE:1E-6,EPSILON:1E-12,MACHINE_EPSILON:1.12E-16,CURVETIME_EPSILON:4E-7,GEOMETRIC_EPSILON:2E-7,WINDING_EPSILON:2E-7,TRIGONOMETRIC_EPSILON:1E-7,CLIPPING_EPSILON:1E-9,KAPPA:4*(g(2)-1)/3,isZero:function(a){return-1E-12<=a&&1E-12>=a},clamp:a,integrate:function(a,b,c,f){var g=d[f-2],h=e[f-2];c=.5*(c-b);b=c+b;var M=0,k=f+1>>1;for(f=1&f?h[M++]*a(b):0;M<k;){var n=c*g[M];f+=h[M++]*(a(b+n)+a(b-n))}return c*f},findRoot:function(a,b,c,d,e,g,h){for(var M=0;M<g;M++){var k=a(c),n=k/b(c),
m=c-n;if(f(n)<h)return m;0<k?(e=c,c=m<=d?.5*(d+e):m):(d=c,c=m>=e?.5*(d+e):m)}return c},solveQuadratic:function(d,e,h,k,n,m){var M=1/0;if(1E-12>f(d)){if(1E-12>f(e))return 1E-12>f(h)?-1:0;var l=-h/e}else{e*=-.5;var Z=b(d,e,h);if(Z&&1.12E-16>f(Z)){var K=c(f(d),f(e),f(h));K&&(d*=K,e*=K,h*=K,Z=b(d,e,h))}-1.12E-16<=Z&&(Z=0>Z?0:g(Z),e+=0>e?-Z:Z,0===e?(l=h/d,M=-l):(l=e/d,M=h/e))}d=0;h=null==n;e=n-1E-12;Z=m+1E-12;return isFinite(l)&&(h||l>e&&l<Z)&&(k[d++]=h?l:a(l,n,m)),M!==l&&isFinite(M)&&(h||M>e&&M<Z)&&(k[d++]=
h?M:a(M,n,m)),d},solveCubic:function(b,d,e,n,m,l,I){function M(a){q=a;a=b*q;p=a+d;va=p*q+e;Z=(a+p)*q+va;K=va*q+n}var Z,K,ca=c(f(b),f(d),f(e),f(n));if(ca&&(b*=ca,d*=ca,e*=ca,n*=ca),1E-12>f(b)){b=d;var p=e;var va=n;var q=1/0}else if(1E-12>f(n))p=d,va=e,q=0;else{M(-(d/b)/3);ca=K/b;var la=k(f(ca),1/3);ca=0>ca?-1:1;var cb=-Z/b;la=0<cb?1.324717957244746*Math.max(la,g(cb)):la;la=q-ca*la;if(la!==q){do M(la),la=0===Z?q:q-K/Z/(1+1.12E-16);while(ca*la>ca*q);f(b)*q*q>f(n/q)&&(va=-n/q,p=(va-e)/q)}}ca=h.solveQuadratic(b,
p,va,m,l,I);la=null==l;return isFinite(q)&&(0===ca||0<ca&&q!==m[0]&&q!==m[1])&&(la||q>l-1E-12&&q<I+1E-12)&&(m[ca++]=la?q:a(q,l,I)),ca}}},m={_id:1,_pools:{},get:function(a){if(a){var b=this._pools[a];return b||(b=this._pools[a]={_id:1}),b._id++}return this._id++}},n=e.extend({_class:"Point",_readIndex:!0,initialize:function(a,b){var c=typeof a;"number"===c?(c="number"==typeof b,this.x=a,this.y=c?b:a,this.__read&&(this.__read=c?2:1)):"undefined"===c||null===a?(this.x=this.y=0,this.__read&&(this.__read=
null===a?1:0)):(c="string"===c?a.split(/[\s,]+/)||[]:a,Array.isArray(c)?(this.x=c[0],this.y=1<c.length?c[1]:c[0]):"x"in c?(this.x=c.x,this.y=c.y):"width"in c?(this.x=c.width,this.y=c.height):"angle"in c?(this.x=c.length,this.y=0,this.setAngle(c.angle)):(this.x=this.y=0,this.__read&&(this.__read=0)),this.__read&&(this.__read=1))},set:function(a,b){return this.x=a,this.y=b,this},equals:function(a){return this===a||a&&(this.x===a.x&&this.y===a.y||Array.isArray(a)&&this.x===a[0]&&this.y===a[1])||!1},
clone:function(){return new n(this.x,this.y)},toString:function(){var a=l.instance;return"{ x: "+a.number(this.x)+", y: "+a.number(this.y)+" }"},_serialize:function(a){a=a.formatter;return[a.number(this.x),a.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(a){if(this.isZero()){var b=this._angle||0;this.set(Math.cos(b)*a,Math.sin(b)*a)}else a/=this.getLength(),h.isZero(a)&&this.getAngle(),this.set(this.x*a,this.y*a)},getAngle:function(){return 180*
this.getAngleInRadians.apply(this,arguments)/Math.PI},setAngle:function(a){this.setAngleInRadians.call(this,a*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var a=n.read(arguments),b=this.getLength()*a.getLength();if(h.isZero(b))return NaN;a=this.dot(a)/b;return Math.acos(-1>a?-1:1<a?1:a)}return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(a){if(this._angle=a,!this.isZero()){var b=
this.getLength();this.set(Math.cos(a)*b,Math.sin(a)*b)}},getQuadrant:function(){return 0<=this.x?0<=this.y?1:4:0<=this.y?2:3}},{beans:!1,getDirectedAngle:function(){var a=n.read(arguments);return 180*Math.atan2(this.cross(a),this.dot(a))/Math.PI},getDistance:function(){var a=n.read(arguments),b=a.x-this.x;a=a.y-this.y;b=b*b+a*a;return e.read(arguments)?b:Math.sqrt(b)},normalize:function(a){a===b&&(a=1);var c=this.getLength();a=0!==c?a/c:0;c=new n(this.x*a,this.y*a);return 0<=a&&(c._angle=this._angle),
c},rotate:function(a,b){if(0===a)return this.clone();a=a*Math.PI/180;var c=b?this.subtract(b):this,d=Math.sin(a),e=Math.cos(a);return c=new n(c.x*e-c.y*d,c.x*d+c.y*e),b?c.add(b):c},transform:function(a){return a?a._transformPoint(this):this},add:function(){var a=n.read(arguments);return new n(this.x+a.x,this.y+a.y)},subtract:function(){var a=n.read(arguments);return new n(this.x-a.x,this.y-a.y)},multiply:function(){var a=n.read(arguments);return new n(this.x*a.x,this.y*a.y)},divide:function(){var a=
n.read(arguments);return new n(this.x/a.x,this.y/a.y)},modulo:function(){var a=n.read(arguments);return new n(this.x%a.x,this.y%a.y)},negate:function(){return new n(-this.x,-this.y)},isInside:function(){return r.read(arguments).contains(this)},isClose:function(){var a=n.read(arguments),b=e.read(arguments);return this.getDistance(a)<=b},isCollinear:function(){var a=n.read(arguments);return n.isCollinear(this.x,this.y,a.x,a.y)},isColinear:"#isCollinear",isOrthogonal:function(){var a=n.read(arguments);
return n.isOrthogonal(this.x,this.y,a.x,a.y)},isZero:function(){return h.isZero(this.x)&&h.isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(){var a=n.read(arguments);return this.x*a.x+this.y*a.y},cross:function(){var a=n.read(arguments);return this.x*a.y-this.y*a.x},project:function(){var a=n.read(arguments),b=a.isZero()?0:this.dot(a)/a.dot(a);return new n(a.x*b,a.y*b)},statics:{min:function(){var a=n.read(arguments),b=n.read(arguments);return new n(Math.min(a.x,
b.x),Math.min(a.y,b.y))},max:function(){var a=n.read(arguments),b=n.read(arguments);return new n(Math.max(a.x,b.x),Math.max(a.y,b.y))},random:function(){return new n(Math.random(),Math.random())},isCollinear:function(a,b,c,d){return Math.abs(a*d-b*c)<=1E-7*Math.sqrt((a*a+b*b)*(c*c+d*d))},isOrthogonal:function(a,b,c,d){return Math.abs(a*c+b*d)<=1E-7*Math.sqrt((a*a+b*b)*(c*c+d*d))}}},e.each(["round","ceil","floor","abs"],function(a){var b=Math[a];this[a]=function(){return new n(b(this.x),b(this.y))}},
{})),p=n.extend({initialize:function(a,b,c,d){this._x=a;this._y=b;this._owner=c;this._setter=d},set:function(a,b,c){return this._x=a,this._y=b,c||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(a){this._x=a;this._owner[this._setter](this)},getY:function(){return this._y},setY:function(a){this._y=a;this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(a){this._owner.changeSelection(this._getSelection(),
a)},_getSelection:function(){return"setPosition"===this._setter?4:0}}),q=e.extend({_class:"Size",_readIndex:!0,initialize:function(a,b){var c=typeof a;"number"===c?(c="number"==typeof b,this.width=a,this.height=c?b:a,this.__read&&(this.__read=c?2:1)):"undefined"===c||null===a?(this.width=this.height=0,this.__read&&(this.__read=null===a?1:0)):(c="string"===c?a.split(/[\s,]+/)||[]:a,Array.isArray(c)?(this.width=c[0],this.height=1<c.length?c[1]:c[0]):"width"in c?(this.width=c.width,this.height=c.height):
"x"in c?(this.width=c.x,this.height=c.y):(this.width=this.height=0,this.__read&&(this.__read=0)),this.__read&&(this.__read=1))},set:function(a,b){return this.width=a,this.height=b,this},equals:function(a){return a===this||a&&(this.width===a.width&&this.height===a.height||Array.isArray(a)&&this.width===a[0]&&this.height===a[1])||!1},clone:function(){return new q(this.width,this.height)},toString:function(){var a=l.instance;return"{ width: "+a.number(this.width)+", height: "+a.number(this.height)+" }"},
_serialize:function(a){a=a.formatter;return[a.number(this.width),a.number(this.height)]},add:function(){var a=q.read(arguments);return new q(this.width+a.width,this.height+a.height)},subtract:function(){var a=q.read(arguments);return new q(this.width-a.width,this.height-a.height)},multiply:function(){var a=q.read(arguments);return new q(this.width*a.width,this.height*a.height)},divide:function(){var a=q.read(arguments);return new q(this.width/a.width,this.height/a.height)},modulo:function(){var a=
q.read(arguments);return new q(this.width%a.width,this.height%a.height)},negate:function(){return new q(-this.width,-this.height)},isZero:function(){return h.isZero(this.width)&&h.isZero(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(a,b){return new q(Math.min(a.width,b.width),Math.min(a.height,b.height))},max:function(a,b){return new q(Math.max(a.width,b.width),Math.max(a.height,b.height))},random:function(){return new q(Math.random(),Math.random())}}},
e.each(["round","ceil","floor","abs"],function(a){var b=Math[a];this[a]=function(){return new q(b(this.width),b(this.height))}},{})),u=q.extend({initialize:function(a,b,c,d){this._width=a;this._height=b;this._owner=c;this._setter=d},set:function(a,b,c){return this._width=a,this._height=b,c||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(a){this._width=a;this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(a){this._height=
a;this._owner[this._setter](this)}}),r=e.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(a,c,d,f){var g=typeof a,h=0;("number"===g?(this.x=a,this.y=c,this.width=d,this.height=f,h=4):"undefined"===g||null===a?(this.x=this.y=this.width=this.height=0,h=null===a?1:0):1===arguments.length&&(Array.isArray(a)?(this.x=a[0],this.y=a[1],this.width=a[2],this.height=a[3],h=1):a.x!==b||a.width!==b?(this.x=a.x||0,this.y=a.y||0,this.width=a.width||0,this.height=a.height||0,h=1):a.from===b&&
a.to===b&&(this.x=this.y=this.width=this.height=0,this._set(a),h=1)),h)||(g=n.readNamed(arguments,"from"),h=e.peek(arguments),(this.x=g.x,this.y=g.y,h&&h.x!==b||e.hasNamed(arguments,"to"))?(h=n.readNamed(arguments,"to"),this.width=h.x-g.x,this.height=h.y-g.y,0>this.width&&(this.x=h.x,this.width=-this.width),0>this.height&&(this.y=h.y,this.height=-this.height)):(g=q.read(arguments),this.width=g.width,this.height=g.height),h=arguments.__index);this.__read&&(this.__read=h)},set:function(a,b,c,d){return this.x=
a,this.y=b,this.width=c,this.height=d,this},clone:function(){return new r(this.x,this.y,this.width,this.height)},equals:function(a){var b=e.isPlainValue(a)?r.read(arguments):a;return b===this||b&&this.x===b.x&&this.y===b.y&&this.width===b.width&&this.height===b.height||!1},toString:function(){var a=l.instance;return"{ x: "+a.number(this.x)+", y: "+a.number(this.y)+", width: "+a.number(this.width)+", height: "+a.number(this.height)+" }"},_serialize:function(a){a=a.formatter;return[a.number(this.x),
a.number(this.y),a.number(this.width),a.number(this.height)]},getPoint:function(a){return new (a?n:p)(this.x,this.y,this,"setPoint")},setPoint:function(){var a=n.read(arguments);this.x=a.x;this.y=a.y},getSize:function(a){return new (a?q:u)(this.width,this.height,this,"setSize")},setSize:function(){var a=q.read(arguments);this._fixX&&(this.x+=(this.width-a.width)*this._fixX);this._fixY&&(this.y+=(this.height-a.height)*this._fixY);this.width=a.width;this.height=a.height;this._fixH=this._fixW=1},getLeft:function(){return this.x},
setLeft:function(a){this._fixW||(this.width-=a-this.x);this.x=a;this._fixX=0},getTop:function(){return this.y},setTop:function(a){this._fixH||(this.height-=a-this.y);this.y=a;this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(a){this._fixX!==b&&1!==this._fixX&&(this._fixW=0);this._fixW?this.x=a-this.width:this.width=a-this.x;this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(a){this._fixY!==b&&1!==this._fixY&&(this._fixH=0);this._fixH?this.y=
a-this.height:this.height=a-this.y;this._fixY=1},getCenterX:function(){return this.x+.5*this.width},setCenterX:function(a){this.x=a-.5*this.width;this._fixX=.5},getCenterY:function(){return this.y+.5*this.height},setCenterY:function(a){this.y=a-.5*this.height;this._fixY=.5},getCenter:function(a){return new (a?n:p)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var a=n.read(arguments);return this.setCenterX(a.x),this.setCenterY(a.y),this},getArea:function(){return this.width*
this.height},isEmpty:function(){return 0===this.width||0===this.height},contains:function(a){return a&&a.width!==b||4===(Array.isArray(a)?a:arguments).length?this._containsRectangle(r.read(arguments)):this._containsPoint(n.read(arguments))},_containsPoint:function(a){var b=a.x;a=a.y;return b>=this.x&&a>=this.y&&b<=this.x+this.width&&a<=this.y+this.height},_containsRectangle:function(a){var b=a.x,c=a.y;return b>=this.x&&c>=this.y&&b+a.width<=this.x+this.width&&c+a.height<=this.y+this.height},intersects:function(){var a=
r.read(arguments);return a.x+a.width>this.x&&a.y+a.height>this.y&&a.x<this.x+this.width&&a.y<this.y+this.height},touches:function(){var a=r.read(arguments);return a.x+a.width>=this.x&&a.y+a.height>=this.y&&a.x<=this.x+this.width&&a.y<=this.y+this.height},intersect:function(){var a=r.read(arguments),b=Math.max(this.x,a.x),c=Math.max(this.y,a.y);return new r(b,c,Math.min(this.x+this.width,a.x+a.width)-b,Math.min(this.y+this.height,a.y+a.height)-c)},unite:function(){var a=r.read(arguments),b=Math.min(this.x,
a.x),c=Math.min(this.y,a.y);return new r(b,c,Math.max(this.x+this.width,a.x+a.width)-b,Math.max(this.y+this.height,a.y+a.height)-c)},include:function(){var a=n.read(arguments),b=Math.min(this.x,a.x),c=Math.min(this.y,a.y);return new r(b,c,Math.max(this.x+this.width,a.x)-b,Math.max(this.y+this.height,a.y)-c)},expand:function(){var a=q.read(arguments),b=a.width;a=a.height;return new r(this.x-b/2,this.y-a/2,this.width+b,this.height+a)},scale:function(a,c){return this.expand(this.width*a-this.width,this.height*
(c===b?a:c)-this.height)}},e.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(a,b){var c=a.join(""),d=/^[RL]/.test(c);4<=b&&(a[1]+=d?"Y":"X");var e=a[d?0:1];d=a[d?1:0];var f="get"+e,g="get"+d,h="set"+e,k="set"+d,M="set"+c;this["get"+c]=function(a){return new (a?n:p)(this[f](),this[g](),this,M)};this[M]=function(){var a=n.read(arguments);this[h](a.x);this[k](a.y)}},{beans:!0})),v=r.extend({initialize:function(a,
b,c,d,e,f){this.set(a,b,c,d,!0);this._owner=e;this._setter=f},set:function(a,b,c,d,e){return this._x=a,this._y=b,this._width=c,this._height=d,e||this._owner[this._setter](this),this}},new function(){var a=r.prototype;return e.each(["x","y","width","height"],function(a){var b=e.capitalize(a),c="_"+a;this["get"+b]=function(){return this[c]};this["set"+b]=function(a){this[c]=a;this._dontNotify||this._owner[this._setter](this)}},e.each("Point Size Center Left Top Right Bottom CenterX CenterY TopLeft TopRight BottomLeft BottomRight LeftCenter TopCenter RightCenter BottomCenter".split(" "),
function(b){var c="set"+b;this[c]=function(){this._dontNotify=!0;a[c].apply(this,arguments);this._dontNotify=!1;this._owner[this._setter](this)}},{isSelected:function(){return!!(2&this._owner._selection)},setSelected:function(a){var b=this._owner;b.changeSelection&&b.changeSelection(2,a)}}))}),A=e.extend({_class:"Matrix",initialize:function kb(a){var b=arguments.length,c=!0;if(6===b?this.set.apply(this,arguments):1===b?a instanceof kb?this.set(a._a,a._b,a._c,a._d,a._tx,a._ty):Array.isArray(a)?this.set.apply(this,
a):c=!1:0===b?this.reset():c=!1,!c)throw Error("Unsupported matrix parameters");},set:function(a,b,c,d,e,f,g){return this._a=a,this._b=b,this._c=c,this._d=d,this._tx=e,this._ty=f,g||this._changed(),this},_serialize:function(a,b){return e.serialize(this.getValues(),a,!0,b)},_changed:function(){var a=this._owner;a&&(a._applyMatrix?a.transform(null,!0):a._changed(9))},clone:function(){return new A(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(a){return a===this||a&&this._a===a._a&&
this._b===a._b&&this._c===a._c&&this._d===a._d&&this._tx===a._tx&&this._ty===a._ty},toString:function(){var a=l.instance;return"[["+[a.number(this._a),a.number(this._c),a.number(this._tx)].join(", ")+"], ["+[a.number(this._b),a.number(this._d),a.number(this._ty)].join(", ")+"]]"},reset:function(a){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,a||this._changed(),this},apply:function(a,b){var c=this._owner;return!!c&&(c.transform(null,!0,e.pick(a,!0),b),this.isIdentity())},translate:function(){var a=
n.read(arguments),b=a.x;a=a.y;return this._tx+=b*this._a+a*this._c,this._ty+=b*this._b+a*this._d,this._changed(),this},scale:function(){var a=n.read(arguments),b=n.read(arguments,0,{readNull:!0});return b&&this.translate(b),this._a*=a.x,this._b*=a.x,this._c*=a.y,this._d*=a.y,b&&this.translate(b.negate()),this._changed(),this},rotate:function(a){a*=Math.PI/180;var b=n.read(arguments,1),c=b.x,d=b.y;b=Math.cos(a);var e=Math.sin(a),f=c-c*b+d*e;c=d-c*e-d*b;d=this._a;var g=this._b,h=this._c,k=this._d;return this._a=
b*d+e*h,this._b=b*g+e*k,this._c=-e*d+b*h,this._d=-e*g+b*k,this._tx+=f*d+c*h,this._ty+=f*g+c*k,this._changed(),this},shear:function(){var a=n.read(arguments),b=n.read(arguments,0,{readNull:!0});b&&this.translate(b);var c=this._a,d=this._b;return this._a+=a.y*this._c,this._b+=a.y*this._d,this._c+=a.x*c,this._d+=a.x*d,b&&this.translate(b.negate()),this._changed(),this},skew:function(){var a=n.read(arguments),b=n.read(arguments,0,{readNull:!0}),c=Math.PI/180;a=new n(Math.tan(a.x*c),Math.tan(a.y*c));return this.shear(a,
b)},append:function(a){if(a){var b=this._a,c=this._b,d=this._c,e=this._d,f=a._a,g=a._c,h=a._b,k=a._d,n=a._tx;a=a._ty;this._a=f*b+h*d;this._c=g*b+k*d;this._b=f*c+h*e;this._d=g*c+k*e;this._tx+=n*b+a*d;this._ty+=n*c+a*e;this._changed()}return this},prepend:function(a){if(a){var b=this._a,c=this._b,d=this._c,e=this._d,f=this._tx,g=this._ty,h=a._a,k=a._c,n=a._b,m=a._d,l=a._tx;a=a._ty;this._a=h*b+k*c;this._c=h*d+k*e;this._b=n*b+m*c;this._d=n*d+m*e;this._tx=h*f+k*g+l;this._ty=n*f+m*g+a;this._changed()}return this},
appended:function(a){return this.clone().append(a)},prepended:function(a){return this.clone().prepend(a)},invert:function(){var a=this._a,b=this._b,c=this._c,d=this._d,e=this._tx,f=this._ty,g=a*d-b*c,h=null;return g&&!isNaN(g)&&isFinite(e)&&isFinite(f)&&(this._a=d/g,this._b=-b/g,this._c=-c/g,this._d=a/g,this._tx=(c*f-d*e)/g,this._ty=(b*e-a*f)/g,h=this),h},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new A(this._a,
this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return 1===this._a&&0===this._b&&0===this._c&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){var a=this._a*this._d-this._c*this._b;return a&&!isNaN(a)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(a,b,c){return 3>arguments.length?this._transformPoint(n.read(arguments)):this._transformCoordinates(a,b,c)},
_transformPoint:function(a,b,c){var d=a.x;a=a.y;return b||(b=new n),b.set(d*this._a+a*this._c+this._tx,d*this._b+a*this._d+this._ty,c)},_transformCoordinates:function(a,b,c){var d=0;for(c*=2;d<c;d+=2){var e=a[d],f=a[d+1];b[d]=e*this._a+f*this._c+this._tx;b[d+1]=e*this._b+f*this._d+this._ty}return b},_transformCorners:function(a){var b=a.x,c=a.y,d=b+a.width;a=c+a.height;b=[b,c,d,c,d,a,b,a];return this._transformCoordinates(b,b,4)},_transformBounds:function(a,b,c){a=this._transformCorners(a);for(var d=
a.slice(0,2),e=d.slice(),f=2;8>f;f++){var g=a[f],h=1&f;g<d[h]?d[h]=g:g>e[h]&&(e[h]=g)}return b||(b=new r),b.set(d[0],d[1],e[0]-d[0],e[1]-d[1],c)},inverseTransform:function(){return this._inverseTransform(n.read(arguments))},_inverseTransform:function(a,b,c){var d=this._a,e=this._b,f=this._c,g=this._d,h=this._tx,k=this._ty,m=d*g-e*f,l=null;m&&!isNaN(m)&&isFinite(h)&&isFinite(k)&&(h=a.x-this._tx,a=a.y-this._ty,b||(b=new n),l=b.set((h*g-a*f)/m,(a*d-h*e)/m,c));return l},decompose:function(){var a=this._a;
var b=this._b,c=this._c,d=this._d;var e=a*d-b*c;var f=Math.sqrt;var g=Math.atan2,h=180/Math.PI;if(0!==a||0!==b){var k=f(a*a+b*b);f=Math.acos(a/k)*(0<b?1:-1);e=[k,e/k];a=[g(a*c+b*d,k*k),0]}else 0!==c||0!==d?(k=f(c*c+d*d),f=Math.asin(c/k)*(0<d?1:-1),e=[e/k,k],a=[0,g(a*c+b*d,k*k)]):(f=0,a=e=[0,0]);return{translation:this.getTranslation(),rotation:f*h,scaling:new n(e),skewing:new n(a[0]*h,a[1]*h)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new n(this._tx,
this._ty)},getScaling:function(){return(this.decompose()||{}).scaling},getRotation:function(){return(this.decompose()||{}).rotation},applyToContext:function(a){this.isIdentity()||a.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},e.each("a b c d tx ty".split(" "),function(a){var b=e.capitalize(a),c="_"+a;this["get"+b]=function(){return this[c]};this["set"+b]=function(a){this[c]=a;this._changed()}},{})),y=e.extend({_class:"Line",initialize:function(a,b,c,d,e){var f=!1;4<=arguments.length?
(this._px=a,this._py=b,this._vx=c,this._vy=d,f=e):(this._px=a.x,this._py=a.y,this._vx=b.x,this._vy=b.y,f=c);f||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new n(this._px,this._py)},getVector:function(){return new n(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(a,b){return y.intersect(this._px,this._py,this._vx,this._vy,a._px,a._py,a._vx,a._vy,!0,b)},getSide:function(a,b){return y.getSide(this._px,this._py,this._vx,this._vy,
a.x,a.y,!0,b)},getDistance:function(a){return Math.abs(y.getSignedDistance(this._px,this._py,this._vx,this._vy,a.x,a.y,!0))},isCollinear:function(a){return n.isCollinear(this._vx,this._vy,a._vx,a._vy)},isOrthogonal:function(a){return n.isOrthogonal(this._vx,this._vy,a._vx,a._vy)},statics:{intersect:function(a,b,c,d,e,f,g,k,M,m){M||(c-=a,d-=b,g-=e,k-=f);M=c*k-d*g;if(!h.isZero(M)&&(e=a-e,f=b-f,g=(g*f-k*e)/M,k=(c*f-d*e)/M,M=1+1E-12,m||-1E-12<g&&g<M&&-1E-12<k&&k<M))return m||(g=0>=g?0:1<=g?1:g),new n(a+
g*c,b+g*d)},getSide:function(a,b,c,d,e,f,g,h){g||(c-=a,d-=b);a=e-a;b=a*d-(f-b)*c;return 0!==b||h||(b=(a*c+a*c)/(c*c+d*d),0<=b&&1>=b&&(b=0)),0>b?-1:0<b?1:0},getSignedDistance:function(a,b,c,d,e,f,g){return g||(c-=a,d-=b),0===c?0<d?e-a:a-e:0===d?0>c?f-b:b-f:((e-a)*d-(f-b)*c)/Math.sqrt(c*c+d*d)}}}),F=k.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(a){k.call(this,!0);this._children=[];this._namedChildren={};this._activeLayer=null;this._currentStyle=
new wa(null,null,this);this._view=ea.create(this,a||R.getCanvas(1,1));this._selectionItems={};this._updateVersion=this._selectionCount=0},_serialize:function(a,b){return e.serialize(this._children,a,!0,b)},_changed:function(a,b){if(1&a){var c=this._view;c&&(c._needsUpdate=!0,!c._requested&&c._autoUpdate&&c.requestUpdate())}if((c=this._changes)&&b){var d=this._changesById,e=b._id,f=d[e];f?f.flags|=a:c.push(d[e]={item:b,flags:a})}},clear:function(){for(var a=this._children,b=a.length-1;0<=b;b--)a[b].remove()},
isEmpty:function(){return 0===this._children.length},remove:function kb(){return!!kb.base.call(this)&&(this._view&&this._view.remove(),!0)},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(a){this._currentStyle.initialize(a)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new E({project:this,
insert:!0})},getSymbolDefinitions:function(){var a=[],b={};return this.getItems({"class":G,match:function(c){c=c._definition;var d=c._id;return b[d]||(b[d]=!0,a.push(c)),!1}}),a},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var a=this._selectionItems,b=[],c;for(c in a){var d=a[c],e=d._selection;1&e&&d.isInserted()?b.push(d):e||this._updateSelection(d)}return b},_updateSelection:function(a){var b=a._id,c=this._selectionItems;a._selection?c[b]!==a&&(this._selectionCount++,c[b]=a):c[b]===
a&&(this._selectionCount--,delete c[b])},selectAll:function(){for(var a=this._children,b=0,c=a.length;b<c;b++)a[b].setFullySelected(!0)},deselectAll:function(){var a=this._selectionItems,b;for(b in a)a[b].setFullySelected(!1)},addLayer:function(a){return this.insertLayer(b,a)},insertLayer:function(a,b){if(b instanceof E){b._remove(!1,!0);e.splice(this._children,[b],a,0);b._setProject(this,!0);var c=b._name;c&&b.setName(c);this._changes&&b._changed(5);this._activeLayer||(this._activeLayer=b)}else b=
null;return b},_insertItem:function(a,c,d,e){return c=this.insertLayer(a,c)||(this._activeLayer||this._insertItem(b,new E(B.NO_INSERT),!0,!0)).insertChild(a,c,d),e&&c.activate&&c.activate(),c},getItems:function(a){return B._getItems(this,a)},getItem:function(a){return B._getItems(this,a,null,null,!0)[0]||null},importJSON:function(a){this.activate();var b=this._activeLayer;return e.importJSON(a,b&&b.isEmpty()&&b)},removeOn:function(a){var b=this._removeSets;if(b){"mouseup"===a&&(b.mousedrag=null);
var c=b[a];if(c){for(var d in c){var e=c[d],f;for(f in b){var g=b[f];g&&g!=c&&delete g[e._id]}e.remove()}b[a]=null}}},draw:function(a,b,c){this._updateVersion++;a.save();b.applyToContext(a);var d=this._children;c=new e({offset:new n(0,0),pixelRatio:c,viewMatrix:b.isIdentity()?null:b,matrices:[new A],updateMatrix:!0});for(var f=0,g=d.length;f<g;f++)d[f].draw(a,c);if(a.restore(),0<this._selectionCount){a.save();a.strokeWidth=1;d=this._selectionItems;c=this._scope.settings.handleSize;f=this._updateVersion;
for(var h in d)d[h]._drawSelection(a,b,c,d,f);a.restore()}}}),B=e.extend(f,{statics:{extend:function Vb(a){return a._serializeFields&&(a._serializeFields=e.set({},this.prototype._serializeFields,a._serializeFields)),Vb.base.apply(this,arguments)},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,
applyMatrix:null,matrix:new A,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}}},new function(){var a="onMouseDown onMouseUp onMouseDrag onClick onDoubleClick onMouseMove onMouseEnter onMouseLeave".split(" ");return e.each(a,function(a){this._events[a]={install:function(a){this.getView()._countItemEvent(a,1)},uninstall:function(a){this.getView()._countItemEvent(a,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},
uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:a}})},{initialize:function(){},_initialize:function(a,c){var d=a&&e.isPlainObject(a),f=d&&!0===a.internal,g=this._matrix=new A,h=d&&a.project||paper.project,k=paper.settings;return this._id=f?null:m.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&k.applyMatrix,c&&g.translate(c),g._owner=this,this._style=new wa(h._currentStyle,this,h),f||d&&!1===a.insert||!(k.insertItems||
d&&!0===a.insert)?this._setProject(h):(d&&a.parent||h)._insertItem(b,this,!0,!0),d&&a!==B.NO_INSERT&&e.filter(this,a,{internal:!0,insert:!0,project:!0,parent:!0}),d},_serialize:function(a,b){function c(c){for(var g in c){var h=f[g];e.equals(h,"leading"===g?1.2*c.fontSize:c[g])||(d[g]=e.serialize(h,a,"data"!==g,b))}}var d={},f=this;return c(this._serializeFields),this instanceof w||c(this._style._defaults),[this._class,d]},_changed:function(a){var c=this._symbol,d=this._parent||c,e=this._project;8&
a&&(this._bounds=this._position=this._decomposed=this._globalMatrix=b);d&&40&a&&B._clearBoundsCache(d);2&a&&B._clearBoundsCache(this);e&&e._changed(a,this);c&&c._changed(a)},set:function(a){return a&&this._set(a),this},getId:function(){return this._id},getName:function(){return this._name},setName:function(a){if(this._name&&this._removeNamed(),a===+a+"")throw Error("Names consisting only of numbers are not supported.");var c=this._getOwner();if(a&&c){var d=c._children;c=c._namedChildren;(c[a]=c[a]||
[]).push(this);a in d||(d[a]=this)}this._name=a||b;this._changed(128)},getStyle:function(){return this._style},setStyle:function(a){this.getStyle().set(a)}},e.each(["locked","visible","blendMode","opacity","guide"],function(a){var b=e.capitalize(a);a="_"+a;this["get"+b]=function(){return this[a]};this["set"+b]=function(b){b!=this[a]&&(this[a]=b,this._changed("_locked"===a?128:129))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(a){a!==this._selection&&(this._selection=
a,(a=this._project)&&(a._updateSelection(this),this._changed(129)))},changeSelection:function(a,b){var c=this._selection;this.setSelection(b?c|a:c&~a)},isSelected:function(){if(this._selectChildren)for(var a=this._children,b=0,c=a.length;b<c;b++)if(a[b].isSelected())return!0;return!!(1&this._selection)},setSelected:function(a){if(this._selectChildren)for(var b=this._children,c=0,d=b.length;c<d;c++)b[c].setSelected(a);this.changeSelection(1,a)},isFullySelected:function(){var a=this._children,b=!!(1&
this._selection);if(a&&b){b=0;for(var c=a.length;b<c;b++)if(!a[b].isFullySelected())return!1;return!0}return b},setFullySelected:function(a){var b=this._children;if(b)for(var c=0,d=b.length;c<d;c++)b[c].setFullySelected(a);this.changeSelection(1,a)},isClipMask:function(){return this._clipMask},setClipMask:function(a){this._clipMask!=(a=!!a)&&(this._clipMask=a,a&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(129),this._parent&&this._parent._changed(1024))},getData:function(){return this._data||
(this._data={}),this._data},setData:function(a){this._data=a},getPosition:function(a){var b=this._position;a=a?n:p;b||(b=this._position=(b=this._pivot)?this._matrix._transformPoint(b):this.getBounds().getCenter(!0));return new a(b.x,b.y,this,"setPosition")},setPosition:function(){this.translate(n.read(arguments).subtract(this.getPosition(!0)))},getPivot:function(a){var b=this._pivot;b&&(b=new (a?n:p)(b.x,b.y,this,"setPivot"));return b},setPivot:function(){this._pivot=n.read(arguments,0,{clone:!0,
readNull:!0});this._position=b}},e.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(a,b){this[b]=function(b){return this.getBounds(b,a)}},{beans:!0,getBounds:function(a,b){var c=b||a instanceof A,d=e.set({},c?b:a,this._boundsOptions);d.stroke&&!this.getStrokeScaling()||(d.cacheItem=this);c=this._getCachedBounds(c&&a,d);return 0===arguments.length?new v(c.x,c.y,c.width,c.height,this,"setBounds"):c},setBounds:function(){var a=r.read(arguments),
b=this.getBounds(),c=this._matrix,d=new A,e=a.getCenter();d.translate(e);a.width==b.width&&a.height==b.height||(c.isInvertible()||(c.initialize(c._backup||(new A).translate(c.getTranslation())),b=this.getBounds()),d.scale(0!==b.width?a.width/b.width:0,0!==b.height?a.height/b.height:0));e=b.getCenter();d.translate(-e.x,-e.y);this.transform(d)},_getBounds:function(a,b){var c=this._children;return c&&0!==c.length?(B._updateBoundsCache(this,b.cacheItem),B._getBounds(c,a,b)):new r},_getCachedBounds:function(a,
b){a=a&&a._orNullIfIdentity();var c=b.internal,d=b.cacheItem,e=c?null:this._matrix._orNullIfIdentity();c=d&&(!a||a.equals(e))&&[b.stroke?1:0,b.handle?1:0,c?1:0].join("");if(B._updateBoundsCache(this._parent||this._symbol,d),c&&this._bounds&&c in this._bounds)return this._bounds[c].rect.clone();d=this._getBounds(a||e,b);c&&(this._bounds||(this._bounds={}),this._bounds[c]={rect:d.clone(),internal:b.internal});return d},_getStrokeMatrix:function(a,b){var c=this.getStrokeScaling()?null:b&&b.internal?
this:this._parent||this._symbol&&this._symbol._item;return(c=c?c.getViewMatrix().invert():a)&&c._shiftless()},statics:{_updateBoundsCache:function(a,b){if(a&&b){var c=b._id,d=a._boundsCache=a._boundsCache||{ids:{},list:[]};d.ids[c]||(d.list.push(b),d.ids[c]=b)}},_clearBoundsCache:function(a){var c=a._boundsCache;if(c){a._bounds=a._position=a._boundsCache=b;var d=0;c=c.list;for(var e=c.length;d<e;d++){var f=c[d];f!==a&&(f._bounds=f._position=b,f._boundsCache&&B._clearBoundsCache(f))}}},_getBounds:function(a,
b,c){var d=1/0,e=-d,f=d,g=e;c=c||{};for(var h=0,k=a.length;h<k;h++){var n=a[h];n._visible&&!n.isEmpty()&&(n=n._getCachedBounds(b&&b.appended(n._matrix),c),d=Math.min(n.x,d),f=Math.min(n.y,f),e=Math.max(n.x+n.width,e),g=Math.max(n.y+n.height,g))}return isFinite(d)?new r(d,f,e-d,g-f):new r}}}),{beans:!0,_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var a=this._decompose();return a&&a.rotation},setRotation:function(a){var b=this.getRotation();
null!=b&&null!=a&&this.rotate(a-b)},getScaling:function(a){var b=this._decompose();b=b&&b.scaling;a=a?n:p;return b&&new a(b.x,b.y,this,"setScaling")},setScaling:function(){var a=this.getScaling(),b=n.read(arguments,0,{clone:!0,readNull:!0});a&&b&&this.scale(b.x/a.x,b.y/a.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var a=this._matrix;a.initialize.apply(a,arguments)},getGlobalMatrix:function(a){var b=this._globalMatrix,c=this._project._updateVersion;if(b&&b._updateVersion!==c&&
(b=null),!b){b=this._globalMatrix=this._matrix.clone();var d=this._parent;d&&b.prepend(d.getGlobalMatrix(!0));b._updateVersion=c}return a?b:b.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(a){(this._applyMatrix=this._canApplyMatrix&&!!a)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},
_setProject:function(a,b){if(this._project!==a){this._project&&this._installEvents(!1);this._project=a;for(var c=this._children,d=0,e=c&&c.length;d<e;d++)c[d]._setProject(a);b=!0}b&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function cb(a){cb.base.call(this,a);for(var b=this._children,c=0,d=b&&b.length;c<d;c++)b[c]._installEvents(a)},getLayer:function(){for(var a=this;a=a._parent;)if(a instanceof E)return a;return null},getParent:function(){return this._parent},
setParent:function(a){return a.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(a,b){this.removeChildren();this.addChildren(a,b)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var a=this._getOwner();return a&&a._children[this._index+1]||null},getPreviousSibling:function(){var a=this._getOwner();return a&&
a._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(a){return a===this||a&&this._class===a._class&&this._style.equals(a._style)&&this._matrix.equals(a._matrix)&&this._locked===a._locked&&this._visible===a._visible&&this._blendMode===a._blendMode&&this._opacity===a._opacity&&this._clipMask===a._clipMask&&this._guide===a._guide&&this._equals(a)||!1},_equals:function(a){return e.equals(this._children,a._children)},clone:function(a){var c=new this.constructor(B.NO_INSERT),
d=this._children,f=e.pick(a?a.insert:b,a===b||!0===a);a=e.pick(a?a.deep:b,!0);d&&c.copyAttributes(this);d&&!a||c.copyContent(this);d||c.copyAttributes(this);f&&c.insertAbove(this);f=this._name;d=this._parent;if(f&&d){d=d._children;a=f;for(var g=1;d[f];)f=a+" "+g++;f!==a&&c.setName(f)}return c},copyContent:function(a){a=a._children;for(var b=0,c=a&&a.length;b<c;b++)this.addChild(a[b].clone(!1),!0)},copyAttributes:function(a,b){this.setStyle(a._style);for(var c="_locked _visible _blendMode _opacity _clipMask _guide".split(" "),
d=0,f=c.length;d<f;d++){var g=c[d];a.hasOwnProperty(g)&&(this[g]=a[g])}b||this._matrix.initialize(a._matrix);this.setApplyMatrix(a._applyMatrix);this.setPivot(a._pivot);this.setSelection(a._selection);c=a._data;d=a._name;this._data=c?e.clone(c):null;d&&this.setName(d)},rasterize:function(a,c){var d=this.getStrokeBounds(),f=(a||this.getView().getResolution())/72,g=d.getTopLeft().floor();d=d.getBottomRight().ceil();d=new q(d.subtract(g));var h=new D(B.NO_INSERT);if(!d.isZero()){var k=R.getCanvas(d.multiply(f)),
n=k.getContext("2d"),m=(new A).scale(f).translate(g.negate());n.save();m.applyToContext(n);this.draw(n,new e({matrices:[m]}));n.restore();h.setCanvas(k)}return h.transform((new A).translate(g.add(d.divide(2))).scale(1/f)),(c===b||c)&&h.insertAbove(this),h},contains:function(){return!!this._contains(this._matrix._inverseTransform(n.read(arguments)))},_contains:function(a){var b=this._children;if(b){for(var c=b.length-1;0<=c;c--)if(b[c].contains(a))return!0;return!1}return a.isInside(this.getInternalBounds())},
isInside:function(){return r.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new O.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(a,b){return a instanceof B&&0<this._asPathItem().getIntersections(a._asPathItem(),null,b,!0).length}},new function(){function a(){return this._hitTest(n.read(arguments),na.getOptions(arguments))}function b(){var a=n.read(arguments),b=na.getOptions(arguments),c=b.match,d=[];return b=e.set({},b,
{match:function(a){c&&!c(a)||d.push(a)}}),this._hitTest(a,b),d}function c(a,b,c,d){var e=this._children;if(e)for(var f=e.length-1;0<=f;f--){var g=e[f];if(g=g!==d&&g._hitTest(a,b,c))return g}return null}return F.inject({hitTest:a,hitTestAll:b,_hitTest:c}),{hitTest:a,hitTestAll:b,_hitTestChildren:c}},{_hitTest:function(a,b,c){function d(a){return!I||a&&I(a)?a:null}function f(b,c){var d=n["get"+c]();if(1>=a.subtract(d).divide(k).length)return new na(b,P,{name:e.hyphenate(c),point:d})}if(this._locked||
!this._visible||this._guide&&!b.guides||this.isEmpty())return null;var g=this._matrix;c=c?c.appended(g):this.getGlobalMatrix().prepend(this.getView()._matrix);var h=this.getStrokeScaling()?null:c.inverted()._shiftless(),k=b._tolerancePadding=new q(O._getStrokePadding(Math.max(b.tolerance,1E-6),h));if(a=g._inverseTransform(a),!a||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(k.multiply(2))._containsPoint(a))return null;var n,m,l=!(b.guides&&!this._guide||b.selected&&!this.isSelected()||
b.type&&b.type!==e.hyphenate(this._class)||b["class"]&&!(this instanceof b["class"])),I=b.match,P=this;if(l&&(b.center||b.bounds)&&this._parent){if(n=this.getInternalBounds(),b.center&&(m=f("center","Center")),!m&&b.bounds)for(var p="TopLeft TopRight BottomLeft BottomRight LeftCenter TopCenter RightCenter BottomCenter".split(" "),sa=0;8>sa&&!m;sa++)m=f("bounds",p[sa]);m=d(m)}return m||(m=this._hitTestChildren(a,b,c)||l&&d(this._hitTestSelf(a,b,c,h))||null),m&&m.point&&(m.point=g.transform(m.point)),
m},_hitTestSelf:function(a,b){if(b.fill&&this.hasFill()&&this._contains(a))return new na("fill",this)},matches:function(a,b){function c(a,b){for(var d in a)if(a.hasOwnProperty(d)){var f=a[d],g=b[d];if(e.isPlainObject(f)&&e.isPlainObject(g)){if(!c(f,g))return!1}else if(!e.equals(f,g))return!1}return!0}var d=typeof a;if("object"===d){for(var f in a)if(a.hasOwnProperty(f)&&!this.matches(f,a[f]))return!1;return!0}if("function"===d)return a(this);if("match"===a)return b(this);d=/^(empty|editable)$/.test(a)?
this["is"+e.capitalize(a)]():"type"===a?e.hyphenate(this._class):this[a];if("class"===a){if("function"==typeof b)return this instanceof b;d=this._class}if("function"==typeof b)return!!b(d);if(b){if(b.test)return b.test(d);if(e.isPlainObject(b))return c(b,d)}return e.equals(d,b)},getItems:function(a){return B._getItems(this,a,this._matrix)},getItem:function(a){return B._getItems(this,a,this._matrix,null,!0)[0]||null},statics:{_getItems:function Z(a,b,c,d,f){if(!d){var g="object"==typeof b&&b;d=g&&
g.overlapping;var h=g&&g.inside,k=d||h,M=k&&r.read([k]);d={items:[],recursive:g&&!1!==g.recursive,inside:!!h,overlapping:!!d,rect:M,path:d&&new O.Rectangle({rectangle:M,insert:!1})};g&&(b=e.filter({},b,{recursive:!0,inside:!0,overlapping:!0}))}a=a._children;g=d.items;c=(M=d.rect)&&(c||new A);h=0;for(var n=a&&a.length;h<n;h++){var m=a[h],l=c&&c.appended(m._matrix),p=!0;if(M){k=m.getBounds(l);if(!M.intersects(k))continue;M.contains(k)||d.overlapping&&(k.contains(M)||d.path.intersects(m,l))||(p=!1)}if(p&&
m.matches(b)&&(g.push(m),f))break;if(!1!==d.recursive&&Z(m,b,l,d,f),f&&0<g.length)break}return g}}},{importJSON:function(a){a=e.importJSON(a,this);return a!==this?this.addChild(a):a},addChild:function(a,c){return this.insertChild(b,a,c)},insertChild:function(a,b,c){return(a=b?this.insertChildren(a,[b],c):null)&&a[0]},addChildren:function(a,b){return this.insertChildren(this._children.length,a,b)},insertChildren:function(a,b,c,d){var f=this._children;if(f&&b&&0<b.length){b=Array.prototype.slice.apply(b);
for(c=b.length-1;0<=c;c--){var g=b[c];g&&(!d||g instanceof d)?g._remove(!1,!0):b.splice(c,1)}e.splice(f,b,a,0);a=this._project;d=a._changes;c=0;for(f=b.length;c<f;c++){g=b[c];var h=g._name;g._parent=this;g._setProject(a,!0);h&&g.setName(h);d&&this._changed(5)}this._changed(11)}else b=null;return b},_insertItem:"#insertChild",_insertAt:function(a,b,c){var d=this;if(d!==a){var e=a&&a._getOwner();e?(d._remove(!1,!0),e._insertItem(a._index+b,d,c)):d=null}return d},insertAbove:function(a,b){return this._insertAt(a,
1,b)},insertBelow:function(a,b){return this._insertAt(a,0,b)},sendToBack:function(){var a=this._getOwner();return a?a._insertItem(0,this):null},bringToFront:function(){var a=this._getOwner();return a?a._insertItem(b,this):null},appendTop:"#addChild",appendBottom:function(a){return this.insertChild(0,a)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",copyTo:function(a){return a._insertItem(b,this.clone(!1))},reduce:function(a){var b=this._children;return b&&1===b.length?(a=b[0].reduce(a),this._parent?
(a.insertAbove(this),this.remove()):a.remove(),a):this},_removeNamed:function(){var a=this._getOwner();if(a){var b=a._children;a=a._namedChildren;var c=this._name,d=a[c],e=d?d.indexOf(this):-1;-1!==e&&(b[c]==this&&delete b[c],d.splice(e,1),d.length?b[c]=d[0]:delete a[c])}},_remove:function(a,b){var c=this._getOwner(),d=this._project,f=this._index;return!!c&&(null!=f&&(d._activeLayer===this&&(d._activeLayer=this.getNextSibling()||this.getPreviousSibling()),e.splice(c._children,null,f,1)),this._name&&
this._removeNamed(),this._installEvents(!1),a&&d._changes&&this._changed(5),b&&c._changed(11,this),this._parent=null,!0)},remove:function(){return this._remove(!0,!0)},replaceWith:function(a){a=a&&a.insertBelow(this);return a&&this.remove(),a},removeChildren:function(a,b){if(!this._children)return null;a=a||0;b=e.pick(b,this._children.length);for(var c=e.splice(this._children,null,a,b-a),d=c.length-1;0<=d;d--)c[d]._remove(!0,!1);return 0<c.length&&this._changed(11),c},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();
for(var a=0,b=this._children.length;a<b;a++)this._children[a]._index=a;this._changed(11)}},isEmpty:function(){return!this._children||0===this._children.length},isEditable:function(){for(var a=this;a;){if(!a._visible||a._locked)return!1;a=a._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(a){function b(a){var b=[];do b.unshift(a);while(a=a._parent);
return b}var c=b(this);a=b(a);for(var d=0,e=Math.min(c.length,a.length);d<e;d++)if(c[d]!=a[d])return c[d]._index<a[d]._index?1:-1;return 0},hasChildren:function(){return this._children&&0<this._children.length},isInserted:function(){return!!this._parent&&this._parent.isInserted()},isAbove:function(a){return-1===this._getOrder(a)},isBelow:function(a){return 1===this._getOrder(a)},isParent:function(a){return this._parent===a},isChild:function(a){return a&&a._parent===this},isDescendant:function(a){for(var b=
this;b=b._parent;)if(b===a)return!0;return!1},isAncestor:function(a){return!!a&&a.isDescendant(this)},isSibling:function(a){return this._parent===a._parent},isGroupedWith:function(a){for(var b=this._parent;b;){if(b._parent&&/^(Group|Layer|CompoundPath)$/.test(b._class)&&a.isDescendant(b))return!0;b=b._parent}return!1}},e.each(["rotate","scale","shear","skew"],function(a){var b="rotate"===a;this[a]=function(){var c=(b?e:n).read(arguments),d=n.read(arguments,0,{readNull:!0});return this.transform((new A)[a](c,
d||this.getPosition(!0)))}},{translate:function(){var a=new A;return this.transform(a.translate.apply(a,arguments))},transform:function(a,b,c,d){a&&a.isIdentity()&&(a=null);var e=this._matrix;b=(b||this._applyMatrix)&&(!e.isIdentity()||a||b&&c&&this._children);if(!a&&!b)return this;if(a&&(!a.isInvertible()&&e.isInvertible()&&(e._backup=e.getValues()),e.prepend(a)),b=b&&this._transformContent(e,c,d)){c=this._pivot;var f=this._style,g=f.getFillColor(!0);f=f.getStrokeColor(!0);c&&e._transformPoint(c,
c,!0);g&&g.transform(e);f&&f.transform(e);e.reset(!0);d&&this._canApplyMatrix&&(this._applyMatrix=!0)}d=this._bounds;e=this._position;this._changed(9);if((c=d&&a&&a.decompose())&&!c.shearing&&0===c.rotation%90){for(var h in d)if(e=d[h],b||!e.internal)e=e.rect,a._transformBounds(e,e);a=this._boundsGetter;(e=d[a&&a.getBounds||a||"getBounds"])&&(this._position=e.getCenter(!0));this._bounds=d}else a&&e&&(this._position=a._transformPoint(e,e));return this},_transformContent:function(a,b,c){var d=this._children;
if(d){for(var e=0,f=d.length;e<f;e++)d[e].transform(a,!0,b,c);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(n.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(n.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(n.read(arguments))},localToParent:function(){return this._matrix._transformPoint(n.read(arguments))},fitBounds:function(a,b){a=r.read(arguments);var c=this.getBounds(),d=c.height/
c.width,e=a.height/a.width;d=(b?d>e:d<e)?a.width/c.width:a.height/c.height;c=new r(new n,new q(c.width*d,c.height*d));c.setCenter(a.getCenter());this.setBounds(c)}}),{_setStyles:function(a,b,c){var d=this._style;if(d.hasFill()&&(a.fillStyle=d.getFillColor().toCanvasStyle(a)),d.hasStroke()){a.strokeStyle=d.getStrokeColor().toCanvasStyle(a);a.lineWidth=d.getStrokeWidth();var e=d.getStrokeJoin(),f=d.getStrokeCap(),g=d.getMiterLimit();if(e&&(a.lineJoin=e),f&&(a.lineCap=f),g&&(a.miterLimit=g),paper.support.nativeDash)e=
d.getDashArray(),f=d.getDashOffset(),e&&e.length&&("setLineDash"in a?(a.setLineDash(e),a.lineDashOffset=f):(a.mozDash=e,a.mozDashOffset=f))}d.hasShadow()&&(b=b.pixelRatio||1,b=c._shiftless().prepend((new A).scale(b,b)),c=b.transform(new n(d.getShadowBlur(),0)),b=b.transform(this.getShadowOffset()),a.shadowColor=d.getShadowColor().toCanvasStyle(a),a.shadowBlur=c.getLength(),a.shadowOffsetX=b.x,a.shadowOffsetY=b.y)},draw:function(a,b,c){var d=this._updateVersion=this._project._updateVersion;if(this._visible&&
0!==this._opacity){var e=b.matrices,f=b.viewMatrix,g=this._matrix,h=e[e.length-1].appended(g);if(h.isInvertible()){f=f?f.appended(h):h;e.push(h);b.updateMatrix&&(h._updateVersion=d,this._globalMatrix=h);d=this._blendMode;h=this._opacity;var k="normal"===d,n=Qa.nativeModes[d];k=k&&1===h||b.dontStart||b.clip||(n||k&&1>h)&&this._canComposite();var m=b.pixelRatio||1;if(!k){var l=this.getStrokeBounds(f);if(!l.width||!l.height)return;var p=b.offset;var q=b.offset=l.getTopLeft().floor();var J=a;a=R.getContext(l.getSize().ceil().add(1).multiply(m));
1!==m&&a.scale(m,m)}a.save();c=c?c.appended(g):this._canScaleStroke&&!this.getStrokeScaling(!0)&&f;l=!k&&b.clipItem;var da=!c||l;if(k?(a.globalAlpha=h,n&&(a.globalCompositeOperation=d)):da&&a.translate(-q.x,-q.y),da&&(k?g:f).applyToContext(a),l&&b.clipItem.draw(a,b.extend({clip:!0})),c)a.setTransform(m,0,0,m,0,0),(g=b.offset)&&a.translate(-g.x,-g.y);this._draw(a,b,f,c);a.restore();e.pop();b.clip&&!b.dontFinish&&a.clip();k||(Qa.process(d,a,J,h,q.subtract(p).multiply(m)),R.release(a),b.offset=p)}}},
_isUpdated:function(a){var b=this._parent;if(b instanceof L)return b._isUpdated(a);var c=this._updateVersion===a;return!c&&b&&b._visible&&b._isUpdated(a)&&(this._updateVersion=a,c=!0),c},_drawSelection:function(a,b,c,d,e){var f=this._selection,g=1&f,h=2&f||g&&this._selectBounds;f&=4;if(this._drawSelected||(g=!1),(g||h||f)&&this._isUpdated(e)){var k;e=this.getSelectedColor(!0)||(k=this.getLayer())&&k.getSelectedColor(!0);k=b.appended(this.getGlobalMatrix(!0));b=c/2;if(a.strokeStyle=a.fillStyle=e?e.toCanvasStyle(a):
"#009dec",g&&this._drawSelected(a,k,d),f){g=this.getPosition(!0);d=g.x;f=g.y;a.beginPath();a.arc(d,f,b,0,2*Math.PI,!0);a.stroke();e=[[0,-1],[1,0],[0,1],[-1,0]];var n=c+1;for(g=0;4>g;g++){var m=e[g],M=m[0];m=m[1];a.moveTo(d+M*b,f+m*b);a.lineTo(d+M*n,f+m*n);a.stroke()}}if(h){h=k._transformCorners(this.getInternalBounds());a.beginPath();for(g=0;8>g;g++)a[0===g?"moveTo":"lineTo"](h[g],h[++g]);a.closePath();a.stroke();for(g=0;8>g;g++)a.fillRect(h[g]-b,h[++g]-b,c,c)}}},_canComposite:function(){return!1}},
e.each(["down","drag","up","move"],function(a){this["removeOn"+e.capitalize(a)]=function(){var b={};return b[a]=!0,this.removeOn(b)}},{removeOn:function(a){for(var b in a)if(a[b]){var c="mouse"+b,d=this._project;d=d._removeSets=d._removeSets||{};d[c]=d[c]||{};d[c][this._id]=this}return this}})),w=B.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(a){this._children=[];this._namedChildren={};this._initialize(a)||this.addChildren(Array.isArray(a)?
a:arguments)},_changed:function Ub(a){Ub.base.call(this,a);1026&a&&(this._clipItem=b)},_getClipItem:function(){var a=this._clipItem;if(a===b){a=null;for(var c=this._children,d=0,e=c.length;d<e;d++)if(c[d]._clipMask){a=c[d];break}this._clipItem=a}return a},isClipped:function(){return!!this._getClipItem()},setClipped:function(a){var b=this.getFirstChild();b&&b.setClipMask(a)},_getBounds:function M(a,b){var c=this._getClipItem();return c?c._getCachedBounds(a&&a.appended(c._matrix),e.set({},b,{stroke:!1})):
M.base.call(this,a,b)},_hitTestChildren:function ca(a,b,c){var d=this._getClipItem();return(!d||d.contains(a))&&ca.base.call(this,a,b,c,d)},_draw:function(a,b){var c=b.clip,d=!c&&this._getClipItem();b=b.extend({clipItem:d,clip:!1});c?(a.beginPath(),b.dontStart=b.dontFinish=!0):d&&d.draw(a,b.extend({clip:!0}));c=this._children;for(var e=0,f=c.length;e<f;e++){var g=c[e];g!==d&&g.draw(a,b)}}}),E=w.extend({_class:"Layer",initialize:function(){w.apply(this,arguments)},_getOwner:function(){return this._parent||
null!=this._index&&this._project},isInserted:function M(){return this._parent?M.base.call(this):null!=this._index},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),x=B.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(a){this._initialize(a)},_equals:function(a){return this._type===a._type&&this._size.equals(a._size)&&e.equals(this._radius,a._radius)},copyContent:function(a){this.setType(a._type);
this.setSize(a._size);this.setRadius(a._radius)},getType:function(){return this._type},setType:function(a){this._type=a},getShape:"#getType",setShape:"#setType",getSize:function(){var a=this._size;return new u(a.width,a.height,this,"setSize")},setSize:function(){var a=q.read(arguments);if(this._size){if(!this._size.equals(a)){var b=this._type,c=a.width,d=a.height;"rectangle"===b?(a=q.min(this._radius,a.divide(2)),this._radius.set(a.width,a.height)):"circle"===b?(c=d=(c+d)/2,this._radius=c/2):"ellipse"===
b&&this._radius.set(c/2,d/2);this._size.set(c,d);this._changed(9)}}else this._size=a.clone()},getRadius:function(){var a=this._radius;return"circle"===this._type?a:new u(a.width,a.height,this,"setRadius")},setRadius:function(a){var b=this._type;if("circle"===b){if(a===this._radius)return;b=2*a;this._radius=a;this._size.set(b,b)}else if(a=q.read(arguments),this._radius){if(this._radius.equals(a))return;(this._radius.set(a.width,a.height),"rectangle"===b)?(b=q.max(this._size,a.multiply(2)),this._size.set(b.width,
b.height)):"ellipse"===b&&this._size.set(2*a.width,2*a.height)}else this._radius=a.clone();this._changed(9)},isEmpty:function(){return!1},toPath:function(a){var c=new (O[e.capitalize(this._type)])({center:new n,size:this._size,radius:this._radius,insert:!1});return c.copyAttributes(this),paper.settings.applyMatrix&&c.setApplyMatrix(!0),(a===b||a)&&c.insertAbove(this),c},toShape:"#clone",_draw:function(a,b,c,d){var e=this._style,f=e.hasFill(),g=e.hasStroke(),h=b.dontFinish||b.clip,k=!d;if(f||g||h){var n=
this._type,m=this._radius,l="circle"===n;if(b.dontStart||a.beginPath(),k&&l)a.arc(0,0,m,0,2*Math.PI,!0);else{var M=l?m:m.width;m=l?m:m.height;var p=this._size;l=p.width;p=p.height;k&&"rectangle"===n&&0===M&&0===m?a.rect(-l/2,-p/2,l,p):(k=l/2,n=p/2,l=.44771525016920644*M,p=.44771525016920644*m,l=[-k,-n+m,-k,-n+p,-k+l,-n,-k+M,-n,k-M,-n,k-l,-n,k,-n+p,k,-n+m,k,n-m,k,n-p,k-l,n,k-M,n,-k+M,n,-k+l,n,-k,n-p,-k,n-m],d&&d.transform(l,l,32),a.moveTo(l[0],l[1]),a.bezierCurveTo(l[2],l[3],l[4],l[5],l[6],l[7]),k!==
M&&a.lineTo(l[8],l[9]),a.bezierCurveTo(l[10],l[11],l[12],l[13],l[14],l[15]),n!==m&&a.lineTo(l[16],l[17]),a.bezierCurveTo(l[18],l[19],l[20],l[21],l[22],l[23]),k!==M&&a.lineTo(l[24],l[25]),a.bezierCurveTo(l[26],l[27],l[28],l[29],l[30],l[31]))}a.closePath()}h||!f&&!g||(this._setStyles(a,b,c),f&&(a.fill(e.getFillRule()),a.shadowColor="rgba(0,0,0,0)"),g&&a.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(a,b){var c=(new r(this._size)).setCenter(0,0),d=
this._style;d=b.stroke&&d.hasStroke()&&d.getStrokeWidth();return a&&(c=a._transformBounds(c)),d?c.expand(O._getStrokePadding(d,this._getStrokeMatrix(a,b))):c}},new function(){function a(a,b,c){var d=a._radius;if(!d.isZero()){a=a._size.divide(2);for(var e=0;4>e;e++){var f=new n(1&e?1:-1,1<e?1:-1),g=f.multiply(a);f=g.subtract(f.multiply(d));g=new r(g,f);if((c?g.expand(c):g).contains(b))return f}}}function b(a,b,c,d){a=a.divide(b);return(!d||a.quadrant===d)&&1>=a.subtract(a.normalize()).multiply(b).divide(c).length}
return{_contains:function la(b){if("rectangle"===this._type){var c=a(this,b);return c?1>=b.subtract(c).divide(this._radius).getLength():la.base.call(this,b)}return.5>=b.divide(this.size).getLength()},_hitTestSelf:function V(c,d,e,f){var g=!1,h=this._style,k=d.stroke&&h.hasStroke(),n=d.fill&&h.hasFill();if(k||n){n=this._type;g=this._radius;var m=k?h.getStrokeWidth()/2:0;m=d._tolerancePadding.add(O._getStrokePadding(m,!h.getStrokeScaling()&&f));"rectangle"===n?(h=m.multiply(2),(n=a(this,c,h))?g=b(c.subtract(n),
g,m,n.getQuadrant()):(n=(new r(this._size)).setCenter(0,0),g=n.expand(h),h=n.expand(h.negate()),g=g._containsPoint(c)&&!h._containsPoint(c))):g=b(c,g,m)}return g?new na(k?"stroke":"fill",this):V.base.apply(this,arguments)}}},{statics:new function(){function a(a,b,c,d,f){f=new x(e.getNamed(f));return f._type=a,f._size=c,f._radius=d,f.translate(b)}return{Circle:function(){var b=n.readNamed(arguments,"center"),c=e.readNamed(arguments,"radius");return a("circle",b,new q(2*c),c,arguments)},Rectangle:function(){var b=
r.readNamed(arguments,"rectangle"),c=q.min(q.readNamed(arguments,"radius"),b.getSize(!0).divide(2));return a("rectangle",b.getCenter(!0),b.getSize(!0),c,arguments)},Ellipse:function(){var b=x._readEllipse(arguments),c=b.radius;return a("ellipse",b.center,c.multiply(2),c,arguments)},_readEllipse:function(a){if(e.hasNamed(a,"radius")){var b=n.readNamed(a,"center");a=q.readNamed(a,"radius")}else a=r.readNamed(a,"rectangle"),b=a.getCenter(!0),a=a.getSize(!0).divide(2);return{center:b,radius:a}}}}}),D=
B.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},initialize:function(a,c){if(!this._initialize(a,c!==b&&n.read(arguments,1))){var e="string"==typeof a?d.getElementById(a):a;e?this.setImage(e):this.setSource(a)}this._size||(this._size=new q,this._loaded=!1)},_equals:function(a){return this.getSource()===a.getSource()},copyContent:function(a){var b=a._image,c=a._canvas;b?this._setImage(b):c&&(b=R.getCanvas(a._size),
b.getContext("2d").drawImage(c,0,0),this._setImage(b));this._crossOrigin=a._crossOrigin},getSize:function(){var a=this._size;return new u(a?a.width:0,a?a.height:0,this,"setSize")},setSize:function(){var a=q.read(arguments);if(!a.equals(this._size))if(0<a.width&&0<a.height){var b=this.getElement();this._setImage(R.getCanvas(a));b&&this.getContext(!0).drawImage(b,0,0,a.width,a.height)}else this._canvas&&R.release(this._canvas),this._size=a.clone()},getWidth:function(){return this._size?this._size.width:
0},setWidth:function(a){this.setSize(a,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(a){this.setSize(this.getWidth(),a)},getLoaded:function(){return this._loaded},isEmpty:function(){var a=this._size;return!a||0===a.width&&0===a.height},getResolution:function(){var a=this._matrix,b=(new n(0,0)).transform(a),c=(new n(1,0)).transform(a).subtract(b);a=(new n(0,1)).transform(a).subtract(b);return new q(72/c.getLength(),72/a.getLength())},getPpi:"#getResolution",
getImage:function(){return this._image},setImage:function(a){function b(a){var b=c.getView(),d=a&&a.type||"load";b&&c.responds(d)&&(paper=b._scope,c.emit(d,new xa(a)))}var c=this;this._setImage(a);this._loaded?setTimeout(b,0):a&&ba.add(a,{load:function(d){c._setImage(a);b(d)},error:b})},_setImage:function(a){this._canvas&&R.release(this._canvas);a&&a.getContext?(this._image=null,this._canvas=a,this._loaded=!0):(this._image=a,this._canvas=null,this._loaded=!!(a&&a.src&&a.complete));this._size=new q(a?
a.naturalWidth||a.width:0,a?a.naturalHeight||a.height:0);this._context=null;this._changed(521)},getCanvas:function(){if(!this._canvas){var a=R.getContext(this._size);try{this._image&&a.drawImage(this._image,0,0),this._canvas=a.canvas}catch(Z){R.release(a)}}return this._canvas},setCanvas:"#setImage",getContext:function(a){return this._context||(this._context=this.getCanvas().getContext("2d")),a&&(this._image=null,this._changed(513)),this._context},setContext:function(a){this._context=a},getSource:function(){var a=
this._image;return a&&a.src||this.toDataURL()},setSource:function(a){var b=new c.Image,d=this._crossOrigin;d&&(b.crossOrigin=d);b.src=a;this.setImage(b)},getCrossOrigin:function(){var a=this._image;return a&&a.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(a){this._crossOrigin=a;var b=this._image;b&&(b.crossOrigin=a)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var a=r.read(arguments),b=R.getContext(a.getSize());return b.drawImage(this.getCanvas(),
a.x,a.y,a.width,a.height,0,0,a.width,a.height),b.canvas},getSubRaster:function(){var a=r.read(arguments),b=new D(B.NO_INSERT);return b._setImage(this.getSubCanvas(a)),b.translate(a.getCenter().subtract(this.getSize().divide(2))),b._matrix.prepend(this._matrix),b.insertAbove(this),b},toDataURL:function(){var a=this._image;a=a&&a.src;return/^data:/.test(a)?a:(a=this.getCanvas())?a.toDataURL.apply(a,arguments):null},drawImage:function(a){var b=n.read(arguments,1);this.getContext(!0).drawImage(a,b.x,
b.y)},getAverageColor:function(a){var b,c;if(a?a instanceof ia?(c=a,b=a.getBounds()):"object"==typeof a&&("width"in a?b=new r(a):"x"in a&&(b=new r(a.x-.5,a.y-.5,1,1))):b=this.getBounds(),!b)return null;a=Math.min(b.width,32);var d=Math.min(b.height,32),f=D._sampleContext;f?f.clearRect(0,0,33,33):f=D._sampleContext=R.getContext(new q(32));f.save();b=(new A).scale(a/b.width,d/b.height).translate(-b.x,-b.y);b.applyToContext(f);c&&c.draw(f,new e({clip:!0,matrices:[b]}));this._matrix.applyToContext(f);
c=this.getElement();b=this._size;c&&f.drawImage(c,-b.width/2,-b.height/2);f.restore();a=f.getImageData(.5,.5,Math.ceil(a),Math.ceil(d)).data;d=[0,0,0];c=f=0;for(b=a.length;c<b;c+=4){var g=a[c+3];f+=g;g/=255;d[0]+=a[c]*g;d[1]+=a[c+1]*g;d[2]+=a[c+2]*g}for(c=0;3>c;c++)d[c]/=f;return f?fa.read(d):null},getPixel:function(){var a=n.read(arguments);a=this.getContext().getImageData(a.x,a.y,1,1).data;return new fa("rgb",[a[0]/255,a[1]/255,a[2]/255],a[3]/255)},setPixel:function(){var a=n.read(arguments),b=
fa.read(arguments),c=b._convert("rgb");b=b._alpha;var d=this.getContext(!0),e=d.createImageData(1,1),f=e.data;f[0]=255*c[0];f[1]=255*c[1];f[2]=255*c[2];f[3]=null!=b?255*b:255;d.putImageData(e,a.x,a.y)},createImageData:function(){var a=q.read(arguments);return this.getContext().createImageData(a.width,a.height)},getImageData:function(){var a=r.read(arguments);return a.isEmpty()&&(a=new r(this._size)),this.getContext().getImageData(a.x,a.y,a.width,a.height)},setImageData:function(a){var b=n.read(arguments,
1);this.getContext(!0).putImageData(a,b.x,b.y)},_getBounds:function(a,b){var c=(new r(this._size)).setCenter(0,0);return a?a._transformBounds(c):c},_hitTestSelf:function(a){if(this._contains(a)){var b=this;return new na("pixel",b,{offset:a.add(b._size.divide(2)).round(),color:{get:function(){return b.getPixel(this.offset)}}})}},_draw:function(a){var b=this.getElement();b&&(a.globalAlpha=this._opacity,a.drawImage(b,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),G=
B.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(a,c){this._initialize(a,c!==b&&n.read(arguments,1))||this.setDefinition(a instanceof oa?a:new oa(a))},_equals:function(a){return this._definition===a._definition},copyContent:function(a){this.setDefinition(a._definition)},getDefinition:function(){return this._definition},setDefinition:function(a){this._definition=a;this._changed(9)},getSymbol:"#getDefinition",
setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(a,b){var c=this._definition._item;return c._getCachedBounds(c._matrix.prepended(a),b)},_hitTestSelf:function(a,b,c,d){a=this._definition._item._hitTest(a,b,c);return a&&(a.item=this),a},_draw:function(a,b){this._definition._item.draw(a,b)}}),oa=e.extend({_class:"SymbolDefinition",initialize:function(a,b){this._id=m.get();this.project=paper.project;a&&this.setItem(a,b)},_serialize:function(a,
b){return b.add(this,function(){return e.serialize([this._class,this._item],a,!1,b)})},_changed:function(a){8&a&&B._clearBoundsCache(this);1&a&&this.project._changed(a)},getItem:function(){return this._item},setItem:function(a,b){a._symbol&&(a=a.clone());this._item&&(this._item._symbol=null);this._item=a;a.remove();a.setSelected(!1);b||a.setPosition(new n);a._symbol=this;this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(a){return new G(this,a)},clone:function(){return new oa(this._item.clone(!1))},
equals:function(a){return a===this||a&&this._item.equals(a._item)||!1}}),na=e.extend({_class:"HitResult",initialize:function(a,b,c){this.type=a;this.item=b;c&&(c.enumerable=!0,this.inject(c))},statics:{getOptions:function(a){a=a&&e.read(a);return e.set({type:null,tolerance:paper.settings.hitTolerance,fill:!a,stroke:!a,segments:!a,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1},a)}}}),H=e.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(a,c,d,e,f,g){var h,k,n,m,l=arguments.length;
0===l||(1===l?a&&"point"in a?(h=a.point,k=a.handleIn,n=a.handleOut,m=a.selection):h=a:null==a||"object"==typeof a?(h=a,k=c,n=d,m=e):(h=a!==b?[a,c]:null,k=d!==b?[d,e]:null,n=f!==b?[f,g]:null));new ja(h,this,"_point");new ja(k,this,"_handleIn");new ja(n,this,"_handleOut");m&&this.setSelection(m)},_serialize:function(a,b){var c=this._point,d=this._selection;c=d||this.hasHandles()?[c,this._handleIn,this._handleOut]:c;return d&&c.push(d),e.serialize(c,a,!0,b)},_changed:function(a){var b=this._path;if(b){var c,
d=b._curves,e=this._index;d&&(a&&a!==this._point&&a!==this._handleIn||!(c=0<e?d[e-1]:b._closed?d[d.length-1]:null)||c._changed(),a&&a!==this._point&&a!==this._handleOut||!(c=d[e])||c._changed());b._changed(25)}},getPoint:function(){return this._point},setPoint:function(){var a=n.read(arguments);this._point.set(a.x,a.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(){var a=n.read(arguments);this._handleIn.set(a.x,a.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(){var a=
n.read(arguments);this._handleOut.set(a.x,a.y)},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},clearHandles:function(){this._handleIn.set(0,0);this._handleOut.set(0,0)},getSelection:function(){return this._selection},setSelection:function(a){var b=this._selection,c=this._path;this._selection=a=a||0;c&&a!==b&&(c._updateSelection(this,b,a),c._changed(129))},changeSelection:function(a,b){var c=this._selection;this.setSelection(b?c|a:c&~a)},isSelected:function(){return!!(7&
this._selection)},setSelected:function(a){this.changeSelection(7,a)},getIndex:function(){return this._index!==b?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var a=this._path,b=this._index;return a?(0<b&&!a._closed&&b===a._segments.length-1&&b--,a.getCurves()[b]||null):null},getLocation:function(){var a=this.getCurve();return a?new U(a,this===a._segment1?0:1):null},getNext:function(){var a=this._path&&this._path._segments;return a&&(a[this._index+1]||this._path._closed&&
a[0])||null},smooth:function(a,c,d){a=a||{};var e=a.type,f=a.factor,g=this.getPrevious();a=this.getNext();var h=(g||this)._point,k=this._point,m=(a||this)._point,l=h.getDistance(k),p=k.getDistance(m);if(e&&"catmull-rom"!==e){if("geometric"!==e)throw Error("Smoothing method '"+e+"' not supported.");g&&a&&(a=h.subtract(m),h=f===b?.4:f,k=h*l/(l+p),c||this.setHandleIn(a.multiply(k)),d||this.setHandleOut(a.multiply(k-h)))}else f=f===b?.5:f,l=Math.pow(l,f),e=l*l,p=Math.pow(p,f),f=p*p,!c&&g&&(c=2*f+3*p*
l+e,g=3*p*(p+l),this.setHandleIn(0!==g?new n((f*h._x+c*k._x-e*m._x)/g-k._x,(f*h._y+c*k._y-e*m._y)/g-k._y):new n)),!d&&a&&(c=2*e+3*l*p+f,g=3*l*(l+p),this.setHandleOut(0!==g?new n((e*m._x+c*k._x-f*h._x)/g-k._x,(e*m._y+c*k._y-f*h._y)/g-k._y):new n))},getPrevious:function(){var a=this._path&&this._path._segments;return a&&(a[this._index-1]||this._path._closed&&a[a.length-1])||null},isFirst:function(){return 0===this._index},isLast:function(){var a=this._path;return a&&this._index===a._segments.length-
1||!1},reverse:function(){var a=this._handleIn,b=this._handleOut,c=a._x,d=a._y;a.set(b._x,b._y);b.set(c,d)},reversed:function(){return new H(this._point,this._handleOut,this._handleIn)},remove:function(){return!!this._path&&!!this._path.removeSegment(this._index)},clone:function(){return new H(this._point,this._handleIn,this._handleOut)},equals:function(a){return a===this||a&&this._class===a._class&&this._point.equals(a._point)&&this._handleIn.equals(a._handleIn)&&this._handleOut.equals(a._handleOut)||
!1},toString:function(){var a=["point: "+this._point];return this._handleIn.isZero()||a.push("handleIn: "+this._handleIn),this._handleOut.isZero()||a.push("handleOut: "+this._handleOut),"{ "+a.join(", ")+" }"},transform:function(a){this._transformCoordinates(a,Array(6),!0);this._changed()},interpolate:function(a,b,c){var d=1-c,e=a._point,f=b._point,g=a._handleIn,h=b._handleIn;b=b._handleOut;a=a._handleOut;this._point.set(d*e._x+c*f._x,d*e._y+c*f._y,!0);this._handleIn.set(d*g._x+c*h._x,d*g._y+c*h._y,
!0);this._handleOut.set(d*a._x+c*b._x,d*a._y+c*b._y,!0);this._changed()},_transformCoordinates:function(a,b,c){var d=this._point,e=c&&this._handleIn.isZero()?null:this._handleIn,f=c&&this._handleOut.isZero()?null:this._handleOut,g=d._x,h=d._y,k=2;return b[0]=g,b[1]=h,e&&(b[k++]=e._x+g,b[k++]=e._y+h),f&&(b[k++]=f._x+g,b[k++]=f._y+h),a&&(a._transformCoordinates(b,b,k/2),g=b[0],h=b[1],c?(d._x=g,d._y=h,k=2,e&&(e._x=b[k++]-g,e._y=b[k++]-h),f&&(f._x=b[k++]-g,f._y=b[k++]-h)):(e||(b[k++]=g,b[k++]=h),f||(b[k++]=
g,b[k++]=h))),b}}),ja=n.extend({initialize:function(a,c,d){var e;if(a)if((e=a[0])!==b)var f=a[1];else{var g=a;(e=g.x)===b&&(g=n.read(arguments),e=g.x);f=g.y;g=g.selected}else e=f=0;this._x=e;this._y=f;this._owner=c;c[d]=this;g&&this.setSelected(!0)},set:function(a,b){return this._x=a,this._y=b,this._owner._changed(this),this},getX:function(){return this._x},setX:function(a){this._x=a;this._owner._changed(this)},getY:function(){return this._y},setY:function(a){this._y=a;this._owner._changed(this)},
isZero:function(){return h.isZero(this._x)&&h.isZero(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(a){this._owner.changeSelection(this._getSelection(),a)},_getSelection:function(){var a=this._owner;return this===a._point?1:this===a._handleIn?2:this===a._handleOut?4:0}}),z=e.extend({_class:"Curve",initialize:function(a,b,c,d,e,f,g,h){var k,n,m,l,p,I,P=arguments.length;3===P?(this._path=a,k=b,n=c):0===P?(k=new H,n=new H):1===P?"segment1"in
a?(k=new H(a.segment1),n=new H(a.segment2)):"point1"in a?(m=a.point1,p=a.handle1,I=a.handle2,l=a.point2):Array.isArray(a)&&(m=[a[0],a[1]],l=[a[6],a[7]],p=[a[2]-a[0],a[3]-a[1]],I=[a[4]-a[6],a[5]-a[7]]):2===P?(k=new H(a),n=new H(b)):4===P?(m=a,p=b,I=c,l=d):8===P&&(m=[a,b],l=[g,h],p=[c-a,d-b],I=[e-g,f-h]);this._segment1=k||new H(m,null,p);this._segment2=n||new H(l,I,null)},_serialize:function(a,b){return e.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:
[this.getPoint1(),this.getPoint2()],a,!0,b)},_changed:function(){this._length=this._bounds=b},clone:function(){return new z(this._segment1,this._segment2)},toString:function(){var a=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||a.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||a.push("handle2: "+this._segment2._handleIn),a.push("point2: "+this._segment2._point),"{ "+a.join(", ")+" }"},remove:function(){var a=!1;if(this._path){a=this._segment2;
var b=a._handleOut;(a=a.remove())&&this._segment1._handleOut.set(b.x,b.y)}return a},getPoint1:function(){return this._segment1._point},setPoint1:function(){var a=n.read(arguments);this._segment1._point.set(a.x,a.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(){var a=n.read(arguments);this._segment2._point.set(a.x,a.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){var a=n.read(arguments);this._segment1._handleOut.set(a.x,a.y)},getHandle2:function(){return this._segment2._handleIn},
setHandle2:function(){var a=n.read(arguments);this._segment2._handleIn.set(a.x,a.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index+1]||this._path._closed&&a[0])||null},getPrevious:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index-1]||this._path._closed&&
a[a.length-1])||null},isFirst:function(){return 0===this._segment1._index},isLast:function(){var a=this._path;return a&&this._segment1._index===a._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle2().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(a){this.getPoint1().setSelected(a);this.getHandle1().setSelected(a);this.getHandle2().setSelected(a);this.getPoint2().setSelected(a)},getValues:function(a){return z.getValues(this._segment1,
this._segment2,a)},getPoints:function(){for(var a=this.getValues(),b=[],c=0;8>c;c+=2)b.push(new n(a[c],a[c+1]));return b},getLength:function(){return null==this._length&&(this._length=z.getLength(this.getValues(),0,1)),this._length},getArea:function(){return z.getArea(this.getValues())},getLine:function(){return new y(this._segment1._point,this._segment2._point)},getPart:function(a,b){return new z(z.getPart(this.getValues(),a,b))},getPartLength:function(a,b){return z.getLength(this.getValues(),a,
b)},getIntersections:function(a){return z._getIntersections(this.getValues(),a&&a!==this?a.getValues():null,this,a,[],{})},divideAt:function(a){return this.divideAtTime(a&&a.curve===this?a.time:a)},divideAtTime:function(a,b){var c=null;if(4E-7<=a&&.9999996>=a){var d=z.subdivide(this.getValues(),a),e=d[0],f=d[1],g=b||this.hasHandles();d=this._segment1;var h=this._segment2,k=this._path;g&&(d._handleOut.set(e[2]-e[0],e[3]-e[1]),h._handleIn.set(f[4]-f[6],f[5]-f[7]));var m=e[6],l=e[7];e=new H(new n(m,
l),g&&new n(e[4]-m,e[5]-l),g&&new n(f[2]-m,f[3]-l));k?(k.insert(d._index+1,e),c=this.getNext()):(this._segment2=e,this._changed(),c=new z(e,h))}return c},splitAt:function(a){return this._path?this._path.splitAt(a):null},splitAtTime:function(a){return this.splitAt(this.getLocationAtTime(a))},divide:function(a,c){return this.divideAtTime(a===b?.5:c?a:this.getTimeAt(a))},split:function(a,c){return this.splitAtTime(a===b?.5:c?a:this.getTimeAt(a))},reversed:function(){return new z(this._segment2.reversed(),
this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut.set(0,0);this._segment2._handleIn.set(0,0)},statics:{getValues:function(a,b,c){var d=a._point;a=a._handleOut;var e=b._handleIn;b=b._point;d=[d._x,d._y,d._x+a._x,d._y+a._y,b._x+e._x,b._y+e._y,b._x,b._y];return c&&c._transformCoordinates(d,d,4),d},subdivide:function(a,c){var d=a[0],e=a[1],f=a[2],g=a[3],h=a[4],k=a[5],n=a[6],m=a[7];c===b&&(c=.5);var l=1-c,p=l*d+c*f,q=l*e+c*g,ka=l*f+c*h,pa=l*g+c*k;h=l*h+c*n;k=l*k+c*m;g=l*p+c*
ka;f=l*q+c*pa;ka=l*ka+c*h;pa=l*pa+c*k;var aa=l*g+c*ka;l=l*f+c*pa;return[[d,e,p,q,g,f,aa,l],[aa,l,ka,pa,h,k,n,m]]},solveCubic:function(a,b,c,d,e,f){var g=a[b],k=a[b+2],n=a[b+4];a=a[b+6];b=0;g<c&&a<c&&k<c&&n<c||g>c&&a>c&&k>c&&n>c||(b=3*(k-g),k=3*(n-k)-b,b=h.solveCubic(a-g-b-k,k,b,g-c,d,e,f));return b},getTimeOf:function(a,b){var c=new n(a[0],a[1]),d=new n(a[6],a[7]),e=b.isClose(c,1E-12)?0:b.isClose(d,1E-12)?1:null;if(null!==e)return e;for(var f=[b.x,b.y],g=[],h=0;2>h;h++)for(var k=z.solveCubic(a,h,
f[h],g,0,1),m=0;m<k;m++)if(e=g[m],b.isClose(z.getPoint(a,e),2E-7))return e;return b.isClose(c,2E-7)?0:b.isClose(d,2E-7)?1:null},getNearestTime:function(a,b){function c(c){if(0<=c&&1>=c){var d=b.getDistance(z.getPoint(a,c),!0);if(d<k)return k=d,m=c,!0}}if(z.isStraight(a)){var d=a[0],e=a[1],f=a[6]-d,g=a[7]-e,h=f*f+g*g;if(0===h)return 0;h=((b.x-d)*f+(b.y-e)*g)/h;return 1E-12>h?0:.999999999999<h?1:z.getTimeOf(a,new n(d+h*f,e+h*g))}var k=1/0,m=0;for(d=0;100>=d;d++)c(d/100);for(d=.005;4E-7<d;)c(m-d)||c(m+
d)||(d/=2);return m},getPart:function(a,b,c){var d=b>c;d&&(c=b=c);return 0<b&&(a=z.subdivide(a,b)[1]),1>c&&(a=z.subdivide(a,(c-b)/(1-b))[0]),d?[a[6],a[7],a[4],a[5],a[2],a[3],a[0],a[1]]:a},isFlatEnough:function(a,b){var c=a[0],d=a[1],e=a[6],f=a[7],g=3*a[2]-2*c-e,h=3*a[3]-2*d-f;c=3*a[4]-2*e-c;d=3*a[5]-2*f-d;return Math.max(g*g,c*c)+Math.max(h*h,d*d)<=16*b*b},getArea:function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6];a=a[7];return 3*((a-c)*(d+f)-(h-b)*(e+g)+e*(b-f)-d*(c-g)+a*(f+b/3)-h*
(g+c/3))/20},getBounds:function(a){for(var b=a.slice(0,2),c=b.slice(),d=[0,0],e=0;2>e;e++)z._addBounds(a[e],a[e+2],a[e+4],a[e+6],e,0,b,c,d);return new r(b[0],b[1],c[0]-b[0],c[1]-b[1])},_addBounds:function(a,b,c,d,e,f,g,k,m){function n(a,b){var c=a-b,d=a+b;c<g[e]&&(g[e]=c);d>k[e]&&(k[e]=d)}f/=2;var l=g[e]-f,p=k[e]+f;if(a<l||b<l||c<l||d<l||a>p||b>p||c>p||d>p)if(b<a!=b<d&&c<a!=c<d)n(a,f),n(d,f);else for(l=h.solveQuadratic(3*(b-c)-a+d,2*(a+c)-4*b,b-a,m),n(d,0),p=0;p<l;p++){var I=m[p],P=1-I;4E-7<I&&.9999996>
I&&n(P*P*P*a+3*P*P*I*b+3*P*I*I*c+I*I*I*d,f)}}}},e.each(["getBounds","getStrokeBounds","getHandleBounds"],function(a){this[a]=function(){this._bounds||(this._bounds={});var b=this._bounds[a];return b||(b=this._bounds[a]=O[a]([this._segment1,this._segment2],!1,this._path)),b.clone()}},{}),e.each({isStraight:function(a,b,c){if(b.isZero()&&c.isZero())return!0;var d=a.getVector();return d.isZero()?!1:2E-7>a.getDistance(b)&&2E-7>a.getDistance(c)?(a=d.dot(d),b=d.dot(b)/a,c=d.dot(c)/a,0<=b&&1>=b&&0>=c&&-1<=
c):!1},isLinear:function(a,b,c){a=a.getVector().divide(3);return b.equals(a)&&c.negate().equals(a)}},function(a,b){this[b]=function(){var b=this._segment1,c=this._segment2;return a(new y(b._point,c._point),b._handleOut,c._handleIn)};this.statics[b]=function(b){var c=b[0],d=b[1],e=b[6],f=b[7];return a(new y(c,d,e,f),new n(b[2]-c,b[3]-d),new n(b[4]-e,b[5]-f))}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},isCollinear:function(a){return a&&
this.isStraight()&&a.isStraight()&&this.getLine().isCollinear(a.getLine())},isHorizontal:function(){return this.isStraight()&&1E-7>Math.abs(this.getTangentAtTime(.5).y)},isVertical:function(){return this.isStraight()&&1E-7>Math.abs(this.getTangentAtTime(.5).x)}}),{beans:!1,getLocationAt:function(a,b){return this.getLocationAtTime(b?a:this.getTimeAt(a))},getLocationAtTime:function(a){return null!=a&&0<=a&&1>=a?new U(this,a):null},getTimeAt:function(a,b){return z.getTimeAt(this.getValues(),a,b)},getParameterAt:"#getTimeAt",
getOffsetAtTime:function(a){return this.getPartLength(0,a)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(n.read(arguments)))},getOffsetOf:function(){var a=this.getLocationOf.apply(this,arguments);return a?a.getOffset():null},getTimeOf:function(){return z.getTimeOf(this.getValues(),n.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var a=n.read(arguments),b=this.getValues(),c=z.getNearestTime(b,a);b=z.getPoint(b,c);return new U(this,c,b,null,a.getDistance(b))},
getNearestPoint:function(){var a=this.getNearestLocation.apply(this,arguments);return a?a.getPoint():a}},new function(){var a="getPoint getTangent getNormal getWeightedTangent getWeightedNormal getCurvature".split(" ");return e.each(a,function(a){this[a+"At"]=function(b,c){var d=this.getValues();return z[a](d,c?b:z.getTimeAt(d,b))};this[a+"AtTime"]=function(b){return z[a](this.getValues(),b)}},{statics:{_evaluateMethods:a}})},new function(){function a(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],
h=9*(d-f)+3*(a[6]-b),k=6*(b+f)-12*d,n=3*(d-b),m=9*(e-g)+3*(a[7]-c),l=6*(c+g)-12*e,p=3*(e-c);return function(a){var b=(h*a+k)*a+n;a=(m*a+l)*a+p;return Math.sqrt(b*b+a*a)}}function c(a,b,c,d){if(null==b||0>b||1<b)return null;var e=a[0],f=a[1],g=a[2],k=a[3],m=a[4],l=a[5],p=a[6],q=a[7];a=h.isZero;a(g-e)&&a(k-f)&&(g=e,k=f);a(m-p)&&a(l-q)&&(m=p,l=q);var K=3*(g-e);a=3*(m-g)-K;var aa=p-e-K-a,r=3*(k-f),la=3*(l-k)-r,ca=q-f-r-la;if(0===c){var u=0===b?e:1===b?p:((aa*b+a)*b+K)*b+e;var v=0===b?f:1===b?q:((ca*b+
la)*b+r)*b+f}else{if(4E-7>b?(u=K,v=r):.9999996<b?(u=3*(p-m),v=3*(q-l)):(u=(3*aa*b+2*a)*b+K,v=(3*ca*b+2*la)*b+r),d)0===u&&0===v&&(4E-7>b||.9999996<b)&&(u=m-g,v=l-k),(d=Math.sqrt(u*u+v*v))&&(u/=d,v/=d);3===c&&(d=Math.pow(u*u+v*v,1.5),u=0!==d?(u*(6*ca*b+2*la)-v*(6*aa*b+2*a))/d:0,v=0)}return 2===c?new n(v,-u):new n(u,v)}return{statics:{getLength:function(c,d,e,f){return(d===b&&(d=0),e===b&&(e=1),z.isStraight(c))?(1>e&&(c=z.subdivide(c,e)[0],d/=e),0<d&&(c=z.subdivide(c,d)[1]),d=c[6]-c[0],e=c[7]-c[1],Math.sqrt(d*
d+e*e)):h.integrate(f||a(c),d,e,Math.max(2,Math.min(16,Math.ceil(32*Math.abs(e-d)))))},getTimeAt:function(c,d,e){if(e===b&&(e=0>d?1:0),0===d)return e;var f=Math.abs,g=0<d,k=g?e:0,m=g?1:e,n=a(c);c=z.getLength(c,k,m,n);var l=f(d)-c;if(1E-12>f(l))return g?m:k;if(1E-12<l)return null;var p=0;return h.findRoot(function(a){return p+=h.integrate(n,e,a,Math.max(2,Math.min(16,Math.ceil(32*Math.abs(a-e))))),e=a,p-d},n,e+d/c,k,m,32,1E-12)},getPoint:function(a,b){return c(a,b,0,!1)},getTangent:function(a,b){return c(a,
b,1,!0)},getWeightedTangent:function(a,b){return c(a,b,1,!1)},getNormal:function(a,b){return c(a,b,2,!0)},getWeightedNormal:function(a,b){return c(a,b,2,!1)},getCurvature:function(a,b){return c(a,b,3,!1).x}}}},new function(){function a(a,b,c,d,e,f,g,h,k,m,n){var l=!n&&b.excludeStart,p=!n&&b.excludeEnd;if(null==e&&(e=z.getTimeOf(c,f)),null!==e&&e>=(l?4E-7:0)&&e<=(p?.9999996:1)&&(null==k&&(k=z.getTimeOf(g,m)),null!==k&&k>=(p?4E-7:0)&&k<=(l?.9999996:1))){if(l=b.renormalize)k=l(e,k),e=k[0],k=k[1];c=new U(d,
e,f||z.getPoint(c,e),n);g=new U(h,k,m||z.getPoint(g,k),n);h=c.getPath()===g.getPath()&&c.getIndex()>g.getIndex()?g:c;b=b.include;c._intersection=g;g._intersection=c;b&&!b(h)||U.insert(a,h,!0)}}function b(d,e,f,g,h,k,m,n,l,p,q,K,r){if(48<=++K||4096<++r)return r;var I,P,J=e[0],Q=e[1],V=e[6],ka=e[7],da=y.getSignedDistance,aa=da(J,Q,V,ka,e[2],e[3]),pa=da(J,Q,V,ka,e[4],e[5]),sa=0<aa*pa?.75:4/9,u=sa*Math.min(0,aa,pa);sa*=Math.max(0,aa,pa);var v=da(J,Q,V,ka,d[0],d[1]),la=da(J,Q,V,ka,d[2],d[3]),Ra=da(J,Q,
V,ka,d[4],d[5]);J=da(J,Q,V,ka,d[6],d[7]);ka=[0,v];da=[1/3,la];var ca=[2/3,Ra],Ia=[1,J];Q=la-(2*v+J)/3;V=Ra-(v+2*J)/3;if(0>Q*V)ka=[[ka,da,Ia],[ka,ca,Ia]];else{var x=Q/V;ka=[2<=x?[ka,da,Ia]:.5>=x?[ka,ca,Ia]:[ka,da,ca,Ia],[ka,Ia]]}V=0>(Q||V)?ka.reverse():ka;Q=V[0];V=V[1];if(0===aa&&0===pa&&0===v&&0===la&&0===Ra&&0===J||null==(I=c(Q,V,u,sa))||null==(P=c(Q.reverse(),V.reverse(),u,sa)))return r;aa=m+(n-m)*I;m+=(n-m)*P;1E-9>Math.max(p-l,m-aa)?(I=(aa+m)/2,P=(l+p)/2,d=f.getValues(),e=g.getValues(),a(h,k,q?
e:d,q?g:f,q?P:I,null,q?d:e,q?f:g,q?I:P,null)):(d=z.getPart(d,I,P),.8<P-I)?m-aa>p-l?(n=z.subdivide(d,.5),I=(aa+m)/2,r=b(e,n[0],g,f,h,k,l,p,aa,I,!q,K,r),r=b(e,n[1],g,f,h,k,l,p,I,m,!q,K,r)):(n=z.subdivide(e,.5),P=(l+p)/2,r=b(n[0],d,g,f,h,k,l,P,aa,m,!q,K,r),r=b(n[1],d,g,f,h,k,P,p,aa,m,!q,K,r)):r=b(e,d,g,f,h,k,l,p,aa,m,!q,K,r);return r}function c(a,b,c,e){return a[0][1]<c?d(a,!0,c):b[0][1]>e?d(b,!1,e):a[0][0]}function d(a,b,c){for(var d=a[0][0],e=a[0][1],f=1,g=a.length;f<g;f++){var h=a[f][0],k=a[f][1];
if(b?k>=c:k<=c)return k===c?h:d+(c-e)*(h-d)/(k-e);d=h;e=k}return null}function e(b,c,d,e,f,g){var k=z.isStraight(b),m=k?c:b,n=k?b:c,l=n[0],p=n[1],I=Math.atan2(-(n[7]-p),n[6]-l),q=Math.sin(I),P=Math.cos(I),K=[];for(I=0;8>I;I+=2){var J=m[I]-l,V=m[I+1]-p;K.push(J*P-V*q,J*q+V*P)}l=[];p=z.solveCubic(K,1,0,l,0,1);for(I=0;I<p;I++)J=l[I],q=z.getPoint(m,J),V=z.getTimeOf(n,q),null!==V&&(K=z.getPoint(n,V),P=k?V:J,J=k?J:V,(!g.excludeEnd||J>h.CURVETIME_EPSILON)&&a(f,g,b,d,P,k?K:q,c,e,J,k?q:K))}function f(b,c,
d,e,f,g){var h=y.intersect(b[0],b[1],b[6],b[7],c[0],c[1],c[6],c[7]);h&&a(f,g,b,d,null,h,c,e,null,h)}return{statics:{_getIntersections:function(c,d,g,h,k,m){if(!d)return z._getSelfIntersection(c,g,k,m);var l=c[0],p=c[1],q=c[6],I=c[7],K=d[0],P=d[1],J=d[6],V=d[7],r=(3*c[2]+l)/4,da=(3*c[3]+p)/4,u=(3*c[4]+q)/4,sa=(3*c[5]+I)/4,v=(3*d[2]+K)/4,la=(3*d[3]+P)/4,ca=(3*d[4]+J)/4,x=(3*d[5]+V)/4,qa=Math.min,va=Math.max;if(!(va(l,r,u,q)+2E-7>qa(K,v,ca,J)&&qa(l,r,u,q)-2E-7<va(K,v,ca,J)&&va(p,da,sa,I)+2E-7>qa(P,la,
x,V)&&qa(p,da,sa,I)-2E-7<va(P,la,x,V)))return k;if(r=z.getOverlaps(c,d)){for(J=0;2>J;J++)V=r[J],a(k,m,c,g,V[0],null,d,h,V[1],null,!0);return k}r=z.isStraight(c);da=z.isStraight(d);u=r&&da;sa=k.length;if((u?f:r||da?e:b)(c,d,g,h,k,m,0,1,0,1,0,0,0),u&&k.length>sa)return k;l=new n(l,p);q=new n(q,I);K=new n(K,P);J=new n(J,V);return l.isClose(K,2E-7)&&a(k,m,c,g,0,l,d,h,0,K),!m.excludeStart&&l.isClose(J,2E-7)&&a(k,m,c,g,0,l,d,h,1,J),!m.excludeEnd&&q.isClose(K,2E-7)&&a(k,m,c,g,1,q,d,h,0,K),q.isClose(J,2E-7)&&
a(k,m,c,g,1,q,d,h,1,J),k},_getSelfIntersection:function(a,b,c,d){var e=a[0],f=a[1],g=a[2],k=a[3],m=a[4],l=a[5],p=a[6],q=a[7],I=new y(e,f,p,q,!1),K=I.getSide(new n(g,k),!0);I=I.getSide(new n(m,l),!0);if(K===I&&0<((e-m)*(k-q)+(g-p)*(l-f))*K)return c;p=p-3*m+3*g-e;m=m-2*g+e;e=g-e;q=q-3*l+3*k-f;l=l-2*k+f;k-=f;f=q*e-p*k;if(0>f*f-4*(q*m-p*l)*(l*e-m*k)){var P;f=[];k=h.solveCubic(p*p+q*q,3*(p*m+q*l),2*(m*m+l*l)+p*e+q*k,m*e+l*k,f,0,1);if(0<k){for(p=l=0;l<k;l++)q=Math.abs(b.getCurvatureAtTime(f[l])),q>p&&(p=
q,P=f[l]);a=z.subdivide(a,P);d.excludeEnd=!0;d.renormalize=function(a,b){return[a*P,b*(1-P)+P]};z._getIntersections(a[0],a[1],b,b,c,d)}}return c},getOverlaps:function(a,b){function c(a){var b=a[6]-a[0];a=a[7]-a[1];return b*b+a*a}var d=Math.abs,e=z.isStraight(a),f=z.isStraight(b),g=e&&f,h=c(a)<c(b),k=h?b:a;h=h?a:b;var m=new y(k[0],k[1],k[6],k[7]);if(2E-7>m.getDistance(new n(h[0],h[1]))&&2E-7>m.getDistance(new n(h[6],h[7])))!g&&2E-7>m.getDistance(new n(k[2],k[3]))&&2E-7>m.getDistance(new n(k[4],k[5]))&&
2E-7>m.getDistance(new n(h[2],h[3]))&&2E-7>m.getDistance(new n(h[4],h[5]))&&(e=f=g=!0);else if(g)return null;if(e^f)return null;f=[a,b];e=[];for(h=k=0;2>k&&2>e.length&&(m=z.getTimeOf(f[1^k],new n(f[k][0===h?0:6],f[k][0===h?1:7])),null!=m&&(m=0===k?[h,m]:[m,h],(0===e.length||4E-7<d(m[0]-e[0][0])&&4E-7<d(m[1]-e[0][1]))&&e.push(m)),1!==k||0!==e.length);k+=0===h?0:1,h^=1);2!==e.length?e=null:g||(g=z.getPart(a,e[0][0],e[1][0]),f=z.getPart(b,e[0][1],e[1][1]),(2E-7<d(f[2]-g[2])||2E-7<d(f[3]-g[3])||2E-7<
d(f[4]-g[4])||2E-7<d(f[5]-g[5]))&&(e=null));return e}}}}),U=e.extend({_class:"CurveLocation",beans:!0,initialize:function(a,b,c,d,e){if(.9999996<b){var f=a.getNext();f&&(b=0,a=f)}this._setCurve(a);this._time=b;this._point=c||a.getPointAtTime(b);this._overlap=d;this._distance=e;this._intersection=this._next=this._previous=null},_setCurve:function(a){var b=a._path;this._version=(this._path=b)?b._version:0;this._curve=a;this._segment=null;this._segment1=a._segment1;this._segment2=a._segment2},_setSegment:function(a){this._setCurve(a.getCurve());
this._segment=a;this._time=a===this._segment1?0:1;this._point=a._point.clone()},getSegment:function(){var a=this.getCurve(),b=this._segment;if(!b){var c=this.getTime();0===c?b=a._segment1:1===c?b=a._segment2:null!=c&&(b=a.getPartLength(0,c)<a.getPartLength(c,1)?a._segment1:a._segment2);this._segment=b}return b},getCurve:function(){function a(a){var b=a&&a.getCurve();if(b&&null!=(c._time=b.getTimeOf(c._point)))return c._setCurve(b),c._segment=a,b}var b=this._path,c=this;return b&&b._version!==this._version&&
(this._time=this._curve=this._offset=null),this._curve||a(this._segment)||a(this._segment1)||a(this._segment2.getPrevious())},getPath:function(){var a=this.getCurve();return a&&a._path},getIndex:function(){var a=this.getCurve();return a&&a.getIndex()},getTime:function(){var a=this.getCurve(),b=this._time;return a&&null==b?this._time=a.getTimeOf(this._point):b},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var a=this._offset;if(null==a){a=0;var b=this.getPath(),
c=this.getIndex();if(b&&null!=c){b=b.getCurves();for(var d=0;d<c;d++)a+=b[d].getLength()}this._offset=a+=this.getCurveOffset()}return a},getCurveOffset:function(){var a=this.getCurve(),b=this.getTime();return null!=b&&a&&a.getPartLength(0,b)},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var a=this.getCurve(),b=null;return a&&(b=a.divideAtTime(this.getTime()),b&&this._setSegment(b._segment1)),b},split:function(){var a=this.getCurve();
return a?a.splitAtTime(this.getTime()):null},equals:function(a,b){var c=this===a;if(!c&&a instanceof U&&this.getPath()===a.getPath()&&this.getPoint().isClose(a.getPoint(),2E-7)){var d=this.getCurve(),e=a.getCurve();c=Math.abs;d=c((d.isLast()&&e.isFirst()?-1:d.getIndex())+this.getTime()-((e.isLast()&&d.isFirst()?-1:e.getIndex())+a.getTime()));c=(4E-7>d||2E-7>(d=c(this.getOffset()-a.getOffset()))||2E-7>c(this.getPath().getLength()-d))&&(b||!this._intersection&&!a._intersection||this._intersection&&
this._intersection.equals(a._intersection,!0))}return c},toString:function(){var a=[],b=this.getPoint(),c=l.instance;b&&a.push("point: "+b);b=this.getIndex();null!=b&&a.push("index: "+b);b=this.getTime();return null!=b&&a.push("time: "+c.number(b)),null!=this._distance&&a.push("distance: "+c.number(this._distance)),"{ "+a.join(", ")+" }"},isTouching:function(){var a=this._intersection;if(a&&this.getTangent().isCollinear(a.getTangent())){var b=this.getCurve();a=a.getCurve();return!(b.isStraight()&&
a.isStraight()&&b.getLine().intersect(a.getLine()))}return!1},isCrossing:function(){function a(a,b,c){return b<c?a>b&&a<c:a>b||a<c}var b=this._intersection;if(!b)return!1;var c=this.getTime(),d=b.getTime(),e=4E-7<c&&.9999996>c,f=4E-7<d&&.9999996>d;if(e&&f)return!this.isTouching();var g=this.getCurve(),h=4E-7>=c?g.getPrevious():g,k=b.getCurve();b=4E-7>=d?k.getPrevious():k;if(.9999996<=c&&(g=g.getNext()),.9999996<=d&&(k=k.getNext()),!(h&&g&&b&&k))return!1;var m=[];e||m.push(h.getLength(),g.getLength());
f||m.push(b.getLength(),k.getLength());var l=this.getPoint();m=Math.min.apply(Math,m)/64;c=e?g.getTangentAtTime(c):g.getPointAt(m).subtract(l);h=e?c.negate():h.getPointAt(-m).subtract(l);d=f?k.getTangentAtTime(d):k.getPointAt(m).subtract(l);b=f?d.negate():b.getPointAt(-m).subtract(l);f=h.getAngle();l=c.getAngle();b=b.getAngle();d=d.getAngle();return!!(e?a(f,b,d)^a(l,b,d)&&a(f,d,b)^a(l,d,b):a(b,f,l)^a(d,f,l)&&a(b,l,f)^a(d,l,f))},hasOverlap:function(){return!!this._overlap}},e.each(z._evaluateMethods,
function(a){var b=a+"At";this[a]=function(){var a=this.getCurve(),c=this.getTime();return null!=c&&a&&a[b](c,!0)}},{preserve:!0}),new function(){function a(a,b,c){function d(c,d){for(var f=c+d;-1<=f&&f<=e;f+=d){var g=a[(f%e+e)%e];if(!b.getPoint().isClose(g.getPoint(),2E-7))break;if(b.equals(g))return g}return null}for(var e=a.length,f=0,g=e-1;f<=g;){var h,k=f+g>>>1,m=a[k];if(c&&(h=b.equals(m)?m:d(k,-1)||d(k,1)))return b._overlap&&(h._overlap=h._intersection._overlap=!0),h;var l=b.getPath(),n=m.getPath();
0>(l===n?b.getIndex()+b.getTime()-(m.getIndex()+m.getTime()):l._id-n._id)?g=k-1:f=k+1}return a.splice(f,0,b),b}return{statics:{insert:a,expand:function(b){for(var c=b.slice(),d=b.length-1;0<=d;d--)a(c,b[d]._intersection,!1);return c}}}}),ia=B.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,initialize:function(){},statics:{create:function(a){return new (1<(a&&a.match(/m/gi)||[]).length||/z\s*\S+/i.test(a)?L:O)(a)}},_asPathItem:function(){return this},setPathData:function(a){function b(a,
b){var c=+d[a];return e&&(c+=f[b]),c}function c(a){return new n(b(a,"x"),b(a+1,"y"))}var d;a=a&&a.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi);var e=!1,f=new n,g=new n;this.clear();for(var h=0,k=a&&a.length;h<k;h++){var m=a[h],l=m[0],p=l.toLowerCase();m=(d=m.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g))&&d.length;switch(e=l===p,"z"!==Q||/[mz]/.test(p)||this.moveTo(f=g),p){case "m":case "l":var Q="m"===p;for(l=0;l<m;l+=2)this[0===l&&Q?"moveTo":"lineTo"](f=c(l));var r=f;Q&&(g=f);break;case "h":case "v":r=
"h"===p?"x":"y";for(l=0;l<m;l++)f[r]=b(l,r),this.lineTo(f);r=f;break;case "c":for(l=0;l<m;l+=6)this.cubicCurveTo(c(l),r=c(l+2),f=c(l+4));break;case "s":for(l=0;l<m;l+=4)this.cubicCurveTo(/[cs]/.test(Q)?f.multiply(2).subtract(r):f,r=c(l),f=c(l+2)),Q=p;break;case "q":for(l=0;l<m;l+=4)this.quadraticCurveTo(r=c(l),f=c(l+2));break;case "t":for(l=0;l<m;l+=2)this.quadraticCurveTo(r=/[qt]/.test(Q)?f.multiply(2).subtract(r):f,f=c(l)),Q=p;break;case "a":for(l=0;l<m;l+=7)this.arcTo(f=c(l+5),new q(+d[l],+d[l+
1]),+d[l+2],+d[l+4],+d[l+3]);break;case "z":this.closePath(1E-12)}Q=p}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(a){a=a.isInside(this.getBounds({internal:!0,handle:!0}))&&this._getWinding(a);return!!("evenodd"===this.getFillRule()?1&a:a)},getIntersections:function(a,b,c,d){var e=this===a||!a,f=this._matrix._orNullIfIdentity(),g=e?f:(c||a._matrix)._orNullIfIdentity();if(!e&&!this.getBounds(f).touches(a.getBounds(g)))return[];var h,k=this.getCurves(),m=
e?k:a.getCurves(),l=k.length,n=e?l:m.length,p=[];c=[];for(var q=0;q<n;q++)p[q]=m[q].getValues(g);for(q=0;q<l;q++){g=k[q];var r=e?p[q]:g.getValues(f),aa=g.getPath();aa!==a&&(a=aa,h=[],c.push(h));e&&z._getSelfIntersection(r,g,h,{include:b,excludeStart:1===l&&g.getPoint1().equals(g.getPoint2())});for(aa=e?q+1:0;aa<n;aa++){if(d&&h.length)return h;var u=m[aa];z._getIntersections(r,p[aa],g,u,h,{include:b,excludeStart:e&&g.getPrevious()===u,excludeEnd:e&&g.getNext()===u})}}h=[];q=0;for(a=c.length;q<a;q++)h.push.apply(h,
c[q]);return h},getCrossings:function(a){return this.getIntersections(a,function(a){return a._overlap||a.isCrossing()})},getNearestLocation:function(){for(var a=n.read(arguments),b=this.getCurves(),c=1/0,d=null,e=0,f=b.length;e<f;e++){var g=b[e].getNearestLocation(a);g._distance<c&&(c=g._distance,d=g)}return d},getNearestPoint:function(){var a=this.getNearestLocation.apply(this,arguments);return a?a.getPoint():a},interpolate:function(a,b,c){var d=!this._children,e=d?"_segments":"_children",f=a[e],
g=b[e];e=this[e];if(!f||!g||f.length!==g.length)throw Error("Invalid operands in interpolate() call: "+a+", "+b);var h=e.length;b=g.length;if(h<b)for(var k=d?H:O;h<b;h++)this.add(new k);else h>b&&this[d?"removeSegments":"removeChildren"](b,h);for(h=0;h<b;h++)e[h].interpolate(f[h],g[h],c);d&&(this.setClosed(a._closed),this._changed(9))}}),O=ia.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(a){this._closed=!1;this._segments=[];this._version=0;var c=Array.isArray(a)?
"object"==typeof a[0]?a:arguments:!a||a.size!==b||a.x===b&&a.point===b?null:arguments;c&&0<c.length?this.setSegments(c):(this._curves=b,this._segmentSelection=0,c||"string"!=typeof a||(this.setPathData(a),a=null));this._initialize(!c&&a)},_equals:function(a){return this._closed===a._closed&&e.equals(this._segments,a._segments)},copyContent:function(a){this.setSegments(a._segments);this._closed=a._closed;a=a._clockwise;a!==b&&(this._clockwise=a)},_changed:function ca(a){if(ca.base.call(this,a),8&a)if(this._length=
this._area=this._clockwise=this._monoCurves=b,16&a)this._version++;else{if(this._curves){a=0;for(var c=this._curves.length;a<c;a++)this._curves[a]._changed()}}else 32&a&&(this._bounds=b)},getStyle:function(){var a=this._parent;return(a instanceof L?a:this)._style},getSegments:function(){return this._segments},setSegments:function(a){var c=this.isFullySelected();this._segmentSelection=this._segments.length=0;this._curves=b;a&&0<a.length&&this._add(H.readAll(a));c&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},
getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var a=this._curves,b=this._segments;if(!a){var c=this._countCurves();a=this._curves=Array(c);for(var d=0;d<c;d++)a[d]=new z(this,b[d],b[d+1]||b[0])}return a},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var a=this.getCurves();return a[a.length-1]},isClosed:function(){return this._closed},setClosed:function(a){if(this._closed!=(a=!!a)){if(this._closed=a,this._curves){var b=
this._curves.length=this._countCurves();a&&(this._curves[b-1]=new z(this,this._segments[b-1],this._segments[0]))}this._changed(25)}}},{beans:!0,getPathData:function(a,b){function c(b,c){b._transformCoordinates(a,u);d=u[0];e=u[1];v?(x.push("M"+r.pair(d,e)),v=!1):(h=u[2],k=u[3],h===d&&k===e&&m===f&&n===g?c||x.push("l"+r.pair(d-f,e-g)):x.push("c"+r.pair(m-f,n-g)+" "+r.pair(h-f,k-g)+" "+r.pair(d-f,e-g)));f=d;g=e;m=u[4];n=u[5]}var d,e,f,g,h,k,m,n,p=this._segments,q=p.length,r=new l(b),u=Array(6),v=!0,
x=[];if(0===q)return"";for(var y=0;y<q;y++)c(p[y]);return this._closed&&0<q&&(c(p[0],!0),x.push("z")),x.join("")},isEmpty:function(){return 0===this._segments.length},_transformContent:function(a){for(var b=this._segments,c=Array(6),d=0,e=b.length;d<e;d++)b[d]._transformCoordinates(a,c,!0);return!0},_add:function(a,b){var c=this._segments,d=this._curves,e=a.length,f=null==b;b=f?c.length:b;for(var g=0;g<e;g++){var h=a[g];h._path&&(h=a[g]=h.clone());h._path=this;h._index=b+g;h._selection&&this._updateSelection(h,
0,h._selection)}if(f)c.push.apply(c,a);else for(c.splice.apply(c,[b,0].concat(a)),g=b+e,f=c.length;g<f;g++)c[g]._index=g;if(d){f=this._countCurves();g=c=0<b&&b+e-1===f?b-1:b;e=Math.min(c+e,f);for(a._curves&&(d.splice.apply(d,[c,0].concat(a._curves)),g+=a._curves.length);g<e;g++)d.splice(g,0,new z(this,null,null));this._adjustCurves(c,e)}return this._changed(25),a},_adjustCurves:function(a,b){for(var c,d=this._segments,e=this._curves,f=a;f<b;f++)c=e[f],c._path=this,c._segment1=d[f],c._segment2=d[f+
1]||d[0],c._changed();(c=e[this._closed&&0===a?d.length-1:a-1])&&(c._segment2=d[a]||d[0],c._changed());(c=e[b])&&(c._segment1=d[b],c._changed())},_countCurves:function(){var a=this._segments.length;return!this._closed&&0<a?a-1:a},add:function(a){return 1<arguments.length&&"number"!=typeof a?this._add(H.readAll(arguments)):this._add([H.read(arguments)])[0]},insert:function(a,b){return 2<arguments.length&&"number"!=typeof b?this._add(H.readAll(arguments,1),a):this._add([H.read(arguments,1)],a)[0]},
addSegment:function(){return this._add([H.read(arguments)])[0]},insertSegment:function(a){return this._add([H.read(arguments,1)],a)[0]},addSegments:function(a){return this._add(H.readAll(a))},insertSegments:function(a,b){return this._add(H.readAll(b),a)},removeSegment:function(a){return this.removeSegments(a,a+1)[0]||null},removeSegments:function(a,b,c){a=a||0;b=e.pick(b,this._segments.length);var d=this._segments,f=this._curves,g=d.length,h=d.splice(a,b-a),k=h.length;if(!k)return h;for(var m=0;m<
k;m++){var l=h[m];l._selection&&this._updateSelection(l,l._selection,0);l._index=l._path=null}m=a;for(l=d.length;m<l;m++)d[m]._index=m;if(f){a=0<a&&b===g+(this._closed?1:0)?a-1:a;f=f.splice(a,k);for(m=f.length-1;0<=m;m--)f[m]._path=null;c&&(h._curves=f.slice(1));this._adjustCurves(a,a)}return this._changed(25),h},clear:"#removeSegments",hasHandles:function(){for(var a=this._segments,b=0,c=a.length;b<c;b++)if(a[b].hasHandles())return!0;return!1},clearHandles:function(){for(var a=this._segments,b=0,
c=a.length;b<c;b++)a[b].clearHandles()},getLength:function(){if(null==this._length){for(var a=this.getCurves(),b=0,c=0,d=a.length;c<d;c++)b+=a[c].getLength();this._length=b}return this._length},getArea:function(a){var c=a===b,d=this._area;if(!c||null==d){var e=this._segments,f=e.length,g=c?this._closed:a;a=f-1;var h=d=0;for(f=g?f:a;h<f;h++)d+=z.getArea(z.getValues(e[h],e[h<a?h+1:0]));c&&(this._area=d)}return d},isClockwise:function(){return this._clockwise!==b?this._clockwise:0<=this.getArea()},setClockwise:function(a){this.isClockwise()!=
(a=!!a)&&this.reverse();this._clockwise=a},isFullySelected:function(){var a=this._segments.length;return this.isSelected()&&0<a&&this._segmentSelection===7*a},setFullySelected:function(a){a&&this._selectSegments(!0);this.setSelected(a)},setSelection:function va(a){1&a||this._selectSegments(!1);va.base.call(this,a)},_selectSegments:function(a){var b=this._segments,c=b.length;a=a?7:0;this._segmentSelection=a*c;for(var d=0;d<c;d++)b[d]._selection=a},_updateSelection:function(a,b,c){a._selection=c;0<
(this._segmentSelection+=c-b)&&this.setSelected(!0)},splitAt:function(a){var b="number"==typeof a?this.getLocationAt(a):a;a=b&&b.index;b=b&&b.time;.9999996<=b&&(a++,b=0);var c=this.getCurves();if(0<=a&&a<c.length){4E-7<=b&&c[a++].divideAtTime(b);var d;a=this.removeSegments(a,this._segments.length,!0);return this._closed?(this.setClosed(!1),d=this):(d=new O(B.NO_INSERT),d.insertAbove(this,!0),d.copyAttributes(this)),d._add(a,0),this.addSegment(a[0]),d}return null},split:function(a,c){var d,e=c===b?
a:(d=this.getCurves()[a])&&d.getLocationAtTime(c);return null!=e?this.splitAt(e):null},join:function(a,b){var c=b||0;if(a&&a!==this){var d=a._segments,e=this.getLastSegment(),f=a.getLastSegment();if(!f)return this;e&&e._point.isClose(f._point,c)&&a.reverse();f=a.getFirstSegment();e&&e._point.isClose(f._point,c)?(e.setHandleOut(f._handleOut),this._add(d.slice(1))):((e=this.getFirstSegment())&&e._point.isClose(f._point,c)&&a.reverse(),f=a.getLastSegment(),e&&e._point.isClose(f._point,c)?(e.setHandleIn(f._handleIn),
this._add(d.slice(0,d.length-1),0)):this._add(d.slice()));a._closed&&this._add([d[0]]);a.remove()}d=this.getFirstSegment();e=this.getLastSegment();return d!==e&&d._point.isClose(e._point,c)&&(d.setHandleIn(e._handleIn),e.remove(),this.setClosed(!0)),this},reduce:function(a){for(var b=this.getCurves(),c=(a=a&&a.simplify)?2E-7:0,d=b.length-1;0<=d;d--){var e=b[d];!e.hasHandles()&&(e.getLength()<c||a&&e.isCollinear(e.getNext()))&&e.remove()}return this},reverse:function(){this._segments.reverse();for(var a=
0,c=this._segments.length;a<c;a++){var d=this._segments[a],e=d._handleIn;d._handleIn=d._handleOut;d._handleOut=e;d._index=a}this._curves=null;this._clockwise!==b&&(this._clockwise=!this._clockwise);this._changed(9)},flatten:function(a){a=(new ua(this,a||.25,256,!0)).parts;for(var b=a.length,c=[],d=0;d<b;d++)c.push(new H(a[d].curve.slice(0,2)));!this._closed&&0<b&&c.push(new H(a[b-1].curve.slice(6)));this.setSegments(c)},simplify:function(a){a=(new W(this)).fit(a||2.5);return a&&this.setSegments(a),
!!a},smooth:function(a){function c(a,b){var c=a&&a.index;if(null!=c){var e=a.path;if(e&&e!==d)throw Error(a._class+" "+c+" of "+e+" is not part of "+d);b&&a instanceof z&&c++}else c="number"==typeof a?a:b;return Math.min(0>c&&h?c%g:0>c?c+g:c,g-1)}var d=this,e=a||{},f=e.type||"asymmetric";a=this._segments;var g=a.length,h=this._closed,k=h&&e.from===b&&e.to===b,m=c(e.from,0),l=c(e.to,g-1);m>l&&(h?m-=g:l=m=l);if(/^(?:asymmetric|continuous)$/.test(f)){var n="asymmetric"===f;f=Math.min;e=l-m+1;var p=e-
1,q=k?f(e,4):1,r=e=q,u=[];if(!(h||(e=f(1,m),r=f(1,g-l-1)),p+=e+r,1>=p)){f=0;for(var v=m-e;f<=p;f++,v++)u[f]=a[(0>v?v+g:v)%g]._point;v=u[0]._x+2*u[1]._x;var x=u[0]._y+2*u[1]._y,y=2,w=p-1,Ba=[v],Ma=[x],$a=[y];l=[];q=[];for(f=1;f<p;f++){var db=f<w,A=db?4:n?3:8,L=db?2:n?0:1,G=(db?1:n?1:2)/y;y=$a[f]=(db?4:n?2:7)-G;v=Ba[f]=A*u[f]._x+L*u[f+1]._x-G*v;x=Ma[f]=A*u[f]._y+L*u[f+1]._y-G*x}l[w]=Ba[w]/$a[w];q[w]=Ma[w]/$a[w];for(f=p-2;0<=f;f--)l[f]=(Ba[f]-l[f+1])/$a[f],q[f]=(Ma[f]-q[f+1])/$a[f];l[p]=(3*u[p]._x-l[w])/
2;q[p]=(3*u[p]._y-q[w])/2;f=e;n=p-r;for(v=m;f<=n;f++,v++)m=a[0>v?v+g:v],r=m._point,p=l[f]-r._x,r=q[f]-r._y,(k||f<n)&&m.setHandleOut(p,r),(k||f>e)&&m.setHandleIn(-p,-r)}}else for(f=m;f<=l;f++)a[0>f?f+g:f].smooth(e,!k&&f===m,!k&&f===l)},toShape:function(a){function c(a,b){var c=n[a],d=c.getNext(),e=n[b],f=e.getNext();return c._handleOut.isZero()&&d._handleIn.isZero()&&e._handleOut.isZero()&&f._handleIn.isZero()&&d._point.subtract(c._point).isCollinear(f._point.subtract(e._point))}function d(a){a=n[a];
var b=a.getPrevious(),c=a.getNext();return b._handleOut.isZero()&&a._handleIn.isZero()&&a._handleOut.isZero()&&c._handleIn.isZero()&&a._point.subtract(b._point).isOrthogonal(c._point.subtract(a._point))}function e(a){var b=n[a],c=b.getNext();a=b._handleOut;var d=c._handleIn;if(a.isOrthogonal(d)){b=b._point;c=c._point;var e=(new y(b,a,!0)).intersect(new y(c,d,!0),!0);return e&&h.isZero(a.getLength()/e.subtract(b).getLength()-.5522847498307936)&&h.isZero(d.getLength()/e.subtract(c).getLength()-.5522847498307936)}return!1}
function f(a,b){return n[a]._point.getDistance(n[b]._point)}if(!this._closed)return null;var g,k,m,l,n=this._segments;if(!this.hasHandles()&&4===n.length&&c(0,2)&&c(1,3)&&d(1)?(g=x.Rectangle,k=new q(f(0,3),f(0,1)),l=n[1]._point.add(n[2]._point).divide(2)):8===n.length&&e(0)&&e(2)&&e(4)&&e(6)&&c(1,5)&&c(3,7)?(g=x.Rectangle,k=new q(f(1,6),f(0,3)),m=k.subtract(new q(f(0,7),f(1,2))).divide(2),l=n[3]._point.add(n[4]._point).divide(2)):4===n.length&&e(0)&&e(1)&&e(2)&&e(3)&&(h.isZero(f(0,2)-f(1,3))?(g=x.Circle,
m=f(0,2)/2):(g=x.Ellipse,m=new q(f(2,0)/2,f(3,1)/2)),l=n[1]._point),g){var p=this.getPosition(!0);g=new g({center:p,size:k,radius:m,insert:!1});return g.copyAttributes(this,!0),g._matrix.prepend(this._matrix),g.rotate(l.subtract(p).getAngle()+90),(a===b||a)&&g.insertAbove(this),g}return null},toPath:"#clone",_hitTestSelf:function(a,b,c,d){function e(b,c){return 1>=a.subtract(b).divide(c).length}function f(a,c,d){if(!b.selected||c.isSelected()){var f=a._point;if(c!==f&&(c=c.add(f)),e(c,Ma))return new na(d,
K,{segment:a,point:c})}}function g(a,c){return(c||b.segments)&&f(a,a._point,"segment")||!c&&b.handles&&(f(a,a._handleIn,"handle-in")||f(a,a._handleOut,"handle-out"))}function h(a){p.add(a)}function k(b){if(("round"!==m||"round"!==l)&&(p=new O({internal:!0,closed:!0}),x||0<b._index&&b._index<v-1?"round"!==m&&(b._handleIn.isZero()||b._handleOut.isZero())&&O._addBevelJoin(b,m,G,n,null,d,h,!0):"round"!==l&&O._addSquareCap(b,l,G,null,d,h,!0),!p.isEmpty())){var c;return p.contains(a)||(c=p.getNearestLocation(a))&&
e(c.getPoint(),y)}return e(b._point,Ma)}var m,l,n,p,q,r,K=this,u=this.getStyle();c=this._segments;var v=c.length,x=this._closed,y=b._tolerancePadding,Ma=y,w=b.stroke&&u.hasStroke(),A=b.fill&&u.hasFill(),L=b.curves,G=w?u.getStrokeWidth()/2:A&&0<b.tolerance||L?0:null;if(null!==G&&(0<G?(m=u.getStrokeJoin(),l=u.getStrokeCap(),n=G*u.getMiterLimit(),Ma=Ma.add(O._getStrokePadding(G,d))):m=l="round"),!b.ends||b.segments||x){if(b.segments||b.handles)for(u=0;u<v;u++)if(r=g(c[u]))return r}else if(r=g(c[0],!0)||
g(c[v-1],!0))return r;if(null!==G){if(q=this.getNearestLocation(a))u=q.getTime(),0===u||1===u&&1<v?k(q.getSegment())||(q=null):e(q.getPoint(),Ma)||(q=null);if(!q&&"miter"===m&&1<v)for(u=0;u<v;u++)if(r=c[u],a.getDistance(r._point)<=n&&k(r)){q=r.getLocation();break}}return!q&&A&&this._contains(a)||q&&!w&&!L?new na("fill",this):q?new na(w?"stroke":"curve",this,{location:q,point:q.getPoint()}):null}},e.each(z._evaluateMethods,function(a){this[a+"At"]=function(b){return(b=this.getLocationAt(b))&&b[a]()}},
{beans:!1,getLocationOf:function(){for(var a=n.read(arguments),b=this.getCurves(),c=0,d=b.length;c<d;c++){var e=b[c].getLocationOf(a);if(e)return e}return null},getOffsetOf:function(){var a=this.getLocationOf.apply(this,arguments);return a?a.getOffset():null},getLocationAt:function(a){for(var b=this.getCurves(),c=0,d=0,e=b.length;d<e;d++){var f=c,g=b[d];if(c+=g.getLength(),c>a)return g.getLocationAt(a-f)}return 0<b.length&&a<=this.getLength()?new U(b[b.length-1],1):null}}),new function(){function a(a,
b,c,d){function e(b){var c=k[b];b=k[b+1];f==c&&g==b||(a.beginPath(),a.moveTo(f,g),a.lineTo(c,b),a.stroke(),a.beginPath(),a.arc(c,b,h,0,2*Math.PI,!0),a.fill())}for(var f,g,h=d/2,k=Array(6),m=0,l=b.length;m<l;m++){var n=b[m],p=n._selection;(n._transformCoordinates(c,k),f=k[0],g=k[1],2&p&&e(2),4&p&&e(4),a.fillRect(f-h,g-h,d,d),1&p)||(n=a.fillStyle,a.fillStyle="#ffffff",a.fillRect(f-h+1,g-h+1,d-2,d-2),a.fillStyle=n)}}function b(a,b,c){function d(b){if(c)b._transformCoordinates(c,r),e=r[0],f=r[1];else{var d=
b._point;e=d._x;f=d._y}I?(a.moveTo(e,f),I=!1):(c?(k=r[2],m=r[3]):(d=b._handleIn,k=e+d._x,m=f+d._y),k===e&&m===f&&l===g&&n===h?a.lineTo(e,f):a.bezierCurveTo(l,n,k,m,e,f));(g=e,h=f,c)?(l=r[4],n=r[5]):(d=b._handleOut,l=g+d._x,n=h+d._y)}for(var e,f,g,h,k,m,l,n,p=b._segments,q=p.length,r=Array(6),I=!0,K=0;K<q;K++)d(p[K]);b._closed&&0<q&&d(p[0])}return{_draw:function(a,c,d,e){function f(a){return n[(a%p+p)%p]}var g=c.dontStart,h=c.dontFinish||c.clip,k=this.getStyle(),m=k.hasFill(),l=k.hasStroke(),n=k.getDashArray(),
p=!paper.support.nativeDash&&l&&n&&n.length;if(g||a.beginPath(),(m||l&&!p||h)&&(b(a,this,e),this._closed&&a.closePath()),!h&&(m||l)&&(this._setStyles(a,c,d),m&&(a.fill(k.getFillRule()),a.shadowColor="rgba(0,0,0,0)"),l)){if(p){g||a.beginPath();c=new ua(this,.25,32,!1,e);d=c.length;e=-k.getDashOffset();g=0;for(e%=d;0<e;)e-=f(g--)+f(g--);for(;e<d;)k=e+f(g++),(0<e||0<k)&&c.drawPart(a,Math.max(e,0),Math.max(k,0)),e=k+f(g++)}a.stroke()}},_drawSelected:function(c,d){c.beginPath();b(c,this,d);c.stroke();
a(c,this._segments,d,paper.settings.handleSize)}}},new function(){function a(a){a=a._segments;if(0===a.length)throw Error("Use a moveTo() command first");return a[a.length-1]}return{moveTo:function(){var a=this._segments;1===a.length&&this.removeSegment(0);a.length||this._add([new H(n.read(arguments))])},moveBy:function(){throw Error("moveBy() is unsupported on Path items.");},lineTo:function(){this._add([new H(n.read(arguments))])},cubicCurveTo:function(){var b=n.read(arguments),c=n.read(arguments),
d=n.read(arguments),e=a(this);e.setHandleOut(b.subtract(e._point));this._add([new H(d,c.subtract(d))])},quadraticCurveTo:function(){var b=n.read(arguments),c=n.read(arguments),d=a(this)._point;this.cubicCurveTo(b.add(d.subtract(b).multiply(1/3)),b.add(c.subtract(b).multiply(1/3)),c)},curveTo:function(){var b=n.read(arguments),c=n.read(arguments),d=e.pick(e.read(arguments),.5),f=1-d,g=a(this)._point;b=b.subtract(g.multiply(f*f)).subtract(c.multiply(d*d)).divide(2*d*f);if(b.isNaN())throw Error("Cannot put a curve through points with parameter = "+
d);this.quadraticCurveTo(b,c)},arcTo:function(){var b=a(this),c=b._point,d=n.read(arguments),f=e.peek(arguments);f=e.pick(f,!0);if("boolean"==typeof f){var g=c.add(d).divide(2);var k=g.add(g.subtract(c).rotate(f?-90:90))}else if(2>=e.remain(arguments))k=d,d=n.read(arguments);else{var m=q.read(arguments);var l=h.isZero;if(l(m.width)||l(m.height))return this.lineTo(d);var p=e.read(arguments);f=!!e.read(arguments);l=!!e.read(arguments);g=c.add(d).divide(2);var r=c.subtract(g).rotate(-p);var u=r.x;var v=
r.y,x=Math.abs;r=x(m.width);m=x(m.height);var w=r*r,G=m*m,L=u*u,D=v*v,Ea=Math.sqrt(L/w+D/G);if(1<Ea&&(r*=Ea,m*=Ea,w=r*r,G=m*m),Ea=(w*G-w*D-G*L)/(w*D+G*L),1E-12>x(Ea)&&(Ea=0),0>Ea)throw Error("Cannot create an arc with the given arguments");l=(new n(r*v/m,-m*u/r)).multiply((l===f?-1:1)*Math.sqrt(Ea)).rotate(p).add(g);p=(new A).translate(l).rotate(p).scale(r,m);u=p._inverseTransform(c);r=u.getDirectedAngle(p._inverseTransform(d));!f&&0<r?r-=360:f&&0>r&&(r+=360)}if(k){u=new y(c.add(k).divide(2),k.subtract(c).rotate(90),
!0);g=new y(k.add(d).divide(2),d.subtract(k).rotate(90),!0);f=new y(c,d);k=f.getSide(k);if(l=u.intersect(g,!0),!l){if(!k)return this.lineTo(d);throw Error("Cannot create an arc with the given arguments");}u=c.subtract(l);r=u.getDirectedAngle(d.subtract(l));c=f.getSide(l);0===c?r=k*Math.abs(r):k===c&&(r+=0>r?360:-360)}c=Math.abs(r);c=360<=c?4:Math.ceil(c/90);k=r/c;f=k*Math.PI/360;f=4/3*Math.sin(f)/(1+Math.cos(f));g=[];for(v=0;v<=c;v++)r=d,x=null,(v<c&&(x=u.rotate(90).multiply(f),p?(r=p._transformPoint(u),
x=p._transformPoint(u.add(x)).subtract(r)):r=l.add(u)),0===v)?b.setHandleOut(x):(m=u.rotate(-90).multiply(f),p&&(m=p._transformPoint(u.add(m)).subtract(r)),g.push(new H(r,m,x))),u=u.rotate(k);this._add(g)},lineBy:function(){var b=n.read(arguments),c=a(this)._point;this.lineTo(c.add(b))},curveBy:function(){var b=n.read(arguments),c=n.read(arguments),d=e.read(arguments),f=a(this)._point;this.curveTo(f.add(b),f.add(c),d)},cubicCurveBy:function(){var b=n.read(arguments),c=n.read(arguments),d=n.read(arguments),
e=a(this)._point;this.cubicCurveTo(e.add(b),e.add(c),e.add(d))},quadraticCurveBy:function(){var b=n.read(arguments),c=n.read(arguments),d=a(this)._point;this.quadraticCurveTo(d.add(b),d.add(c))},arcBy:function(){var b=a(this)._point,c=b.add(n.read(arguments)),d=e.pick(e.peek(arguments),!0);"boolean"==typeof d?this.arcTo(c,d):this.arcTo(c,b.add(n.read(arguments)))},closePath:function(a){this.setClosed(!0);this.join(this,a)}}},{_getBounds:function(a,b){return O[b.handle?"getHandleBounds":b.stroke?"getStrokeBounds":
"getBounds"](this._segments,this._closed,this,a,b)},statics:{getBounds:function(a,b,c,d,e,f){function g(a){a._transformCoordinates(d,h);for(a=0;2>a;a++)z._addBounds(k[a],k[a+4],h[a+2],h[a],a,f?f[a]:0,m,l,n);a=k;k=h;h=a}c=a[0];if(!c)return new r;var h=Array(6),k=c._transformCoordinates(d,Array(6)),m=k.slice(0,2),l=m.slice(),n=Array(2);e=1;for(var p=a.length;e<p;e++)g(a[e]);return b&&g(c),new r(m[0],m[1],l[0]-m[0],l[1]-m[1])},getStrokeBounds:function(a,b,c,d,e){function f(a){u=u.include(a)}function g(a,
b){var c=a._handleIn,e=a._handleOut;"round"===b||!c.isZero()&&!e.isZero()&&c.isCollinear(e)?u=u.unite(K.setCenter(a._point.transform(d))):O._addBevelJoin(a,b,I,v,d,n,f)}function h(a,b){"round"===b?u=u.unite(K.setCenter(a._point.transform(d))):O._addSquareCap(a,b,I,d,n,f)}var k=c.getStyle(),m=k.hasStroke(),l=k.getStrokeWidth(),n=m&&c._getStrokeMatrix(d,e),p=m&&O._getStrokePadding(l,n),u=O.getBounds(a,b,c,d,e,p);if(!m)return u;var I=l/2;c=k.getStrokeJoin();e=k.getStrokeCap();var v=I*k.getMiterLimit(),
K=new r(new q(p));k=a.length-(b?0:1);for(p=1;p<k;p++)g(a[p],c);return b?g(a[0],c):0<k&&(h(a[0],e),h(a[a.length-1],e)),u},_getStrokePadding:function(a,b){if(!b)return[a,a];var c=(new n(a,0)).transform(b),d=(new n(0,a)).transform(b),e=c.getAngleInRadians();c=c.getLength();d=d.getLength();var f=Math.sin(e),g=Math.cos(e),h=Math.tan(e);e=Math.atan2(d*h,c);h=Math.atan2(d,h*c);return[Math.abs(c*Math.cos(e)*g+d*Math.sin(e)*f),Math.abs(d*Math.sin(h)*g+c*Math.cos(h)*f)]},_addBevelJoin:function(a,b,c,d,e,f,
g,h){var k=a.getCurve(),m=k.getPrevious();a=k.getPointAtTime(0);m=m.getNormalAtTime(1);k=k.getNormalAtTime(0);c=0>m.getDirectedAngle(k)?-c:c;if((m.setLength(c),k.setLength(c),e&&e._transformPoint(a,a),f&&(f._transformPoint(m,m),f._transformPoint(k,k)),h&&(g(a),g(a.add(m))),"miter"===b)&&(b=(new y(a.add(m),new n(-m.y,m.x),!0)).intersect(new y(a.add(k),new n(-k.y,k.x),!0),!0))&&a.getDistance(b)<=d&&(g(b),!h))return;h||g(a.add(m));g(a.add(k))},_addSquareCap:function(a,b,c,d,e,f,g){var h=a._point;a=a.getLocation();
c=a.getNormal().multiply(c);d&&d._transformPoint(h,h);e&&e._transformPoint(c,c);g&&(f(h.subtract(c)),f(h.add(c)));"square"===b&&(h=h.add(c.rotate(0===a.getTime()?-90:90)));f(h.add(c));f(h.subtract(c))},getHandleBounds:function(a,b,c,d,e){var f;b=c.getStyle();if(e.stroke&&b.hasStroke()){var g=c._getStrokeMatrix(d,e);c=f=b.getStrokeWidth()/2;"miter"===b.getStrokeJoin()&&(c=f*b.getMiterLimit());"square"===b.getStrokeCap()&&(c=Math.max(c,f*Math.sqrt(2)));f=O._getStrokePadding(f,g);g=O._getStrokePadding(c,
g)}b=Array(6);c=1/0;e=-c;for(var h=c,k=e,m=0,l=a.length;m<l;m++){a[m]._transformCoordinates(d,b);for(var n=0;6>n;n+=2){var p=0===n?g:f,q=p?p[0]:0,u=p?p[1]:0,v=b[n],I=b[n+1];p=v-q;q=v+q;v=I-u;u=I+u;p<c&&(c=p);q>e&&(e=q);v<h&&(h=v);u>k&&(k=u)}}return new r(c,h,e-c,k-h)}}});O.inject({statics:new function(){function a(a,b,c){c=e.getNamed(c);var d=new O(c&&!1===c.insert&&B.NO_INSERT);return d._add(a),d._closed=b,d.set(c)}function b(b,d,e){for(var f=Array(4),g=0;4>g;g++){var h=c[g];f[g]=new H(h._point.multiply(d).add(b),
h._handleIn.multiply(d),h._handleOut.multiply(d))}return a(f,!0,e)}var c=[new H([-1,0],[0,.5522847498307936],[0,-.5522847498307936]),new H([0,-1],[-.5522847498307936,0],[.5522847498307936,0]),new H([1,0],[0,-.5522847498307936],[0,.5522847498307936]),new H([0,1],[.5522847498307936,0],[-.5522847498307936,0])];return{Line:function(){return a([new H(n.readNamed(arguments,"from")),new H(n.readNamed(arguments,"to"))],!1,arguments)},Circle:function(){var a=n.readNamed(arguments,"center"),c=e.readNamed(arguments,
"radius");return b(a,new q(c),arguments)},Rectangle:function(){var b=r.readNamed(arguments,"rectangle"),c=q.readNamed(arguments,"radius",0,{readNull:!0});var d=b.getBottomLeft(!0);var e=b.getTopLeft(!0),f=b.getTopRight(!0),g=b.getBottomRight(!0);if(!c||c.isZero())d=[new H(d),new H(e),new H(f),new H(g)];else{c=q.min(c,b.getSize(!0).divide(2));b=c.width;c=c.height;var h=.5522847498307936*b,k=.5522847498307936*c;d=[new H(d.add(b,0),null,[-h,0]),new H(d.subtract(0,c),[0,k]),new H(e.add(0,c),null,[0,-k]),
new H(e.add(b,0),[-h,0],null),new H(f.subtract(b,0),null,[h,0]),new H(f.add(0,c),[0,-k],null),new H(g.subtract(0,c),null,[0,k]),new H(g.subtract(b,0),[h,0])]}return a(d,!0,arguments)},RoundRectangle:"#Rectangle",Ellipse:function(){var a=x._readEllipse(arguments);return b(a.center,a.radius,arguments)},Oval:"#Ellipse",Arc:function(){var a=n.readNamed(arguments,"from"),b=n.readNamed(arguments,"through"),c=n.readNamed(arguments,"to"),d=e.getNamed(arguments),f=new O(d&&!1===d.insert&&B.NO_INSERT);return f.moveTo(a),
f.arcTo(b,c),f.set(d)},RegularPolygon:function(){var b=n.readNamed(arguments,"center"),c=e.readNamed(arguments,"sides"),d=e.readNamed(arguments,"radius"),f=360/c,g=0===c%3;d=new n(0,g?-d:d);g=g?-1:.5;for(var h=Array(c),k=0;k<c;k++)h[k]=new H(b.add(d.rotate((k+g)*f)));return a(h,!0,arguments)},Star:function(){for(var b=n.readNamed(arguments,"center"),c=2*e.readNamed(arguments,"points"),d=e.readNamed(arguments,"radius1"),f=e.readNamed(arguments,"radius2"),g=360/c,h=new n(0,-1),k=Array(c),m=0;m<c;m++)k[m]=
new H(b.add(h.rotate(g*m).multiply(m%2?f:d)));return a(k,!0,arguments)}}}});var L=ia.extend({_class:"CompoundPath",_serializeFields:{children:[]},initialize:function(a){this._children=[];this._namedChildren={};this._initialize(a)||("string"==typeof a?this.setPathData(a):this.addChildren(Array.isArray(a)?a:arguments))},insertChildren:function I(a,c,d){for(var e=c.length-1;0<=e;e--){var f=c[e];f instanceof L&&(c=c.slice(),c.splice.apply(c,[e,1].concat(f.removeChildren())),f.remove())}c=I.base.call(this,
a,c,d,O);e=0;for(a=!d&&c&&c.length;e<a;e++)f=c[e],f._clockwise===b&&f.setClockwise(0===f._index);return c},reduce:function K(a){for(var b=this._children,c=b.length-1;0<=c;c--){var d=b[c].reduce(a);d.isEmpty()&&d.remove()}return 0===b.length?(d=new O(B.NO_INSERT),d.copyAttributes(this),d.insertAbove(this),this.remove(),d):K.base.call(this)},isClockwise:function(){var a=this.getFirstChild();return a&&a.isClockwise()},setClockwise:function(a){this.isClockwise()^!!a&&this.reverse()},getFirstSegment:function(){var a=
this.getFirstChild();return a&&a.getFirstSegment()},getLastSegment:function(){var a=this.getLastChild();return a&&a.getLastSegment()},getCurves:function(){for(var a=this._children,b=[],c=0,d=a.length;c<d;c++)b.push.apply(b,a[c].getCurves());return b},getFirstCurve:function(){var a=this.getFirstChild();return a&&a.getFirstCurve()},getLastCurve:function(){var a=this.getLastChild();return a&&a.getFirstCurve()},getArea:function(){for(var a=this._children,b=0,c=0,d=a.length;c<d;c++)b+=a[c].getArea();return b}},
{beans:!0,getPathData:function(a,b){for(var c=this._children,d=[],e=0,f=c.length;e<f;e++){var g=c[e],h=g._matrix;d.push(g.getPathData(a&&!h.isIdentity()?a.appended(h):a,b))}return d.join(" ")}},{_hitTestChildren:function V(a,b,c){return V.base.call(this,a,b["class"]===O||"path"===b.type?b:e.set({},b,{fill:!1}),c)},_draw:function(a,b,c,d){var e=this._children;if(0!==e.length){b=b.extend({dontStart:!0,dontFinish:!0});a.beginPath();for(var f=0,g=e.length;f<g;f++)e[f].draw(a,b,d);b.clip||(this._setStyles(a,
b,c),b=this._style,b.hasFill()&&(a.fill(b.getFillRule()),a.shadowColor="rgba(0,0,0,0)"),b.hasStroke()&&a.stroke())}},_drawSelected:function(a,b,c){for(var d=this._children,e=0,f=d.length;e<f;e++){var g=d[e],h=g._matrix;c[g._id]||g._drawSelected(a,h.isIdentity()?b:b.appended(h))}}},new function(){function a(a,b){var c=a._children;if(b&&0===c.length)throw Error("Use a moveTo() command first");return c[c.length-1]}return e.each("lineTo cubicCurveTo quadraticCurveTo curveTo arcTo lineBy cubicCurveBy quadraticCurveBy curveBy arcBy".split(" "),
function(b){this[b]=function(){var c=a(this,!0);c[b].apply(c,arguments)}},{moveTo:function(){var b=a(this),c=b&&b.isEmpty()?b:new O(B.NO_INSERT);c!==b&&this.addChild(c);c.moveTo.apply(c,arguments)},moveBy:function(){var b=a(this,!0);b=b&&b.getLastSegment();var c=n.read(arguments);this.moveTo(b?c.add(b._point):c)},closePath:function(b){a(this,!0).closePath(b)}})},e.each(["reverse","flatten","simplify","smooth"],function(a){this[a]=function(b){for(var c,d=this._children,e=0,f=d.length;e<f;e++)c=d[e][a](b)||
c;return c}},{}));ia.inject(new function(){function a(a,b){var c=a.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);return b?c.resolveCrossings():c}function b(a,b,c,d,e){a=new a(B.NO_INSERT);return a.addChildren(b,!0),c&&(a=a.reduce({simplify:!0})),a.insertAbove(e&&d.isSibling(e)&&d.getIndex()<e.getIndex()?e:d),a.copyAttributes(d,!0),a}function c(c,e,f){function h(a){for(var b=0,c=a.length;b<c;b++){var d=a[b];r.push.apply(r,d._segments);u.push.apply(u,d._getMonoCurves());d._overlapsOnly=d._validOverlapsOnly=
!0}}var k=p[f];if(k[f]=!0,!c._children&&!c._closed)return d(c,e,k);f=a(c,!0);var n=e&&c!==e&&a(e,!0);n&&(k.subtract||k.exclude)^n.isClockwise()^f.isClockwise()&&n.reverse();var q=g(U.expand(f.getCrossings(n))),r=[],u=[];h(f._children||[f]);n&&h(n._children||[n]);for(var v=0,Q=q.length;v<Q;v++)m(q[v]._segment,f,n,u,k);v=0;for(Q=r.length;v<Q;v++){q=r[v];var x=q._intersection;(null==q._winding&&m(q,f,n,u,k),x&&x._overlap)||(x=q._path,x._overlapsOnly=!1,k[q._winding]&&(x._validOverlapsOnly=!1))}return b(L,
l(r,k),!0,c,e)}function d(c,d,e){function f(a){if(h.contains(a.getPointAt(a.getLength()/2))^m)return l.unshift(a),!0}if(!d||!d._children&&!d._closed||!e.subtract&&!e.intersect)return null;var g=a(c,!1),h=a(d,!1),k=g.getCrossings(h),m=e.subtract,l=[];for(e=k.length-1;0<=e;e--){var n=k[e].split();n&&(f(n)&&n.getFirstSegment().setHandleIn(0,0),g.getLastSegment().setHandleOut(0,0))}return f(g),b(w,l,!1,c,d)}function f(a,b){for(var c=a;c;){if(c===b)return;c=c._previous}for(;a._next&&a._next!==b;)a=a._next;
if(!a._next){for(;b._previous;)b=b._previous;a._next=b;b._previous=a}}function g(a,b){for(var c,d,e=b&&[],g=!1,h=[],k=a.length-1;0<=k;k--){var m=a[k];if(b){if(!b(m))continue;e.unshift(m)}var l=m._curve,n=m._time,p=n;(l!==c?g=!l.hasHandles():4E-7<=d&&.9999996>=d&&(n/=d),4E-7>n)?d=l._segment1:.9999996<n?d=l._segment2:(c=l.divideAtTime(n,!0),g&&h.push(l,c),d=c._segment1);m._setSegment(d);c=d._intersection;m=m._intersection;if(c)for(f(c,m),m=c;m;)f(m._intersection,c),m=m._next;else d._intersection=m;
c=l;d=p}k=0;for(g=h.length;k<g;k++)h[k].clearHandles();return e||a}function k(a,b,c){var d=a.x;a=a.y;var e=0,f=0,g=b.length,h=[],m=Math.abs;if(c){var l=-(1/0),p=1/0,q=a-2E-7,r=a+2E-7;for(c=0;c<g;c++)for(var u=b[c].values,v=z.solveCubic(u,0,d,h,0,1)-1;0<=v;v--){var Q=z.getPoint(u,h[v]).y;Q<q&&Q>l?l=Q:Q>r&&Q<p&&(p=Q)}l=(l+a)/2;p=(p+a)/2;l>-(1/0)&&(e=k(new n(d,l),b).winding);p<1/0&&(f=k(new n(d,p),b).winding)}else{q=d-2E-7;r=d+2E-7;Q=v=0;var x=!1;for(c=0;c<g;c++){var J=b[c],P=J.winding;u=J.values;var K=
u[1],V=u[7];if(J.last&&(l=J.last.winding,p=J.last.values[6],x=!1),a>=K&&a<=V||a>=V&&a<=K)P?(J=a===K?u[0]:a===V?u[6]:1===z.solveCubic(u,1,a,h,0,1)?z.getPoint(u,h[0]).x:null,null!=J&&(J>=q&&J<=r?x=!0:a===K&&P===l||a===K&&0>(d-J)*(d-p)||(J<q?e+=P:J>r&&(f+=P))),l=P,p=u[6]):0>=(d-u[0])*(d-u[6])&&(x=!0);x&&(c>=g-1||b[c+1].last)&&(v+=1,--Q)}0===e&&0===f&&(e=v,f=Q)}return{winding:Math.max(m(e),m(f)),contour:!e^!f}}function m(a,b,c,d,e){var f=[],g=a,h=0;do{var m=a.getCurve(),l=m.getLength();f.push({segment:a,
curve:m,length:l});h+=l;a=a.getNext()}while(a&&!a._intersection&&a!==g);l=h/2;m=0;for(a=f.length;m<a;m++){g=f[m];h=g.length;if(l<=h){m=g.curve;var n=m._path;a=n._parent;g=m.getTimeAt(l);l=m.getPointAtTime(g);m=1E-7>Math.abs(m.getTangentAtTime(g).y);a instanceof L&&(n=a);n=e.subtract&&c&&(n===b&&c._getWinding(l,m)||n===c&&!b._getWinding(l,m))?{winding:0}:k(l,d,m);break}l-=h}for(m=f.length-1;0<=m;m--)b=f[m].segment,b._winding=n.winding,b._contour=n.contour}function l(a,b){function c(a,c){return!(!a||
a._visited||!(!b||b[a._winding]||!c&&b.unite&&a._contour))}function d(a,d){if(!a._next)return a;for(;a;){var e=a._segment,h=e.getNext(),k=h&&h._intersection;if(e!==d&&(e===f||e===g||h===f||h===g||!e._visited&&!h._visited&&(!b||c(e)&&(c(h)||k&&c(k._segment)))))return a;a=a._next}return null}for(var f,g,k=[],m=0,l=a.length;m<l;m++){var n=null,p=!1,q=a[m],r=q._intersection;if(!q._visited&&q._path._overlapsOnly){var u=q._path,v=u._segments,Q=r._segment._path._segments;if(e.equals(v,Q)){(b.unite||b.intersect)&&
u.getArea()&&k.push(u.clone(!1));u=0;for(var x=v.length;u<x;u++)v[u]._visited=Q[u]._visited=!0}}if(c(q,!0)&&(q._path._validOverlapsOnly||!r||!r._overlap)){for(f=g=null;;){r=(r=r&&d(r,q)||r)&&r._segment;if(q===f||q===g?p=!0:r&&(r===f||r===g?(p=!0,q=r):c(r,c(q,!0))&&(b&&(b.intersect||b.subtract)&&(q._visited=!0),q=r)),p||q._visited){q._visited=!0;break}if(q._path._validOverlapsOnly&&!c(q))break;n||(n=new O(B.NO_INSERT),f=q,g=r);r=q.getNext();n.add(new H(q._point,J,r&&q._handleOut));q._visited=!0;q=
r||q._path.getFirstSegment();var J=r&&r._handleIn;r=q._intersection}p?(n.firstSegment.setHandleIn(J),n.setClosed(!0)):n&&(p=n.getArea(!0),2E-7<=Math.abs(p)&&console.error("Boolean operation resulted in open path","segments =",n._segments.length,"length =",n.getLength(),"area=",p),n=null);n&&(8<n._segments.length||!h.isZero(n.getArea()))&&(k.push(n),n=null)}}return k}var p={unite:{1:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0}};return{_getWinding:function(a,b){return k(a,this._getMonoCurves(),
b).winding},unite:function(a){return c(this,a,"unite")},intersect:function(a){return c(this,a,"intersect")},subtract:function(a){return c(this,a,"subtract")},exclude:function(a){return c(this,a,"exclude")},divide:function(a){return b(w,[this.subtract(a),this.intersect(a)],!0,this,a)},resolveCrossings:function(){function a(a){return(a=a&&a._intersection)&&a._overlap}var b=this._children,c=b||[this],d=!1,f=!1,h=this.getIntersections(null,function(a){return a._overlap&&(d=!0)||a.isCrossing()&&(f=!0)});
if(h=U.expand(h),d)for(var k=g(h,function(a){return a._overlap}),m=k.length-1;0<=m;m--){var n=k[m]._segment,p=n.getPrevious(),q=n.getNext();n._path&&a(p)&&a(q)&&(n.remove(),p._handleOut.set(0,0),q._handleIn.set(0,0),n=p.getCurve(),n.isStraight()&&0===n.getLength()&&p.remove())}f&&(g(h,d&&function(a){var b=a.getCurve(),c=a._intersection._curve;a=a._segment;return!!(b&&c&&b._path&&c._path)||void(a&&(a._intersection=null))}),c=l(e.each(c,function(a){this.push.apply(this,a._segments)},[])));var r;h=c.length;
if(1<h){c=c.slice().sort(function(a,b){return b.getBounds().getArea()-a.getBounds().getArea()});k=c[0];p=[k];n={};var u=(q="nonzero"===this.getFillRule())&&e.each(c,function(a){this.push(a.isClockwise()?1:-1)},[]);for(m=1;m<h;m++){for(var v=c[m],Q=v.getInteriorPoint(),x=!1,J=null,P=!1,K=m-1;0<=K&&!J;K--)if(c[K].contains(Q)){if(q&&!x&&(u[m]+=u[K],u[m]&&u[K])){P=n[m]=!0;break}x=!0;J=!n[K]&&c[K]}P||(v.setClockwise(J?!J.isClockwise():k.isClockwise()),p.push(v))}c=p;h=p.length}return 1<h&&b?(c!==b&&this.setChildren(c,
!0),r=this):1!==h||b||(c[0]!==this&&this.setSegments(c[0].removeSegments()),r=this),r||(r=new L(B.NO_INSERT),r.addChildren(c,!0),r=r.reduce(),r.copyAttributes(this),this.replaceWith(r)),r}}});O.inject({_getMonoCurves:function(){function a(a){var b=a[1],e=a[7];b=2E-7>Math.abs((b-e)/(a[0]-a[6]))?0:b>e?-1:1;a={values:a,winding:b};d.push(a);b&&(c=a)}function b(b){if(0!==z.getLength(b)){var c=b[1],d=b[3],e=b[5],f=b[7];if(z.isStraight(b)||c>=d==d>=e&&d>=e==e>=f)a(b);else{var g=[];c=h.solveQuadratic(3*(d-
e)-c+f,2*(c+e)-4*d,d-c,g,4E-7,.9999996);1>c?a(b):(g.sort(),d=g[0],b=z.subdivide(b,d),a(b[0]),1<c&&(d=(g[1]-d)/(1-d),b=z.subdivide(b[1],d),a(b[0])),a(b[1]))}}}var c,d=this._monoCurves;if(!d){d=this._monoCurves=[];for(var e=this.getCurves(),f=this._segments,g=0,k=e.length;g<k;g++)b(e[g].getValues());!this._closed&&1<f.length&&(g=f[f.length-1]._point,e=f[0]._point,f=g._x,g=g._y,k=e._x,e=e._y,b([f,g,f,g,k,e,k,e]));0<d.length&&(d[0].last=c)}return d},getInteriorPoint:function(){var a=this.getBounds().getCenter(!0);
if(!this.contains(a)){for(var b=this._getMonoCurves(),c=[],d=a.y,e=[],f=0,g=b.length;f<g;f++){var h=b[f].values;if(1===b[f].winding&&d>h[1]&&d<=h[7]||d>=h[7]&&d<h[1])for(var k=z.solveCubic(h,1,d,c,0,1)-1;0<=k;k--)e.push(z.getPoint(h,c[k]).x)}e.sort(function(a,b){return a-b});a.x=(e[0]+e[1])/2}return a}});L.inject({_getMonoCurves:function(){for(var a=this._children,b=[],c=0,d=a.length;c<d;c++)b.push.apply(b,a[c]._getMonoCurves());return b}});var ua=e.extend({_class:"PathIterator",initialize:function(a,
b,c,d,e){function f(a,b){var c=z.getValues(a,b,e);h.push(c);g(c,a._index,0,1)}function g(a,c,e,f){if(!(f-e>l)||d&&z.isStraight(a)||z.isFlatEnough(a,b||.25)){e=a[6]-a[0];var h=a[7]-a[1];e=Math.sqrt(e*e+h*h);0<e&&(m+=e,k.push({offset:m,curve:a,index:c,time:f}))}else a=z.subdivide(a,.5),h=(e+f)/2,g(a[0],c,e,h),g(a[1],c,h,f)}var h=[],k=[],m=0,l=1/(c||32);c=a._segments;for(var n=c[0],p=1,q=c.length;p<q;p++){var r=c[p];f(n,r);n=r}a._closed&&f(r,c[0]);this.curves=h;this.parts=k;this.length=m;this.index=
0},_get:function(a){for(var b,c=this.index;b=c,!(0===c||this.parts[--c].offset<a););for(var d=this.parts.length;b<d;b++)if(c=this.parts[b],c.offset>=a)return this.index=b,b=(d=this.parts[b-1])&&d.index===c.index?d.time:0,d=d?d.offset:0,{index:c.index,time:b+(c.time-b)*(a-d)/(c.offset-d)};c=this.parts[this.parts.length-1];return{index:c.index,time:1}},drawPart:function(a,b,c){b=this._get(b);c=this._get(c);for(var d=b.index,e=c.index;d<=e;d++){var f=z.getPart(this.curves[d],d===b.index?b.time:0,d===
c.index?c.time:1);d===b.index&&a.moveTo(f[0],f[1]);a.bezierCurveTo.apply(a,f.slice(2))}}},e.each(z._evaluateMethods,function(a){this[a+"At"]=function(b){b=this._get(b);return z[a](this.curves[b.index],b.time)}},{})),W=e.extend({initialize:function(a){var b,c=this.points=[],d=a._segments;a=a._closed;for(var e=0,f=d.length;e<f;e++){var g=d[e].point;b&&b.equals(g)||c.push(b=g.clone())}a&&(c.unshift(c[c.length-1]),c.push(c[1]));this.closed=a},fit:function(a){var b=this.points,c=b.length,d=null;return 0<
c&&(d=[new H(b[0])],1<c&&(this.fitCubic(d,a,0,c-1,b[1].subtract(b[0]),b[c-2].subtract(b[c-1])),this.closed&&(d.shift(),d.pop()))),d},fitCubic:function(a,b,c,d,e,f){var g=this.points;if(1===d-c)return b=g[c],d=g[d],c=b.getDistance(d)/3,void this.addCurve(a,[b,b.add(e.normalize(c)),d.add(f.normalize(c)),d]);for(var h,k=this.chordLengthParameterize(c,d),m=Math.max(b,b*b),l=!0,n=0;4>=n;n++){var p=this.generateBezier(c,d,k,e,f),q=this.findMaxError(c,d,p,k);if(q.error<b&&l)return void this.addCurve(a,p);
if(h=q.index,q.error>=m)break;l=this.reparameterize(c,d,k,p);m=q.error}g=g[h-1].subtract(g[h+1]);this.fitCubic(a,b,c,h,e,g);this.fitCubic(a,b,h,d,g.negate(),f)},addCurve:function(a,b){a[a.length-1].setHandleOut(b[1].subtract(b[0]));a.push(new H(b[3],b[2].subtract(b[3])))},generateBezier:function(a,b,c,d,e){var f=Math.abs,g=this.points,h=g[a],k=g[b],m=[[0,0],[0,0]],l=[0,0],n=0;for(b=b-a+1;n<b;n++){var p=c[n],q=1-p,r=3*p*q,u=q*q*q;q*=r;r*=p;var v=p*p*p;p=d.normalize(q);var x=e.normalize(r);u=g[a+n].subtract(h.multiply(u+
q)).subtract(k.multiply(r+v));m[0][0]+=p.dot(p);m[0][1]+=p.dot(x);m[1][0]=m[0][1];m[1][1]+=x.dot(x);l[0]+=p.dot(u);l[1]+=x.dot(u)}a=m[0][0]*m[1][1]-m[1][0]*m[0][1];1E-12<f(a)?(f=m[0][0]*l[1]-m[1][0]*l[0],l=(l[0]*m[1][1]-l[1]*m[0][1])/a,f/=a):(a=m[0][0]+m[0][1],m=m[1][0]+m[1][1],l=f=1E-12<f(a)?l[0]/a:1E-12<f(m)?l[1]/m:0);m=k.getDistance(h);a=1E-12*m;if(l<a||f<a)l=f=m/3;else{a=k.subtract(h);var w=d.normalize(l);var y=e.normalize(f);w.dot(a)-y.dot(a)>m*m&&(l=f=m/3,w=y=null)}return[h,h.add(w||d.normalize(l)),
k.add(y||e.normalize(f)),k]},reparameterize:function(a,b,c,d){for(var e=a;e<=b;e++)c[e-a]=this.findRoot(d,this.points[e],c[e-a]);e=1;for(a=c.length;e<a;e++)if(c[e]<=c[e-1])return!1;return!0},findRoot:function(a,b,c){for(var d=[],e=[],f=0;2>=f;f++)d[f]=a[f+1].subtract(a[f]).multiply(3);for(f=0;1>=f;f++)e[f]=d[f+1].subtract(d[f]).multiply(2);a=this.evaluate(3,a,c);d=this.evaluate(2,d,c);e=this.evaluate(1,e,c);b=a.subtract(b);e=d.dot(d)+b.dot(e);return 1E-6>Math.abs(e)?c:c-b.dot(d)/e},evaluate:function(a,
b,c){b=b.slice();for(var d=1;d<=a;d++)for(var e=0;e<=a-d;e++)b[e]=b[e].multiply(1-c).add(b[e+1].multiply(c));return b[0]},chordLengthParameterize:function(a,b){for(var c=[0],d=a+1;d<=b;d++)c[d-a]=c[d-a-1]+this.points[d].getDistance(this.points[d-1]);d=1;for(var e=b-a;d<=e;d++)c[d]/=c[e];return c},findMaxError:function(a,b,c,d){for(var e=Math.floor((b-a+1)/2),f=0,g=a+1;g<b;g++){var h=this.evaluate(3,c,d[g-a]).subtract(this.points[g]);h=h.x*h.x+h.y*h.y;h>=f&&(f=h,e=g)}return{error:f,index:e}}}),Y=B.extend({_class:"TextItem",
_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(a){this._content="";this._lines=[];var c=a&&e.isPlainObject(a)&&a.x===b&&a.y===b;this._initialize(c&&a,!c&&n.read(arguments))},_equals:function(a){return this._content===a._content},copyContent:function(a){this.setContent(a._content)},getContent:function(){return this._content},setContent:function(a){this._content=""+a;this._lines=this._content.split(/\r\n|\n|\r/gm);this._changed(265)},
isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),X=Y.extend({_class:"PointText",initialize:function(){Y.apply(this,arguments)},getPoint:function(){var a=this._matrix.getTranslation();return new p(a.x,a.y,this,"setPoint")},setPoint:function(){var a=n.read(arguments);this.translate(a.subtract(this._matrix.getTranslation()))},_draw:function(a,b,c){if(this._content){this._setStyles(a,b,c);
b=this._lines;var d=this._style;c=d.hasFill();var e=d.hasStroke(),f=d.getLeading(),g=a.shadowColor;a.font=d.getFontStyle();a.textAlign=d.getJustification();d=0;for(var h=b.length;d<h;d++){a.shadowColor=g;var k=b[d];c&&(a.fillText(k,0,0),a.shadowColor="rgba(0,0,0,0)");e&&a.strokeText(k,0,0);a.translate(0,f)}}},_getBounds:function(a,b){var c=this._style,d=this._lines,e=d.length,f=c.getJustification(),g=c.getLeading();c=this.getView().getTextWidth(c.getFontStyle(),d);d=0;"left"!==f&&(d-=c/("center"===
f?2:1));e=new r(d,e?-.75*g:0,c,e*g);return a?a._transformBounds(e,e):e}}),fa=e.extend(new function(){var a,b={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},d={},f={},g=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],h={"rgb-hsb":function(a,b,c){var d=Math.max(a,b,c),e=d-Math.min(a,b,c);return[0===e?0:60*(d==a?(b-c)/e+(b<c?6:0):d==b?(c-a)/e+2:(a-b)/e+4),0===d?0:e/d,d]},
"hsb-rgb":function(a,b,c){a=(a/60%6+6)%6;var d=Math.floor(a);a-=d;d=g[d];b=[c,c*(1-b),c*(1-b*a),c*(1-b*(1-a))];return[b[d[0]],b[d[1]],b[d[2]]]},"rgb-hsl":function(a,b,c){var d=Math.max(a,b,c),e=Math.min(a,b,c),f=d-e,g=0===f,h=(d+e)/2;return[g?0:60*(d==a?(b-c)/f+(b<c?6:0):d==b?(c-a)/f+2:(a-b)/f+4),g?0:.5>h?f/(d+e):f/(2-d-e),h]},"hsl-rgb":function(a,b,c){if(a=(a/360%1+1)%1,0===b)return[c,c,c];a=[a+1/3,a,a-1/3];b=.5>c?c*(1+b):c+b-c*b;c=2*c-b;for(var d=[],e=0;3>e;e++){var f=a[e];0>f&&(f+=1);1<f&&--f;
d[e]=1>6*f?c+6*(b-c)*f:1>2*f?b:2>3*f?c+(b-c)*(2/3-f)*6:c}return d},"rgb-gray":function(a,b,c){return[.2989*a+.587*b+.114*c]},"gray-rgb":function(a){return[a,a,a]},"gray-hsb":function(a){return[0,0,a]},"gray-hsl":function(a){return[0,0,a]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return e.each(b,function(a,c){d[c]=[];e.each(a,function(a,f){var g=e.capitalize(a),h=/^(hue|saturation)$/.test(a),k=d[c][f]="gradient"===a?function(a){var b=this._components[0];return a=Pa.read(Array.isArray(a)?
a:arguments,0,{readNull:!0}),b!==a&&(b&&b._removeOwner(this),a&&a._addOwner(this)),a}:"gradient"===c?function(){return n.read(arguments,0,{readNull:"highlight"===a,clone:!0})}:function(a){return null==a||isNaN(a)?0:a};this["get"+g]=function(){return this._type===c||h&&/^hs[bl]$/.test(this._type)?this._components[f]:this._convert(c)[f]};this["set"+g]=function(a){this._type===c||h&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(c),this._properties=b[c],this._type=c);this._components[f]=
k.call(this,a);this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function ka(e){var g,h,k,m,l=Array.prototype.slice,n=arguments,p=this.__read,q=0;Array.isArray(e)&&(n=e,e=n[0]);var r=null!=e&&typeof e;if("string"===r&&e in b&&(g=e,e=n[1],Array.isArray(e)?(h=e,k=n[2]):(p&&(q=1),n=l.call(n,1),r=typeof e)),!h){if(m="number"===r?n:"object"===r&&null!=e.length?e:null)g||(g=3<=m.length?"rgb":"gray"),n=b[g].length,k=m[n],p&&(q+=m===arguments?n+(null!=k?1:0):1),m.length>n&&(m=l.call(m,0,n));
else if("string"===r){g="rgb";h=e;if(l=h.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/))for(h=[0,0,0],n=0;3>n;n++)r=l[n+1],h[n]=parseInt(1==r.length?r+r:r,16)/255;else if(l=h.match(/^rgba?\((.*)\)$/))for(h=l[1].split(","),n=0,l=h.length;n<l;n++)r=+h[n],h[n]=3>n?r/255:r;else c?(l=f[h],l||(a||(a=R.getContext(1,1),a.globalCompositeOperation="copy"),a.fillStyle="rgba(0,0,0,0)",a.fillStyle=h,a.fillRect(0,0,1,1),l=a.getImageData(0,0,1,1).data,l=f[h]=[l[0]/255,l[1]/255,l[2]/255]),h=l.slice()):h=[0,0,0];4===h.length&&
(k=h[3],h.length--)}else if("object"===r)if(e.constructor===ka){if(g=e._type,h=e._components.slice(),k=e._alpha,"gradient"===g)for(l=1,n=h.length;l<n;l++)(r=h[l])&&(h[l]=r.clone())}else if(e.constructor===Pa)g="gradient",m=n;else{g="hue"in e?"lightness"in e?"hsl":"hsb":"gradient"in e||"stops"in e||"radial"in e?"gradient":"gray"in e?"gray":"rgb";k=b[g];r=d[g];this._components=h=[];l=0;for(n=k.length;l<n;l++){var u=e[k[l]];null==u&&0===l&&"gradient"===g&&"stops"in e&&(u={stops:e.stops,radial:e.radial});
u=r[l].call(this,u);null!=u&&(h[l]=u)}k=e.alpha}p&&g&&(q=1)}if(this._type=g||"rgb",!h)for(this._components=h=[],r=d[this._type],l=0,n=r.length;l<n;l++)u=r[l].call(this,m&&m[l]),null!=u&&(h[l]=u);this._components=h;this._properties=b[this._type];this._alpha=k;p&&(this.__read=q)},_set:"#initialize",_serialize:function(a,b){var c=this.getComponents();return e.serialize(/^(gray|rgb)$/.test(this._type)?c:[this._type].concat(c),a,!0,b)},_changed:function(){this._canvasStyle=null;this._owner&&this._owner._changed(65)},
_convert:function(a){var b;return this._type===a?this._components.slice():(b=h[this._type+"-"+a])?b.apply(this,this._components):h["rgb-"+a].apply(this,h[this._type+"-rgb"].apply(this,this._components))},convert:function(a){return new fa(a,this._convert(a),this._alpha)},getType:function(){return this._type},setType:function(a){this._components=this._convert(a);this._properties=b[a];this._type=a},getComponents:function(){var a=this._components.slice();return null!=this._alpha&&a.push(this._alpha),
a},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(a){this._alpha=null==a?null:Math.min(Math.max(a,0),1);this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(a){var b=e.isPlainValue(a,!0)?fa.read(arguments):a;return b===this||b&&this._class===b._class&&this._type===b._type&&this._alpha===b._alpha&&e.equals(this._components,b._components)||!1},toString:function(){for(var a=this._properties,b=[],c="gradient"===this._type,d=l.instance,e=0,f=a.length;e<
f;e++){var g=this._components[e];null!=g&&b.push(a[e]+": "+(c?g:d.number(g)))}return null!=this._alpha&&b.push("alpha: "+d.number(this._alpha)),"{ "+b.join(", ")+" }"},toCSS:function(a){function b(a){return Math.round(255*(0>a?0:1<a?1:a))}var c=this._convert("rgb"),d=a||null==this._alpha?1:this._alpha;return c=[b(c[0]),b(c[1]),b(c[2])],1>d&&c.push(0>d?0:d),a?"#"+(16777216+(c[0]<<16)+(c[1]<<8)+c[2]).toString(16).slice(1):(4==c.length?"rgba(":"rgb(")+c.join(",")+")"},toCanvasStyle:function(a){if(this._canvasStyle)return this._canvasStyle;
if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var b=this._components,c=b[0],d=c._stops,e=b[1],f=b[2];if(c._radial){c=f.getDistance(e);if(b=b[3])f=b.subtract(e),f.getLength()>c&&(b=e.add(f.normalize(c-.1)));b=b||e;a=a.createRadialGradient(b.x,b.y,0,e.x,e.y,c)}else a=a.createLinearGradient(e.x,e.y,f.x,f.y);e=0;for(c=d.length;e<c;e++)b=d[e],a.addColorStop(b._offset||e/(c-1),b._color.toCanvasStyle());return this._canvasStyle=a},transform:function(a){if("gradient"===this._type){for(var b=
this._components,c=1,d=b.length;c<d;c++){var e=b[c];a._transformPoint(e,e,!0)}this._changed()}},statics:{_types:b,random:function(){var a=Math.random;return new fa(a(),a(),a())}}})},new function(){return e.each({add:function(a,b){return a+b},subtract:function(a,b){return a-b},multiply:function(a,b){return a*b},divide:function(a,b){return a/b}},function(a,b){this[b]=function(b){b=fa.read(arguments);for(var c=this._type,d=this._components,e=b._convert(c),f=0,g=d.length;f<g;f++)e[f]=a(d[f],e[f]);return new fa(c,
e,null!=this._alpha?a(this._alpha,b.getAlpha()):null)}},{})}),Pa=e.extend({_class:"Gradient",initialize:function(a,b){this._id=m.get();a&&this._set(a)&&(a=b=null);this._stops||this.setStops(a||["white","black"]);null==this._radial&&this.setRadial("string"==typeof b&&"radial"===b||b||!1)},_serialize:function(a,b){return b.add(this,function(){return e.serialize([this._stops,this._radial],a,!0,b)})},_changed:function(){for(var a=0,b=this._owners&&this._owners.length;a<b;a++)this._owners[a]._changed()},
_addOwner:function(a){this._owners||(this._owners=[]);this._owners.push(a)},_removeOwner:function(a){a=this._owners?this._owners.indexOf(a):-1;-1!=a&&(this._owners.splice(a,1),0===this._owners.length&&(this._owners=b))},clone:function(){for(var a=[],b=0,c=this._stops.length;b<c;b++)a[b]=this._stops[b].clone();return new Pa(a,this._radial)},getStops:function(){return this._stops},setStops:function(a){if(2>a.length)throw Error("Gradient stop list needs to contain at least two stops.");var c=this._stops;
if(c)for(var d=0,e=c.length;d<e;d++)c[d]._owner=b;c=this._stops=ta.readAll(a,0,{clone:!0});d=0;for(e=c.length;d<e;d++)c[d]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(a){this._radial=a;this._changed()},equals:function(a){if(a===this)return!0;if(a&&this._class===a._class){var b=this._stops;a=a._stops;var c=b.length;if(c===a.length){for(var d=0;d<c;d++)if(!b[d].equals(a[d]))return!1;return!0}}return!1}}),ta=e.extend({_class:"GradientStop",initialize:function(a,
c){var d=a,e=c;"object"==typeof a&&c===b&&(Array.isArray(a)&&"number"!=typeof a[0]?(d=a[0],e=a[1]):("color"in a||"offset"in a||"rampPoint"in a)&&(d=a.color,e=a.offset||a.rampPoint||0));this.setColor(d);this.setOffset(e)},clone:function(){return new ta(this._color.clone(),this._offset)},_serialize:function(a,b){var c=this._color,d=this._offset;return e.serialize(null==d?[c]:[c,d],a,!0,b)},_changed:function(){this._owner&&this._owner._changed(65)},getOffset:function(){return this._offset},setOffset:function(a){this._offset=
a;this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){var a=fa.read(arguments,0,{clone:!0});a&&(a._owner=this);this._color=a;this._changed()},equals:function(a){return a===this||a&&this._class===a._class&&this._color.equals(a._color)&&this._offset==a._offset||!1}}),wa=e.extend(new function(){var a={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,
dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new n,selectedColor:null},c=e.set({},a,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),d=e.set({},c,{fillColor:new fa}),f={strokeWidth:97,strokeCap:97,strokeJoin:97,strokeScaling:105,miterLimit:97,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},g={beans:!0},h={_class:"Style",beans:!0,initialize:function(b,e,f){this._values={};this._project=(this._owner=e)&&e._project||
f||paper.project;this._defaults=!e||e instanceof w?c:e instanceof Y?d:a;b&&this.set(b)}};return e.each(c,function(a,c){var d=/Color$/.test(c),k="shadowOffset"===c,m=e.capitalize(c),l=f[c],p="set"+m,q="get"+m;h[p]=function(a){var e=this._owner,f=e&&e._children;if(f&&0<f.length&&!(e instanceof L)){e=0;for(var g=f.length;e<g;e++)f[e]._style[p](a)}else c in this._defaults&&(f=this._values[c],f!==a&&(d&&(f&&f._owner!==b&&(f._owner=b),a&&a.constructor===fa&&(a._owner&&(a=a.clone()),a._owner=e)),this._values[c]=
a,e&&e._changed(l||65)))};h[q]=function(a){var f=this._owner,g=f&&f._children;if(c in this._defaults&&(!g||0===g.length||a||f instanceof L)){var h=this._values[c];h===b?(h=this._defaults[c])&&h.clone&&(h=h.clone()):(g=d?fa:k?n:null,!g||h&&h.constructor===g||(this._values[c]=h=g.read([h],0,{readNull:!0,clone:!0}),h&&d&&(h._owner=f)))}else if(g)for(f=0,a=g.length;f<a;f++){var m=g[f]._style[q]();if(0===f)h=m;else if(!e.equals(h,m))return b}return h};g[q]=function(a){return this._style[q](a)};g[p]=function(a){this._style[p](a)}}),
e.each({Font:"FontFamily",WindingRule:"FillRule"},function(a,b){var c="get"+b,d="set"+b;h[c]=g[c]="#get"+a;h[d]=g[d]="#set"+a}),B.inject(g),h},{set:function(a){var b=a instanceof wa;if(a=b?a._values:a)for(var c in a)if(c in this._defaults){var d=a[c];this[c]=d&&b&&d.clone?d.clone():d}},equals:function(a){return a===this||a&&this._class===a._class&&e.equals(this._values,a._values)||!1},hasFill:function(){var a=this.getFillColor();return!!a&&0<a.alpha},hasStroke:function(){var a=this.getStrokeColor();
return!!a&&0<a.alpha&&0<this.getStrokeWidth()},hasShadow:function(){var a=this.getShadowColor();return!!a&&0<a.alpha&&(0<this.getShadowBlur()||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var a=this.getFontSize();return this.getFontWeight()+" "+a+(/[a-z]/i.test(a+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function I(){var a=I.base.call(this),b=this.getFontSize();return/pt|em|%|px/.test(b)&&
(b=this.getView().getPixelSize(b)),null!=a?a:1.2*b}}),ha=new function(){function a(a,b,c,d){for(var e=" webkit moz Moz ms o".split(" "),f=b[0].toUpperCase()+b.substring(1),g=0;6>g;g++){var h=e[g];h=h?h+f:b;if(h in a){if(!c)return a[h];a[h]=d;break}}}return{getStyles:function(a){var b=a&&9!==a.nodeType?a.ownerDocument:a;return(b=b&&b.defaultView)&&b.getComputedStyle(a,"")},getBounds:function(a,b){var c=a.ownerDocument,d=c.body,e=c.documentElement;try{var f=a.getBoundingClientRect()}catch(aa){f={left:0,
top:0,width:0,height:0}}var g=f.left-(e.clientLeft||d.clientLeft||0),h=f.top-(e.clientTop||d.clientTop||0);b||(c=c.defaultView,g+=c.pageXOffset||e.scrollLeft||d.scrollLeft,h+=c.pageYOffset||e.scrollTop||d.scrollTop);return new r(g,h,f.width,f.height)},getViewportBounds:function(a){var b=a.ownerDocument;a=b.defaultView;b=b.documentElement;return new r(0,0,a.innerWidth||b.clientWidth,a.innerHeight||b.clientHeight)},getOffset:function(a,b){return ha.getBounds(a,b).getPoint()},getSize:function(a){return ha.getBounds(a,
!0).getSize()},isInvisible:function(a){return ha.getSize(a).equals(new q(0,0))},isInView:function(a){return!ha.isInvisible(a)&&ha.getViewportBounds(a).intersects(ha.getBounds(a,!0))},isInserted:function(a){return d.body.contains(a)},getPrefixed:function(b,c){return b&&a(b,c)},setPrefixed:function(b,c,d){if("object"==typeof c)for(var e in c)a(b,e,!0,c[e]);else a(b,c,!0,d)}}},ba={add:function(a,b){if(a)for(var c in b)for(var d=b[c],e=c.split(/[\s,]+/g),f=0,g=e.length;f<g;f++)a.addEventListener(e[f],
d,!1)},remove:function(a,b){if(a)for(var c in b)for(var d=b[c],e=c.split(/[\s,]+/g),f=0,g=e.length;f<g;f++)a.removeEventListener(e[f],d,!1)},getPoint:function(a){a=a.targetTouches?a.targetTouches.length?a.targetTouches[0]:a.changedTouches[0]:a;return new n(a.pageX||a.clientX+d.documentElement.scrollLeft,a.pageY||a.clientY+d.documentElement.scrollTop)},getTarget:function(a){return a.target||a.srcElement},getRelatedTarget:function(a){return a.relatedTarget||a.toElement},getOffset:function(a,b){return ba.getPoint(a).subtract(ha.getOffset(b||
ba.getTarget(a)))}};ba.requestAnimationFrame=new function(){function a(){var b=f;f=[];for(var c=0,g=b.length;c<g;c++)b[c]();(e=d&&f.length)&&d(a)}var b,d=ha.getPrefixed(c,"requestAnimationFrame"),e=!1,f=[];return function(c){f.push(c);d?e||(d(a),e=!0):b||(b=setInterval(a,1E3/60))}};var ea=e.extend(f,{_class:"View",initialize:function sa(a,b){function e(a){return b[a]||parseInt(b.getAttribute(a),10)}function f(){var a=ha.getSize(b);return a.isNaN()||a.isZero()?new q(e("width"),e("height")):a}var h;
if(c&&b){this._id=b.getAttribute("id");null==this._id&&b.setAttribute("id",this._id="view-"+sa._id++);ba.add(b,this._viewEvents);if(ha.setPrefixed(b.style,{userDrag:"none",userSelect:"none",touchCallout:"none",contentZooming:"none",tapHighlightColor:"rgba(0,0,0,0)"}),g.hasAttribute(b,"resize")){var k=this;ba.add(c,this._windowEvents={resize:function(){k.setViewSize(f())}})}if(h=f(),g.hasAttribute(b,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var m=this._stats.domElement,l=m.style,n=
ha.getOffset(b);l.position="absolute";l.left=n.x+"px";l.top=n.y+"px";d.body.appendChild(m)}}else h=new q(b),b=null;this._project=a;this._scope=a._scope;this._element=b;this._pixelRatio||(this._pixelRatio=c&&c.devicePixelRatio||1);this._setElementSize(h.width,h.height);this._viewSize=h;sa._views.push(this);sa._viewsById[this._id]=this;(this._matrix=new A)._owner=this;this._zoom=1;sa._focused||(sa._focused=this);this._frameItems={};this._frameItemCount=0;this._itemEvents={"native":{},virtual:{}};this._autoUpdate=
!paper.agent.node;this._needsUpdate=!1},remove:function(){if(!this._project)return!1;ea._focused===this&&(ea._focused=null);ea._views.splice(ea._views.indexOf(this),1);delete ea._viewsById[this._id];var a=this._project;return a._view===this&&(a._view=null),ba.remove(this._element,this._viewEvents),ba.remove(c,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:e.each(B._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(a){this[a]=
{}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(a){(this._autoUpdate=a)&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var a=this;ba.requestAnimationFrame(function(){if(a._requested=!1,a._animate){a.requestUpdate();var b=a._element;ha.getPrefixed(d,"hidden")&&"true"!==g.getAttribute(b,"keepalive")||
!ha.isInView(b)||a._handleFrame()}a._autoUpdate&&a.update()});this._requested=!0}},play:function(){this._animate=!0;this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){paper=this._scope;var a=Date.now()/1E3,b=this._last?a-this._last:0;this._last=a;this.emit("frame",new e({delta:b,time:this._time+=b,count:this._count++}));this._stats&&this._stats.update()},_animateItem:function(a,b){var c=this._frameItems;b?(c[a._id]={item:a,time:0,count:0},1===++this._frameItemCount&&
this.on("frame",this._handleFrameItems)):(delete c[a._id],0===--this._frameItemCount&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(a){for(var b in this._frameItems){var c=this._frameItems[b];c.item.emit("frame",new e(a,{time:c.time+=a.delta,count:c.count++}))}},_changed:function(){this._project._changed(2049);this._bounds=null},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return 72*this._pixelRatio},
getViewSize:function(){var a=this._viewSize;return new u(a.width,a.height,this,"setViewSize")},setViewSize:function(){var a=q.read(arguments),b=a.width,c=a.height,d=a.subtract(this._viewSize);d.isZero()||(this._setElementSize(b,c),this._viewSize.set(b,c),this.emit("resize",{size:a,delta:d}),this._changed(),this._autoUpdate&&this.requestUpdate())},_setElementSize:function(a,b){var c=this._element;c&&(c.width!==a&&(c.width=a),c.height!==b&&(c.height=b))},getBounds:function(){return this._bounds||(this._bounds=
this._matrix.inverted()._transformBounds(new r(new n,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var a=n.read(arguments);this.translate(this.getCenter().subtract(a))},getZoom:function(){return this._zoom},setZoom:function(a){this.transform((new A).scale(a/this._zoom,this.getCenter()));this._zoom=a},getMatrix:function(){return this._matrix},setMatrix:function(){var a=this._matrix;
a.initialize.apply(a,arguments)},isVisible:function(){return ha.isInView(this._element)},isInserted:function(){return ha.isInserted(this._element)},getPixelSize:function(a){var b=this._element;if(b){b=b.parentNode;var c=d.createElement("div");c.style.fontSize=a;b.appendChild(c);var e=parseFloat(ha.getStyles(c).fontSize);b.removeChild(c)}else e=parseFloat(e);return e},getTextWidth:function(a,b){return 0}},e.each(["rotate","scale","shear","skew"],function(a){var b="rotate"===a;this[a]=function(){var c=
(b?e:n).read(arguments),d=n.read(arguments,0,{readNull:!0});return this.transform((new A)[a](c,d||this.getCenter(!0)))}},{translate:function(){var a=new A;return this.transform(a.translate.apply(a,arguments))},transform:function(a){this._matrix.append(a)},scrollBy:function(){this.translate(n.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(n.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(n.read(arguments))},getEventPoint:function(a){return this.viewToProject(ba.getOffset(a,
this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(a,b){d&&"string"==typeof b&&(b=d.getElementById(b));return new (c?Ga:ea)(a,b)}}},new function(){function a(a){a=ba.getTarget(a);return a.getAttribute&&ea._viewsById[a.getAttribute("id")]}function b(){var a=ea._focused;if(!a||!a.isVisible())for(var b=0,c=ea._views.length;b<c;b++)if((a=ea._views[b]).isVisible()){ea._focused=h=a;break}}function e(a,b,c,d,e,f,g){function h(a,c){if(a.responds(c)){if(k||(k=new Na(c,d,e,b||a,f?e.subtract(f):
null)),a.emit(c,k)&&(qa=!0,k.prevented&&(D=!0),k.stopped))return m=!0}else{var g=E[c];if(g)return h(a,g)}}for(var k,m=!1;a&&a!==g&&!h(a,c);)a=a._parent;return m}function f(a,b,c,d,f,g){return a._project.removeOn(c),D=qa=!1,y&&e(y,null,c,d,f,g)||b&&b!==y&&!b.isDescendant(y)&&e(b,null,E[c]||c,d,f,g,y)||e(a,y||b||a,c,d,f,g)}if(c){var g,h,k,m,l,n=!1,p=!1,q=c.navigator;q.pointerEnabled||q.msPointerEnabled?(k="pointerdown MSPointerDown",m="pointermove MSPointerMove",l="pointerup pointercancel MSPointerUp MSPointerCancel"):
(k="touchstart",m="touchmove",l="touchend touchcancel","ontouchstart"in c&&q.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(k+=" mousedown",m+=" mousemove",l+=" mouseup"));q={};var r={mouseout:function(a){var b=ea._focused,c=ba.getRelatedTarget(a);if(b&&(!c||"HTML"===c.nodeName)){c=ba.getOffset(a,b._element);var d=c.x,e=Math.abs,f=e(d),g=f-33554432;c.x=e(g)<f?g*(0>d?-1:1):d;c=b.viewToProject(c);b._handleMouseEvent("mousemove",a,c)}},scroll:b};q[k]=function(b){var c=ea._focused=a(b);
n||(n=!0,c._handleMouseEvent("mousedown",b))};r[m]=function(c){var d=ea._focused;if(!p){var e=a(c);e?d!==e&&(d&&d._handleMouseEvent("mousemove",c,void 0),g||(g=d),d=ea._focused=h=e):h&&h===d&&(g&&!g.isInserted()&&(g=null),d=ea._focused=g,g=null,b())}d&&d._handleMouseEvent("mousemove",c,void 0)};r[k]=function(){p=!0};r[l]=function(a){var b=ea._focused;b&&n&&b._handleMouseEvent("mouseup",a);p=n=!1};ba.add(d,r);ba.add(c,{load:b});var u,v,x,w,y,A,G,L,qa=!1,D=!1,E={doubleclick:"click",mousedrag:"mousemove"},
z=!1,O={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:q,_handleMouseEvent:function(a,b,c){function d(a){return g.virtual[a]||l.responds(a)||m&&m.responds(a)}var g=this._itemEvents,h=g["native"][a],k="mousemove"===a,m=this._scope.tool,l=this;k&&n&&d("mousedrag")&&(a="mousedrag");c||(c=this.getEventPoint(b));var p=this.getBounds().contains(c),q=h&&p&&l._project.hitTest(c,
{tolerance:0,fill:!0,stroke:!0});q=q&&q.item||null;var r=!1,J={};J[a.substr(5)]=!0;h&&q!==w&&(w&&e(w,null,"mouseleave",b,c),q&&e(q,null,"mouseenter",b,c),w=q);z^p&&(e(this,null,p?"mouseenter":"mouseleave",b,c),r=!0);!p&&!J.drag||c.equals(v)||(f(this,q,k?a:"mousemove",b,c,v),r=!0);z=p;(J.down&&p||J.up&&u)&&(f(this,q,a,b,c,u),J.down?(L=q===A&&300>Date.now()-G,x=A=q,y=!D&&q,u=c):J.up&&(D||q!==x||(G=Date.now(),f(this,q,L?"doubleclick":"click",b,c,u),L=!1),x=y=null),z=!1,r=!0);v=c;r&&m&&(qa=m._handleMouseEvent(a,
b,c,J)||qa);(qa&&!J.move||J.down&&d("mouseup"))&&b.preventDefault()},_handleKeyEvent:function(a,b,c,d){function e(e){e.responds(a)&&(paper=g,e.emit(a,f=f||new Ca(a,b,c,d)))}var f,g=this._scope,h=g.tool;this.isVisible()&&(e(this),h&&h.responds(a)&&e(h))},_countItemEvent:function(a,b){var c=this._itemEvents,d=c["native"];c=c.virtual;for(var e in O)d[e]=(d[e]||0)+(O[e][a]||0)*b;c[a]=(c[a]||0)+b},statics:{updateFocus:b}}}}),Ga=ea.extend({_class:"CanvasView",initialize:function(a,b){if(!(b instanceof c.HTMLCanvasElement)){var d=
q.read(arguments,1);if(d.isZero())throw Error("Cannot create CanvasView with the provided argument: "+[].slice.call(arguments,1));b=R.getCanvas(d)}var e=this._context=b.getContext("2d");(e.save(),this._pixelRatio=1,/^off|false$/.test(g.getAttribute(b,"hidpi")))||(d=c.devicePixelRatio||1,e=ha.getPrefixed(e,"backingStorePixelRatio")||1,this._pixelRatio=d/e);ea.call(this,a,b);this._needsUpdate=!0},remove:function V(){return this._context.restore(),V.base.call(this)},_setElementSize:function da(a,b){var c=
this._pixelRatio;if(da.base.call(this,a*c,b*c),1!==c){var d=this._element,e=this._context;g.hasAttribute(d,"resize")||(d=d.style,d.width=a+"px",d.height=b+"px");e.restore();e.save();e.scale(c,c)}},getPixelSize:function da(a){var b=paper.agent;if(b&&b.firefox)a=da.base.call(this,a);else{b=this._context;var c=b.font;b.font=a+" serif";a=parseFloat(b.font);b.font=c}return a},getTextWidth:function(a,b){var c=this._context,d=c.font,e=0;c.font=a;for(var f=0,g=b.length;f<g;f++)e=Math.max(e,c.measureText(b[f]).width);
return c.font=d,e},update:function(){if(!this._needsUpdate)return!1;var a=this._project,b=this._context,c=this._viewSize;return b.clearRect(0,0,c.width+1,c.height+1),a&&a.draw(b,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),xa=e.extend({_class:"Event",initialize:function(a){this.type=(this.event=a)&&a.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0;this.event.preventDefault()},stopPropagation:function(){this.stopped=!0;this.event.stopPropagation()},stop:function(){this.stopPropagation();
this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return ya.modifiers}}),Ca=xa.extend({_class:"KeyEvent",initialize:function(a,b,c,d){this.type=a;this.event=b;this.key=c;this.character=d},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),ya=new function(){function a(a){var b=a.key||a.keyIdentifier;return b=/^U\+/.test(b)?String.fromCharCode(parseInt(b.substr(2),
16)):/^Arrow[A-Z]/.test(b)?b.substr(5):"Unidentified"===b?String.fromCharCode(a.keyCode):b,h[b]||(1<b.length?e.hyphenate(b):b.toLowerCase())}function b(a,c,d,g){var h,k=ea._focused;if(m[c]=a,a?l[c]=d:delete l[c],1<c.length&&(h=e.camelize(c))in n){n[h]=a;var p=paper&&paper.agent;if("meta"===h&&p&&p.mac)if(a)f={};else{for(var q in f)q in l&&b(!1,q,f[q],g);f=null}}else a&&f&&(f[c]=d);k&&k._handleKeyEvent(a?"keydown":"keyup",g,c,d)}var f,g,h={"\t":"tab"," ":"space","\b":"backspace","\u007f":"delete",
Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},k={tab:"\t",space:" ",enter:"\r"},m={},l={},n=(new e({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1})).inject({option:{get:function(){return this.alt}},command:{get:function(){var a=paper&&paper.agent;return a&&a.mac?this.meta:this.control}}});return ba.add(d,{keydown:function(c){var d=a(c),e=paper&&paper.agent;1<d.length||e&&e.chrome&&(c.altKey||e.mac&&c.metaKey||!e.mac&&c.ctrlKey)?b(!0,d,k[d]||(1<d.length?"":d),c):g=d},keypress:function(c){if(g){var d=
a(c),e=c.charCode;e=32<=e?String.fromCharCode(e):1<d.length?"":d;d!==g&&(d=e.toLowerCase());b(!0,d,e,c);g=null}},keyup:function(c){var d=a(c);d in l&&b(!1,d,l[d],c)}}),ba.add(c,{blur:function(a){for(var c in l)b(!1,c,l[c],a)}}),{modifiers:n,isDown:function(a){return!!m[a]}}},Na=xa.extend({_class:"MouseEvent",initialize:function(a,b,c,d,e){this.type=a;this.event=b;this.point=c;this.target=d;this.delta=e},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+
(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Ja=xa.extend({_class:"ToolEvent",_item:null,initialize:function(a,b,c){this.tool=a;this.type=b;this.event=c},_choosePoint:function(a,b){return a?a:b?b.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(a){this._point=a},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(a){this._lastPoint=a},getDownPoint:function(){return this._choosePoint(this._downPoint,
this.tool._downPoint)},setDownPoint:function(a){this._downPoint=a},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(a){this._middlePoint=a},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(a){this._delta=a},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":
"_moveCount"]},setCount:function(a){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=a},getItem:function(){if(!this._item){var a=this.tool._scope.project.hitTest(this.getPoint());if(a){a=a.item;for(var b=a._parent;/^(Group|CompoundPath)$/.test(b._class);)a=b,b=b._parent;this._item=a}}return this._item},setItem:function(a){this._item=a},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),
za=k.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:"onMouseDown onMouseUp onMouseDrag onMouseMove onActivate onDeactivate onEditOptions onKeyDown onKeyUp".split(" "),initialize:function(a){k.call(this);this._downCount=this._moveCount=-1;this._set(a)},getMinDistance:function(){return this._minDistance},setMinDistance:function(a){this._minDistance=a;null!=a&&null!=this._maxDistance&&a>this._maxDistance&&(this._maxDistance=a)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(a){this._maxDistance=
a;null!=this._minDistance&&null!=a&&a<this._minDistance&&(this._minDistance=a)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(a){this._minDistance=this._maxDistance=a},_handleMouseEvent:function(a,b,c,d){function e(a,b){var e=c,f=g?n._point:n._downPoint||e;if(g){if(n._moveCount&&e.equals(f))return!1;if(f&&(null!=a||null!=b)){var h=e.subtract(f),k=h.getLength();if(k<(a||0))return!1;b&&(e=f.add(h.normalize(Math.min(k,b))))}n._moveCount++}return n._point=
e,n._lastPoint=f||e,d.down&&(n._moveCount=-1,n._downPoint=e,n._downCount++),!0}function f(){h&&(l=n.emit(a,new Ja(n,a,b))||l)}paper=this._scope;d.drag&&!this.responds(a)&&(a="mousemove");var g=d.move||d.drag,h=this.responds(a),k=this.minDistance,m=this.maxDistance,l=!1,n=this;if(d.down)e(),f();else if(d.up)e(null,m),f();else if(h)for(;e(k,m);)f();return l}}),Aa={request:function(a){var b=new c.XMLHttpRequest;return b.open((a.method||"get").toUpperCase(),a.url,e.pick(a.async,!0)),a.mimeType&&b.overrideMimeType(a.mimeType),
b.onload=function(){var c=b.status;0===c||200===c?a.onLoad&&a.onLoad.call(b,b.responseText):b.onerror()},b.onerror=function(){var c=b.status,d='Could not load "'+a.url+'" (Status: '+c+")";if(!a.onError)throw Error(d);a.onError(d,c)},b.send(null)}},R={canvases:[],getCanvas:function(a,b){if(!c)return null;var e,f=!0;"object"==typeof a&&(b=a.height,a=a.width);this.canvases.length?e=this.canvases.pop():(e=d.createElement("canvas"),f=!1);var g=e.getContext("2d");if(!g)throw Error("Canvas "+e+" is unable toprovide a 2D context.");
return e.width===a&&e.height===b?f&&g.clearRect(0,0,a+1,b+1):(e.width=a,e.height=b),g.save(),e},getContext:function(a,b){var c=this.getCanvas(a,b);return c?c.getContext("2d"):null},release:function(a){(a=a&&a.canvas?a.canvas:a)&&a.getContext&&(a.getContext("2d").restore(),this.canvases.push(a))}},Qa=new function(){function a(a,b,c,d){d-=.2989*a+.587*b+.114*c;n=a+d;p=b+d;q=c+d;d=.2989*n+.587*p+.114*q;b=r(n,p,q);a=u(n,p,q);0>b&&(b=d-b,n=d+(n-d)*d/b,p=d+(p-d)*d/b,q=d+(q-d)*d/b);255<a&&(b=255-d,a-=d,
n=d+(n-d)*b/a,p=d+(p-d)*b/a,q=d+(q-d)*b/a)}function b(a,b,c,d){var e=[a,b,c],f=u(a,b,c);c=r(a,b,c);c=c===a?0:c===b?1:2;f=f===a?0:f===b?1:2;a=0===r(c,f)?1===u(c,f)?2:1:0;e[f]>e[c]?(e[a]=(e[a]-e[c])*d/(e[f]-e[c]),e[f]=d):e[a]=e[f]=0;e[c]=0;n=e[0];p=e[1];q=e[2]}var c,d,f,g,h,k,m,l,n,p,q,r=Math.min,u=Math.max,v=Math.abs,x={multiply:function(){n=h*c/255;p=k*d/255;q=m*f/255},screen:function(){n=h+c-h*c/255;p=k+d-k*d/255;q=m+f-m*f/255},overlay:function(){n=128>h?2*h*c/255:255-2*(255-h)*(255-c)/255;p=128>
k?2*k*d/255:255-2*(255-k)*(255-d)/255;q=128>m?2*m*f/255:255-2*(255-m)*(255-f)/255},"soft-light":function(){var a=c*h/255;n=a+h*(255-(255-h)*(255-c)/255-a)/255;a=d*k/255;p=a+k*(255-(255-k)*(255-d)/255-a)/255;a=f*m/255;q=a+m*(255-(255-m)*(255-f)/255-a)/255},"hard-light":function(){n=128>c?2*c*h/255:255-2*(255-c)*(255-h)/255;p=128>d?2*d*k/255:255-2*(255-d)*(255-k)/255;q=128>f?2*f*m/255:255-2*(255-f)*(255-m)/255},"color-dodge":function(){n=0===h?0:255===c?255:r(255,255*h/(255-c));p=0===k?0:255===d?255:
r(255,255*k/(255-d));q=0===m?0:255===f?255:r(255,255*m/(255-f))},"color-burn":function(){n=255===h?255:0===c?0:u(0,255-255*(255-h)/c);p=255===k?255:0===d?0:u(0,255-255*(255-k)/d);q=255===m?255:0===f?0:u(0,255-255*(255-m)/f)},darken:function(){n=h<c?h:c;p=k<d?k:d;q=m<f?m:f},lighten:function(){n=h>c?h:c;p=k>d?k:d;q=m>f?m:f},difference:function(){n=h-c;0>n&&(n=-n);p=k-d;0>p&&(p=-p);q=m-f;0>q&&(q=-q)},exclusion:function(){n=h+c*(255-h-h)/255;p=k+d*(255-k-k)/255;q=m+f*(255-m-m)/255},hue:function(){var e=
c,g=d,l=f;var v=h;var x=k,w=m;v=u(v,x,w)-r(v,x,w);b(e,g,l,v);a(n,p,q,.2989*h+.587*k+.114*m)},saturation:function(){var e=h,g=k,l=m;var v=c;var x=d,w=f;v=u(v,x,w)-r(v,x,w);b(e,g,l,v);a(n,p,q,.2989*h+.587*k+.114*m)},luminosity:function(){a(h,k,m,.2989*c+.587*d+.114*f)},color:function(){a(c,d,f,.2989*h+.587*k+.114*m)},add:function(){n=r(h+c,255);p=r(k+d,255);q=r(m+f,255)},subtract:function(){n=u(h-c,0);p=u(k-d,0);q=u(m-f,0)},average:function(){n=(h+c)/2;p=(k+d)/2;q=(m+f)/2},negation:function(){n=255-
v(255-c-h);p=255-v(255-d-k);q=255-v(255-f-m)}},y=this.nativeModes=e.each("source-over source-in source-out source-atop destination-over destination-in destination-out destination-atop lighter darker copy xor".split(" "),function(a){this[a]=!0},{}),w=R.getContext(1,1);w&&(e.each(x,function(a,b){var c="darken"===b,d=!1;w.save();try{w.fillStyle=c?"#300":"#a00",w.fillRect(0,0,1,1),w.globalCompositeOperation=b,w.globalCompositeOperation===b&&(w.fillStyle=c?"#a00":"#300",w.fillRect(0,0,1,1),d=w.getImageData(0,
0,1,1).data[0]!==c?170:51)}catch(mc){}w.restore();y[b]=d}),R.release(w));this.process=function(a,b,e,r,u){var v=b.canvas,w="normal"===a;if(w||y[a])e.save(),e.setTransform(1,0,0,1,0,0),e.globalAlpha=r,w||(e.globalCompositeOperation=a),e.drawImage(v,u.x,u.y),e.restore();else if(a=x[a]){w=e.getImageData(u.x,u.y,v.width,v.height);var qa=w.data;b=b.getImageData(0,0,v.width,v.height).data;v=0;for(var A=qa.length;v<A;v+=4){c=b[v];h=qa[v];d=b[v+1];k=qa[v+1];f=b[v+2];m=qa[v+2];g=b[v+3];l=qa[v+3];a();var G=
g*r/255,L=1-G;qa[v]=G*n+L*h;qa[v+1]=G*p+L*k;qa[v+2]=G*q+L*m;qa[v+3]=g*r+L*l}e.putImageData(w,u.x,u.y)}}},ma=new function(){function a(a,c,d){for(var e in c){var f=c[e],g=b[e];"number"==typeof f&&d&&(f=d.number(f));g?a.setAttributeNS(g,e,f):a.setAttribute(e,f)}return a}var b={href:"http://www.w3.org/1999/xlink",xlink:"http://www.w3.org/2000/xmlns",xmlns:"http://www.w3.org/2000/xmlns/","xmlns:xlink":"http://www.w3.org/2000/xmlns/"};return{svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",
xlink:"http://www.w3.org/1999/xlink",create:function(b,c,e){return a(d.createElementNS("http://www.w3.org/2000/svg",b),c,e)},get:function(a,c){var d=b[c];d=d?a.getAttributeNS(d,c):a.getAttribute(c);return"null"===d?null:d},set:a}},ab=e.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{"true":"none",
"false":"non-scaling-stroke"},function(a,b){return!b&&(a instanceof ia||a instanceof x||a instanceof Y)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(a,b){var c=
e.capitalize(b),d=a[2];this[b]={type:a[1],property:b,attribute:a[0],toSVG:d,fromSVG:d&&e.each(d,function(a,b){this[a]=b},{}),exportFilter:a[3],get:"get"+c,set:"set"+c}},{});return new function(){function a(a,b,c){var d=new e,f=a.getTranslation();b&&(a=a._shiftless(),f=a._inverseTransform(f),d[c?"cx":"x"]=f.x,d[c?"cy":"y"]=f.y,f=null);if(!a.isIdentity())if(c=a.decompose()){a=[];b=c.rotation;var g=c.scaling;c=c.skewing;f&&!f.isZero()&&a.push("translate("+u.point(f)+")");b&&a.push("rotate("+u.number(b)+
")");h.isZero(g.x-1)&&h.isZero(g.y-1)||a.push("scale("+u.point(g)+")");c&&c.x&&a.push("skewX("+u.number(c.x)+")");c&&c.y&&a.push("skewY("+u.number(c.y)+")");d.transform=a.join(" ")}else d.transform="matrix("+a.getValues().join(",")+")";return d}function b(b,c){var d=a(b._matrix),e=b._children;d=ma.create("g",d,u);for(var f=0,g=e.length;f<g;f++){var h=e[f],m=p(h,c);if(m)if(h.isClipMask()){var l=ma.create("clipPath");l.appendChild(m);k(h,l,"clip");ma.set(d,{"clip-path":"url(#"+l.id+")"})}else d.appendChild(m)}return d}
function d(b){var c=b._type,d=b._radius,e=a(b._matrix,!0,"rectangle"!==c);if("rectangle"===c){c="rect";var f=b._size;b=f.width;f=f.height;e.x-=b/2;e.y-=f/2;e.width=b;e.height=f;d.isZero()&&(d=null)}return d&&("circle"===c?e.r=d:(e.rx=d.width,e.ry=d.height)),ma.create(c,e,u)}function f(a,b,c){var d={},f=!c&&a.getParent(),h=[];return null!=a._name&&(d.id=a._name),e.each(ab,function(b){var c=b.get,m=b.type,l=a[c]();if(b.exportFilter?b.exportFilter(a,l):!f||!e.equals(f[c](),l))if("color"===m&&null!=l&&
(c=l.getAlpha(),1>c&&(d[b.attribute+"-opacity"]=c)),"style"===m)h.push(b.attribute+": "+l);else{c=b.attribute;if(null==l)l="none";else if("color"===m)if(l.gradient){m=g(l,"color");if(!m){var n=l.getGradient();m=n._radial;b=l.getOrigin();var p=l.getDestination();m?(b={cx:b.x,cy:b.y,r:b.getDistance(p)},(p=l.getHighlight())&&(b.fx=p.x,b.fy=p.y)):b={x1:b.x,y1:b.y,x2:p.x,y2:p.y};b.gradientUnits="userSpaceOnUse";m=ma.create((m?"radial":"linear")+"Gradient",b,u);n=n._stops;p=0;for(var q=n.length;p<q;p++){b=
n[p];var r=b._color,v=r.getAlpha();b={offset:b._offset||p/(q-1)};r&&(b["stop-color"]=r.toCSS(!0));1>v&&(b["stop-opacity"]=v);m.appendChild(ma.create("stop",b,u))}k(l,m,"color")}l="url(#"+m.id+")"}else l=l.toCSS(!0);else l="array"===m?l.join(","):"lookup"===m?b.toSVG[l]:l;d[c]=l}}),h.length&&(d.style=h.join(";")),1===d.opacity&&delete d.opacity,a._visible||(d.visibility="hidden"),ma.set(b,d,u)}function g(a,b){v||(v={ids:{},svgs:{}});var c=a._id||a.__id||(a.__id=m.get("svg"));return a&&v.svgs[b+"-"+
c]}function k(a,b,c){v||g();var d=v.ids[c]=(v.ids[c]||0)+1;b.id=c+"-"+d;v.svgs[c+"-"+(a._id||a.__id)]=b}function n(a,b){var d=a,e=null;if(v){d="svg"===a.nodeName.toLowerCase()&&a;for(var f in v.svgs)e||(d||(d=ma.create("svg"),d.appendChild(a)),e=d.insertBefore(ma.create("defs"),d.firstChild)),e.appendChild(v.svgs[f]);v=null}return b.asString?(new c.XMLSerializer).serializeToString(d):d}function p(a,b,c){var d=x[a._class];if(d=d&&d(a,b)){var e=b.onExport;e&&(d=e(a,d,b)||d);(b=JSON.stringify(a._data))&&
"{}"!==b&&"null"!==b&&d.setAttribute("data-paper-data",b)}return d&&f(a,d,c)}function q(a){return a||(a={}),u=new l(a.precision),a}var u,v,x={Group:b,Layer:b,Raster:function(b,c){var d=a(b._matrix,!0),e=b.getSize(),f=b.getImage();return d.x-=e.width/2,d.y-=e.height/2,d.width=e.width,d.height=e.height,d.href=!1===c.embedImages&&f&&f.src||b.toDataURL(),ma.create("image",d,u)},Path:function(b,c){var e=c.matchShapes;if(e){var f=b.toShape(!1);if(f)return d(f,c)}var g=b._segments,h=g.length;f=a(b._matrix);
if(e&&2<=h&&!b.hasHandles())if(2<h){e=b._closed?"polygon":"polyline";for(var k=[],m=0;m<h;m++)k.push(u.point(g[m]._point));f.points=k.join(" ")}else e="line",h=g[0]._point,g=g[1]._point,f.set({x1:h.x,y1:h.y,x2:g.x,y2:g.y});else e="path",f.d=b.getPathData(null,c.precision);return ma.create(e,f,u)},Shape:d,CompoundPath:function(b,c){var d=a(b._matrix),e=b.getPathData(null,c.precision);return e&&(d.d=e),ma.create("path",d,u)},SymbolItem:function(b,c){var d=a(b._matrix,!0),e=b._definition,f=g(e,"symbol"),
h=e._item,m=h.getBounds();return f||(f=ma.create("symbol",{viewBox:u.rectangle(m)}),f.appendChild(p(h,c)),k(e,f,"symbol")),d.href="#"+f.id,d.x+=m.x,d.y+=m.y,d.width=m.width,d.height=m.height,d.overflow="visible",ma.create("use",d,u)},PointText:function(b){var c=ma.create("text",a(b._matrix,!0),u);return c.textContent=b._content,c}};B.inject({exportSVG:function(a){return a=q(a),n(p(this,a,!0),a)}});F.inject({exportSVG:function(b){b=q(b);var c=this._children,d=this.getView(),f=e.pick(b.bounds,"view"),
g=b.matrix||"view"===f&&d._matrix;g=g&&A.read([g]);d="view"===f?new r([0,0],d.getViewSize()):"content"===f?B._getBounds(c,g,{stroke:!0}):r.read([f],0,{readNull:!0});f={version:"1.1",xmlns:ma.svg,"xmlns:xlink":ma.xlink};d&&(f.width=d.width,f.height=d.height,(d.x||d.y)&&(f.viewBox=u.rectangle(d)));f=d=ma.create("svg",f,u);g&&!g.isIdentity()&&(f=d.appendChild(ma.create("g",a(g),u)));g=0;for(var h=c.length;g<h;g++)f.appendChild(p(c[g],b,!0));return n(d,b)}})},new function(){function a(a,b,c,d,e){a=ma.get(a,
b);c=null==a?d?null:c?"":0:c?a:parseFloat(a);return/%\s*$/.test(a)?c/100*(e?1:z[/x|^width/.test(b)?"width":"height"]):c}function f(b,c,d,e,f){return c=a(b,c||"x",!1,e,f),d=a(b,d||"y",!1,e,f),!e||null!=c&&null!=d?new n(c,d):null}function g(b,c,d,e,f){return c=a(b,c||"width",!1,e,f),d=a(b,d||"height",!1,e,f),!e||null!=c&&null!=d?new q(c,d):null}function h(a,b,c){return"none"===a?null:"number"===b?parseFloat(a):"array"===b?a?a.split(/[\s,]+/g).map(parseFloat):[]:"color"===b?G(a)||a:"lookup"===b?c[a]:
a}function k(a,b,c,d){var e=a.childNodes,f="clippath"===b;b="defs"===b;var g=new w,h=g._project,k=h._currentStyle,m=[];if(f||b||(g=y(g,a,d),h._currentStyle=g._style.clone()),d)for(var l=a.querySelectorAll("defs"),n=0,p=l.length;n<p;n++)L(l[n],c,!1);n=0;for(p=e.length;n<p;n++){var q;l=e[n];1!==l.nodeType||/^defs$/i.test(l.nodeName)||!(q=L(l,c,!1))||q instanceof oa||m.push(q)}return g.addChildren(m),f&&(g=y(g.reduce(),a,d)),h._currentStyle=k,(f||b)&&(g.remove(),g=null),g}function m(a,b){for(var c=a.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),
d=[],e=0,f=c.length;e<f;e+=2)d.push(new n(parseFloat(c[e]),parseFloat(c[e+1])));c=new O(d);return"polygon"===b&&c.closePath(),c}function l(b,c){var d=(a(b,"href",!0)||"").substring(1);var e="radialgradient"===c;if(d)d=H[d].getGradient(),d._radial^e&&(d=d.clone(),d._radial=e);else{d=b.childNodes;for(var g=[],h=0,k=d.length;h<k;h++){var m=d[h];1===m.nodeType&&g.push(y(new ta,m))}d=new Pa(g,e)}var l,n,p;g="userSpaceOnUse"!==a(b,"gradientUnits",!0);e?(l=f(b,"cx","cy",!1,g),n=l.add(a(b,"r",!1,!1,g),0),
p=f(b,"fx","fy",!0,g)):(l=f(b,"x1","y1",!1,g),n=f(b,"x2","y2",!1,g));return y(new fa(d,l,n,p),b)._scaleToBounds=g,null}function p(a,b,c,d){if(a.transform){b=(d.getAttribute(c)||"").split(/\)\s*/g);c=new A;d=0;for(var e=b.length;d<e;d++){var f=b[d];if(!f)break;var g=f.split(/\(\s*/);f=g[0];g=g[1].split(/[\s,]+/g);for(var h=0,k=g.length;h<k;h++)g[h]=parseFloat(g[h]);switch(f){case "matrix":c.append(new A(g[0],g[1],g[2],g[3],g[4],g[5]));break;case "rotate":c.rotate(g[0],g[1],g[2]);break;case "translate":c.translate(g[0],
g[1]);break;case "scale":c.scale(g);break;case "skewX":c.skew(g[0],0);break;case "skewY":c.skew(0,g[0])}}a.transform(c)}}function u(a,b,c){c="fill-opacity"===c?"getFillColor":"getStrokeColor";(a=a[c]&&a[c]())&&a.setAlpha(parseFloat(b))}function v(a,c,d){var f=a.attributes[c];f=f&&f.value;f||(c=e.camelize(c),(f=a.style[c])||d.node[c]===d.parent[c]||(f=d.node[c]));return f?"none"===f?null:f:b}function y(a,c,d){var f=c.parentNode,g={node:ha.getStyles(c)||{},parent:!d&&!/^defs$/i.test(f.tagName)&&ha.getStyles(f)||
{}};return e.each(ja,function(d,e){var f=v(c,e,g);a=f!==b&&d(a,f,e,c,g)||a}),a}function G(a){a=(a=a&&a.match(/\((?:["'#]*)([^"')]+)/))&&H[a[1].replace(c.location.href.split("#")[0]+"#","")];return a&&a._scaleToBounds&&(a=a.clone(),a._scaleToBounds=!0),a}function L(a,b,c){var f,h,k,m=a.nodeName.toLowerCase(),l="#document"!==m,n=d.body;c&&l&&(z=g(a,null,null,!0)||paper.getView().getSize(),f=ma.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),h=a.parentNode,k=a.nextSibling,f.appendChild(a),
n.appendChild(f));var p=paper.settings,q=p.applyMatrix,r=p.insertItems;p.applyMatrix=!1;p.insertItems=!1;var u=U[m];m=u&&u(a,m,b,c)||null;if(p.insertItems=r,p.applyMatrix=q,m)!l||m instanceof w||(m=y(m,a,c)),p=b.onImport,l=l&&a.getAttribute("data-paper-data"),p&&(m=p(a,m,b)||m),b.expandShapes&&m instanceof x&&(m.remove(),m=m.toPath()),l&&(m._data=JSON.parse(l));return f&&(n.removeChild(f),h&&(k?h.insertBefore(a,k):h.appendChild(a))),c&&(H={},m&&e.pick(b.applyMatrix,q)&&m.matrix.apply(!0,!0)),m}function E(a,
e,f){function g(d){try{var g="object"==typeof d?d:(new c.DOMParser).parseFromString(d,"image/svg+xml");if(!g.nodeName)throw Error("Unsupported SVG source: "+a);paper=k;m=L(g,e,!0);e&&!1===e.insert||f._insertItem(b,m);var l=e.onLoad;l&&l(m,d)}catch(Xb){h(Xb)}}function h(a,b){var c=e.onError;if(!c)throw Error(a);c(a,b)}if(!a)return null;e="function"==typeof e?{onLoad:e}:e||{};var k=paper,m=null;if("string"!=typeof a||/^.*</.test(a)){if("undefined"!=typeof File&&a instanceof File){var l=new FileReader;
return l.onload=function(){g(l.result)},l.onerror=function(){h(l.error)},l.readAsText(a)}g(a)}else{var n=d.getElementById(a);n?g(n):Aa.request({url:a,async:!0,onLoad:g,onError:h})}return m}var z,H={},U={"#document":function(a,b,c,d){a=a.childNodes;b=0;for(var e=a.length;b<e;b++){var f=a[b];if(1===f.nodeType)return L(f,c,d)}},g:k,svg:k,clippath:k,polygon:m,polyline:m,path:function(a){return ia.create(a.getAttribute("d"))},lineargradient:l,radialgradient:l,image:function(b){var c=new D(a(b,"href",!0));
return c.on("load",function(){var a=g(b);this.setSize(a);a=this._matrix._transformPoint(f(b).add(a.divide(2)));this.translate(a)}),c},symbol:function(a,b,c,d){return new oa(k(a,b,c,d),!0)},defs:k,use:function(b){var c=(a(b,"href",!0)||"").substring(1);c=H[c];b=f(b);return c?c instanceof oa?c.place(b):c.clone().translate(b):null},circle:function(b){return new x.Circle(f(b,"cx","cy"),a(b,"r"))},ellipse:function(a){return new x.Ellipse({center:f(a,"cx","cy"),radius:g(a,"rx","ry")})},rect:function(a){return new x.Rectangle(new r(f(a),
g(a)),g(a,"rx","ry"))},line:function(a){return new O.Line(f(a,"x1","y1"),f(a,"x2","y2"))},text:function(a){var b=new X(f(a).add(f(a,"dx","dy")));return b.setContent(a.textContent.trim()||""),b}},ja=e.set(e.each(ab,function(a){this[a.attribute]=function(b,c){if(b[a.set]&&(b[a.set](h(c,a.type,a.fromSVG)),"color"===a.type)){var d=b[a.get]();if(d){if(d._scaleToBounds){var e=b.getBounds();d.transform((new A).translate(e.getPoint()).scale(e.getSize()))}b instanceof x&&d.transform((new A).translate(b.getPosition(!0).negate()))}}}},
{}),{id:function(a,b){H[b]=a;a.setName&&a.setName(b)},"clip-path":function(a,b){var c=G(b);if(c){if(c=c.clone(),c.setClipMask(!0),!(a instanceof w))return new w(c,a);a.insertChild(0,c)}},gradientTransform:p,transform:p,"fill-opacity":u,"stroke-opacity":u,visibility:function(a,b){a.setVisible&&a.setVisible("visible"===b)},display:function(a,b){a.setVisible&&a.setVisible(null!==b)},"stop-color":function(a,b){a.setColor&&a.setColor(b)},"stop-opacity":function(a,b){a._color&&a._color.setAlpha(parseFloat(b))},
offset:function(a,b){if(a.setOffset){var c=b.match(/(.*)%$/);a.setOffset(c?c[1]/100:parseFloat(b))}},viewBox:function(a,b,c,d,e){b=new r(h(b,"array"));c=g(d,null,null,!0);if(a instanceof w){var f=c?c.divide(b.getSize()):1;var k=(new A).scale(f).translate(b.getPoint().negate());f=a}else a instanceof oa&&(c&&b.setSize(c),f=a._item);f&&("visible"!==v(d,"overflow",e)&&(a=new x.Rectangle(b),a.setClipMask(!0),f.addChild(a)),k&&f.transform(k))}});B.inject({importSVG:function(a,b){return E(a,b,this)}});F.inject({importSVG:function(a,
b){return this.activate(),E(a,b,this)}})},e.exports.PaperScript=function(){function a(a,b,c){var d=r[b];if(a&&a[d])return a=a[d](c),"!="===b?!a:a;switch(b){case "+":return a+c;case "-":return a-c;case "*":return a*c;case "/":return a/c;case "%":return a%c;case "==":return a==c;case "!=":return a!=c}}function b(a,b){var c=u[a];if(c&&b&&b[c])return b[c]();switch(a){case "+":return+b;case "-":return-b}}function f(a,b){return p.acorn.parse(a,b)}function h(a,b){function e(a){for(var b=0,c=l.length;b<c;b++){var d=
l[b];if(d[0]>=a)break;a+=d[1]}return a}function g(b){return a.substring(e(b.range[0]),e(b.range[1]))}function h(b,c){for(var d=e(b.range[0]),f=e(b.range[1]),g=0,h=l.length-1;0<=h;h--)if(d>l[h][0]){g=h+1;break}l.splice(g,0,[d,c.length-f+d]);a=a.substring(0,d)+c+a.substring(f)}function k(b,c){if(b){for(var d in b)if("range"!==d&&"loc"!==d){var f=b[d];if(Array.isArray(f))for(var m=0,l=f.length;m<l;m++)k(f[m],b);else f&&"object"==typeof f&&k(f,b)}switch(b.type){case "UnaryExpression":b.operator in u&&
"Literal"!==b.argument.type&&(d=g(b.argument),h(b,'$__("'+b.operator+'", '+d+")"));break;case "BinaryExpression":b.operator in r&&"Literal"!==b.left.type&&(d=g(b.left),f=g(b.right),m=b.right,m=a.substring(e(b.left.range[1]),e(m.range[0])),l=b.operator,h(b,"__$__("+d+","+m.replace(new RegExp("\\"+l),'"'+l+'"')+", "+f+")"));break;case "UpdateExpression":case "AssignmentExpression":f=c&&c.type,"ForStatement"===f||"BinaryExpression"===f&&/^[=!<>]/.test(c.operator)||"MemberExpression"===f&&c.computed||
("UpdateExpression"===b.type?(d=g(b.argument),m="__$__("+d+', "'+b.operator[0]+'", 1)',l=d+" = "+m,b.prefix||"AssignmentExpression"!==f&&"VariableDeclarator"!==f||(g(c.left||c.id)===d&&(l=m),l=d+"; "+l),h(b,l)):/^.=$/.test(b.operator)&&"Literal"!==b.left.type&&(d=g(b.left),f=g(b.right),h(b,d+" = __$__("+d+', "'+b.operator[0]+'", '+f+")")))}}}function m(a){var b="";for(a=(Math.abs(a)<<1)+(0>a?1:0);a||!b;){var c=31&a;(a>>=5)&&(c|=32);b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c]}return b}
if(!a)return"";b=b||{};var l=[],n=b.url||"",p=paper.agent,q=p.versionNumber,v=!1,x=b.sourceMaps,w=b.source||a,y=/\r\n|\n|\r/gm,L=b.offset||0;if(x&&(p.chrome&&30<=q||p.webkit&&537.76<=q||p.firefox&&23<=q||p.node)){p.node?L-=2:c&&n&&!c.location.href.indexOf(n)&&(v=d.getElementsByTagName("html")[0].innerHTML,L=v.substr(0,v.indexOf(a)+1).match(y).length+1);v=0<L&&!(p.chrome&&36<=q||p.safari&&600<=q||p.firefox&&40<=q||p.node);p=["AA"+m(v?0:L)+"A"];p.length=(a.match(y)||[]).length+1+(v?L:0);var G={version:3,
file:n,names:[],mappings:p.join(";AACA"),sourceRoot:"",sources:[n],sourcesContent:[w]}}return k(f(a,{ranges:!0})),G&&(v&&(a=Array(L+1).join("\n")+a),/^(inline|both)$/.test(x)&&(a+="\n//# sourceMappingURL=data:application/json;base64,"+c.btoa(unescape(encodeURIComponent(JSON.stringify(G))))),a+="\n//# sourceURL="+(n||"paperscript")),{url:n,source:w,code:a,map:G}}function k(c,f,g){function k(a,b){for(var d in a)!b&&/^_/.test(d)||!(new RegExp("([\\b\\s\\W]|^)"+d.replace(/\$/g,"\\$")+"\\b")).test(c)||
(r.push(d),u.push(a[d]))}paper=f;var m=f.getView(),l=/\btool\.\w+|\s+on(?:Key|Mouse)(?:Up|Down|Move|Drag)\b/.test(c)&&!/\bnew\s+Tool\b/.test(c)?new za:null,p=l?l._events:[],q=["onFrame","onResize"].concat(p),r=[],u=[];g="object"==typeof c?c:h(c,g);c=g.code;k({__$__:a,$__:b,paper:f,view:m,tool:l},!0);k(f);(q=e.each(q,function(a){(new RegExp("\\s+"+a+"\\b")).test(c)&&(r.push(a),this.push(a+": "+a))},[]).join(", "))&&(c+="\nreturn { "+q+" };");var v=paper.agent;if(d&&(v.chrome||v.firefox&&40>v.versionNumber)){q=
d.createElement("script");var x=d.head||d.getElementsByTagName("head")[0];v.firefox&&(c="\n"+c);q.appendChild(d.createTextNode("paper._execute = function("+r+") {"+c+"\n}"));x.appendChild(q);v=paper._execute;delete paper._execute;x.removeChild(q)}else v=Function(r,c);var w=v.apply(f,u)||{};return e.each(p,function(a){var b=w[a];b&&(l[a]=b)}),m&&(w.onResize&&m.setOnResize(w.onResize),m.emit("resize",{size:m.size,delta:new n}),w.onFrame&&m.setOnFrame(w.onFrame),m.requestUpdate()),g}function m(a){if(/^text\/(?:x-|)paperscript$/.test(a.type)&&
"true"!==g.getAttribute(a,"ignore")){var b=g.getAttribute(a,"canvas"),c=d.getElementById(b),e=a.src||a.getAttribute("data-src"),f=g.hasAttribute(a,"async");if(!c)throw Error('Unable to find canvas with id "'+b+'"');var h=g.get(c.getAttribute("data-paper-scope"))||(new g).setup(c);return c.setAttribute("data-paper-scope",h._id),e?Aa.request({url:e,async:f,mimeType:"text/plain",onLoad:function(a){k(a,h,e)}}):k(a.innerHTML,h,a.baseURI),a.setAttribute("data-paper-ignore","true"),h}}function l(){e.each(d&&
d.getElementsByTagName("script"),m)}var p=this;!function(a,b){return void b(a.acorn||(a.acorn={}))}(this,function(a){function b(a){S=a||{};for(var b in Ca)Object.prototype.hasOwnProperty.call(S,b)||(S[b]=Ca[b]);aa=S.sourceFile||null}function c(a,b){var c=ka(N,a);b+=" ("+c.line+":"+c.column+")";var d=new SyntaxError(b);throw d.pos=a,d.loc=c,d.raisedAt=C,d;}function d(a){function b(a){if(1==a.length)return c+="return str === "+JSON.stringify(a[0])+";";c+="switch(str){";for(var b=0;b<a.length;++b)c+=
"case "+JSON.stringify(a[b])+":";c+="return true}return false;"}a=a.split(" ");var c="",d=[],e=0;a:for(;e<a.length;++e){for(var f=0;f<d.length;++f)if(d[f][0].length==a[e].length){d[f].push(a[e]);continue a}d.push([a[e]])}if(3<d.length){d.sort(function(a,b){return b.length-a.length});c+="switch(str.length){";for(e=0;e<d.length;++e)a=d[e],c+="case "+a[0].length+":",b(a);c+="}"}else b(a);return new Function("str",c)}function e(){this.line=pa;this.column=C-Fa}function f(a,b){da=C;S.locations&&(ma=new e);
T=a;h();ta=b;Ga=a.beforeExpr}function g(){for(var a=C,b=S.onComment&&S.locations&&new e,c=N.charCodeAt(C+=2);wa>C&&10!==c&&13!==c&&8232!==c&&8233!==c;)++C,c=N.charCodeAt(C);S.onComment&&S.onComment(!1,N.slice(a+2,C),a,C,b,S.locations&&new e)}function h(){for(;wa>C;){var a=N.charCodeAt(C);if(32===a)++C;else if(13===a)++C,a=N.charCodeAt(C),10===a&&++C,S.locations&&(++pa,Fa=C);else if(10===a||8232===a||8233===a)++C,S.locations&&(++pa,Fa=C);else if(8<a&&14>a)++C;else if(47===a)if(a=N.charCodeAt(C+1),
42===a){a=void 0;var b=S.onComment&&S.locations&&new e,d=C,f=N.indexOf("*/",C+=2);if(-1===f&&c(C-2,"Unterminated comment"),C=f+2,S.locations)for(Va.lastIndex=d;(a=Va.exec(N))&&a.index<C;)++pa,Fa=a.index+a[0].length;S.onComment&&S.onComment(!0,N.slice(d+2,f),d,C,b,S.locations&&new e)}else{if(47!==a)break;g()}else{if(160!==a&&!(5760<=a&&Yb.test(String.fromCharCode(a))))break;++C}}}function k(a){switch(a){case 46:return a=N.charCodeAt(C+1),48<=a&&57>=a?q(!0):(++C,f(mb));case 40:return++C,f(Ka);case 41:return++C,
f(Ha);case 59:return++C,f(La);case 44:return++C,f(Oa);case 91:return++C,f(eb);case 93:return++C,f(fb);case 123:return++C,f(Wa);case 125:return++C,f(Sa);case 58:return++C,f(Xa);case 63:return++C,f(nb);case 48:if(a=N.charCodeAt(C+1),120===a||88===a)return C+=2,a=p(16),null==a&&c(R+2,"Expected hexadecimal number"),gb(N.charCodeAt(C))&&c(C,"Identifier directly after number"),f(za,a);case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return q(!1);case 34:case 39:a:{C++;for(var b="";;){C>=
wa&&c(R,"Unterminated string constant");var d=N.charCodeAt(C);if(d===a){a=(++C,f(bb,b));break a}if(92===d){d=N.charCodeAt(++C);var e=/^[0-7]+/.exec(N.slice(C,C+3));for(e&&(e=e[0]);e&&255<parseInt(e,8);)e=e.slice(0,-1);if("0"===e&&(e=null),++C,e)Da&&c(C-2,"Octal literal in strict mode"),b+=String.fromCharCode(parseInt(e,8)),C+=e.length-1;else switch(d){case 110:b+="\n";break;case 114:b+="\r";break;case 120:b+=String.fromCharCode(r(2));break;case 117:b+=String.fromCharCode(r(4));break;case 85:b+=String.fromCharCode(r(8));
break;case 116:b+="\t";break;case 98:b+="\b";break;case 118:b+="\x0B";break;case 102:b+="\f";break;case 48:b+="\x00";break;case 13:10===N.charCodeAt(C)&&++C;case 10:S.locations&&(Fa=C,++pa);break;default:b+=String.fromCharCode(d)}}else 13!==d&&10!==d&&8232!==d&&8233!==d||c(R,"Unterminated string constant"),b+=String.fromCharCode(d),++C}}return a;case 47:return a=N.charCodeAt(C+1),Ga?(++C,n()):61===a?l(Ta,2):l(ob,1);case 37:case 42:return 61===N.charCodeAt(C+1)?l(Ta,2):l(Zb,1);case 124:case 38:return b=
N.charCodeAt(C+1),b===a?l(124===a?wb:xb,2):61===b?l(Ta,2):l(124===a?$b:ac,1);case 94:return 61===N.charCodeAt(C+1)?l(Ta,2):l(bc,1);case 43:case 45:return b=N.charCodeAt(C+1),b===a?45==b&&62==N.charCodeAt(C+2)&&hb.test(N.slice(Ba,C))?(C+=3,g(),h(),m()):l(cc,2):61===b?l(Ta,2):l(dc,1);case 60:case 62:return b=N.charCodeAt(C+1),d=1,b===a?(d=62===a&&62===N.charCodeAt(C+2)?3:2,61===N.charCodeAt(C+d)?l(Ta,d+1):l(ec,d)):33==b&&60==a&&45==N.charCodeAt(C+2)&&45==N.charCodeAt(C+3)?(C+=4,g(),h(),m()):(61===b&&
(d=61===N.charCodeAt(C+2)?3:2),l(fc,d));case 61:case 33:return 61===N.charCodeAt(C+1)?l(gc,61===N.charCodeAt(C+2)?3:2):l(61===a?pb:yb,1);case 126:return l(yb,1)}return!1}function m(a){if(a?C=R+1:R=C,S.locations&&(xa=new e),a)return n();if(C>=wa)return f(Na);var b=N.charCodeAt(C);if(gb(b)||92===b)return v();a=k(b);if(!1===a){b=String.fromCharCode(b);if("\\"===b||zb.test(b))return v();c(C,"Unexpected character '"+b+"'")}return a}function l(a,b){var c=N.slice(C,C+b);C+=b;f(a,c)}function n(){for(var a,
b,d=C;;){C>=wa&&c(d,"Unterminated regular expression");var e=N.charAt(C);if(hb.test(e)&&c(d,"Unterminated regular expression"),a)a=!1;else{if("["===e)b=!0;else if("]"===e&&b)b=!1;else if("/"===e&&!b)break;a="\\"===e}++C}a=N.slice(d,C);++C;(b=u())&&!/^[gmsiy]*$/.test(b)&&c(d,"Invalid regexp flag");try{var g=new RegExp(a,b)}catch(lb){lb instanceof SyntaxError&&c(d,lb.message),c(lb)}return f(Ia,g)}function p(a,b){for(var c=C,d=0,e=0,f=null==b?1/0:b;f>e;++e){var g,h=N.charCodeAt(C);if(g=97<=h?h-97+10:
65<=h?h-65+10:48<=h&&57>=h?h-48:1/0,g>=a)break;++C;d=d*a+g}return C===c||null!=b&&C-c!==b?null:d}function q(a){var b=C,d=!1,e=48===N.charCodeAt(C);a||null!==p(10)||c(b,"Invalid number");46===N.charCodeAt(C)&&(++C,p(10),d=!0);a=N.charCodeAt(C);69!==a&&101!==a||(a=N.charCodeAt(++C),43!==a&&45!==a||++C,null===p(10)&&c(b,"Invalid number"),d=!0);gb(N.charCodeAt(C))&&c(C,"Identifier directly after number");var g;a=N.slice(b,C);return d?g=parseFloat(a):e&&1!==a.length?/[89]/.test(a)||Da?c(b,"Invalid number"):
g=parseInt(a,8):g=parseInt(a,10),f(za,g)}function r(a){a=p(16,a);return null===a&&c(R,"Bad character escape sequence"),a}function u(){Ya=!1;for(var a,b=!0,d=C;;){var e=N.charCodeAt(C);if(Ab(e))Ya&&(a+=N.charAt(C)),++C;else{if(92!==e)break;Ya||(a=N.slice(d,C));Ya=!0;117!=N.charCodeAt(++C)&&c(C,"Expecting Unicode escape sequence \\uXXXX");++C;e=r(4);var f=String.fromCharCode(e);f||c(C-1,"Invalid Unicode escape");(b?gb(e):Ab(e))||c(C-4,"Invalid Unicode escape");a+=f}b=!1}return Ya?a:N.slice(d,C)}function v(){var a=
u(),b=Ua;return!Ya&&hc(a)&&(b=qb[a]),f(b,a)}function x(){ya=R;Ba=da;Ea=ma;m()}function w(a){if(Da=a,C=R,S.locations)for(;Fa>C;)Fa=N.lastIndexOf("\n",Fa-2)+1,--pa;h();m()}function y(){this.type=null;this.start=R;this.end=null}function L(){this.start=xa;this.end=null;null!==aa&&(this.source=aa)}function G(){var a=new y;return S.locations&&(a.loc=new L),S.directSourceFile&&(a.sourceFile=S.directSourceFile),S.ranges&&(a.range=[R,0]),a}function A(a){var b=new y;return b.start=a.start,S.locations&&(b.loc=
new L,b.loc.start=a.loc.start),S.ranges&&(b.range=[a.range[0],0]),b}function D(a,b){return a.type=b,a.end=Ba,S.locations&&(a.loc.end=Ea),S.ranges&&(a.range[1]=Ba),a}function E(a){return 5<=S.ecmaVersion&&"ExpressionStatement"===a.type&&"Literal"===a.expression.type&&"use strict"===a.expression.value}function z(a){return T===a?(x(),!0):void 0}function O(){return!S.strictSemicolons&&(T===Na||T===Sa||hb.test(N.slice(Ba,R)))}function H(){z(La)||O()||F()}function B(a){T===a?x():F()}function F(){c(R,"Unexpected token")}
function ia(a){"Identifier"!==a.type&&"MemberExpression"!==a.type&&c(a.start,"Assigning to rvalue");Da&&"Identifier"===a.type&&ib(a.name)&&c(a.start,"Assigning to "+a.name+" in strict mode")}function oa(){(T===ob||T===Ta&&"/="==ta)&&m(!0);var a=T,b=G();switch(a){case Qa:case Bb:x();var d=a===Qa;z(La)||O()?b.label=null:T!==Ua?F():(b.label=ba(),H());for(var e=0;e<ra.length;++e){var f=ra[e];if(null==b.label||f.name===b.label.name){if(null!=f.kind&&(d||"loop"===f.kind))break;if(b.label&&d)break}}return e===
ra.length&&c(b.start,"Unsyntactic "+a.keyword),D(b,d?"BreakStatement":"ContinueStatement");case Cb:return x(),H(),D(b,"DebuggerStatement");case Db:return x(),ra.push(rb),b.body=oa(),ra.pop(),B(sb),b.test=U(),H(),D(b,"DoWhileStatement");case Eb:if(x(),ra.push(rb),B(Ka),T===La)return na(b,null);if(T===tb)return a=G(),x(),fa(a,!0),D(a,"VariableDeclaration"),1===a.declarations.length&&z(jb)?W(b,a):na(b,a);a=Y(!1,!0);return z(jb)?(ia(a),W(b,a)):na(b,a);case ub:return x(),ea(b,!0);case Fb:return x(),b.test=
U(),b.consequent=oa(),b.alternate=z(Gb)?oa():null,D(b,"IfStatement");case Hb:return Aa||S.allowReturnOutsideFunction||c(R,"'return' outside of function"),x(),z(La)||O()?b.argument=null:(b.argument=Y(),H()),D(b,"ReturnStatement");case vb:x();b.discriminant=U();b.cases=[];B(Wa);for(ra.push(ic);T!=Sa;)T===Ra||T===Ib?(a=T===Ra,e&&D(e,"SwitchCase"),b.cases.push(e=G()),e.consequent=[],x(),a?e.test=Y():(d&&c(ya,"Multiple default clauses"),d=!0,e.test=null),B(Xa)):(e||F(),e.consequent.push(oa()));return e&&
D(e,"SwitchCase"),x(),ra.pop(),D(b,"SwitchStatement");case Jb:return x(),hb.test(N.slice(Ba,R))&&c(Ba,"Illegal newline after throw"),b.argument=Y(),H(),D(b,"ThrowStatement");case Kb:if(x(),b.block=ja(),b.handler=null,T===ab)a=G(),x(),B(Ka),a.param=ba(),Da&&ib(a.param.name)&&c(a.param.start,"Binding "+a.param.name+" in strict mode"),B(Ha),a.guard=null,a.body=ja(),b.handler=D(a,"CatchClause");return b.guardedHandlers=Ja,b.finalizer=z(Lb)?ja():null,b.handler||b.finalizer||c(b.start,"Missing catch or finally clause"),
D(b,"TryStatement");case tb:return x(),fa(b),H(),D(b,"VariableDeclaration");case sb:return x(),b.test=U(),ra.push(rb),b.body=oa(),ra.pop(),D(b,"WhileStatement");case Mb:return Da&&c(R,"'with' in strict mode"),x(),b.object=U(),b.body=oa(),D(b,"WithStatement");case Wa:return ja();case La:return x(),D(b,"EmptyStatement");default:d=ta;f=Y();if(a===Ua&&"Identifier"===f.type&&z(Xa)){for(e=0;e<ra.length;++e)ra[e].name===d&&c(f.start,"Label '"+d+"' is already declared");return ra.push({name:d,kind:T.isLoop?
"loop":T===vb?"switch":null}),b.body=oa(),ra.pop(),b.label=f,D(b,"LabeledStatement")}return b.expression=f,H(),D(b,"ExpressionStatement")}}function U(){B(Ka);var a=Y();return B(Ha),a}function ja(a){var b,c=G(),d=!0,e=!1;c.body=[];for(B(Wa);!z(Sa);){var f=oa();c.body.push(f);d&&a&&E(f)&&(b=e,w(e=!0));d=!1}return e&&!b&&w(!1),D(c,"BlockStatement")}function na(a,b){return a.init=b,B(La),a.test=T===La?null:Y(),B(La),a.update=T===Ha?null:Y(),B(Ha),a.body=oa(),ra.pop(),D(a,"ForStatement")}function W(a,
b){return a.left=b,a.right=Y(),B(Ha),a.body=oa(),ra.pop(),D(a,"ForInStatement")}function fa(a,b){a.declarations=[];for(a.kind="var";;){var d=G();if(d.id=ba(),Da&&ib(d.id.name)&&c(d.id.start,"Binding "+d.id.name+" in strict mode"),d.init=z(pb)?Y(!0,b):null,a.declarations.push(D(d,"VariableDeclarator")),!z(Oa))break}return a}function Y(a,b){var c=J(b);if(!a&&T===Oa){var d=A(c);for(d.expressions=[c];z(Oa);)d.expressions.push(J(b));return D(d,"SequenceExpression")}return c}function J(a){var b=Pa(ha(),
-1,a);if(z(nb)){var c=A(b);b=(c.test=b,c.consequent=Y(!0),B(Xa),c.alternate=Y(!0,a),D(c,"ConditionalExpression"))}return T.isAssign?(c=A(b),c.operator=ta,c.left=b,x(),c.right=J(a),ia(b),D(c,"AssignmentExpression")):b}function Pa(a,b,c){var d=T.binop;if(null!=d&&(!c||T!==jb)&&d>b){var e=A(a);e.left=a;e.operator=ta;a=T;x();e.right=Pa(ha(),d,c);d=D(e,a===wb||a===xb?"LogicalExpression":"BinaryExpression");return Pa(d,b,c)}return a}function ha(){if(T.prefix){var a=G(),b=T.isUpdate;return a.operator=ta,
a.prefix=!0,Ga=!0,x(),a.argument=ha(),b?ia(a.argument):Da&&"delete"===a.operator&&"Identifier"===a.argument.type&&c(a.start,"Deleting local variable in strict mode"),D(a,b?"UpdateExpression":"UnaryExpression")}for(b=X(Q());T.postfix&&!O();)a=A(b),a.operator=ta,a.prefix=!1,a.argument=b,ia(b),x(),b=D(a,"UpdateExpression");return b}function X(a,b){if(z(mb)){var c=A(a);return c.object=a,c.property=ba(!0),c.computed=!1,X(D(c,"MemberExpression"),b)}return z(eb)?(c=A(a),c.object=a,c.property=Y(),c.computed=
!0,B(fb),X(D(c,"MemberExpression"),b)):!b&&z(Ka)?(c=A(a),c.callee=a,c.arguments=ua(Ha,!1),X(D(c,"CallExpression"),b)):a}function Q(){switch(T){case Nb:var a=G();return x(),D(a,"ThisExpression");case Ua:return ba();case za:case bb:case Ia:return a=G(),a.value=ta,a.raw=N.slice(R,da),x(),D(a,"Literal");case Ob:case Pb:case Qb:return a=G(),a.value=T.atomValue,a.raw=T.keyword,x(),D(a,"Literal");case Ka:a=xa;var b=R;x();var d=Y();return d.start=b,d.end=da,S.locations&&(d.loc.start=a,d.loc.end=ma),S.ranges&&
(d.range=[b,da]),B(Ha),d;case eb:return a=G(),x(),a.elements=ua(fb,!0,!0),D(a,"ArrayExpression");case Wa:a=G();b=!0;d=!1;a.properties=[];for(x();!z(Sa);){if(b)b=!1;else if(B(Oa),S.allowTrailingCommas&&z(Sa))break;var e,f={key:T===za||T===bb?Q():ba(!0)},g=!1;if(z(Xa)?(f.value=Y(!0),e=f.kind="init"):5<=S.ecmaVersion&&"Identifier"===f.key.type&&("get"===f.key.name||"set"===f.key.name)?(g=d=!0,e=f.kind=f.key.name,f.key=T===za||T===bb?Q():ba(!0),T!==Ka&&F(),f.value=ea(G(),!1)):F(),"Identifier"===f.key.type&&
(Da||d))for(var h=0;h<a.properties.length;++h){var k=a.properties[h];if(k.key.name===f.key.name){var m=e==k.kind||g&&"init"===k.kind||"init"===e&&("get"===k.kind||"set"===k.kind);m&&!Da&&"init"===e&&"init"===k.kind&&(m=!1);m&&c(f.key.start,"Redefinition of property")}}a.properties.push(f)}return D(a,"ObjectExpression");case ub:return a=G(),x(),ea(a,!1);case Rb:return a=G(),x(),a.callee=X(Q(),!0),z(Ka)?a.arguments=ua(Ha,!1):a.arguments=Ja,D(a,"NewExpression");default:F()}}function ea(a,b){T===Ua?a.id=
ba():b?F():a.id=null;a.params=[];var d=!0;for(B(Ka);!z(Ha);)d?d=!1:B(Oa),a.params.push(ba());d=Aa;var e=ra;if(Aa=!0,ra=[],a.body=ja(!0),Aa=d,ra=e,Da||a.body.body.length&&E(a.body.body[0]))for(d=a.id?-1:0;d<a.params.length;++d)if(e=0>d?a.id:a.params[d],(Sb(e.name)||ib(e.name))&&c(e.start,"Defining '"+e.name+"' in strict mode"),0<=d)for(var f=0;d>f;++f)e.name===a.params[f].name&&c(e.start,"Argument name clash in strict mode");return D(a,b?"FunctionDeclaration":"FunctionExpression")}function ua(a,b,
c){for(var d=[],e=!0;!z(a);){if(e)e=!1;else if(B(Oa),b&&S.allowTrailingCommas&&z(a))break;c&&T===Oa?d.push(null):d.push(Y(!0))}return d}function ba(a){var b=G();return a&&"everywhere"==S.forbidReserved&&(a=!1),T===Ua?(!a&&(S.forbidReserved&&(3===S.ecmaVersion?jc:kc)(ta)||Da&&Sb(ta))&&-1==N.slice(R,da).indexOf("\\")&&c(R,"The keyword '"+ta+"' is reserved"),b.name=ta):a&&T.keyword?b.name=T.keyword:F(),Ga=!1,x(),D(b,"Identifier")}a.version="0.5.0";var S,N,wa,aa;a.parse=function(a,c){N=String(a);wa=N.length;
b(c);pa=1;C=Fa=0;Ga=!0;h();var d=S.program;ya=Ba=C;S.locations&&(Ea=new e);Aa=Da=null;ra=[];m();var f=d||G(),g=!0;for(d||(f.body=[]);T!==Na;)d=oa(),f.body.push(d),g&&E(d)&&w(!0),g=!1;return D(f,"Program")};var Ca=a.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,allowReturnOutsideFunction:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null},ka=a.getLineInfo=function(a,b){for(var c=1,d=0;;){Va.lastIndex=d;var e=Va.exec(a);
if(!(e&&e.index<b))break;++c;d=e.index+e[0].length}return{line:c,column:b-d}};a.tokenize=function(a,c){function d(a){return Ba=da,m(a),e.start=R,e.end=da,e.startLoc=xa,e.endLoc=ma,e.type=T,e.value=ta,e}N=String(a);wa=N.length;b(c);pa=1;C=Fa=0;Ga=!0;h();var e={};return d.jumpTo=function(a,b){if(C=a,S.locations){pa=1;Fa=Va.lastIndex=0;for(var c;(c=Va.exec(N))&&c.index<a;)++pa,Fa=c.index+c[0].length}Ga=b;h()},d};var C,R,da,xa,ma,T,ta,Ga,pa,Fa,ya,Ba,Ea,Aa,ra,Da,Ja=[],za={type:"num"},Ia={type:"regexp"},
bb={type:"string"},Ua={type:"name"},Na={type:"eof"},Qa={keyword:"break"},Ra={keyword:"case",beforeExpr:!0},ab={keyword:"catch"},Bb={keyword:"continue"},Cb={keyword:"debugger"},Ib={keyword:"default"},Db={keyword:"do",isLoop:!0},Gb={keyword:"else",beforeExpr:!0},Lb={keyword:"finally"},Eb={keyword:"for",isLoop:!0},ub={keyword:"function"},Fb={keyword:"if"},Hb={keyword:"return",beforeExpr:!0},vb={keyword:"switch"},Jb={keyword:"throw",beforeExpr:!0},Kb={keyword:"try"},tb={keyword:"var"},sb={keyword:"while",
isLoop:!0},Mb={keyword:"with"},Rb={keyword:"new",beforeExpr:!0},Nb={keyword:"this"},Ob={keyword:"null",atomValue:null},Pb={keyword:"true",atomValue:!0},Qb={keyword:"false",atomValue:!1},jb={keyword:"in",binop:7,beforeExpr:!0},qb={"break":Qa,"case":Ra,"catch":ab,"continue":Bb,"debugger":Cb,"default":Ib,"do":Db,"else":Gb,"finally":Lb,"for":Eb,"function":ub,"if":Fb,"return":Hb,"switch":vb,"throw":Jb,"try":Kb,"var":tb,"while":sb,"with":Mb,"null":Ob,"true":Pb,"false":Qb,"new":Rb,"in":jb,"instanceof":{keyword:"instanceof",
binop:7,beforeExpr:!0},"this":Nb,"typeof":{keyword:"typeof",prefix:!0,beforeExpr:!0},"void":{keyword:"void",prefix:!0,beforeExpr:!0},"delete":{keyword:"delete",prefix:!0,beforeExpr:!0}},eb={type:"[",beforeExpr:!0},fb={type:"]"},Wa={type:"{",beforeExpr:!0},Sa={type:"}"},Ka={type:"(",beforeExpr:!0},Ha={type:")"},Oa={type:",",beforeExpr:!0},La={type:";",beforeExpr:!0},Xa={type:":",beforeExpr:!0},mb={type:"."},nb={type:"?",beforeExpr:!0},ob={binop:10,beforeExpr:!0},pb={isAssign:!0,beforeExpr:!0},Ta={isAssign:!0,
beforeExpr:!0},cc={postfix:!0,prefix:!0,isUpdate:!0},yb={prefix:!0,beforeExpr:!0},wb={binop:1,beforeExpr:!0},xb={binop:2,beforeExpr:!0},$b={binop:3,beforeExpr:!0},bc={binop:4,beforeExpr:!0},ac={binop:5,beforeExpr:!0},gc={binop:6,beforeExpr:!0},fc={binop:7,beforeExpr:!0},ec={binop:8,beforeExpr:!0},dc={binop:9,prefix:!0,beforeExpr:!0},Zb={binop:10,beforeExpr:!0};a.tokTypes={bracketL:eb,bracketR:fb,braceL:Wa,braceR:Sa,parenL:Ka,parenR:Ha,comma:Oa,semi:La,colon:Xa,dot:mb,question:nb,slash:ob,eq:pb,name:Ua,
eof:Na,num:za,regexp:Ia,string:bb};for(var Tb in qb)a.tokTypes["_"+Tb]=qb[Tb];var Ya,jc=d("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),kc=d("class enum extends super const export import"),Sb=d("implements interface let package private protected public static yield"),ib=d("eval arguments"),hc=d("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),
Yb=/[\u1680\u180e\u2000-\u200a\u202f\u205f\u3000\ufeff]/,zb=RegExp("[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]"),
lc=RegExp("[\u00aa\u00b5\u00ba\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u0620-\u0649\u0672-\u06d3\u06e7-\u06e8\u06fb-\u06fc\u0730-\u074a\u0800-\u0814\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0840-\u0857\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962-\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09d7\u09df-\u09e0\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5f-\u0b60\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62-\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2-\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d46-\u0d48\u0d57\u0d62-\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e34-\u0e3a\u0e40-\u0e45\u0e50-\u0e59\u0eb4-\u0eb9\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f41-\u0f47\u0f71-\u0f84\u0f86-\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1029\u1040-\u1049\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u170e-\u1710\u1720-\u1730\u1740-\u1750\u1772\u1773\u1780-\u17b2\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1920-\u192b\u1930-\u193b\u1951-\u196d\u19b0-\u19c0\u19c8-\u19c9\u19d0-\u19d9\u1a00-\u1a15\u1a20-\u1a53\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b46-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1bb0-\u1bb9\u1be6-\u1bf3\u1c00-\u1c22\u1c40-\u1c49\u1c5b-\u1c7d\u1cd0-\u1cd2\u1d00-\u1dbe\u1e01-\u1f15\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2d81-\u2d96\u2de0-\u2dff\u3021-\u3028\u3099\u309a\ua640-\ua66d\ua674-\ua67d\ua69f\ua6f0-\ua6f1\ua7f8-\ua800\ua806\ua80b\ua823-\ua827\ua880-\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8f3-\ua8f7\ua900-\ua909\ua926-\ua92d\ua930-\ua945\ua980-\ua983\ua9b3-\ua9c0\uaa00-\uaa27\uaa40-\uaa41\uaa4c-\uaa4d\uaa50-\uaa59\uaa7b\uaae0-\uaae9\uaaf2-\uaaf3\uabc0-\uabe1\uabec\uabed\uabf0-\uabf9\ufb20-\ufb28\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]"),
hb=/[\n\r\u2028\u2029]/,Va=/\r\n|[\n\r\u2028\u2029]/g,gb=a.isIdentifierStart=function(a){return 65>a?36===a:91>a||(97>a?95===a:123>a||170<=a&&zb.test(String.fromCharCode(a)))},Ab=a.isIdentifierChar=function(a){return 48>a?36===a:58>a||!(65>a)&&(91>a||(97>a?95===a:123>a||170<=a&&lc.test(String.fromCharCode(a))))},rb={kind:"loop"},ic={kind:"switch"}});var r={"+":"__add","-":"__subtract","*":"__multiply","/":"__divide","%":"__modulo","==":"__equals","!=":"__equals"},u={"-":"__negate","+":null},v=e.each("add subtract multiply divide modulo equals negate".split(" "),
function(a){this["__"+a]="#"+a},{});return n.inject(v),q.inject(v),fa.inject(v),c&&("complete"===d.readyState?setTimeout(l):ba.add(c,{load:l})),{compile:h,execute:k,load:function(a){return a?m(a):l()},parse:f}}.call(this),paper=new (g.inject(e.exports,{enumerable:!0,Base:e,Numerical:h,Key:ya,DomEvent:ba,DomElement:ha,document:d,window:c,Symbol:oa,PlacedSymbol:G})),paper.agent.node&&require("./node/extend")(paper),"function"==typeof define&&define.amd?define("paper",paper):"object"==typeof module&&
module&&(module.exports=paper),paper}.call(this,"object"==typeof self?self:null);
(function(a){"object"===typeof exports&&"undefined"!==typeof module?module.exports=a():"function"===typeof define&&define.amd?define([],a):("undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:this).opentype=a()})(function(){return function e(b,c,d){function f(k,h){if(!c[k]){if(!b[k]){var m="function"==typeof require&&require;if(!h&&m)return m(k,!0);if(g)return g(k,!0);m=Error("Cannot find module '"+k+"'");throw m.code="MODULE_NOT_FOUND",m;}m=c[k]={exports:{}};
b[k][0].call(m.exports,function(c){var d=b[k][1][c];return f(d?d:c)},m,m.exports,e,b,c,d)}return c[k].exports}for(var g="function"==typeof require&&require,k=0;k<d.length;k++)f(d[k]);return f}({1:[function(b,c,d){function e(){this.table=new Uint16Array(16);this.trans=new Uint16Array(288)}function f(b,c){this.source=b;this.bitcount=this.tag=this.sourceIndex=0;this.dest=c;this.destLen=0;this.ltree=new e;this.dtree=new e}function g(b,c,d,e){var f;for(f=0;f<d;++f)b[f]=0;for(f=0;f<30-d;++f)b[f+d]=f/d|
0;d=e;for(f=0;30>f;++f)c[f]=d,d+=1<<b[f]}function k(b,c,d,e){var f,g;for(f=0;16>f;++f)b.table[f]=0;for(f=0;f<e;++f)b.table[c[d+f]]++;for(f=g=b.table[0]=0;16>f;++f)B[f]=g,g+=b.table[f];for(f=0;f<e;++f)c[d+f]&&(b.trans[B[c[d+f]]++]=f)}function l(b,c,d){if(!c)return d;for(;24>b.bitcount;)b.tag|=b.source[b.sourceIndex++]<<b.bitcount,b.bitcount+=8;var e=b.tag&65535>>>16-c;b.tag>>>=c;b.bitcount-=c;return e+d}function h(b,c){for(;24>b.bitcount;)b.tag|=b.source[b.sourceIndex++]<<b.bitcount,b.bitcount+=8;
var d=0,e=0,f=0,g=b.tag;do e=2*e+(g&1),g>>>=1,++f,d+=c.table[f],e-=c.table[f];while(0<=e);b.tag=g;b.bitcount-=f;return c.trans[d+e]}function m(b,c,d){for(;;){var e=h(b,c);if(256===e)return 0;if(256>e)b.dest[b.destLen++]=e;else{var f;e-=257;e=l(b,q[e],u[e]);var g=h(b,d);for(f=g=b.destLen-l(b,r[g],v[g]);f<g+e;++f)b.dest[b.destLen++]=b.dest[f]}}}var n=new e,p=new e,q=new Uint8Array(30),u=new Uint16Array(30),r=new Uint8Array(30),v=new Uint16Array(30),A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,
3,13,2,14,1,15]),y=new e,F=new Uint8Array(320),B=new Uint16Array(16);(function(b,c){var d;for(d=0;7>d;++d)b.table[d]=0;b.table[7]=24;b.table[8]=152;b.table[9]=112;for(d=0;24>d;++d)b.trans[d]=256+d;for(d=0;144>d;++d)b.trans[24+d]=d;for(d=0;8>d;++d)b.trans[168+d]=280+d;for(d=0;112>d;++d)b.trans[176+d]=144+d;for(d=0;5>d;++d)c.table[d]=0;c.table[5]=32;for(d=0;32>d;++d)c.trans[d]=d})(n,p);g(q,u,4,3);g(r,v,2,1);q[28]=0;u[28]=258;c.exports=function(b,c){var d=new f(b,c);do{var e=d;e.bitcount--||(e.tag=e.source[e.sourceIndex++],
e.bitcount=7);var g=e.tag&1;e.tag>>>=1;e=g;g=l(d,2,0);switch(g){case 0:for(g=d;8<g.bitcount;)g.sourceIndex--,g.bitcount-=8;var q=g.source[g.sourceIndex+1];q=256*q+g.source[g.sourceIndex];var r=g.source[g.sourceIndex+3];r=256*r+g.source[g.sourceIndex+2];if(q!==(~r&65535))g=-3;else{g.sourceIndex+=4;for(r=q;r;--r)g.dest[g.destLen++]=g.source[g.sourceIndex++];g=g.bitcount=0}break;case 1:g=m(d,n,p);break;case 2:var u;q=d;var v=d.ltree,w=d.dtree;r=l(q,5,257);g=l(q,5,1);var B=l(q,4,4);for(u=0;19>u;++u)F[u]=
0;for(u=0;u<B;++u){var E=l(q,3,0);F[A[u]]=E}k(y,F,0,19);for(u=0;u<r+g;)switch(B=h(q,y),B){case 16:E=F[u-1];for(B=l(q,2,3);B;--B)F[u++]=E;break;case 17:for(B=l(q,3,3);B;--B)F[u++]=0;break;case 18:for(B=l(q,7,11);B;--B)F[u++]=0;break;default:F[u++]=B}k(v,F,0,r);k(w,F,r,g);g=m(d,d.ltree,d.dtree);break;default:g=-3}if(0!==g)throw Error("Data error");}while(!e);return d.destLen<d.dest.length?"function"===typeof d.dest.slice?d.dest.slice(0,d.destLen):d.dest.subarray(0,d.destLen):d.dest}},{}],2:[function(b,
c,d){d.fail=function(b){throw Error(b);};d.argument=function(b,c){b||d.fail(c)};d.assert=d.argument},{}],3:[function(b,c,d){d.line=function(b,c,d,k,l){b.beginPath();b.moveTo(c,d);b.lineTo(k,l);b.stroke()}},{}],4:[function(b,c,d){function e(b){this.font=b}function f(b){this.cmap=b}function g(b,c){this.encoding=b;this.charset=c}function k(b){var c;switch(b.version){case 1:this.names=d.standardNames.slice();break;case 2:this.names=Array(b.numberOfGlyphs);for(c=0;c<b.numberOfGlyphs;c++)this.names[c]=
b.glyphNameIndex[c]<d.standardNames.length?d.standardNames[b.glyphNameIndex[c]]:b.names[b.glyphNameIndex[c]-d.standardNames.length];break;case 2.5:this.names=Array(b.numberOfGlyphs);for(c=0;c<b.numberOfGlyphs;c++)this.names[c]=d.standardNames[c+b.glyphNameIndex[c]];break;case 3:this.names=[]}}e.prototype.charToGlyphIndex=function(b){b=b.charCodeAt(0);var c=this.font.glyphs;if(c)for(var d=0;d<c.length;d+=1)for(var e=c.get(d),f=0;f<e.unicodes.length;f+=1){if(e.unicodes[f]===b)return d}else return null};
f.prototype.charToGlyphIndex=function(b){return this.cmap.glyphIndexMap[b.charCodeAt(0)]||0};g.prototype.charToGlyphIndex=function(b){b=b.charCodeAt(0);return this.charset.indexOf(this.encoding[b])};k.prototype.nameToGlyphIndex=function(b){return this.names.indexOf(b)};k.prototype.glyphIndexToName=function(b){return this.names[b]};d.cffStandardStrings=".notdef;space;exclam;quotedbl;numbersign;dollar;percent;ampersand;quoteright;parenleft;parenright;asterisk;plus;comma;hyphen;period;slash;zero;one;two;three;four;five;six;seven;eight;nine;colon;semicolon;less;equal;greater;question;at;A;B;C;D;E;F;G;H;I;J;K;L;M;N;O;P;Q;R;S;T;U;V;W;X;Y;Z;bracketleft;backslash;bracketright;asciicircum;underscore;quoteleft;a;b;c;d;e;f;g;h;i;j;k;l;m;n;o;p;q;r;s;t;u;v;w;x;y;z;braceleft;bar;braceright;asciitilde;exclamdown;cent;sterling;fraction;yen;florin;section;currency;quotesingle;quotedblleft;guillemotleft;guilsinglleft;guilsinglright;fi;fl;endash;dagger;daggerdbl;periodcentered;paragraph;bullet;quotesinglbase;quotedblbase;quotedblright;guillemotright;ellipsis;perthousand;questiondown;grave;acute;circumflex;tilde;macron;breve;dotaccent;dieresis;ring;cedilla;hungarumlaut;ogonek;caron;emdash;AE;ordfeminine;Lslash;Oslash;OE;ordmasculine;ae;dotlessi;lslash;oslash;oe;germandbls;onesuperior;logicalnot;mu;trademark;Eth;onehalf;plusminus;Thorn;onequarter;divide;brokenbar;degree;thorn;threequarters;twosuperior;registered;minus;eth;multiply;threesuperior;copyright;Aacute;Acircumflex;Adieresis;Agrave;Aring;Atilde;Ccedilla;Eacute;Ecircumflex;Edieresis;Egrave;Iacute;Icircumflex;Idieresis;Igrave;Ntilde;Oacute;Ocircumflex;Odieresis;Ograve;Otilde;Scaron;Uacute;Ucircumflex;Udieresis;Ugrave;Yacute;Ydieresis;Zcaron;aacute;acircumflex;adieresis;agrave;aring;atilde;ccedilla;eacute;ecircumflex;edieresis;egrave;iacute;icircumflex;idieresis;igrave;ntilde;oacute;ocircumflex;odieresis;ograve;otilde;scaron;uacute;ucircumflex;udieresis;ugrave;yacute;ydieresis;zcaron;exclamsmall;Hungarumlautsmall;dollaroldstyle;dollarsuperior;ampersandsmall;Acutesmall;parenleftsuperior;parenrightsuperior;266 ff;onedotenleader;zerooldstyle;oneoldstyle;twooldstyle;threeoldstyle;fouroldstyle;fiveoldstyle;sixoldstyle;sevenoldstyle;eightoldstyle;nineoldstyle;commasuperior;threequartersemdash;periodsuperior;questionsmall;asuperior;bsuperior;centsuperior;dsuperior;esuperior;isuperior;lsuperior;msuperior;nsuperior;osuperior;rsuperior;ssuperior;tsuperior;ff;ffi;ffl;parenleftinferior;parenrightinferior;Circumflexsmall;hyphensuperior;Gravesmall;Asmall;Bsmall;Csmall;Dsmall;Esmall;Fsmall;Gsmall;Hsmall;Ismall;Jsmall;Ksmall;Lsmall;Msmall;Nsmall;Osmall;Psmall;Qsmall;Rsmall;Ssmall;Tsmall;Usmall;Vsmall;Wsmall;Xsmall;Ysmall;Zsmall;colonmonetary;onefitted;rupiah;Tildesmall;exclamdownsmall;centoldstyle;Lslashsmall;Scaronsmall;Zcaronsmall;Dieresissmall;Brevesmall;Caronsmall;Dotaccentsmall;Macronsmall;figuredash;hypheninferior;Ogoneksmall;Ringsmall;Cedillasmall;questiondownsmall;oneeighth;threeeighths;fiveeighths;seveneighths;onethird;twothirds;zerosuperior;foursuperior;fivesuperior;sixsuperior;sevensuperior;eightsuperior;ninesuperior;zeroinferior;oneinferior;twoinferior;threeinferior;fourinferior;fiveinferior;sixinferior;seveninferior;eightinferior;nineinferior;centinferior;dollarinferior;periodinferior;commainferior;Agravesmall;Aacutesmall;Acircumflexsmall;Atildesmall;Adieresissmall;Aringsmall;AEsmall;Ccedillasmall;Egravesmall;Eacutesmall;Ecircumflexsmall;Edieresissmall;Igravesmall;Iacutesmall;Icircumflexsmall;Idieresissmall;Ethsmall;Ntildesmall;Ogravesmall;Oacutesmall;Ocircumflexsmall;Otildesmall;Odieresissmall;OEsmall;Oslashsmall;Ugravesmall;Uacutesmall;Ucircumflexsmall;Udieresissmall;Yacutesmall;Thornsmall;Ydieresissmall;001.000;001.001;001.002;001.003;Black;Bold;Book;Light;Medium;Regular;Roman;Semibold".split(";");
d.cffStandardEncoding="                                space exclam quotedbl numbersign dollar percent ampersand quoteright parenleft parenright asterisk plus comma hyphen period slash zero one two three four five six seven eight nine colon semicolon less equal greater question at A B C D E F G H I J K L M N O P Q R S T U V W X Y Z bracketleft backslash bracketright asciicircum underscore quoteleft a b c d e f g h i j k l m n o p q r s t u v w x y z braceleft bar braceright asciitilde                                   exclamdown cent sterling fraction yen florin section currency quotesingle quotedblleft guillemotleft guilsinglleft guilsinglright fi fl  endash dagger daggerdbl periodcentered  paragraph bullet quotesinglbase quotedblbase quotedblright guillemotright ellipsis perthousand  questiondown  grave acute circumflex tilde macron breve dotaccent dieresis  ring cedilla  hungarumlaut ogonek caron emdash                 AE  ordfeminine     Lslash Oslash OE ordmasculine      ae    dotlessi   lslash oslash oe germandbls".split(" ");
d.cffExpertEncoding="                                space exclamsmall Hungarumlautsmall  dollaroldstyle dollarsuperior ampersandsmall Acutesmall parenleftsuperior parenrightsuperior twodotenleader onedotenleader comma hyphen period fraction zerooldstyle oneoldstyle twooldstyle threeoldstyle fouroldstyle fiveoldstyle sixoldstyle sevenoldstyle eightoldstyle nineoldstyle colon semicolon commasuperior threequartersemdash periodsuperior questionsmall  asuperior bsuperior centsuperior dsuperior esuperior   isuperior   lsuperior msuperior nsuperior osuperior   rsuperior ssuperior tsuperior  ff fi fl ffi ffl parenleftinferior  parenrightinferior Circumflexsmall hyphensuperior Gravesmall Asmall Bsmall Csmall Dsmall Esmall Fsmall Gsmall Hsmall Ismall Jsmall Ksmall Lsmall Msmall Nsmall Osmall Psmall Qsmall Rsmall Ssmall Tsmall Usmall Vsmall Wsmall Xsmall Ysmall Zsmall colonmonetary onefitted rupiah Tildesmall                                   exclamdownsmall centoldstyle Lslashsmall   Scaronsmall Zcaronsmall Dieresissmall Brevesmall Caronsmall  Dotaccentsmall   Macronsmall   figuredash hypheninferior   Ogoneksmall Ringsmall Cedillasmall    onequarter onehalf threequarters questiondownsmall oneeighth threeeighths fiveeighths seveneighths onethird twothirds   zerosuperior onesuperior twosuperior threesuperior foursuperior fivesuperior sixsuperior sevensuperior eightsuperior ninesuperior zeroinferior oneinferior twoinferior threeinferior fourinferior fiveinferior sixinferior seveninferior eightinferior nineinferior centinferior dollarinferior periodinferior commainferior Agravesmall Aacutesmall Acircumflexsmall Atildesmall Adieresissmall Aringsmall AEsmall Ccedillasmall Egravesmall Eacutesmall Ecircumflexsmall Edieresissmall Igravesmall Iacutesmall Icircumflexsmall Idieresissmall Ethsmall Ntildesmall Ogravesmall Oacutesmall Ocircumflexsmall Otildesmall Odieresissmall OEsmall Oslashsmall Ugravesmall Uacutesmall Ucircumflexsmall Udieresissmall Yacutesmall Thornsmall Ydieresissmall".split(" ");
d.standardNames=".notdef .null nonmarkingreturn space exclam quotedbl numbersign dollar percent ampersand quotesingle parenleft parenright asterisk plus comma hyphen period slash zero one two three four five six seven eight nine colon semicolon less equal greater question at A B C D E F G H I J K L M N O P Q R S T U V W X Y Z bracketleft backslash bracketright asciicircum underscore grave a b c d e f g h i j k l m n o p q r s t u v w x y z braceleft bar braceright asciitilde Adieresis Aring Ccedilla Eacute Ntilde Odieresis Udieresis aacute agrave acircumflex adieresis atilde aring ccedilla eacute egrave ecircumflex edieresis iacute igrave icircumflex idieresis ntilde oacute ograve ocircumflex odieresis otilde uacute ugrave ucircumflex udieresis dagger degree cent sterling section bullet paragraph germandbls registered copyright trademark acute dieresis notequal AE Oslash infinity plusminus lessequal greaterequal yen mu partialdiff summation product pi integral ordfeminine ordmasculine Omega ae oslash questiondown exclamdown logicalnot radical florin approxequal Delta guillemotleft guillemotright ellipsis nonbreakingspace Agrave Atilde Otilde OE oe endash emdash quotedblleft quotedblright quoteleft quoteright divide lozenge ydieresis Ydieresis fraction currency guilsinglleft guilsinglright fi fl daggerdbl periodcentered quotesinglbase quotedblbase perthousand Acircumflex Ecircumflex Aacute Edieresis Egrave Iacute Icircumflex Idieresis Igrave Oacute Ocircumflex apple Ograve Uacute Ucircumflex Ugrave dotlessi circumflex tilde macron breve dotaccent ring cedilla hungarumlaut ogonek caron Lslash lslash Scaron scaron Zcaron zcaron brokenbar Eth eth Yacute yacute Thorn thorn minus multiply onesuperior twosuperior threesuperior onehalf onequarter threequarters franc Gbreve gbreve Idotaccent Scedilla scedilla Cacute cacute Ccaron ccaron dcroat".split(" ");
d.DefaultEncoding=e;d.CmapEncoding=f;d.CffEncoding=g;d.GlyphNames=k;d.addGlyphNames=function(b){for(var c,d=b.tables.cmap.glyphIndexMap,e=Object.keys(d),f=0;f<e.length;f+=1){var g=e[f];c=b.glyphs.get(d[g]);c.addUnicode(parseInt(g))}for(f=0;f<b.glyphs.length;f+=1)c=b.glyphs.get(f),b.cffEncoding?c.name=b.cffEncoding.charset[f]:b.glyphNames.names&&(c.name=b.glyphNames.glyphIndexToName(f))}},{}],5:[function(b,c,d){function e(b){b=b||{};b.empty||(m.checkArgument(b.familyName,"When creating a new Font object, familyName is required."),
m.checkArgument(b.styleName,"When creating a new Font object, styleName is required."),m.checkArgument(b.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),m.checkArgument(b.ascender,"When creating a new Font object, ascender is required."),m.checkArgument(b.descender,"When creating a new Font object, descender is required."),m.checkArgument(0>b.descender,"Descender should be negative (e.g. -512)."),this.names={fontFamily:{en:b.familyName||" "},fontSubfamily:{en:b.styleName||" "},
fullName:{en:b.fullName||b.familyName+" "+b.styleName},postScriptName:{en:b.postScriptName||b.familyName+b.styleName},designer:{en:b.designer||" "},designerURL:{en:b.designerURL||" "},manufacturer:{en:b.manufacturer||" "},manufacturerURL:{en:b.manufacturerURL||" "},license:{en:b.license||" "},licenseURL:{en:b.licenseURL||" "},version:{en:b.version||"Version 0.1"},description:{en:b.description||" "},copyright:{en:b.copyright||" "},trademark:{en:b.trademark||" "}},this.unitsPerEm=b.unitsPerEm||1E3,
this.ascender=b.ascender,this.descender=b.descender,this.createdTimestamp=b.createdTimestamp,this.tables={os2:{usWeightClass:b.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:b.widthClass||this.usWidthClasses.MEDIUM,fsSelection:b.fsSelection||this.fsSelectionValues.REGULAR}});this.supported=!0;this.glyphs=new l.GlyphSet(this,b.glyphs||[]);this.encoding=new k.DefaultEncoding(this);this.substitution=new h(this);this.tables=this.tables||{}}var f=b("./path"),g=b("./tables/sfnt"),k=b("./encoding"),
l=b("./glyphset"),h=b("./substitution"),m=b("./util");e.prototype.hasChar=function(b){return null!==this.encoding.charToGlyphIndex(b)};e.prototype.charToGlyphIndex=function(b){return this.encoding.charToGlyphIndex(b)};e.prototype.charToGlyph=function(b){b=this.charToGlyphIndex(b);(b=this.glyphs.get(b))||(b=this.glyphs.get(0));return b};e.prototype.stringToGlyphs=function(b){for(var c=[],d=0;d<b.length;d+=1)c.push(this.charToGlyph(b[d]));return c};e.prototype.nameToGlyphIndex=function(b){return this.glyphNames.nameToGlyphIndex(b)};
e.prototype.nameToGlyph=function(b){b=this.nametoGlyphIndex(b);(b=this.glyphs.get(b))||(b=this.glyphs.get(0));return b};e.prototype.glyphIndexToName=function(b){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(b):""};e.prototype.getKerningValue=function(b,c){b=b.index||b;c=c.index||c;var d=this.getGposKerningValue;return d?d(b,c):this.kerningPairs[b+","+c]||0};e.prototype.forEachGlyph=function(b,c,d,e,f,g){console.log("options",f);c=void 0!==c?c:0;d=void 0!==d?d:0;e=void 0!==
e?e:72;f=f||{};var h=void 0===f.kerning?!0:f.kerning,k=void 0===f.letterSpacing?0:f.letterSpacing,m=void 0===f.wordSpacing?0:f.wordSpacing,l=1/this.unitsPerEm*e;b=this.stringToGlyphs(b);for(var n=0;n<b.length;n+=1){var p=b[n];g(p,c,d,e,f);p.advanceWidth&&(c+=p.advanceWidth*l);if(h&&n<b.length-1){var q=this.getKerningValue(p,b[n+1]);c+=q*l}console.log("glyph",p);c+=k;"space"==p.name&&(c+=m)}};e.prototype.getPath=function(b,c,d,e,g){var h=new f.Path;this.forEachGlyph(b,c,d,e,g,function(b,c,d,e){b=b.getPath(c,
d,e);h.extend(b)});return h};e.prototype.getPaths=function(b,c,d,e,f){var g=[];this.forEachGlyph(b,c,d,e,f,function(b,c,d,e){b=b.getPath(c,d,e);g.push(b)});return g};e.prototype.draw=function(b,c,d,e,f,g){this.getPath(c,d,e,f,g).draw(b)};e.prototype.drawPoints=function(b,c,d,e,f,g){this.forEachGlyph(c,d,e,f,g,function(c,d,e,f){c.drawPoints(b,d,e,f)})};e.prototype.drawMetrics=function(b,c,d,e,f,g){this.forEachGlyph(c,d,e,f,g,function(c,d,e,f){c.drawMetrics(b,d,e,f)})};e.prototype.getEnglishName=function(b){if(b=
this.names[b])return b.en};e.prototype.validate=function(){function b(b){var e=d.getEnglishName(b);e&&0<e.trim().length||c.push("No English "+b+" specified.")}var c=[],d=this;b("fontFamily");b("weightName");b("manufacturer");b("copyright");b("version");0<this.unitsPerEm||c.push("No unitsPerEm specified.")};e.prototype.toTables=function(){return g.fontToTable(this)};e.prototype.toBuffer=function(){console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead.");return this.toArrayBuffer()};
e.prototype.toArrayBuffer=function(){for(var b=this.toTables().encode(),c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0;e<b.length;e++)d[e]=b[e];return c};e.prototype.download=function(){var c=this.getEnglishName("fontFamily"),d=this.getEnglishName("fontSubfamily"),e=c.replace(/\s/g,"")+"-"+d+".otf",f=this.toArrayBuffer();m.isBrowser()?(window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem,window.requestFileSystem(window.TEMPORARY,f.byteLength,function(b){b.root.getFile(e,
{create:!0},function(b){b.createWriter(function(c){var d=new DataView(f);d=new Blob([d],{type:"font/opentype"});c.write(d);c.addEventListener("writeend",function(){location.href=b.toURL()},!1)})})},function(b){throw Error(b.name+": "+b.message);})):(c=b("fs"),d=m.arrayBufferToNodeBuffer(f),c.writeFileSync(e,d))};e.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};e.prototype.usWidthClasses={ULTRA_CONDENSED:1,
EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};e.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};d.Font=e},{"./encoding":4,"./glyphset":7,"./path":11,"./substitution":12,"./tables/sfnt":31,"./util":33,fs:void 0}],6:[function(b,c,d){function e(b,c){var d=c||{commands:[]};return{configurable:!0,get:function(){"function"===typeof d&&(d=d());return d},
set:function(b){d=b}}}function f(b){this.bindConstructorValues(b)}var g=b("./check"),k=b("./draw"),l=b("./path");f.prototype.bindConstructorValues=function(b){this.index=b.index||0;this.name=b.name||null;this.unicode=b.unicode||void 0;this.unicodes=b.unicodes||void 0!==b.unicode?[b.unicode]:[];b.xMin&&(this.xMin=b.xMin);b.yMin&&(this.yMin=b.yMin);b.xMax&&(this.xMax=b.xMax);b.yMax&&(this.yMax=b.yMax);b.advanceWidth&&(this.advanceWidth=b.advanceWidth);Object.defineProperty(this,"path",e(this,b.path))};
f.prototype.addUnicode=function(b){0===this.unicodes.length&&(this.unicode=b);this.unicodes.push(b)};f.prototype.getPath=function(b,c,d,e){b=void 0!==b?b:0;c=void 0!==c?c:0;e=void 0!==e?e:{xScale:1,yScale:1};var f=1/this.path.unitsPerEm*(void 0!==d?d:72);d=e.xScale*f;e=e.yScale*f;f=new l.Path;for(var g=this.path.commands,h=0;h<g.length;h+=1){var k=g[h];"M"===k.type?f.moveTo(b+k.x*d,c+-k.y*e):"L"===k.type?f.lineTo(b+k.x*d,c+-k.y*e):"Q"===k.type?f.quadraticCurveTo(b+k.x1*d,c+-k.y1*e,b+k.x*d,c+-k.y*
e):"C"===k.type?f.curveTo(b+k.x1*d,c+-k.y1*e,b+k.x2*d,c+-k.y2*e,b+k.x*d,c+-k.y*e):"Z"===k.type&&f.closePath()}return f};f.prototype.getContours=function(){if(void 0===this.points)return[];for(var b=[],c=[],d=0;d<this.points.length;d+=1){var e=this.points[d];c.push(e);e.lastPointOfContour&&(b.push(c),c=[])}g.argument(0===c.length,"There are still points left in the current contour.");return b};f.prototype.getMetrics=function(){for(var b=this.path.commands,c=[],d=[],e=0;e<b.length;e+=1){var f=b[e];
"Z"!==f.type&&(c.push(f.x),d.push(f.y));if("Q"===f.type||"C"===f.type)c.push(f.x1),d.push(f.y1);"C"===f.type&&(c.push(f.x2),d.push(f.y2))}b={xMin:Math.min.apply(null,c),yMin:Math.min.apply(null,d),xMax:Math.max.apply(null,c),yMax:Math.max.apply(null,d),leftSideBearing:this.leftSideBearing};isFinite(b.xMin)||(b.xMin=0);isFinite(b.xMax)||(b.xMax=this.advanceWidth);isFinite(b.yMin)||(b.yMin=0);isFinite(b.yMax)||(b.yMax=0);b.rightSideBearing=this.advanceWidth-b.leftSideBearing-(b.xMax-b.xMin);return b};
f.prototype.draw=function(b,c,d,e,f){this.getPath(c,d,e,f).draw(b)};f.prototype.drawPoints=function(b,c,d,e){function f(c,d,e,f){var g=2*Math.PI;b.beginPath();for(var h=0;h<c.length;h+=1)b.moveTo(d+c[h].x*f,e+c[h].y*f),b.arc(d+c[h].x*f,e+c[h].y*f,2,0,g,!1);b.closePath();b.fill()}c=void 0!==c?c:0;d=void 0!==d?d:0;e=1/this.path.unitsPerEm*(void 0!==e?e:24);for(var g=[],h=[],k=this.path,m=0;m<k.commands.length;m+=1){var l=k.commands[m];void 0!==l.x&&g.push({x:l.x,y:-l.y});void 0!==l.x1&&h.push({x:l.x1,
y:-l.y1});void 0!==l.x2&&h.push({x:l.x2,y:-l.y2})}b.fillStyle="blue";f(g,c,d,e);b.fillStyle="red";f(h,c,d,e)};f.prototype.drawMetrics=function(b,c,d,e){c=void 0!==c?c:0;d=void 0!==d?d:0;e=1/this.path.unitsPerEm*(void 0!==e?e:24);b.lineWidth=1;b.strokeStyle="black";k.line(b,c,-1E4,c,1E4);k.line(b,-1E4,d,1E4,d);var f=this.xMin||0,g=this.yMin||0,h=this.xMax||0,m=this.yMax||0,l=this.advanceWidth||0;b.strokeStyle="blue";k.line(b,c+f*e,-1E4,c+f*e,1E4);k.line(b,c+h*e,-1E4,c+h*e,1E4);k.line(b,-1E4,d+-g*e,
1E4,d+-g*e);k.line(b,-1E4,d+-m*e,1E4,d+-m*e);b.strokeStyle="green";k.line(b,c+l*e,-1E4,c+l*e,1E4)};d.Glyph=f},{"./check":2,"./draw":3,"./path":11}],7:[function(b,c,d){function e(b,c,d){Object.defineProperty(b,c,{get:function(){b.path;return b[d]},set:function(c){b[d]=c},enumerable:!0,configurable:!0})}function f(b,c){this.font=b;this.glyphs={};if(Array.isArray(c))for(var d=0;d<c.length;d++)this.glyphs[d]=c[d];this.length=c&&c.length||0}var g=b("./glyph");f.prototype.get=function(b){"function"===typeof this.glyphs[b]&&
(this.glyphs[b]=this.glyphs[b]());return this.glyphs[b]};f.prototype.push=function(b,c){this.glyphs[b]=c;this.length++};d.GlyphSet=f;d.glyphLoader=function(b,c){return new g.Glyph({index:c,font:b})};d.ttfGlyphLoader=function(b,c,d,f,n,p){return function(){var h=new g.Glyph({index:c,font:b});h.path=function(){d(h,f,n);var c=p(b.glyphs,h);c.unitsPerEm=b.unitsPerEm;return c};e(h,"xMin","_xMin");e(h,"xMax","_xMax");e(h,"yMin","_yMin");e(h,"yMax","_yMax");return h}};d.cffGlyphLoader=function(b,c,d,e){return function(){var f=
new g.Glyph({index:c,font:b});f.path=function(){var c=d(b,f,e);c.unitsPerEm=b.unitsPerEm;return c};return f}}},{"./glyph":6}],8:[function(b,c,d){function e(b,c){for(var d=0,e=b.length-1;d<=e;){var f=d+e>>>1,g=b[f].tag;if(g===c)return f;g<c?d=f+1:e=f-1}return-d-1}var f=b("./check");c.exports={searchTag:e,binSearch:function(b,c){for(var d=0,e=b.length-1;d<=e;){var f=d+e>>>1,g=b[f];if(g===c)return f;g<c?d=f+1:e=f-1}return-d-1},getScriptNames:function(){var b=this.getGsubTable();return b?b.scripts.map(function(b){return b.tag}):
[]},getScriptTable:function(b,c){var d=this.getGsubTable(c);if(d){var f=d.scripts;d=e(d.scripts,b);if(0<=d)return f[d].script;var g={tag:b,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};f.splice(-1-d,0,g.script);return g}},getLangSysTable:function(b,c,d){if(b=this.getScriptTable(b,d)){if("DFLT"===c)return b.defaultLangSys;var f=e(b.langSysRecords,c);if(0<=f)return b.langSysRecords[f].langSys;if(d)return c={tag:c,langSys:{reserved:0,reqFeatureIndex:65535,
featureIndexes:[]}},b.langSysRecords.splice(-1-f,0,c),c.langSys}},getFeatureTable:function(b,c,d,e){if(b=this.getLangSysTable(b,c,e)){c=b.featureIndexes;for(var g=this.font.tables.gsub.features,h=0;h<c.length;h++)if(b=g[c[h]],b.tag===d)return b.feature;if(e)return e=g.length,f.assert(0===e||d>=g[e-1].tag,"Features must be added in alphabetical order."),b={tag:d,feature:{params:0,lookupListIndexes:[]}},g.push(b),c.push(e),b.feature}},getLookupTable:function(b,c,d,e,f){if(b=this.getFeatureTable(b,c,
d,f)){c=b.lookupListIndexes;d=this.font.tables.gsub.lookups;for(var g=0;g<c.length;g++)if(b=d[c[g]],b.lookupType===e)return b;if(f)return b={lookupType:e,lookupFlag:0,subtables:[],markFilteringSet:void 0},e=d.length,d.push(b),c.push(e),b}},expandCoverage:function(b){if(1===b.format)return b.glyphs;var c=[];b=b.ranges;for(var d=0;d<b;d++){var e=b[d],f=e.end;for(e=e.start;e<=f;e++)c.push(e)}return c}}},{"./check":2}],9:[function(b,c,d){function e(c,d){b("fs").readFile(c,function(b,c){if(b)return d(b.message);
d(null,u.nodeBufferToArrayBuffer(c))})}function f(b,c){var d=new XMLHttpRequest;d.open("get",b,!0);d.responseType="arraybuffer";d.onload=function(){return 200!==d.status?c("Font could not be loaded: "+d.statusText):c(null,d.response)};d.send()}function g(b,c){for(var d=[],e=12,f=0;f<c;f+=1){var g=p.getTag(b,e),h=p.getULong(b,e+4),k=p.getULong(b,e+8),m=p.getULong(b,e+12);d.push({tag:g,checksum:h,offset:k,length:m,compression:!1});e+=16}return d}function k(b,c){if("WOFF"===c.compression){var d=new Uint8Array(b.buffer,
c.offset+2,c.compressedLength-2),e=new Uint8Array(c.originalLength);h(d,e);if(e.byteLength!==c.originalLength)throw Error("Decompression error: "+c.tag+" decompressed length doesn't match recorded length");return{data:new DataView(e.buffer,0),offset:0}}return{data:b,offset:c.offset}}function l(b){var c=new n.Font({empty:!0});b=new DataView(b,0);var d=p.getTag(b,0);if(d===String.fromCharCode(0,1,0,0)){c.outlinesFormat="truetype";d=p.getUShort(b,4);var e=g(b,d)}else if("OTTO"===d)c.outlinesFormat="cff",
d=p.getUShort(b,4),e=g(b,d);else if("wOFF"===d){e=p.getTag(b,4);if(e===String.fromCharCode(0,1,0,0))c.outlinesFormat="truetype";else if("OTTO"===e)c.outlinesFormat="cff";else throw Error("Unsupported OpenType flavor "+d);e=d=p.getUShort(b,12);for(var f=[],h=44,l=0;l<e;l+=1){var q=p.getTag(b,h),u=p.getULong(b,h+4),ia=p.getULong(b,h+8),wa=p.getULong(b,h+12);f.push({tag:q,offset:u,compression:ia<wa?"WOFF":!1,compressedLength:ia,originalLength:wa});h+=20}e=f}else throw Error("Unsupported OpenType signature "+
d);for(f=0;f<d;f+=1)switch(h=e[f],h.tag){case "cmap":h=k(b,h);c.tables.cmap=r.parse(h.data,h.offset);c.encoding=new m.CmapEncoding(c.tables.cmap);break;case "fvar":var ha=h;break;case "head":h=k(b,h);c.tables.head=w.parse(h.data,h.offset);c.unitsPerEm=c.tables.head.unitsPerEm;var ba=c.tables.head.indexToLocFormat;break;case "hhea":h=k(b,h);c.tables.hhea=E.parse(h.data,h.offset);c.ascender=c.tables.hhea.ascender;c.descender=c.tables.hhea.descender;c.numberOfHMetrics=c.tables.hhea.numberOfHMetrics;
break;case "hmtx":var ea=h;break;case "ltag":h=k(b,h);var Ga=G.parse(h.data,h.offset);break;case "maxp":h=k(b,h);c.tables.maxp=na.parse(h.data,h.offset);c.numGlyphs=c.tables.maxp.numGlyphs;break;case "name":var xa=h;break;case "OS/2":h=k(b,h);c.tables.os2=ja.parse(h.data,h.offset);break;case "post":h=k(b,h);c.tables.post=z.parse(h.data,h.offset);c.glyphNames=new m.GlyphNames(c.tables.post);break;case "glyf":var Ca=h;break;case "loca":var ya=h;break;case "CFF ":var Na=h;break;case "kern":var Ja=h;
break;case "GPOS":var za=h;break;case "GSUB":var Aa=h;break;case "meta":var R=h}xa=k(b,xa);c.tables.name=H.parse(xa.data,xa.offset,Ga);c.names=c.tables.name;if(Ca&&ya)ba=0===ba,ya=k(b,ya),ya=oa.parse(ya.data,ya.offset,c.numGlyphs,ba),Ca=k(b,Ca),c.glyphs=y.parse(Ca.data,Ca.offset,ya,c);else if(Na)Ca=k(b,Na),v.parse(Ca.data,Ca.offset,c);else throw Error("Font doesn't contain TrueType or CFF outlines.");ea=k(b,ea);x.parse(ea.data,ea.offset,c.numberOfHMetrics,c.numGlyphs,c.glyphs);m.addGlyphNames(c);
Ja?(Ja=k(b,Ja),c.kerningPairs=D.parse(Ja.data,Ja.offset)):c.kerningPairs={};za&&(za=k(b,za),F.parse(za.data,za.offset,c));Aa&&(Aa=k(b,Aa),c.tables.gsub=B.parse(Aa.data,Aa.offset));ha&&(ha=k(b,ha),c.tables.fvar=A.parse(ha.data,ha.offset,c.names));R&&(R=k(b,R),c.tables.meta=U.parse(R.data,R.offset),c.metas=c.tables.meta);return c}var h=b("tiny-inflate"),m=b("./encoding"),n=b("./font");c=b("./glyph");var p=b("./parse"),q=b("./path"),u=b("./util"),r=b("./tables/cmap"),v=b("./tables/cff"),A=b("./tables/fvar"),
y=b("./tables/glyf"),F=b("./tables/gpos"),B=b("./tables/gsub"),w=b("./tables/head"),E=b("./tables/hhea"),x=b("./tables/hmtx"),D=b("./tables/kern"),G=b("./tables/ltag"),oa=b("./tables/loca"),na=b("./tables/maxp"),H=b("./tables/name"),ja=b("./tables/os2"),z=b("./tables/post"),U=b("./tables/meta");d._parse=p;d.Font=n.Font;d.Glyph=c.Glyph;d.Path=q.Path;d.parse=l;d.load=function(b,c){("undefined"===typeof window?e:f)(b,function(b,d){if(b)return c(b);try{var e=l(d)}catch(Y){return c(Y,null)}return c(null,
e)})};d.loadSync=function(c){c=b("fs").readFileSync(c);return l(u.nodeBufferToArrayBuffer(c))}},{"./encoding":4,"./font":5,"./glyph":6,"./parse":10,"./path":11,"./tables/cff":14,"./tables/cmap":15,"./tables/fvar":16,"./tables/glyf":17,"./tables/gpos":18,"./tables/gsub":19,"./tables/head":20,"./tables/hhea":21,"./tables/hmtx":22,"./tables/kern":23,"./tables/loca":24,"./tables/ltag":25,"./tables/maxp":26,"./tables/meta":27,"./tables/name":28,"./tables/os2":29,"./tables/post":30,"./util":33,fs:void 0,
"tiny-inflate":1}],10:[function(b,c,d){function e(b,c){return b.getUint16(c,!1)}function f(b,c){this.data=b;this.offset=c;this.relativeOffset=0}var g=b("./check");d.getByte=function(b,c){return b.getUint8(c)};d.getCard8=d.getByte;d.getUShort=d.getCard16=e;d.getShort=function(b,c){return b.getInt16(c,!1)};d.getULong=function(b,c){return b.getUint32(c,!1)};d.getFixed=function(b,c){var d=b.getInt16(c,!1),e=b.getUint16(c+2,!1);return d+e/65535};d.getTag=function(b,c){for(var d="",e=c;e<c+4;e+=1)d+=String.fromCharCode(b.getInt8(e));
return d};d.getOffset=function(b,c,d){for(var e=0,f=0;f<d;f+=1)e<<=8,e+=b.getUint8(c+f);return e};d.getBytes=function(b,c,d){for(var e=[];c<d;c+=1)e.push(b.getUint8(c));return e};d.bytesToString=function(b){for(var c="",d=0;d<b.length;d+=1)c+=String.fromCharCode(b[d]);return c};var k={"byte":1,uShort:2,"short":2,uLong:4,fixed:4,longDateTime:8,tag:4};f.prototype.parseByte=function(){var b=this.data.getUint8(this.offset+this.relativeOffset);this.relativeOffset+=1;return b};f.prototype.parseChar=function(){var b=
this.data.getInt8(this.offset+this.relativeOffset);this.relativeOffset+=1;return b};f.prototype.parseCard8=f.prototype.parseByte;f.prototype.parseUShort=function(){var b=this.data.getUint16(this.offset+this.relativeOffset);this.relativeOffset+=2;return b};f.prototype.parseCard16=f.prototype.parseUShort;f.prototype.parseSID=f.prototype.parseUShort;f.prototype.parseOffset16=f.prototype.parseUShort;f.prototype.parseShort=function(){var b=this.data.getInt16(this.offset+this.relativeOffset);this.relativeOffset+=
2;return b};f.prototype.parseF2Dot14=function(){var b=this.data.getInt16(this.offset+this.relativeOffset)/16384;this.relativeOffset+=2;return b};f.prototype.parseULong=function(){var b=d.getULong(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return b};f.prototype.parseFixed=function(){var b=d.getFixed(this.data,this.offset+this.relativeOffset);this.relativeOffset+=4;return b};f.prototype.parseString=function(b){var c=this.data,d=this.offset+this.relativeOffset,e="";this.relativeOffset+=
b;for(var f=0;f<b;f++)e+=String.fromCharCode(c.getUint8(d+f));return e};f.prototype.parseTag=function(){return this.parseString(4)};f.prototype.parseLongDateTime=function(){var b=d.getULong(this.data,this.offset+this.relativeOffset+4);this.relativeOffset+=8;return b-2082844800};f.prototype.parseVersion=function(){var b=e(this.data,this.offset+this.relativeOffset),c=e(this.data,this.offset+this.relativeOffset+2);this.relativeOffset+=4;return b+c/4096/10};f.prototype.skip=function(b,c){void 0===c&&
(c=1);this.relativeOffset+=k[b]*c};f.prototype.parseOffset16List=f.prototype.parseUShortList=function(b){void 0===b&&(b=this.parseUShort());for(var c=Array(b),d=this.data,e=this.offset+this.relativeOffset,f=0;f<b;f++)c[f]=d.getUint16(e),e+=2;this.relativeOffset+=2*b;return c};f.prototype.parseList=function(b,c){c||(c=b,b=this.parseUShort());for(var d=Array(b),e=0;e<b;e++)d[e]=c.call(this);return d};f.prototype.parseRecordList=function(b,c){c||(c=b,b=this.parseUShort());for(var d=Array(b),e=Object.keys(c),
f=0;f<b;f++){for(var g={},h=0;h<e.length;h++){var k=e[h];g[k]=c[k].call(this)}d[f]=g}return d};f.prototype.parseStruct=function(b){if("function"===typeof b)return b.call(this);for(var c=Object.keys(b),d={},e=0;e<c.length;e++){var f=c[e];d[f]=b[f].call(this)}return d};f.prototype.parsePointer=function(b){var c=this.parseOffset16();if(0<c)return(new f(this.data,this.offset+c)).parseStruct(b)};f.prototype.parseListOfLists=function(b){for(var c=this.parseOffset16List(),d=c.length,e=this.relativeOffset,
f=Array(d),g=0;g<d;g++){var h=c[g];if(0===h)f[g]=void 0;else if(this.relativeOffset=h,b){for(var k=this.parseOffset16List(),l=Array(k.length),y=0;y<k.length;y++)this.relativeOffset=h+k[y],l[y]=b.call(this);f[g]=l}else f[g]=this.parseUShortList()}this.relativeOffset=e;return f};f.prototype.parseCoverage=function(){var b=this.offset+this.relativeOffset,c=this.parseUShort(),d=this.parseUShort();if(1===c)return{format:1,glyphs:this.parseUShortList(d)};if(2===c){b=Array(d);for(c=0;c<d;c++)b[c]={start:this.parseUShort(),
end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:b}}g.assert(!1,"0x"+b.toString(16)+": Coverage format must be 1 or 2.")};f.prototype.parseClassDef=function(){var b=this.offset+this.relativeOffset,c=this.parseUShort();if(1===c)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(2===c)return{format:2,ranges:this.parseRecordList({start:f.uShort,end:f.uShort,classId:f.uShort})};g.assert(!1,"0x"+b.toString(16)+": ClassDef format must be 1 or 2.")};f.list=
function(b,c){return function(){return this.parseList(b,c)}};f.recordList=function(b,c){return function(){return this.parseRecordList(b,c)}};f.pointer=function(b){return function(){return this.parsePointer(b)}};f.tag=f.prototype.parseTag;f["byte"]=f.prototype.parseByte;f.uShort=f.offset16=f.prototype.parseUShort;f.uShortList=f.prototype.parseUShortList;f.struct=f.prototype.parseStruct;f.coverage=f.prototype.parseCoverage;f.classDef=f.prototype.parseClassDef;var l={reserved:f.uShort,reqFeatureIndex:f.uShort,
featureIndexes:f.uShortList};f.prototype.parseScriptList=function(){return this.parsePointer(f.recordList({tag:f.tag,script:f.pointer({defaultLangSys:f.pointer(l),langSysRecords:f.recordList({tag:f.tag,langSys:f.pointer(l)})})}))};f.prototype.parseFeatureList=function(){return this.parsePointer(f.recordList({tag:f.tag,feature:f.pointer({featureParams:f.offset16,lookupListIndexes:f.uShortList})}))};f.prototype.parseLookupList=function(b){return this.parsePointer(f.list(f.pointer(function(){var c=this.parseUShort();
g.argument(1<=c&&8>=c,"GSUB lookup type "+c+" unknown.");var d=this.parseUShort(),e=d&16;return{lookupType:c,lookupFlag:d,subtables:this.parseList(f.pointer(b[c])),markFilteringSet:e?this.parseUShort():void 0}})))};d.Parser=f},{"./check":2}],11:[function(b,c,d){function e(){this.commands=[];this.fill="black";this.stroke=null;this.strokeWidth=1}e.prototype.moveTo=function(b,c){this.commands.push({type:"M",x:b,y:c})};e.prototype.lineTo=function(b,c){this.commands.push({type:"L",x:b,y:c})};e.prototype.curveTo=
e.prototype.bezierCurveTo=function(b,c,d,e,h,m){this.commands.push({type:"C",x1:b,y1:c,x2:d,y2:e,x:h,y:m})};e.prototype.quadTo=e.prototype.quadraticCurveTo=function(b,c,d,e){this.commands.push({type:"Q",x1:b,y1:c,x:d,y:e})};e.prototype.close=e.prototype.closePath=function(){this.commands.push({type:"Z"})};e.prototype.extend=function(b){b.commands&&(b=b.commands);Array.prototype.push.apply(this.commands,b)};e.prototype.draw=function(b){b.beginPath();for(var c=0;c<this.commands.length;c+=1){var d=this.commands[c];
"M"===d.type?b.moveTo(d.x,d.y):"L"===d.type?b.lineTo(d.x,d.y):"C"===d.type?b.bezierCurveTo(d.x1,d.y1,d.x2,d.y2,d.x,d.y):"Q"===d.type?b.quadraticCurveTo(d.x1,d.y1,d.x,d.y):"Z"===d.type&&b.closePath()}this.fill&&(b.fillStyle=this.fill,b.fill());this.stroke&&(b.strokeStyle=this.stroke,b.lineWidth=this.strokeWidth,b.stroke())};e.prototype.toPathData=function(b){function c(){for(var c="",d=0;d<arguments.length;d+=1){var e=arguments[d];0<=e&&0<d&&(c+=" ");e=Math.round(e)===e?""+Math.round(e):e.toFixed(b);
c+=e}return c}b=void 0!==b?b:2;for(var d="",e=0;e<this.commands.length;e+=1){var f=this.commands[e];"M"===f.type?d+="M"+c(f.x,f.y):"L"===f.type?d+="L"+c(f.x,f.y):"C"===f.type?d+="C"+c(f.x1,f.y1,f.x2,f.y2,f.x,f.y):"Q"===f.type?d+="Q"+c(f.x1,f.y1,f.x,f.y):"Z"===f.type&&(d+="Z")}return d};e.prototype.toSVG=function(b){b='<path d="'+this.toPathData(b);b+='"';this.fill&&"black"!==this.fill&&(b=null===this.fill?b+' fill="none"':b+(' fill="'+this.fill+'"'));this.stroke&&(b+=' stroke="'+this.stroke+'" stroke-width="'+
this.strokeWidth+'"');return b+"/>"};d.Path=e},{}],12:[function(b,c,d){function e(b,c,d){b=b.subtables;for(var e=0;e<b.length;e++){var f=b[e];if(f.substFormat===c)return f}if(d)return b.push(d),d}var f=b("./check");b=b("./layout");d=function(b){this.font=b};d.prototype=b;d.prototype.getGsubTable=function(b){var c=this.font.tables.gsub;!c&&b&&(this.font.tables.gsub=c={version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],
lookups:[]});return c};d.prototype.getSingle=function(b,c,d){var e=[];b=this.getLookupTable(c,d,b,1);if(!b)return e;b=b.subtables;for(c=0;c<b.length;c++){var f=b[c];d=this.expandCoverage(f.coverage);if(1===f.substFormat){var g=f.deltaGlyphId;for(f=0;f<d.length;f++){var k=d[f];e.push({sub:k,by:k+g})}}else for(g=f.substitute,f=0;f<d.length;f++)e.push({sub:d[f],by:g[f]})}return e};d.prototype.getAlternates=function(b,c,d){var e=[];b=this.getLookupTable(c,d,b,3);if(!b)return e;b=b.subtables;for(c=0;c<
b.length;c++){var f=b[c];d=this.expandCoverage(f.coverage);f=f.alternateSets;for(var g=0;g<d.length;g++)e.push({sub:d[g],by:f[g]})}return e};d.prototype.getLigatures=function(b,c,d){var e=[];b=this.getLookupTable(c,d,b,4);if(!b)return[];b=b.subtables;for(c=0;c<b.length;c++){var f=b[c];d=this.expandCoverage(f.coverage);f=f.ligatureSets;for(var g=0;g<d.length;g++)for(var k=d[g],l=f[g],u=0;u<l.length;u++){var r=l[u];e.push({sub:[k].concat(r.components),by:r.ligGlyph})}}return e};d.prototype.addSingle=
function(b,c,d,h){b=this.getLookupTable(d,h,b,1,!0);b=e(b,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});f.assert(1===b.coverage.format,"Ligature: unable to modify coverage table format "+b.coverage.format);d=c.sub;h=this.binSearch(b.coverage.glyphs,d);0>h&&(h=-1-h,b.coverage.glyphs.splice(h,0,d),b.substitute.splice(h,0,0));b.substitute[h]=c.by};d.prototype.addAlternate=function(b,c,d,h){b=this.getLookupTable(d,h,b,3,!0);b=e(b,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});
f.assert(1===b.coverage.format,"Ligature: unable to modify coverage table format "+b.coverage.format);d=c.sub;h=this.binSearch(b.coverage.glyphs,d);0>h&&(h=-1-h,b.coverage.glyphs.splice(h,0,d),b.alternateSets.splice(h,0,0));b.alternateSets[h]=c.by};d.prototype.addLigature=function(b,c,d,e){b=this.getLookupTable(d||"DFLT",e||"DFLT",b,4,!0);d=b.subtables[0];d||(d={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},b.subtables[0]=d);f.assert(1===d.coverage.format,"Ligature: unable to modify coverage table format "+
d.coverage.format);e=c.sub[0];b=c.sub.slice(1);c={ligGlyph:c.by,components:b};var g=this.binSearch(d.coverage.glyphs,e);if(0<=g){d=d.ligatureSets[g];for(e=0;e<d.length;e++){a:{g=d[e].components;var h=g.length;if(h!==b.length)g=!1;else{for(var k=0;k<h;k++)if(g[k]!==b[k]){g=!1;break a}g=!0}}if(g)return}d.push(c)}else g=-1-g,d.coverage.glyphs.splice(g,0,e),d.ligatureSets.splice(g,0,[c])};d.prototype.getFeature=function(b,c,d){c=c||"DFLT";d=d||"DFLT";if(/ss\d\d/.test(b))return this.getSingle(b,c,d);switch(b){case "aalt":case "salt":return this.getSingle(b,
c,d).concat(this.getAlternates(b,c,d));case "dlig":case "liga":case "rlig":return this.getLigatures(b,c,d)}};d.prototype.add=function(b,c,d,e){d=d||"DFLT";e=e||"DFLT";if(/ss\d\d/.test(b))return this.addSingle(b,c,d,e);switch(b){case "aalt":case "salt":return"number"===typeof c.by?this.addSingle(b,c,d,e):this.addAlternate(b,c,d,e);case "dlig":case "liga":case "rlig":return this.addLigature(b,c,d,e)}};c.exports=d},{"./check":2,"./layout":8}],13:[function(b,c,d){function e(b,c,d){var e;for(e=0;e<c.length;e+=
1){var f=c[e];this[f.name]=f.value}this.tableName=b;this.fields=c;if(d)for(b=Object.keys(d),e=0;e<b.length;e+=1)c=b[e],f=d[c],void 0!==this[c]&&(this[c]=f)}function f(b,c,d){void 0===d&&(d=c.length);var e=Array(c.length+1);e[0]={name:b+"Count",type:"USHORT",value:d};for(d=0;d<c.length;d++)e[d+1]={name:b+d,type:"USHORT",value:c[d]};return e}function g(b,c,d){var e=c.length,f=Array(e+1);f[0]={name:b+"Count",type:"USHORT",value:e};for(var g=0;g<e;g++)f[g+1]={name:b+g,type:"TABLE",value:d(c[g],g)};return f}
function k(b,c,d){var e=c.length,f=[];f[0]={name:b+"Count",type:"USHORT",value:e};for(b=0;b<e;b++)f=f.concat(d(c[b],b));return f}function l(b){1===b.format?e.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(f("glyph",b.glyphs))):p.assert(!1,"Can't create coverage table format 2 yet.")}function h(b){e.call(this,"scriptListTable",k("scriptRecord",b,function(b,c){var d=b.script,g=d.defaultLangSys;p.assert(!!g,"Unable to write GSUB: script "+b.tag+" has no default language system.");
return[{name:"scriptTag"+c,type:"TAG",value:b.tag},{name:"script"+c,type:"TABLE",value:new e("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new e("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:g.reqFeatureIndex}].concat(f("featureIndex",g.featureIndexes)))}].concat(k("langSys",d.langSysRecords,function(b,c){var d=b.langSys;return[{name:"langSysTag"+c,type:"TAG",value:b.tag},{name:"langSys"+c,type:"TABLE",value:new e("langSys",[{name:"lookupOrder",
type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:d.reqFeatureIndex}].concat(f("featureIndex",d.featureIndexes)))}]})))}]}))}function m(b){e.call(this,"featureListTable",k("featureRecord",b,function(b,c){var d=b.feature;return[{name:"featureTag"+c,type:"TAG",value:b.tag},{name:"feature"+c,type:"TABLE",value:new e("featureTable",[{name:"featureParams",type:"USHORT",value:d.featureParams}].concat(f("lookupListIndex",d.lookupListIndexes)))}]}))}function n(b,c){e.call(this,"lookupListTable",
g("lookup",b,function(b){var d=c[b.lookupType];p.assert(!!d,"Unable to write GSUB lookup type "+b.lookupType+" tables.");return new e("lookupTable",[{name:"lookupType",type:"USHORT",value:b.lookupType},{name:"lookupFlag",type:"USHORT",value:b.lookupFlag}].concat(g("subtable",b.subtables,d)))}))}var p=b("./check"),q=b("./types").encode,u=b("./types").sizeOf;e.prototype.encode=function(){return q.TABLE(this)};e.prototype.sizeOf=function(){return u.TABLE(this)};l.prototype=Object.create(e.prototype);
l.prototype.constructor=l;h.prototype=Object.create(e.prototype);h.prototype.constructor=h;m.prototype=Object.create(e.prototype);m.prototype.constructor=m;n.prototype=Object.create(e.prototype);n.prototype.constructor=n;d.Record=d.Table=e;d.Coverage=l;d.ScriptList=h;d.FeatureList=m;d.LookupList=n;d.ushortList=f;d.tableList=g;d.recordList=k},{"./check":2,"./types":32}],14:[function(b,c,d){function e(b,c){if(b===c)return!0;if(Array.isArray(b)&&Array.isArray(c)){if(b.length!==c.length)return!1;for(var d=
0;d<b.length;d+=1)if(!e(b[d],c[d]))return!1;return!0}return!1}function f(b,c,d){var e=[],f=[],g=y.getCard16(b,c),h;if(0!==g){var k=y.getByte(b,c+2);var m=c+(g+1)*k+2;var l=c+3;for(h=0;h<g+1;h+=1)e.push(y.getOffset(b,l,k)),l+=k;g=m+e[g]}else g=c+2;for(h=0;h<e.length-1;h+=1)k=y.getBytes(b,m+e[h],m+e[h+1]),d&&(k=d(k)),f.push(k);return{objects:f,startOffset:c,endOffset:g}}function g(b,c){if(28===c){var d=b.parseByte();var e=b.parseByte();return d<<8|e}if(29===c){d=b.parseByte();e=b.parseByte();var f=
b.parseByte();var g=b.parseByte();return d<<24|e<<16|f<<8|g}if(30===c){d="";for(e=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){g=b.parseByte();f=g>>4;g&=15;if(15===f)break;d+=e[f];if(15===g)break;d+=e[g]}return parseFloat(d)}if(32<=c&&246>=c)return c-139;if(247<=c&&250>=c)return d=b.parseByte(),256*(c-247)+d+108;if(251<=c&&254>=c)return d=b.parseByte(),256*-(c-251)-d-108;throw Error("Invalid b0 "+c);}function k(b,c,d){var e=new y.Parser(b,void 0!==c?c:0);c=[];var f=[];for(d=
void 0!==d?d:b.length;e.relativeOffset<d;)b=e.parseByte(),21>=b?(12===b&&(b=1200+e.parseByte()),c.push([b,f]),f=[]):f.push(g(e,b));d={};for(b=0;b<c.length;b+=1){e=c[b][0];f=c[b][1];f=1===f.length?f[0]:f;if(d.hasOwnProperty(e))throw Error("Object "+d+" already has key "+e);d[e]=f}return d}function l(b,c){return c=390>=c?v.cffStandardStrings[c]:b[c-391]}function h(b,c,d){for(var e={},f=0;f<c.length;f+=1){var g=c[f],h=b[g.op];void 0===h&&(h=void 0!==g.value?g.value:null);"SID"===g.type&&(h=l(d,h));e[g.name]=
h}return e}function m(b,c,d){function e(b,c){v&&n.closePath();n.moveTo(b,c);v=!0}function f(){0===p.length%2||r||(u=p.shift()+b.nominalWidthX);q+=p.length>>1;p.length=0;r=!0}function g(d){for(var y,A,B,z,E,D,G=0;G<d.length;)switch(A=d[G],G+=1,A){case 1:f();break;case 3:f();break;case 4:1<p.length&&!r&&(u=p.shift()+b.nominalWidthX,r=!0);w+=p.pop();e(x,w);break;case 5:for(;0<p.length;)x+=p.shift(),w+=p.shift(),n.lineTo(x,w);break;case 6:for(;0<p.length;){x+=p.shift();n.lineTo(x,w);if(0===p.length)break;
w+=p.shift();n.lineTo(x,w)}break;case 7:for(;0<p.length;){w+=p.shift();n.lineTo(x,w);if(0===p.length)break;x+=p.shift();n.lineTo(x,w)}break;case 8:for(;0<p.length;)h=x+p.shift(),k=w+p.shift(),m=h+p.shift(),l=k+p.shift(),x=m+p.shift(),w=l+p.shift(),n.curveTo(h,k,m,l,x,w);break;case 10:y=p.pop()+b.subrsBias;(y=b.subrs[y])&&g(y);break;case 11:return;case 12:A=d[G];G+=1;switch(A){case 35:h=x+p.shift();k=w+p.shift();m=h+p.shift();l=k+p.shift();y=m+p.shift();A=l+p.shift();B=y+p.shift();z=A+p.shift();E=
B+p.shift();D=z+p.shift();x=E+p.shift();w=D+p.shift();p.shift();n.curveTo(h,k,m,l,y,A);n.curveTo(B,z,E,D,x,w);break;case 34:h=x+p.shift();k=w;m=h+p.shift();l=k+p.shift();y=m+p.shift();A=l;B=y+p.shift();z=l;E=B+p.shift();D=w;x=E+p.shift();n.curveTo(h,k,m,l,y,A);n.curveTo(B,z,E,D,x,w);break;case 36:h=x+p.shift();k=w+p.shift();m=h+p.shift();l=k+p.shift();y=m+p.shift();A=l;B=y+p.shift();z=l;E=B+p.shift();D=z+p.shift();x=E+p.shift();n.curveTo(h,k,m,l,y,A);n.curveTo(B,z,E,D,x,w);break;case 37:h=x+p.shift();
k=w+p.shift();m=h+p.shift();l=k+p.shift();y=m+p.shift();A=l+p.shift();B=y+p.shift();z=A+p.shift();E=B+p.shift();D=z+p.shift();Math.abs(E-x)>Math.abs(D-w)?x=E+p.shift():w=D+p.shift();n.curveTo(h,k,m,l,y,A);n.curveTo(B,z,E,D,x,w);break;default:console.log("Glyph "+c.index+": unknown operator 1200"+A),p.length=0}break;case 14:0<p.length&&!r&&(u=p.shift()+b.nominalWidthX,r=!0);v&&(n.closePath(),v=!1);break;case 18:f();break;case 19:case 20:f();G+=q+7>>3;break;case 21:2<p.length&&!r&&(u=p.shift()+b.nominalWidthX,
r=!0);w+=p.pop();x+=p.pop();e(x,w);break;case 22:1<p.length&&!r&&(u=p.shift()+b.nominalWidthX,r=!0);x+=p.pop();e(x,w);break;case 23:f();break;case 24:for(;2<p.length;)h=x+p.shift(),k=w+p.shift(),m=h+p.shift(),l=k+p.shift(),x=m+p.shift(),w=l+p.shift(),n.curveTo(h,k,m,l,x,w);x+=p.shift();w+=p.shift();n.lineTo(x,w);break;case 25:for(;6<p.length;)x+=p.shift(),w+=p.shift(),n.lineTo(x,w);h=x+p.shift();k=w+p.shift();m=h+p.shift();l=k+p.shift();x=m+p.shift();w=l+p.shift();n.curveTo(h,k,m,l,x,w);break;case 26:for(p.length%
2&&(x+=p.shift());0<p.length;)h=x,k=w+p.shift(),m=h+p.shift(),l=k+p.shift(),x=m,w=l+p.shift(),n.curveTo(h,k,m,l,x,w);break;case 27:for(p.length%2&&(w+=p.shift());0<p.length;)h=x+p.shift(),k=w,m=h+p.shift(),l=k+p.shift(),x=m+p.shift(),w=l,n.curveTo(h,k,m,l,x,w);break;case 28:y=d[G];A=d[G+1];p.push((y<<24|A<<16)>>16);G+=2;break;case 29:y=p.pop()+b.gsubrsBias;(y=b.gsubrs[y])&&g(y);break;case 30:for(;0<p.length;){h=x;k=w+p.shift();m=h+p.shift();l=k+p.shift();x=m+p.shift();w=l+(1===p.length?p.shift():
0);n.curveTo(h,k,m,l,x,w);if(0===p.length)break;h=x+p.shift();k=w;m=h+p.shift();l=k+p.shift();w=l+p.shift();x=m+(1===p.length?p.shift():0);n.curveTo(h,k,m,l,x,w)}break;case 31:for(;0<p.length;){h=x+p.shift();k=w;m=h+p.shift();l=k+p.shift();w=l+p.shift();x=m+(1===p.length?p.shift():0);n.curveTo(h,k,m,l,x,w);if(0===p.length)break;h=x;k=w+p.shift();m=h+p.shift();l=k+p.shift();x=m+p.shift();w=l+(1===p.length?p.shift():0);n.curveTo(h,k,m,l,x,w)}break;default:32>A?console.log("Glyph "+c.index+": unknown operator "+
A):247>A?p.push(A-139):251>A?(y=d[G],G+=1,p.push(256*(A-247)+y+108)):255>A?(y=d[G],G+=1,p.push(256*-(A-251)-y-108)):(y=d[G],A=d[G+1],B=d[G+2],z=d[G+3],G+=4,p.push((y<<24|A<<16|B<<8|z)/65536))}}var h,k,m,l,n=new F.Path,p=[],q=0,r=!1,u=b.defaultWidthX,v=!1,x=0,w=0;g(d);c.advanceWidth=u;return n}function n(b){return 1240>b.length?107:33900>b.length?1131:32768}function p(b,c){v.cffStandardStrings.indexOf(b);var d=c.indexOf(b);0<=d?d+=v.cffStandardStrings.length:(d=v.cffStandardStrings.length+c.length,
c.push(b));return d}function q(b,c,d){for(var f={},g=0;g<b.length;g+=1){var h=b[g],k=c[h.name];void 0===k||e(k,h.value)||("SID"===h.type&&(k=p(k,d)),f[h.op]={name:h.name,type:h.type,value:k})}return f}function u(b,c){var d=new B.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);d.dict=q(w,b,c);return d}function r(b){var c=new B.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);c.topDicts=[{name:"topDict_0",type:"TABLE",value:b}];return c}var v=b("../encoding"),A=b("../glyphset"),
y=b("../parse"),F=b("../path"),B=b("../table"),w=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,
type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:"real real real real real real".split(" "),value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,
type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]}],E=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];d.parse=function(b,c,d){d.tables.cff={};y.getCard8(b,c);y.getCard8(b,c+1);y.getCard8(b,c+2);y.getCard8(b,c+3);var e=f(b,c+4,y.bytesToString);e=f(b,e.endOffset);var g=f(b,e.endOffset,y.bytesToString),p=f(b,g.endOffset);d.gsubrs=p.objects;d.gsubrsBias=n(d.gsubrs);p=new DataView((new Uint8Array(e.objects[0])).buffer);
e=g.objects;p=k(p,0,p.byteLength);p=h(p,w,e);d.tables.cff.topDict=p;e=c+p["private"][1];var q=g.objects;var r=k(b,e,p["private"][0]);q=h(r,E,q);d.defaultWidthX=q.defaultWidthX;d.nominalWidthX=q.nominalWidthX;0!==q.subrs?(e=f(b,e+q.subrs),d.subrs=e.objects,d.subrsBias=n(d.subrs)):(d.subrs=[],d.subrsBias=0);e=f(b,c+p.charStrings);d.nGlyphs=e.objects.length;q=d.nGlyphs;r=g.objects;var u=new y.Parser(b,c+p.charset);--q;g=[".notdef"];var x=u.parseCard8();if(0===x)for(x=0;x<q;x+=1){var B=u.parseSID();g.push(l(r,
B))}else if(1===x)for(;g.length<=q;){B=u.parseSID();var D=u.parseCard8();for(x=0;x<=D;x+=1)g.push(l(r,B)),B+=1}else if(2===x)for(;g.length<=q;)for(B=u.parseSID(),D=u.parseCard16(),x=0;x<=D;x+=1)g.push(l(r,B)),B+=1;else throw Error("Unknown charset format "+x);if(0===p.encoding)d.cffEncoding=new v.CffEncoding(v.cffStandardEncoding,g);else if(1===p.encoding)d.cffEncoding=new v.CffEncoding(v.cffExpertEncoding,g);else{q={};b=new y.Parser(b,c+p.encoding);c=b.parseCard8();if(0===c)for(r=b.parseCard8(),
c=0;c<r;c+=1)p=b.parseCard8(),q[p]=c;else if(1===c)for(r=b.parseCard8(),p=1,c=0;c<r;c+=1)for(u=b.parseCard8(),x=b.parseCard8(),B=u;B<=u+x;B+=1)q[B]=p,p+=1;else throw Error("Unknown encoding format "+c);b=new v.CffEncoding(q,g);d.cffEncoding=b}d.encoding=d.encoding||d.cffEncoding;d.glyphs=new A.GlyphSet(d);for(b=0;b<d.nGlyphs;b+=1)d.glyphs.push(b,A.cffGlyphLoader(d,b,m,e.objects[b]))};d.make=function(b,c){var d=new B.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",
type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),e=1/c.unitsPerEm;e={version:c.version,fullName:c.fullName,familyName:c.familyName,weight:c.weightName,fontBBox:c.fontBBox||[0,0,0,0],fontMatrix:[e,0,0,e,0,0],charset:999,encoding:0,charStrings:999,"private":[0,999]};for(var f=[],g,h=1;h<b.length;h+=1)g=b.get(h),f.push(g.name);g=[];d.header=new B.Record("Header",
[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}]);h=[c.postScriptName];var k=new B.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);k.names=[];for(var m=0;m<h.length;m+=1)k.names.push({name:"name_"+m,type:"NAME",value:h[m]});d.nameIndex=k;h=u(e,g);d.topDictIndex=r(h);d.globalSubrIndex=new B.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}]);h=new B.Record("Charsets",[{name:"format",
type:"Card8",value:0}]);for(k=0;k<f.length;k+=1)m=p(f[k],g),h.fields.push({name:"glyph_"+k,type:"SID",value:m});d.charsets=h;f=new B.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]);for(h=0;h<b.length;h+=1){k=b.get(h);m=[];var l=k.path;m.push({name:"width",type:"NUMBER",value:k.advanceWidth});for(var n=0,v=0,x=0;x<l.commands.length;x+=1){var w=l.commands[x];if("Q"===w.type){var y=1/3,A=2/3;w={type:"C",x:w.x,y:w.y,x1:y*n+A*w.x1,y1:y*v+A*w.y1,x2:y*w.x+A*w.x1,y2:y*w.y+A*w.y1}}if("M"===
w.type)n=Math.round(w.x-n),v=Math.round(w.y-v),m.push({name:"dx",type:"NUMBER",value:n}),m.push({name:"dy",type:"NUMBER",value:v}),m.push({name:"rmoveto",type:"OP",value:21}),n=Math.round(w.x),v=Math.round(w.y);else if("L"===w.type)n=Math.round(w.x-n),v=Math.round(w.y-v),m.push({name:"dx",type:"NUMBER",value:n}),m.push({name:"dy",type:"NUMBER",value:v}),m.push({name:"rlineto",type:"OP",value:5}),n=Math.round(w.x),v=Math.round(w.y);else if("C"===w.type){y=Math.round(w.x1-n);A=Math.round(w.y1-v);var F=
Math.round(w.x2-w.x1),D=Math.round(w.y2-w.y1);n=Math.round(w.x-w.x2);v=Math.round(w.y-w.y2);m.push({name:"dx1",type:"NUMBER",value:y});m.push({name:"dy1",type:"NUMBER",value:A});m.push({name:"dx2",type:"NUMBER",value:F});m.push({name:"dy2",type:"NUMBER",value:D});m.push({name:"dx",type:"NUMBER",value:n});m.push({name:"dy",type:"NUMBER",value:v});m.push({name:"rrcurveto",type:"OP",value:8});n=Math.round(w.x);v=Math.round(w.y)}}m.push({name:"endchar",type:"OP",value:14});f.charStrings.push({name:k.name,
type:"CHARSTRING",value:m})}d.charStringsIndex=f;f=new B.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);f.dict=q(E,{},g);d.privateDict=f;f=new B.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);f.strings=[];for(h=0;h<g.length;h+=1)f.strings.push({name:"string_"+h,type:"STRING",value:g[h]});d.stringIndex=f;f=d.header.sizeOf()+d.nameIndex.sizeOf()+d.topDictIndex.sizeOf()+d.stringIndex.sizeOf()+d.globalSubrIndex.sizeOf();e.charset=f;e.encoding=0;e.charStrings=e.charset+d.charsets.sizeOf();
e["private"][1]=e.charStrings+d.charStringsIndex.sizeOf();h=u(e,g);d.topDictIndex=r(h);return d}},{"../encoding":4,"../glyphset":7,"../parse":10,"../path":11,"../table":13}],15:[function(b,c,d){function e(b,c,d){b.segments.push({end:c,start:c,delta:-(c-d),offset:0})}var f=b("../check"),g=b("../parse"),k=b("../table");d.parse=function(b,c){var d,e={};e.version=g.getUShort(b,c);f.argument(0===e.version,"cmap table version should be 0.");e.numTables=g.getUShort(b,c+2);var h=-1;for(d=e.numTables-1;0<=
d;--d){var k=g.getUShort(b,c+4+8*d),l=g.getUShort(b,c+4+8*d+2);if(3===k&&(0===l||1===l||10===l)){h=g.getULong(b,c+4+8*d+4);break}}if(-1===h)return null;d=new g.Parser(b,c+h);e.format=d.parseUShort();if(12===e.format)for(d.parseUShort(),e.length=d.parseULong(),e.language=d.parseULong(),e.groupCount=k=d.parseULong(),e.glyphIndexMap={},h=0;h<k;h+=1){var r=d.parseULong();l=d.parseULong();for(var v=d.parseULong();r<=l;r+=1)e.glyphIndexMap[r]=v,v++}else if(4===e.format)for(v=h,e.length=d.parseUShort(),
e.language=d.parseUShort(),e.segCount=h=d.parseUShort()>>1,d.skip("uShort",3),e.glyphIndexMap={},d=new g.Parser(b,c+v+14),k=new g.Parser(b,c+v+16+2*h),l=new g.Parser(b,c+v+16+4*h),r=new g.Parser(b,c+v+16+6*h),v=0;v<h-1;v+=1)for(var A=d.parseUShort(),y=k.parseUShort(),F=l.parseShort(),B=r.parseUShort(),w=y;w<=A;w+=1){if(0!==B){var E=r.offset+r.relativeOffset-2;E+=B;E+=2*(w-y);E=g.getUShort(b,E);0!==E&&(E=E+F&65535)}else E=w+F&65535;e.glyphIndexMap[w]=E}else throw Error("Only format 4 and 12 cmap tables are supported.");
return e};d.make=function(b){var c,d=new k.Table("cmap",[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:1},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:12},{name:"format",type:"USHORT",value:4},{name:"length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},
{name:"rangeShift",type:"USHORT",value:0}]);d.segments=[];for(c=0;c<b.length;c+=1){for(var f=b.get(c),g=0;g<f.unicodes.length;g+=1)e(d,f.unicodes[g],c);d.segments=d.segments.sort(function(b,c){return b.start-c.start})}d.segments.push({end:65535,start:65535,delta:1,offset:0});b=d.segments.length;d.segCountX2=2*b;d.searchRange=2*Math.pow(2,Math.floor(Math.log(b)/Math.log(2)));d.entrySelector=Math.log(d.searchRange/2)/Math.log(2);d.rangeShift=d.segCountX2-d.searchRange;f=[];g=[];var l=[],u=[],r=[];for(c=
0;c<b;c+=1){var v=d.segments[c];f=f.concat({name:"end_"+c,type:"USHORT",value:v.end});g=g.concat({name:"start_"+c,type:"USHORT",value:v.start});l=l.concat({name:"idDelta_"+c,type:"SHORT",value:v.delta});u=u.concat({name:"idRangeOffset_"+c,type:"USHORT",value:v.offset});void 0!==v.glyphId&&(r=r.concat({name:"glyph_"+c,type:"USHORT",value:v.glyphId}))}d.fields=d.fields.concat(f);d.fields.push({name:"reservedPad",type:"USHORT",value:0});d.fields=d.fields.concat(g);d.fields=d.fields.concat(l);d.fields=
d.fields.concat(u);d.fields=d.fields.concat(r);d.length=2*f.length+16+2*g.length+2*l.length+2*u.length+2*r.length;return d}},{"../check":2,"../parse":10,"../table":13}],16:[function(b,c,d){function e(b,c){var d=JSON.stringify(b),e=256,f;for(f in c){var g=parseInt(f);if(g&&!(256>g)){if(JSON.stringify(c[f])===d)return g;e<=g&&(e=g+1)}}c[e]=b;return e}function f(b,c,d){d=e(c.name,d);return[{name:"tag_"+b,type:"TAG",value:c.tag},{name:"minValue_"+b,type:"FIXED",value:c.minValue<<16},{name:"defaultValue_"+
b,type:"FIXED",value:c.defaultValue<<16},{name:"maxValue_"+b,type:"FIXED",value:c.maxValue<<16},{name:"flags_"+b,type:"USHORT",value:0},{name:"nameID_"+b,type:"USHORT",value:d}]}function g(b,c,d){var e={};b=new m.Parser(b,c);e.tag=b.parseTag();e.minValue=b.parseFixed();e.defaultValue=b.parseFixed();e.maxValue=b.parseFixed();b.skip("uShort",1);e.name=d[b.parseUShort()]||{};return e}function k(b,c,d,f){f=e(c.name,f);f=[{name:"nameID_"+b,type:"USHORT",value:f},{name:"flags_"+b,type:"USHORT",value:0}];
for(var g=0;g<d.length;++g){var h=d[g].tag;f.push({name:"axis_"+b+" "+h,type:"FIXED",value:c.coordinates[h]<<16})}return f}function l(b,c,d,e){var f={};b=new m.Parser(b,c);f.name=e[b.parseUShort()]||{};b.skip("uShort",1);f.coordinates={};for(e=0;e<d.length;++e)f.coordinates[d[e].tag]=b.parseFixed();return f}var h=b("../check"),m=b("../parse"),n=b("../table");d.make=function(b,c){var d=new n.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",
type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:b.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:b.instances.length},{name:"instanceSize",type:"USHORT",value:4+4*b.axes.length}]);d.offsetToData=d.sizeOf();for(var e=0;e<b.axes.length;e++)d.fields=d.fields.concat(f(e,b.axes[e],c));for(e=0;e<b.instances.length;e++)d.fields=d.fields.concat(k(e,b.instances[e],b.axes,c));return d};d.parse=function(b,c,d){var e=new m.Parser(b,c),f=e.parseULong();
h.argument(65536===f,"Unsupported fvar table version.");var k=e.parseOffset16();e.skip("uShort",1);var n=e.parseUShort(),p=e.parseUShort();f=e.parseUShort();e=e.parseUShort();for(var q=[],u=0;u<n;u++)q.push(g(b,c+k+u*p,d));u=[];c=c+k+n*p;for(k=0;k<f;k++)u.push(l(b,c+k*e,q,d));return{axes:q,instances:u}}},{"../check":2,"../parse":10,"../table":13}],17:[function(b,c,d){function e(b,c,d,e,f){0<(c&e)?(b=b.parseByte(),0===(c&f)&&(b=-b),b=d+b):b=0<(c&f)?d:d+b.parseShort();return b}function f(b,c,d){c=new m.Parser(c,
d);b.numberOfContours=c.parseShort();b._xMin=c.parseShort();b._yMin=c.parseShort();b._xMax=c.parseShort();b._yMax=c.parseShort();if(0<b.numberOfContours){var f,g=b.endPointIndices=[];for(f=0;f<b.numberOfContours;f+=1)g.push(c.parseUShort());b.instructionLength=c.parseUShort();b.instructions=[];for(f=0;f<b.instructionLength;f+=1)b.instructions.push(c.parseByte());var h=g[g.length-1]+1;d=[];for(f=0;f<h;f+=1){var k=c.parseByte();d.push(k);if(0<(k&8))for(var n=c.parseByte(),p=0;p<n;p+=1)d.push(k),f+=
1}l.argument(d.length===h,"Bad flags.");if(0<g.length){n=[];if(0<h){for(f=0;f<h;f+=1)k=d[f],p={},p.onCurve=!!(k&1),p.lastPointOfContour=0<=g.indexOf(f),n.push(p);for(f=g=0;f<h;f+=1)k=d[f],p=n[f],p.x=e(c,k,g,2,16),g=p.x;for(f=g=0;f<h;f+=1)k=d[f],p=n[f],p.y=e(c,k,g,4,32),g=p.y}b.points=n}else b.points=[]}else if(0===b.numberOfContours)b.points=[];else for(b.isComposite=!0,b.points=[],b.components=[],d=!0;d;)d=c.parseUShort(),k={glyphIndex:c.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0},
0<(d&1)?0<(d&2)?(k.dx=c.parseShort(),k.dy=c.parseShort()):k.matchedPoints=[c.parseUShort(),c.parseUShort()]:0<(d&2)?(k.dx=c.parseChar(),k.dy=c.parseChar()):k.matchedPoints=[c.parseByte(),c.parseByte()],0<(d&8)?k.xScale=k.yScale=c.parseF2Dot14():0<(d&64)?(k.xScale=c.parseF2Dot14(),k.yScale=c.parseF2Dot14()):0<(d&128)&&(k.xScale=c.parseF2Dot14(),k.scale01=c.parseF2Dot14(),k.scale10=c.parseF2Dot14(),k.yScale=c.parseF2Dot14()),b.components.push(k),d=!!(d&32)}function g(b,c){for(var d=[],e=0;e<b.length;e+=
1){var f=b[e];d.push({x:c.xScale*f.x+c.scale01*f.y+c.dx,y:c.scale10*f.x+c.yScale*f.y+c.dy,onCurve:f.onCurve,lastPointOfContour:f.lastPointOfContour})}return d}function k(b,c){if(c.isComposite)for(var d=0;d<c.components.length;d+=1){var e=c.components[d],f=b.get(e.glyphIndex);f.getPath();if(f.points){if(void 0!==e.matchedPoints){if(e.matchedPoints[0]>c.points.length-1||e.matchedPoints[1]>f.points.length-1)throw Error("Matched points out of range in "+c.name);var h=c.points[e.matchedPoints[0]],k=f.points[e.matchedPoints[1]];
e={xScale:e.xScale,scale01:e.scale01,scale10:e.scale10,yScale:e.yScale,dx:0,dy:0};k=g([k],e)[0];e.dx=h.x-k.x;e.dy=h.y-k.y}f=g(f.points,e);c.points=c.points.concat(f)}}h=c.points;d=new n.Path;if(h){f=[];k=[];for(e=0;e<h.length;e+=1){var m=h[e];k.push(m);m.lastPointOfContour&&(f.push(k),k=[])}l.argument(0===k.length,"There are still points left in the current contour.");for(h=0;h<f.length;h+=1){k=f[h];e=k[0];m=k[k.length-1];if(e.onCurve){var p=null;var q=!0}else p=e=m.onCurve?m:{x:(e.x+m.x)/2,y:(e.y+
m.y)/2},q=!1;d.moveTo(e.x,e.y);for(q=q?1:0;q<k.length;q+=1){var E=k[q],x=0===q?e:k[q-1];if(x.onCurve&&E.onCurve)d.lineTo(E.x,E.y);else if(x.onCurve&&!E.onCurve)p=E;else if(x.onCurve||E.onCurve)if(!x.onCurve&&E.onCurve)d.quadraticCurveTo(p.x,p.y,E.x,E.y),p=null;else throw Error("Invalid state.");else d.quadraticCurveTo(x.x,x.y,(x.x+E.x)/2,(x.y+E.y)/2),p=E}e!==m&&(p?d.quadraticCurveTo(p.x,p.y,e.x,e.y):d.lineTo(e.x,e.y))}d.closePath()}return d}var l=b("../check"),h=b("../glyphset"),m=b("../parse"),n=
b("../path");d.parse=function(b,c,d,e){var g=new h.GlyphSet(e),m;for(m=0;m<d.length-1;m+=1){var l=d[m];l!==d[m+1]?g.push(m,h.ttfGlyphLoader(e,m,f,b,c+l,k)):g.push(m,h.glyphLoader(e,m))}return g}},{"../check":2,"../glyphset":7,"../parse":10,"../path":11}],18:[function(b,c,d){function e(b,c){for(var d=new m.Parser(b,c),e=d.parseUShort(),f=[],g=0;g<e;g++)f[d.parseTag()]={offset:d.parseUShort()};return f}function f(b,c){var d=new m.Parser(b,c),e=d.parseUShort(),f=d.parseUShort();if(1===e)return d.parseUShortList(f);
if(2===e){for(e=[];f--;)for(var g=d.parseUShort(),h=d.parseUShort(),k=d.parseUShort();g<=h;g++)e[k++]=g;return e}}function g(b,c){var d=new m.Parser(b,c),e=d.parseUShort();if(1===e){var f=d.parseUShort();e=d.parseUShort();var g=d.parseUShortList(e);return function(b){return g[b-f]||0}}if(2===e){e=d.parseUShort();for(var h=[],k=[],l=[],n=0;n<e;n++)h[n]=d.parseUShort(),k[n]=d.parseUShort(),l[n]=d.parseUShort();return function(b){for(var c=0,d=h.length-1;c<d;){var e=c+d+1>>1;b<h[e]?d=e-1:c=e}return h[c]<=
b&&b<=k[c]?l[c]||0:0}}}function k(b,c){var d=new m.Parser(b,c),e=d.parseUShort(),h=d.parseUShort();h=f(b,c+h);var k=d.parseUShort(),l=d.parseUShort(),n;if(4===k&&0===l){var p={};if(1===e){e=d.parseUShort();for(var B=[],w=d.parseOffset16List(e),E=0;E<e;E++){var x=w[E],D=p[x];if(!D)for(D={},d.relativeOffset=x,x=d.parseUShort();x--;){var G=d.parseUShort();k&&(n=d.parseShort());l&&d.parseShort();D[G]=n}B[h[E]]=D}return function(b,c){var d=B[b];if(d)return d[c]}}if(2===e){w=d.parseUShort();E=d.parseUShort();
p=d.parseUShort();e=d.parseUShort();var oa=g(b,c+w),na=g(b,c+E),H=[];for(w=0;w<p;w++)for(E=H[w]=[],D=0;D<e;D++)k&&(n=d.parseShort()),l&&d.parseShort(),E[D]=n;var ja={};for(w=0;w<h.length;w++)ja[h[w]]=1;return function(b,c){if(ja[b]){var d=oa(b),e=na(c);if(d=H[d])return d[e]}}}}}function l(b,c){var d=new m.Parser(b,c),e=d.parseUShort(),f=d.parseUShort(),g=f&16,h=d.parseUShort(),l=d.parseOffset16List(h);d={lookupType:e,lookupFlag:f,markFilteringSet:g?d.parseUShort():-1};if(2===e){var n=[];for(e=0;e<
h;e++)n.push(k(b,c+l[e]));d.getKerningValue=function(b,c){for(var d=n.length;d--;){var e=n[d](b,c);if(void 0!==e)return e}return 0}}return d}var h=b("../check"),m=b("../parse");d.parse=function(b,c,d){var f=new m.Parser(b,c),g=f.parseFixed();h.argument(1===g,"Unsupported GPOS table version.");e(b,c+f.parseUShort());e(b,c+f.parseUShort());var k=f.parseUShort();f.relativeOffset=k;g=f.parseUShort();f=f.parseOffset16List(g);c+=k;for(k=0;k<g;k++){var n=l(b,c+f[k]);2!==n.lookupType||d.getGposKerningValue||
(d.getGposKerningValue=n.getKerningValue)}}},{"../check":2,"../parse":10}],19:[function(b,c,d){var e=b("../check"),f=b("../parse").Parser,g=Array(9),k=b("../table");g[1]=function(){var b=this.offset+this.relativeOffset,c=this.parseUShort();if(1===c)return{substFormat:1,coverage:this.parsePointer(f.coverage),deltaGlyphId:this.parseUShort()};if(2===c)return{substFormat:2,coverage:this.parsePointer(f.coverage),substitute:this.parseOffset16List()};e.assert(!1,"0x"+b.toString(16)+": lookup type 1 format must be 1 or 2.")};
g[2]=function(){var b=this.parseUShort();e.argument(1===b,"GSUB Multiple Substitution Subtable identifier-format must be 1");return{substFormat:b,coverage:this.parsePointer(f.coverage),sequences:this.parseListOfLists()}};g[3]=function(){var b=this.parseUShort();e.argument(1===b,"GSUB Alternate Substitution Subtable identifier-format must be 1");return{substFormat:b,coverage:this.parsePointer(f.coverage),alternateSets:this.parseListOfLists()}};g[4]=function(){var b=this.parseUShort();e.argument(1===
b,"GSUB ligature table identifier-format must be 1");return{substFormat:b,coverage:this.parsePointer(f.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var l={sequenceIndex:f.uShort,lookupListIndex:f.uShort};g[5]=function(){var b=this.offset+this.relativeOffset,c=this.parseUShort();if(1===c)return{substFormat:c,coverage:this.parsePointer(f.coverage),ruleSets:this.parseListOfLists(function(){var b=
this.parseUShort(),c=this.parseUShort();return{input:this.parseUShortList(b-1),lookupRecords:this.parseRecordList(c,l)}})};if(2===c)return{substFormat:c,coverage:this.parsePointer(f.coverage),classDef:this.parsePointer(f.classDef),classSets:this.parseListOfLists(function(){var b=this.parseUShort(),c=this.parseUShort();return{classes:this.parseUShortList(b-1),lookupRecords:this.parseRecordList(c,l)}})};if(3===c){b=this.parseUShort();var d=this.parseUShort();return{substFormat:c,coverages:this.parseList(b,
f.pointer(f.coverage)),lookupRecords:this.parseRecordList(d,l)}}e.assert(!1,"0x"+b.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};g[6]=function(){var b=this.offset+this.relativeOffset,c=this.parseUShort();if(1===c)return{substFormat:1,coverage:this.parsePointer(f.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(l)}})};if(2===
c)return{substFormat:2,coverage:this.parsePointer(f.coverage),backtrackClassDef:this.parsePointer(f.classDef),inputClassDef:this.parsePointer(f.classDef),lookaheadClassDef:this.parsePointer(f.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(l)}})};if(3===c)return{substFormat:3,backtrackCoverage:this.parseList(f.pointer(f.coverage)),inputCoverage:this.parseList(f.pointer(f.coverage)),
lookaheadCoverage:this.parseList(f.pointer(f.coverage)),lookupRecords:this.parseRecordList(l)};e.assert(!1,"0x"+b.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};g[7]=function(){var b=this.parseUShort();e.argument(1===b,"GSUB Extension Substitution subtable identifier-format must be 1");b=this.parseUShort();var c=new f(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:b,extension:g[b].call(c)}};g[8]=function(){var b=this.parseUShort();e.argument(1===b,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1");
return{substFormat:b,coverage:this.parsePointer(f.coverage),backtrackCoverage:this.parseList(f.pointer(f.coverage)),lookaheadCoverage:this.parseList(f.pointer(f.coverage)),substitutes:this.parseUShortList()}};var h=Array(9);h[1]=function(b){return 1===b.substFormat?new k.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new k.Coverage(b.coverage)},{name:"deltaGlyphID",type:"USHORT",value:b.deltaGlyphId}]):new k.Table("substitutionTable",[{name:"substFormat",
type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new k.Coverage(b.coverage)}].concat(k.ushortList("substitute",b.substitute)))};h[3]=function(b){e.assert(1===b.substFormat,"Lookup type 3 substFormat must be 1.");return new k.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new k.Coverage(b.coverage)}].concat(k.tableList("altSet",b.alternateSets,function(b){return new k.Table("alternateSetTable",k.ushortList("alternate",b))})))};h[4]=
function(b){e.assert(1===b.substFormat,"Lookup type 4 substFormat must be 1.");return new k.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new k.Coverage(b.coverage)}].concat(k.tableList("ligSet",b.ligatureSets,function(b){return new k.Table("ligatureSetTable",k.tableList("ligature",b,function(b){return new k.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:b.ligGlyph}].concat(k.ushortList("component",b.components,b.components.length+
1)))}))})))};d.parse=function(b,c){var d=new f(b,c||0),h=d.parseVersion();e.argument(1===h,"Unsupported GSUB table version.");return{version:h,scripts:d.parseScriptList(),features:d.parseFeatureList(),lookups:d.parseLookupList(g)}};d.make=function(b){return new k.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new k.ScriptList(b.scripts)},{name:"features",type:"TABLE",value:new k.FeatureList(b.features)},{name:"lookups",type:"TABLE",value:new k.LookupList(b.lookups,
h)}])}},{"../check":2,"../parse":10,"../table":13}],20:[function(b,c,d){var e=b("../check"),f=b("../parse"),g=b("../table");d.parse=function(b,c){var d={},g=new f.Parser(b,c);d.version=g.parseVersion();d.fontRevision=Math.round(1E3*g.parseFixed())/1E3;d.checkSumAdjustment=g.parseULong();d.magicNumber=g.parseULong();e.argument(1594834165===d.magicNumber,"Font header has wrong magic number.");d.flags=g.parseUShort();d.unitsPerEm=g.parseUShort();d.created=g.parseLongDateTime();d.modified=g.parseLongDateTime();
d.xMin=g.parseShort();d.yMin=g.parseShort();d.xMax=g.parseShort();d.yMax=g.parseShort();d.macStyle=g.parseUShort();d.lowestRecPPEM=g.parseUShort();d.fontDirectionHint=g.parseShort();d.indexToLocFormat=g.parseShort();d.glyphDataFormat=g.parseShort();return d};d.make=function(b){var c=Math.round((new Date).getTime()/1E3)+2082844800,d=c;b.createdTimestamp&&(d=b.createdTimestamp+2082844800);return new g.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},
{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1E3},{name:"created",type:"LONGDATETIME",value:d},{name:"modified",type:"LONGDATETIME",value:c},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",
type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],b)}},{"../check":2,"../parse":10,"../table":13}],21:[function(b,c,d){var e=b("../parse"),f=b("../table");d.parse=function(b,c){var d={},f=new e.Parser(b,c);d.version=f.parseVersion();d.ascender=f.parseShort();d.descender=f.parseShort();d.lineGap=f.parseShort();d.advanceWidthMax=f.parseUShort();d.minLeftSideBearing=f.parseShort();d.minRightSideBearing=f.parseShort();d.xMaxExtent=f.parseShort();
d.caretSlopeRise=f.parseShort();d.caretSlopeRun=f.parseShort();d.caretOffset=f.parseShort();f.relativeOffset+=8;d.metricDataFormat=f.parseShort();d.numberOfHMetrics=f.parseUShort();return d};d.make=function(b){return new f.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",
type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],b)}},{"../parse":10,"../table":13}],22:[function(b,
c,d){var e=b("../parse"),f=b("../table");d.parse=function(b,c,d,f,m){b=new e.Parser(b,c);for(c=0;c<f;c+=1){if(c<d){var g=b.parseUShort();var h=b.parseShort()}var k=m.get(c);k.advanceWidth=g;k.leftSideBearing=h}};d.make=function(b){for(var c=new f.Table("hmtx",[]),d=0;d<b.length;d+=1){var e=b.get(d),g=e.leftSideBearing||0;c.fields.push({name:"advanceWidth_"+d,type:"USHORT",value:e.advanceWidth||0});c.fields.push({name:"leftSideBearing_"+d,type:"SHORT",value:g})}return c}},{"../parse":10,"../table":13}],
23:[function(b,c,d){var e=b("../check"),f=b("../parse");d.parse=function(b,c){var d={},g=new f.Parser(b,c),k=g.parseUShort();e.argument(0===k,"Unsupported kern table version.");g.skip("uShort",1);k=g.parseUShort();e.argument(0===k,"Unsupported kern sub-table version.");g.skip("uShort",2);k=g.parseUShort();g.skip("uShort",3);for(var n=0;n<k;n+=1){var p=g.parseUShort(),q=g.parseUShort(),u=g.parseShort();d[p+","+q]=u}return d}},{"../check":2,"../parse":10}],24:[function(b,c,d){var e=b("../parse");d.parse=
function(b,c,d,l){b=new e.Parser(b,c);c=l?b.parseUShort:b.parseULong;for(var f=[],g=0;g<d+1;g+=1){var k=c.call(b);l&&(k*=2);f.push(k)}return f}},{"../parse":10}],25:[function(b,c,d){var e=b("../check"),f=b("../parse"),g=b("../table");d.make=function(b){for(var c=new g.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:b.length}]),d="",e=12+4*b.length,f=0;f<b.length;++f){var k=d.indexOf(b[f]);0>k&&(k=d.length,d+=b[f]);c.fields.push({name:"offset "+
f,type:"USHORT",value:e+k});c.fields.push({name:"length "+f,type:"USHORT",value:b[f].length})}c.fields.push({name:"stringPool",type:"CHARARRAY",value:d});return c};d.parse=function(b,c){var d=new f.Parser(b,c),g=d.parseULong();e.argument(1===g,"Unsupported ltag table version.");d.skip("uLong",1);g=d.parseULong();for(var k=[],l=0;l<g;l++){for(var q="",u=c+d.parseUShort(),r=d.parseUShort(),v=u;v<u+r;++v)q+=String.fromCharCode(b.getInt8(v));k.push(q)}return k}},{"../check":2,"../parse":10,"../table":13}],
26:[function(b,c,d){var e=b("../parse"),f=b("../table");d.parse=function(b,c){var d={},f=new e.Parser(b,c);d.version=f.parseVersion();d.numGlyphs=f.parseUShort();1===d.version&&(d.maxPoints=f.parseUShort(),d.maxContours=f.parseUShort(),d.maxCompositePoints=f.parseUShort(),d.maxCompositeContours=f.parseUShort(),d.maxZones=f.parseUShort(),d.maxTwilightPoints=f.parseUShort(),d.maxStorage=f.parseUShort(),d.maxFunctionDefs=f.parseUShort(),d.maxInstructionDefs=f.parseUShort(),d.maxStackElements=f.parseUShort(),
d.maxSizeOfInstructions=f.parseUShort(),d.maxComponentElements=f.parseUShort(),d.maxComponentDepth=f.parseUShort());return d};d.make=function(b){return new f.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:b}])}},{"../parse":10,"../table":13}],27:[function(b,c,d){var e=b("../types").decode,f=b("../check"),g=b("../parse"),k=b("../table");d.parse=function(b,c){var d=new g.Parser(b,c),h=d.parseULong();f.argument(1===h,"Unsupported META table version.");d.parseULong();
d.parseULong();h=d.parseULong();for(var k={},l=0;l<h;l++){var u=d.parseTag(),r=d.parseULong(),v=d.parseULong();r=e.UTF8(b,c+r,v);k[u]=r}return k};d.make=function(b){var c=Object.keys(b).length,d="",e=16+12*c;c=new k.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:e},{name:"numTags",type:"ULONG",value:c}]);for(var f in b){var g=d.length;d+=b[f];c.fields.push({name:"tag "+f,type:"TAG",value:f});c.fields.push({name:"offset "+f,
type:"ULONG",value:e+g});c.fields.push({name:"length "+f,type:"ULONG",value:b[f].length})}c.fields.push({name:"stringPool",type:"CHARARRAY",value:d});return c}},{"../check":2,"../parse":10,"../table":13,"../types":32}],28:[function(b,c,d){function e(b,c,d){switch(b){case 0:return"utf-16";case 1:return A[d]||v[c];case 3:if(1===c||10===c)return"utf-16"}}function f(b){var c={},d;for(d in b)c[b[d]]=parseInt(d);return c}function g(b,c,d,e,f,g){return new n.Record("NameRecord",[{name:"platformID",type:"USHORT",
value:b},{name:"encodingID",type:"USHORT",value:c},{name:"languageID",type:"USHORT",value:d},{name:"nameID",type:"USHORT",value:e},{name:"length",type:"USHORT",value:f},{name:"offset",type:"USHORT",value:g}])}function k(b,c){a:{var d=b.length;var e=c.length-d+1,f=0;b:for(;f<e;f++)for(;f<e;){for(var g=0;g<d;g++)if(c[f+g]!==b[g])continue b;d=f;break a}d=-1}if(0>d)for(d=c.length,e=0,f=b.length;e<f;++e)c.push(b[e]);return d}c=b("../types");var l=c.decode,h=c.encode,m=b("../parse"),n=b("../table"),p="copyright fontFamily fontSubfamily uniqueID fullName version postScriptName trademark manufacturer designer description manufacturerURL designerURL license licenseURL reserved preferredFamily preferredSubfamily compatibleFullName sampleText postScriptFindFontName wwsFamily wwsSubfamily".split(" "),
q={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",
61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},
u={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,
129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},r={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",
5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",
6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",
1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",
9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"},v={0:"macintosh",
1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",
31:"x-mac-extarabic"},A={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};d.parse=function(b,c,d){var f={};c=new m.Parser(b,c);for(var g=c.parseUShort(),h=c.parseUShort(),k=c.offset+c.parseUShort(),n=0;n<h;n++){var u=c.parseUShort(),v=c.parseUShort(),y=c.parseUShort(),A=c.parseUShort();A=p[A]||A;var z=
c.parseUShort(),B=c.parseUShort();a:{switch(u){case 0:if(65535===y){var F="und";break a}if(d){F=d[y];break a}break;case 1:F=q[y];break a;case 3:F=r[y];break a}F=void 0}u=e(u,v,y);void 0!==u&&void 0!==F&&(u="utf-16"===u?l.UTF16(b,k+B,z):l.MACSTRING(b,k+B,z,u))&&(v=f[A],void 0===v&&(v=f[A]={}),v[F]=u)}1===g&&c.parseUShort();return f};d.make=function(b,c){var d=[],l={},m=f(p);for(F in b){var v=m[F];void 0===v&&(v=F);v=parseInt(v);if(isNaN(v))throw Error('Name table entry "'+F+'" does not exist, see nameTableNames for complete list.');
l[v]=b[F];d.push(v)}var y=f(q),A=f(r);m=[];var F=[];for(var na=0;na<d.length;na++){v=d[na];var H=l[v],ja;for(ja in H){var z=H[ja],U=1,ia=y[ja],O=u[ia],L=e(U,O,ia);L=h.MACSTRING(z,L);void 0===L&&(U=0,ia=c.indexOf(ja),0>ia&&(ia=c.length,c.push(ja)),O=4,L=h.UTF16(z));var ua=k(L,F);m.push(g(U,O,ia,v,L.length,ua));U=A[ja];void 0!==U&&(z=h.UTF16(z),ia=k(z,F),m.push(g(3,1,U,v,z.length,ia)))}}m.sort(function(b,c){return b.platformID-c.platformID||b.encodingID-c.encodingID||b.languageID-c.languageID||b.nameID-
c.nameID});d=new n.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:m.length},{name:"stringOffset",type:"USHORT",value:6+12*m.length}]);for(l=0;l<m.length;l++)d.fields.push({name:"record_"+l,type:"RECORD",value:m[l]});d.fields.push({name:"strings",type:"LITERAL",value:F});return d}},{"../parse":10,"../table":13,"../types":32}],29:[function(b,c,d){var e=b("../parse"),f=b("../table"),g=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},
{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},
{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},
{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},
{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,
end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},
{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66E3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];d.unicodeRanges=g;d.getUnicodeRange=function(b){for(var c=0;c<g.length;c+=1){var d=g[c];if(b>=d.begin&&b<d.end)return c}return-1};d.parse=function(b,c){var d={},f=new e.Parser(b,c);d.version=f.parseUShort();d.xAvgCharWidth=f.parseShort();d.usWeightClass=f.parseUShort();d.usWidthClass=
f.parseUShort();d.fsType=f.parseUShort();d.ySubscriptXSize=f.parseShort();d.ySubscriptYSize=f.parseShort();d.ySubscriptXOffset=f.parseShort();d.ySubscriptYOffset=f.parseShort();d.ySuperscriptXSize=f.parseShort();d.ySuperscriptYSize=f.parseShort();d.ySuperscriptXOffset=f.parseShort();d.ySuperscriptYOffset=f.parseShort();d.yStrikeoutSize=f.parseShort();d.yStrikeoutPosition=f.parseShort();d.sFamilyClass=f.parseShort();d.panose=[];for(var g=0;10>g;g++)d.panose[g]=f.parseByte();d.ulUnicodeRange1=f.parseULong();
d.ulUnicodeRange2=f.parseULong();d.ulUnicodeRange3=f.parseULong();d.ulUnicodeRange4=f.parseULong();d.achVendID=String.fromCharCode(f.parseByte(),f.parseByte(),f.parseByte(),f.parseByte());d.fsSelection=f.parseUShort();d.usFirstCharIndex=f.parseUShort();d.usLastCharIndex=f.parseUShort();d.sTypoAscender=f.parseShort();d.sTypoDescender=f.parseShort();d.sTypoLineGap=f.parseShort();d.usWinAscent=f.parseUShort();d.usWinDescent=f.parseUShort();1<=d.version&&(d.ulCodePageRange1=f.parseULong(),d.ulCodePageRange2=
f.parseULong());2<=d.version&&(d.sxHeight=f.parseShort(),d.sCapHeight=f.parseShort(),d.usDefaultChar=f.parseUShort(),d.usBreakChar=f.parseUShort(),d.usMaxContent=f.parseUShort());return d};d.make=function(b){return new f.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",
type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},
{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",
type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",
value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],b)}},{"../parse":10,"../table":13}],30:[function(b,c,d){var e=b("../encoding"),f=b("../parse"),g=b("../table");d.parse=function(b,c){var d={},g=new f.Parser(b,c),k;d.version=g.parseVersion();d.italicAngle=g.parseFixed();d.underlinePosition=g.parseShort();d.underlineThickness=g.parseShort();
d.isFixedPitch=g.parseULong();d.minMemType42=g.parseULong();d.maxMemType42=g.parseULong();d.minMemType1=g.parseULong();d.maxMemType1=g.parseULong();switch(d.version){case 1:d.names=e.standardNames.slice();break;case 2:d.numberOfGlyphs=g.parseUShort();d.glyphNameIndex=Array(d.numberOfGlyphs);for(k=0;k<d.numberOfGlyphs;k++)d.glyphNameIndex[k]=g.parseUShort();d.names=[];for(k=0;k<d.numberOfGlyphs;k++)if(d.glyphNameIndex[k]>=e.standardNames.length){var l=g.parseChar();d.names.push(g.parseString(l))}break;
case 2.5:for(d.numberOfGlyphs=g.parseUShort(),d.offset=Array(d.numberOfGlyphs),k=0;k<d.numberOfGlyphs;k++)d.offset[k]=g.parseChar()}return d};d.make=function(){return new g.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",
type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}},{"../encoding":4,"../parse":10,"../table":13}],31:[function(b,c,d){function e(b){for(;0!==b.length%4;)b.push(0);for(var c=0,d=0;d<b.length;d+=4)c+=(b[d]<<24)+(b[d+1]<<16)+(b[d+2]<<8)+b[d+3];return c%=Math.pow(2,32)}function f(b,c,d,e){return new h.Record("Table Record",[{name:"tag",type:"TAG",value:void 0!==b?b:""},{name:"checkSum",type:"ULONG",value:void 0!==c?c:0},{name:"offset",type:"ULONG",value:void 0!==d?d:0},{name:"length",
type:"ULONG",value:void 0!==e?e:0}])}function g(b){var c=new h.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);c.tables=b;c.numTables=b.length;var d=Math.pow(2,Math.log(c.numTables)/Math.log(2)|0);c.searchRange=16*d;c.entrySelector=Math.log(d)/Math.log(2)|0;c.rangeShift=16*c.numTables-c.searchRange;d=[];for(var g=[],k=c.sizeOf()+
f().sizeOf()*c.numTables;0!==k%4;)k+=1,g.push({name:"padding",type:"BYTE",value:0});for(var m=0;m<b.length;m+=1){var n=b[m];l.argument(4===n.tableName.length,"Table name"+n.tableName+" is invalid.");var p=n.sizeOf(),q=f(n.tableName,e(n.encode()),k,p);d.push({name:q.tag+" Table Record",type:"RECORD",value:q});g.push({name:n.tableName+" table",type:"RECORD",value:n});k+=p;for(l.argument(!isNaN(k),"Something went wrong calculating the offset.");0!==k%4;)k+=1,g.push({name:"padding",type:"BYTE",value:0})}d.sort(function(b,
c){return b.value.tag>c.value.tag?1:-1});c.fields=c.fields.concat(d);c.fields=c.fields.concat(g);return c}function k(b,c,d){for(var e=0;e<c.length;e+=1){var f=b.charToGlyphIndex(c[e]);if(0<f)return b.glyphs.get(f).getMetrics()}return d}var l=b("../check"),h=b("../table"),m=b("./cmap"),n=b("./cff"),p=b("./head"),q=b("./hhea"),u=b("./hmtx"),r=b("./ltag"),v=b("./maxp"),A=b("./name"),y=b("./os2"),F=b("./post"),B=b("./gsub"),w=b("./meta");d.computeCheckSum=e;d.make=g;d.fontToTable=function(b){for(var c=
[],d=[],f=[],h=[],l=[],E=[],ja=[],z,U=0,ia=0,O=0,L=0,ua=0,W=0;W<b.glyphs.length;W+=1){var Y=b.glyphs.get(W),X=Y.unicode|0;if(isNaN(Y.advanceWidth))throw Error("Glyph "+Y.name+" ("+W+"): advanceWidth is not a number.");(z>X||void 0===z)&&0<X&&(z=X);U<X&&(U=X);X=y.getUnicodeRange(X);if(32>X)ia|=1<<X;else if(64>X)O|=1<<X-32;else if(96>X)L|=1<<X-64;else if(123>X)ua|=1<<X-96;else throw Error("Unicode ranges bits > 123 are reserved for internal usage");".notdef"!==Y.name&&(X=Y.getMetrics(),c.push(X.xMin),
d.push(X.yMin),f.push(X.xMax),h.push(X.yMax),E.push(X.leftSideBearing),ja.push(X.rightSideBearing),l.push(Y.advanceWidth))}W=Math.min.apply(null,c);d=Math.min.apply(null,d);f=Math.max.apply(null,f);h=Math.max.apply(null,h);c=Math.max.apply(null,l);for(X=Y=0;X<l.length;X+=1)Y+=l[X];W={xMin:W,yMin:d,xMax:f,yMax:h,advanceWidthMax:c,advanceWidthAvg:Y/l.length,minLeftSideBearing:Math.min.apply(null,E),maxLeftSideBearing:Math.max.apply(null,E),minRightSideBearing:Math.min.apply(null,ja)};W.ascender=b.ascender;
W.descender=b.descender;l=p.make({flags:3,unitsPerEm:b.unitsPerEm,xMin:W.xMin,yMin:W.yMin,xMax:W.xMax,yMax:W.yMax,lowestRecPPEM:3,createdTimestamp:b.createdTimestamp});E=q.make({ascender:W.ascender,descender:W.descender,advanceWidthMax:W.advanceWidthMax,minLeftSideBearing:W.minLeftSideBearing,minRightSideBearing:W.minRightSideBearing,xMaxExtent:W.maxLeftSideBearing+(W.xMax-W.xMin),numberOfHMetrics:b.glyphs.length});ja=v.make(b.glyphs.length);z=y.make({xAvgCharWidth:Math.round(W.advanceWidthAvg),usWeightClass:b.tables.os2.usWeightClass,
usWidthClass:b.tables.os2.usWidthClass,usFirstCharIndex:z,usLastCharIndex:U,ulUnicodeRange1:ia,ulUnicodeRange2:O,ulUnicodeRange3:L,ulUnicodeRange4:ua,fsSelection:b.tables.os2.fsSelection,sTypoAscender:W.ascender,sTypoDescender:W.descender,sTypoLineGap:0,usWinAscent:W.yMax,usWinDescent:Math.abs(W.yMin),ulCodePageRange1:1,sxHeight:k(b,"xyvw",{yMax:Math.round(W.ascender/2)}).yMax,sCapHeight:k(b,"HIKLEFJMNTZBDPRAGOQSUVWXY",W).yMax,usDefaultChar:b.hasChar(" ")?32:0,usBreakChar:b.hasChar(" ")?32:0});U=
u.make(b.glyphs);ia=m.make(b.glyphs);O=b.getEnglishName("fontFamily");L=b.getEnglishName("fontSubfamily");ua=O+" "+L;(h=b.getEnglishName("postScriptName"))||(h=O.replace(/\s/g,"")+"-"+L);f={};for(var fa in b.names)f[fa]=b.names[fa];f.uniqueID||(f.uniqueID={en:b.getEnglishName("manufacturer")+":"+ua});f.postScriptName||(f.postScriptName={en:h});f.preferredFamily||(f.preferredFamily=b.names.fontFamily);f.preferredSubfamily||(f.preferredSubfamily=b.names.fontSubfamily);d=[];fa=A.make(f,d);f=0<d.length?
r.make(d):void 0;d=F.make();L=n.make(b.glyphs,{version:b.getEnglishName("version"),fullName:ua,familyName:O,weightName:L,postScriptName:h,unitsPerEm:b.unitsPerEm,fontBBox:[0,W.yMin,W.ascender,W.advanceWidthMax]});O=b.metas&&0<Object.keys(b.metas).length?w.make(b.metas):void 0;fa=[l,E,ja,z,fa,ia,d,L,U];f&&fa.push(f);b.tables.gsub&&fa.push(B.make(b.tables.gsub));O&&fa.push(O);b=g(fa);fa=b.encode();fa=e(fa);z=b.fields;U=!1;for(W=0;W<z.length;W+=1)if("head table"===z[W].name){z[W].value.checkSumAdjustment=
2981146554-fa;U=!0;break}if(!U)throw Error("Could not find head table with checkSum to adjust.");return b}},{"../check":2,"../table":13,"./cff":14,"./cmap":15,"./gsub":19,"./head":20,"./hhea":21,"./hmtx":22,"./ltag":25,"./maxp":26,"./meta":27,"./name":28,"./os2":29,"./post":30}],32:[function(b,c,d){function e(b){return function(){return b}}var f=b("./check");b={};var g={},k={};g.BYTE=function(b){f.argument(0<=b&&255>=b,"Byte value should be between 0 and 255.");return[b]};k.BYTE=e(1);g.CHAR=function(b){return[b.charCodeAt(0)]};
k.CHAR=e(1);g.CHARARRAY=function(b){for(var c=[],d=0;d<b.length;d+=1)c[d]=b.charCodeAt(d);return c};k.CHARARRAY=function(b){return b.length};g.USHORT=function(b){return[b>>8&255,b&255]};k.USHORT=e(2);g.SHORT=function(b){32768<=b&&(b=-(65536-b));return[b>>8&255,b&255]};k.SHORT=e(2);g.UINT24=function(b){return[b>>16&255,b>>8&255,b&255]};k.UINT24=e(3);g.ULONG=function(b){return[b>>24&255,b>>16&255,b>>8&255,b&255]};k.ULONG=e(4);g.LONG=function(b){2147483648<=b&&(b=-(4294967296-b));return[b>>24&255,b>>
16&255,b>>8&255,b&255]};k.LONG=e(4);g.FIXED=g.ULONG;k.FIXED=k.ULONG;g.FWORD=g.SHORT;k.FWORD=k.SHORT;g.UFWORD=g.USHORT;k.UFWORD=k.USHORT;g.LONGDATETIME=function(b){return[0,0,0,0,b>>24&255,b>>16&255,b>>8&255,b&255]};k.LONGDATETIME=e(8);g.TAG=function(b){f.argument(4===b.length,"Tag should be exactly 4 ASCII characters.");return[b.charCodeAt(0),b.charCodeAt(1),b.charCodeAt(2),b.charCodeAt(3)]};k.TAG=e(4);g.Card8=g.BYTE;k.Card8=k.BYTE;g.Card16=g.USHORT;k.Card16=k.USHORT;g.OffSize=g.BYTE;k.OffSize=k.BYTE;
g.SID=g.USHORT;k.SID=k.USHORT;g.NUMBER=function(b){return-107<=b&&107>=b?[b+139]:108<=b&&1131>=b?(b-=108,[(b>>8)+247,b&255]):-1131<=b&&-108>=b?(b=-b-108,[(b>>8)+251,b&255]):-32768<=b&&32767>=b?g.NUMBER16(b):g.NUMBER32(b)};k.NUMBER=function(b){return g.NUMBER(b).length};g.NUMBER16=function(b){return[28,b>>8&255,b&255]};k.NUMBER16=e(3);g.NUMBER32=function(b){return[29,b>>24&255,b>>16&255,b>>8&255,b&255]};k.NUMBER32=e(5);g.REAL=function(b){var c=b.toString(),d=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(c);
d&&(c=parseFloat("1e"+((d[2]?+d[2]:0)+d[1].length)),c=(Math.round(b*c)/c).toString());b="";var e;d=0;for(e=c.length;d<e;d+=1){var f=c[d];b="e"===f?b+("-"===c[++d]?"c":"b"):"."===f?b+"a":"-"===f?b+"e":b+f}b+=b.length&1?"f":"ff";c=[30];d=0;for(e=b.length;d<e;d+=2)c.push(parseInt(b.substr(d,2),16));return c};k.REAL=function(b){return g.REAL(b).length};g.NAME=g.CHARARRAY;k.NAME=k.CHARARRAY;g.STRING=g.CHARARRAY;k.STRING=k.CHARARRAY;b.UTF8=function(b,c,d){for(var e=[],f=0;f<d;f++,c+=1)e[f]=b.getUint8(c);
return String.fromCharCode.apply(null,e)};b.UTF16=function(b,c,d){var e=[];d/=2;for(var f=0;f<d;f++,c+=2)e[f]=b.getUint16(c);return String.fromCharCode.apply(null,e)};g.UTF16=function(b){for(var c=[],d=0;d<b.length;d+=1){var e=b.charCodeAt(d);c[c.length]=e>>8&255;c[c.length]=e&255}return c};k.UTF16=function(b){return 2*b.length};var l={"x-mac-croatian":"\u00c4\u00c5\u00c7\u00c9\u00d1\u00d6\u00dc\u00e1\u00e0\u00e2\u00e4\u00e3\u00e5\u00e7\u00e9\u00e8\u00ea\u00eb\u00ed\u00ec\u00ee\u00ef\u00f1\u00f3\u00f2\u00f4\u00f6\u00f5\u00fa\u00f9\u00fb\u00fc\u2020\u00b0\u00a2\u00a3\u00a7\u2022\u00b6\u00df\u00ae\u0160\u2122\u00b4\u00a8\u2260\u017d\u00d8\u221e\u00b1\u2264\u2265\u2206\u00b5\u2202\u2211\u220f\u0161\u222b\u00aa\u00ba\u03a9\u017e\u00f8\u00bf\u00a1\u00ac\u221a\u0192\u2248\u0106\u00ab\u010c\u2026\u00a0\u00c0\u00c3\u00d5\u0152\u0153\u0110\u2014\u201c\u201d\u2018\u2019\u00f7\u25ca\uf8ff\u00a9\u2044\u20ac\u2039\u203a\u00c6\u00bb\u2013\u00b7\u201a\u201e\u2030\u00c2\u0107\u00c1\u010d\u00c8\u00cd\u00ce\u00cf\u00cc\u00d3\u00d4\u0111\u00d2\u00da\u00db\u00d9\u0131\u02c6\u02dc\u00af\u03c0\u00cb\u02da\u00b8\u00ca\u00e6\u02c7",
"x-mac-cyrillic":"\u0410\u0411\u0412\u0413\u0414\u0415\u0416\u0417\u0418\u0419\u041a\u041b\u041c\u041d\u041e\u041f\u0420\u0421\u0422\u0423\u0424\u0425\u0426\u0427\u0428\u0429\u042a\u042b\u042c\u042d\u042e\u042f\u2020\u00b0\u0490\u00a3\u00a7\u2022\u00b6\u0406\u00ae\u00a9\u2122\u0402\u0452\u2260\u0403\u0453\u221e\u00b1\u2264\u2265\u0456\u00b5\u0491\u0408\u0404\u0454\u0407\u0457\u0409\u0459\u040a\u045a\u0458\u0405\u00ac\u221a\u0192\u2248\u2206\u00ab\u00bb\u2026\u00a0\u040b\u045b\u040c\u045c\u0455\u2013\u2014\u201c\u201d\u2018\u2019\u00f7\u201e\u040e\u045e\u040f\u045f\u2116\u0401\u0451\u044f\u0430\u0431\u0432\u0433\u0434\u0435\u0436\u0437\u0438\u0439\u043a\u043b\u043c\u043d\u043e\u043f\u0440\u0441\u0442\u0443\u0444\u0445\u0446\u0447\u0448\u0449\u044a\u044b\u044c\u044d\u044e",
"x-mac-gaelic":"\u00c4\u00c5\u00c7\u00c9\u00d1\u00d6\u00dc\u00e1\u00e0\u00e2\u00e4\u00e3\u00e5\u00e7\u00e9\u00e8\u00ea\u00eb\u00ed\u00ec\u00ee\u00ef\u00f1\u00f3\u00f2\u00f4\u00f6\u00f5\u00fa\u00f9\u00fb\u00fc\u2020\u00b0\u00a2\u00a3\u00a7\u2022\u00b6\u00df\u00ae\u00a9\u2122\u00b4\u00a8\u2260\u00c6\u00d8\u1e02\u00b1\u2264\u2265\u1e03\u010a\u010b\u1e0a\u1e0b\u1e1e\u1e1f\u0120\u0121\u1e40\u00e6\u00f8\u1e41\u1e56\u1e57\u027c\u0192\u017f\u1e60\u00ab\u00bb\u2026\u00a0\u00c0\u00c3\u00d5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\u1e61\u1e9b\u00ff\u0178\u1e6a\u20ac\u2039\u203a\u0176\u0177\u1e6b\u00b7\u1ef2\u1ef3\u204a\u00c2\u00ca\u00c1\u00cb\u00c8\u00cd\u00ce\u00cf\u00cc\u00d3\u00d4\u2663\u00d2\u00da\u00db\u00d9\u0131\u00dd\u00fd\u0174\u0175\u1e84\u1e85\u1e80\u1e81\u1e82\u1e83",
"x-mac-greek":"\u00c4\u00b9\u00b2\u00c9\u00b3\u00d6\u00dc\u0385\u00e0\u00e2\u00e4\u0384\u00a8\u00e7\u00e9\u00e8\u00ea\u00eb\u00a3\u2122\u00ee\u00ef\u2022\u00bd\u2030\u00f4\u00f6\u00a6\u20ac\u00f9\u00fb\u00fc\u2020\u0393\u0394\u0398\u039b\u039e\u03a0\u00df\u00ae\u00a9\u03a3\u03aa\u00a7\u2260\u00b0\u00b7\u0391\u00b1\u2264\u2265\u00a5\u0392\u0395\u0396\u0397\u0399\u039a\u039c\u03a6\u03ab\u03a8\u03a9\u03ac\u039d\u00ac\u039f\u03a1\u2248\u03a4\u00ab\u00bb\u2026\u00a0\u03a5\u03a7\u0386\u0388\u0153\u2013\u2015\u201c\u201d\u2018\u2019\u00f7\u0389\u038a\u038c\u038e\u03ad\u03ae\u03af\u03cc\u038f\u03cd\u03b1\u03b2\u03c8\u03b4\u03b5\u03c6\u03b3\u03b7\u03b9\u03be\u03ba\u03bb\u03bc\u03bd\u03bf\u03c0\u03ce\u03c1\u03c3\u03c4\u03b8\u03c9\u03c2\u03c7\u03c5\u03b6\u03ca\u03cb\u0390\u03b0\u00ad",
"x-mac-icelandic":"\u00c4\u00c5\u00c7\u00c9\u00d1\u00d6\u00dc\u00e1\u00e0\u00e2\u00e4\u00e3\u00e5\u00e7\u00e9\u00e8\u00ea\u00eb\u00ed\u00ec\u00ee\u00ef\u00f1\u00f3\u00f2\u00f4\u00f6\u00f5\u00fa\u00f9\u00fb\u00fc\u00dd\u00b0\u00a2\u00a3\u00a7\u2022\u00b6\u00df\u00ae\u00a9\u2122\u00b4\u00a8\u2260\u00c6\u00d8\u221e\u00b1\u2264\u2265\u00a5\u00b5\u2202\u2211\u220f\u03c0\u222b\u00aa\u00ba\u03a9\u00e6\u00f8\u00bf\u00a1\u00ac\u221a\u0192\u2248\u2206\u00ab\u00bb\u2026\u00a0\u00c0\u00c3\u00d5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\u00f7\u25ca\u00ff\u0178\u2044\u20ac\u00d0\u00f0\u00de\u00fe\u00fd\u00b7\u201a\u201e\u2030\u00c2\u00ca\u00c1\u00cb\u00c8\u00cd\u00ce\u00cf\u00cc\u00d3\u00d4\uf8ff\u00d2\u00da\u00db\u00d9\u0131\u02c6\u02dc\u00af\u02d8\u02d9\u02da\u00b8\u02dd\u02db\u02c7",
"x-mac-inuit":"\u1403\u1404\u1405\u1406\u140a\u140b\u1431\u1432\u1433\u1434\u1438\u1439\u1449\u144e\u144f\u1450\u1451\u1455\u1456\u1466\u146d\u146e\u146f\u1470\u1472\u1473\u1483\u148b\u148c\u148d\u148e\u1490\u1491\u00b0\u14a1\u14a5\u14a6\u2022\u00b6\u14a7\u00ae\u00a9\u2122\u14a8\u14aa\u14ab\u14bb\u14c2\u14c3\u14c4\u14c5\u14c7\u14c8\u14d0\u14ef\u14f0\u14f1\u14f2\u14f4\u14f5\u1505\u14d5\u14d6\u14d7\u14d8\u14da\u14db\u14ea\u1528\u1529\u152a\u152b\u152d\u2026\u00a0\u152e\u153e\u1555\u1556\u1557\u2013\u2014\u201c\u201d\u2018\u2019\u1558\u1559\u155a\u155d\u1546\u1547\u1548\u1549\u154b\u154c\u1550\u157f\u1580\u1581\u1582\u1583\u1584\u1585\u158f\u1590\u1591\u1592\u1593\u1594\u1595\u1671\u1672\u1673\u1674\u1675\u1676\u1596\u15a0\u15a1\u15a2\u15a3\u15a4\u15a5\u15a6\u157c\u0141\u0142",
"x-mac-ce":"\u00c4\u0100\u0101\u00c9\u0104\u00d6\u00dc\u00e1\u0105\u010c\u00e4\u010d\u0106\u0107\u00e9\u0179\u017a\u010e\u00ed\u010f\u0112\u0113\u0116\u00f3\u0117\u00f4\u00f6\u00f5\u00fa\u011a\u011b\u00fc\u2020\u00b0\u0118\u00a3\u00a7\u2022\u00b6\u00df\u00ae\u00a9\u2122\u0119\u00a8\u2260\u0123\u012e\u012f\u012a\u2264\u2265\u012b\u0136\u2202\u2211\u0142\u013b\u013c\u013d\u013e\u0139\u013a\u0145\u0146\u0143\u00ac\u221a\u0144\u0147\u2206\u00ab\u00bb\u2026\u00a0\u0148\u0150\u00d5\u0151\u014c\u2013\u2014\u201c\u201d\u2018\u2019\u00f7\u25ca\u014d\u0154\u0155\u0158\u2039\u203a\u0159\u0156\u0157\u0160\u201a\u201e\u0161\u015a\u015b\u00c1\u0164\u0165\u00cd\u017d\u017e\u016a\u00d3\u00d4\u016b\u016e\u00da\u016f\u0170\u0171\u0172\u0173\u00dd\u00fd\u0137\u017b\u0141\u017c\u0122\u02c7",
macintosh:"\u00c4\u00c5\u00c7\u00c9\u00d1\u00d6\u00dc\u00e1\u00e0\u00e2\u00e4\u00e3\u00e5\u00e7\u00e9\u00e8\u00ea\u00eb\u00ed\u00ec\u00ee\u00ef\u00f1\u00f3\u00f2\u00f4\u00f6\u00f5\u00fa\u00f9\u00fb\u00fc\u2020\u00b0\u00a2\u00a3\u00a7\u2022\u00b6\u00df\u00ae\u00a9\u2122\u00b4\u00a8\u2260\u00c6\u00d8\u221e\u00b1\u2264\u2265\u00a5\u00b5\u2202\u2211\u220f\u03c0\u222b\u00aa\u00ba\u03a9\u00e6\u00f8\u00bf\u00a1\u00ac\u221a\u0192\u2248\u2206\u00ab\u00bb\u2026\u00a0\u00c0\u00c3\u00d5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\u00f7\u25ca\u00ff\u0178\u2044\u20ac\u2039\u203a\ufb01\ufb02\u2021\u00b7\u201a\u201e\u2030\u00c2\u00ca\u00c1\u00cb\u00c8\u00cd\u00ce\u00cf\u00cc\u00d3\u00d4\uf8ff\u00d2\u00da\u00db\u00d9\u0131\u02c6\u02dc\u00af\u02d8\u02d9\u02da\u00b8\u02dd\u02db\u02c7",
"x-mac-romanian":"\u00c4\u00c5\u00c7\u00c9\u00d1\u00d6\u00dc\u00e1\u00e0\u00e2\u00e4\u00e3\u00e5\u00e7\u00e9\u00e8\u00ea\u00eb\u00ed\u00ec\u00ee\u00ef\u00f1\u00f3\u00f2\u00f4\u00f6\u00f5\u00fa\u00f9\u00fb\u00fc\u2020\u00b0\u00a2\u00a3\u00a7\u2022\u00b6\u00df\u00ae\u00a9\u2122\u00b4\u00a8\u2260\u0102\u0218\u221e\u00b1\u2264\u2265\u00a5\u00b5\u2202\u2211\u220f\u03c0\u222b\u00aa\u00ba\u03a9\u0103\u0219\u00bf\u00a1\u00ac\u221a\u0192\u2248\u2206\u00ab\u00bb\u2026\u00a0\u00c0\u00c3\u00d5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\u00f7\u25ca\u00ff\u0178\u2044\u20ac\u2039\u203a\u021a\u021b\u2021\u00b7\u201a\u201e\u2030\u00c2\u00ca\u00c1\u00cb\u00c8\u00cd\u00ce\u00cf\u00cc\u00d3\u00d4\uf8ff\u00d2\u00da\u00db\u00d9\u0131\u02c6\u02dc\u00af\u02d8\u02d9\u02da\u00b8\u02dd\u02db\u02c7",
"x-mac-turkish":"\u00c4\u00c5\u00c7\u00c9\u00d1\u00d6\u00dc\u00e1\u00e0\u00e2\u00e4\u00e3\u00e5\u00e7\u00e9\u00e8\u00ea\u00eb\u00ed\u00ec\u00ee\u00ef\u00f1\u00f3\u00f2\u00f4\u00f6\u00f5\u00fa\u00f9\u00fb\u00fc\u2020\u00b0\u00a2\u00a3\u00a7\u2022\u00b6\u00df\u00ae\u00a9\u2122\u00b4\u00a8\u2260\u00c6\u00d8\u221e\u00b1\u2264\u2265\u00a5\u00b5\u2202\u2211\u220f\u03c0\u222b\u00aa\u00ba\u03a9\u00e6\u00f8\u00bf\u00a1\u00ac\u221a\u0192\u2248\u2206\u00ab\u00bb\u2026\u00a0\u00c0\u00c3\u00d5\u0152\u0153\u2013\u2014\u201c\u201d\u2018\u2019\u00f7\u25ca\u00ff\u0178\u011e\u011f\u0130\u0131\u015e\u015f\u2021\u00b7\u201a\u201e\u2030\u00c2\u00ca\u00c1\u00cb\u00c8\u00cd\u00ce\u00cf\u00cc\u00d3\u00d4\uf8ff\u00d2\u00da\u00db\u00d9\uf8a0\u02c6\u02dc\u00af\u02d8\u02d9\u02da\u00b8\u02dd\u02db\u02c7"};
b.MACSTRING=function(b,c,d,e){e=l[e];if(void 0!==e){for(var f="",g=0;g<d;g++){var h=b.getUint8(c+g);f=127>=h?f+String.fromCharCode(h):f+e[h&127]}return f}};var h="function"===typeof WeakMap&&new WeakMap,m;g.MACSTRING=function(b,c){a:{if(!m)for(d in m={},l)m[d]=new String(d);var d=m[c];if(void 0!==d){if(h){var e=h.get(d);if(void 0!==e){d=e;break a}}e=l[c];if(void 0!==e){for(var f={},g=0;g<e.length;g++)f[e.charCodeAt(g)]=g+128;h&&h.set(d,f);d=f;break a}}d=void 0}if(void 0!==d){e=[];for(f=0;f<b.length;f++){g=
b.charCodeAt(f);if(128<=g&&(g=d[g],void 0===g))return;e[f]=g}return e}};k.MACSTRING=function(b,c){var d=g.MACSTRING(b,c);return void 0!==d?d.length:0};g.INDEX=function(b){var c,d=1,e=[d],f=[];for(c=0;c<b.length;c+=1){var h=g.OBJECT(b[c]);Array.prototype.push.apply(f,h);d+=h.length;e.push(d)}if(0===f.length)return[0,0];h=[];d=1+Math.floor(Math.log(d)/Math.log(2))/8|0;var k=[void 0,g.BYTE,g.USHORT,g.UINT24,g.ULONG][d];for(c=0;c<e.length;c+=1){var l=k(e[c]);Array.prototype.push.apply(h,l)}return Array.prototype.concat(g.Card16(b.length),
g.OffSize(d),h,f)};k.INDEX=function(b){return g.INDEX(b).length};g.DICT=function(b){for(var c=[],d=Object.keys(b),e=d.length,f=0;f<e;f+=1){var h=parseInt(d[f],0),k=b[h];c=c.concat(g.OPERAND(k.value,k.type));c=c.concat(g.OPERATOR(h))}return c};k.DICT=function(b){return g.DICT(b).length};g.OPERATOR=function(b){return 1200>b?[b]:[12,b-1200]};g.OPERAND=function(b,c){var d=[];if(Array.isArray(c))for(var e=0;e<c.length;e+=1)f.argument(b.length===c.length,"Not enough arguments given for type"+c),d=d.concat(g.OPERAND(b[e],
c[e]));else if("SID"===c)d=d.concat(g.NUMBER(b));else if("offset"===c)d=d.concat(g.NUMBER32(b));else if("number"===c)d=d.concat(g.NUMBER(b));else if("real"===c)d=d.concat(g.REAL(b));else throw Error("Unknown operand type "+c);return d};g.OP=g.BYTE;k.OP=k.BYTE;var n="function"===typeof WeakMap&&new WeakMap;g.CHARSTRING=function(b){if(n){var c=n.get(b);if(void 0!==c)return c}c=[];for(var d=b.length,e=0;e<d;e+=1){var f=b[e];c=c.concat(g[f.type](f.value))}n&&n.set(b,c);return c};k.CHARSTRING=function(b){return g.CHARSTRING(b).length};
g.OBJECT=function(b){var c=g[b.type];f.argument(void 0!==c,"No encoding function for type "+b.type);return c(b.value)};k.OBJECT=function(b){var c=k[b.type];f.argument(void 0!==c,"No sizeOf function for type "+b.type);return c(b.value)};g.TABLE=function(b){var c=[],d=b.fields.length,e=[],h=[],k;for(k=0;k<d;k+=1){var l=b.fields[k],m=g[l.type];f.argument(void 0!==m,"No encoding function for field type "+l.type+" ("+l.name+")");var n=b[l.name];void 0===n&&(n=l.value);m=m(n);"TABLE"===l.type?(h.push(c.length),
c=c.concat([0,0]),e.push(m)):c=c.concat(m)}for(k=0;k<e.length;k+=1)d=h[k],l=c.length,f.argument(65536>l,"Table "+b.tableName+" too big."),c[d]=l>>8,c[d+1]=l&255,c=c.concat(e[k]);return c};k.TABLE=function(b){for(var c=0,d=b.fields.length,e=0;e<d;e+=1){var g=b.fields[e],h=k[g.type];f.argument(void 0!==h,"No sizeOf function for field type "+g.type+" ("+g.name+")");var l=b[g.name];void 0===l&&(l=g.value);c+=h(l);"TABLE"===g.type&&(c+=2)}return c};g.RECORD=g.TABLE;k.RECORD=k.TABLE;g.LITERAL=function(b){return b};
k.LITERAL=function(b){return b.length};d.decode=b;d.encode=g;d.sizeOf=k},{"./check":2}],33:[function(b,c,d){d.isBrowser=function(){return"undefined"!==typeof window};d.isNode=function(){return"undefined"===typeof window};d.nodeBufferToArrayBuffer=function(b){for(var c=new ArrayBuffer(b.length),d=new Uint8Array(c),e=0;e<b.length;++e)d[e]=b[e];return c};d.arrayBufferToNodeBuffer=function(b){var c=new Buffer(b.byteLength);b=new Uint8Array(b);for(var d=0;d<c.length;++d)c[d]=b[d];return c};d.checkArgument=
function(b,c){if(!b)throw c;}},{}]},{},[9])(9)});function SetMatrix_action(a){this.docRef=a;this.elementList=[];this.matrixList=[]}_=SetMatrix_action.prototype;_.execute=function(){for(var a=this.elementList.length,b=0;b<a;b++)this.elementList[b].getTransform().setMatrix(this.matrixList[b]),this.docRef.selectElement(this.elementList[b]);this.docRef.onChange();this.docRef.dispatchGeometryChangedEvent(this.elementList);this.docRef.showSelectionProperties();this.docRef.createInteractionFromSelection()};
_.addElements=function(a){for(var b=a.length,c=0;c<b;c++)this.elementList.push(a[c]),this.matrixList.push(a[c].getTransform().matrix.clone())};function ScaleElements_action(a){this.docRef=a;this.elementList=[];this.scaleY=this.scaleX=1;this.pivotPt;this.localMode=!1;this.contentViewMatrix;this.options={}}_=ScaleElements_action.prototype;
_.execute=function(){var a=this.docRef.content.getTransform().matrix.clone();this.docRef.content.getTransform().setMatrix(this.contentViewMatrix);this.docRef.workspace.getTransform().setMatrix(this.contentViewMatrix);this.docRef.scaleElementList(this.elementList,this.scaleX,this.scaleY,this.pivotPt,this.localMode);0==this.docRef.useStoredUndoRedoContentView&&(this.docRef.content.getTransform().setMatrix(a),this.docRef.workspace.getTransform().setMatrix(a));this.docRef.normalizeScaleElementList(this.elementList,
this.options);this.docRef.selectElementList(this.elementList);this.docRef.dispatchGeometryChangedEvent(this.elementList);this.docRef.onChange();this.docRef.showSelectionProperties();this.docRef.createInteractionFromSelection()};_.addElements=function(a,b){this.contentViewMatrix=this.docRef.content.getTransform().matrix.clone();this.options=b||{scaleStrokeWidth:!0,scaleText:!0};console.log(this.contentViewMatrix);for(var c=a.length,d=0;d<c;d++)this.elementList.push(a[d])};
function SetProperties_action(a){this.docRef=a;this.elementList=[];this.propertyList=[];this.updateDocumentSelection=!0}_=SetProperties_action.prototype;_.execute=function(){for(var a,b,c=this.elementList.length,d=0;d<c;d++)for(name in a=this.elementList[d],b=this.propertyList[d],b)a[name]=b[name];this.onExecuteEnd()};_.onExecuteEnd=function(){this.docRef.onChange();this.updateDocumentSelection&&(this.docRef.selectElementList(this.elementList),this.docRef.createInteractionFromSelection());this.docRef.showSelectionProperties()};
_.addElements=function(a,b){for(var c=a.length,d=0;d<c;d++){this.elementList.push(a[d]);var e={};e[b]=a[d][b];this.propertyList.push(e)}};_.addElementAndProperties=function(a,b){this.elementList.push(a);this.propertyList.push(b)};function SetAttributes_action(a){this.docRef=a;this.elementList=[];this.attributeList=[];this.updateDocumentSelection=!0}_=SetAttributes_action.prototype;
_.execute=function(){for(var a,b,c,d=this.elementList.length,e=0;e<d;e++)for(c in a=this.elementList[e],b=this.attributeList[e],b)a.setAttribute(c,b[c]);this.onExecuteEnd()};_.onExecuteEnd=function(){this.docRef.onChange();this.updateDocumentSelection&&(this.docRef.selectElementList(this.elementList),this.docRef.createInteractionFromSelection());this.docRef.showSelectionProperties()};
_.addElements=function(a,b){for(var c=a.length,d=0;d<c;d++){this.elementList.push(a[d]);var e={};if("string"==typeof b)e[b]="",a[d].hasAttribute(b)&&(e[b]=a[d].getAttribute(b));else if(b instanceof Array)for(var f=0;f<b.length;f++)e[b[f]]="",a[d].hasAttribute(b[f])&&(e[b[f]]=a[d].getAttribute(b[f]));else if(b instanceof Object)for(var g in b)e[g]="",a[d].hasAttribute(g)&&(e[g]=a[d].getAttribute(g));this.attributeList.push(e)}};_.addElementAndAttributes=function(a,b){this.elementList.push(a);this.attributeList.push(b)};
function AddElements_action(a){this.docRef=a;this.actionDataList=[];this.updateDocumentSelection=!0}_=AddElements_action.prototype;_.execute=function(){for(var a,b=this.actionDataList.length,c=0;c<b;c++)a=this.actionDataList[c],a.parentElement.appendChild(a.element),a.element.setIndex(a.id);this.docRef.onChange();if(this.updateDocumentSelection)this.onExecuteEnd()};
_.onExecuteEnd=function(){for(var a,b=this.actionDataList.length,c=0;c<b;c++)a=this.actionDataList[c],this.docRef.selectElement(a.element);this.docRef.showSelectionProperties();this.docRef.createInteractionFromSelection()};_.addElements=function(a){for(var b=a.length,c=0;c<b;c++)this.actionDataList.push({parentElement:a[c].parentNode,element:a[c],id:a[c].getIndex()})};function RemoveElements_action(a){this.docRef=a;this.elementList=[];this.updateDocumentSelection=!0}_=RemoveElements_action.prototype;
_.execute=function(){for(var a,b=this.elementList.length,c=0;c<b;c++)a=this.elementList[c],a.parentNode.removeChild(a);this.docRef.onChange();if(this.updateDocumentSelection)this.onExecuteEnd()};_.onExecuteEnd=function(){this.docRef.deselectAllElements();this.docRef.createInteractionFromSelection();this.docRef.showSelectionProperties()};_.addElements=function(a){for(var b=a.length,c=0;c<b;c++)this.elementList.push(a[c])};
function ReplaceElements_action(a){this.docRef=a;this.elementListToAdd_data=[];this.elementListToRemove=[];this.updateDocumentSelection=!0}_=ReplaceElements_action.prototype;_.execute=function(){var a;var b=this.elementListToRemove.length;for(a=0;a<b;a++){var c=this.elementListToRemove[a];c.parentNode.removeChild(c)}b=this.elementListToAdd_data.length;for(a=0;a<b;a++)c=this.elementListToAdd_data[a],c.parentElement.appendChild(c.element),c.element.setIndex(c.id);this.docRef.onChange();if(this.updateDocumentSelection)this.onExecuteEnd()};
_.onExecuteEnd=function(){this.docRef.deselectAllElements();for(var a,b=this.elementListToAdd_data.length,c=0;c<b;c++)a=this.elementListToAdd_data[c],this.docRef.selectElement(a.element);this.docRef.createInteractionFromSelection();this.docRef.showSelectionProperties()};_.addElementsToRemove=function(a){for(var b=a.length,c=0;c<b;c++)this.elementListToRemove.push(a[c])};
_.addElementsToAdd=function(a){for(var b=a.length,c=0;c<b;c++)this.elementListToAdd_data.push({parentElement:a[c].parentNode,element:a[c],id:a[c].getIndex()})};function SetIndex_action(a){this.docRef=a;this.actionDataList=[]}_=SetIndex_action.prototype;_.execute=function(){for(var a,b=this.actionDataList.length,c=0;c<b;c++)a=this.actionDataList[c],a.element.setIndex(a.id),this.docRef.selectElement(a.element);this.docRef.onChange();this.docRef.showSelectionProperties();this.docRef.createInteractionFromSelection()};
_.addElements=function(a){for(var b=a.length,c=0;c<b;c++)this.actionDataList.push({element:a[c],id:a[c].getIndex()})};Extends(SetPathSegmentPos_action,SetProperties_action);function SetPathSegmentPos_action(a){SetPathSegmentPos_action.superConstructor.call(this,a)}_=SetPathSegmentPos_action.prototype;
_.onExecuteEnd=function(){this.docRef.onChange();for(var a=[],b=[],c=this.elementList.length,d=0;d<c;d++)-1==a.indexOf(this.elementList[d].pathOwner)&&a.push(this.elementList[d].pathOwner),this.propertyList[d].hasOwnProperty("x")&&b.push(this.elementList[d]);this.docRef.selectElementList(a);this.docRef.dispatchGeometryChangedEvent(a);this.docRef.createInteractionFromSelection();this.docRef.showSelectionProperties()};
function AddPathSegment_action(a){this.docRef=a;this.actionDataList=[];this.updateDocumentSelection=!0}_=AddPathSegment_action.prototype;_.execute=function(){for(var a,b,c,d=this.actionDataList.length,e=0;e<d;e++)a=this.actionDataList[e],c=a.pathOwner,b=a.segment,a=a.id,c.pathSegList.insertItemBefore(b,a);this.docRef.onChange();if(this.updateDocumentSelection)this.onExecuteEnd()};
_.onExecuteEnd=function(){if(!(this.docRef.editorRef.tools.activeTool instanceof DrawPath_tool)){for(var a=[],b=this.actionDataList.length,c=0;c<b;c++)-1==a.indexOf(this.actionDataList[c].pathOwner)&&a.push(this.actionDataList[c].pathOwner);if(this.onExecuteEndCallback)this.onExecuteEndCallback();this.docRef.selectElementList(a);this.docRef.createInteractionFromSelection();this.docRef.showSelectionProperties()}};
_.addElements=function(a){for(var b,c,d,e=a.length,f=0;f<e;f++)b=a[f],c=b.pathOwner,d=c.getPathSegIndex(b),this.actionDataList.push({pathOwner:c,segment:b,id:d})};function RemovePathSegment_action(a){this.docRef=a;this.actionDataList=[];this.updateDocumentSelection=!0}_=RemovePathSegment_action.prototype;_.execute=function(){for(var a,b,c=this.actionDataList.length,d=0;d<c;d++)a=this.actionDataList[d],b=a.pathOwner,a=a.id,b.pathSegList.removeItem(a);this.docRef.onChange();if(this.updateDocumentSelection)this.onExecuteEnd()};
_.onExecuteEnd=function(){if(!(this.docRef.editorRef.tools.activeTool instanceof DrawPath_tool)){for(var a=[],b=this.actionDataList.length,c=0;c<b;c++)-1==a.indexOf(this.actionDataList[c].pathOwner)&&a.push(this.actionDataList[c].pathOwner);this.docRef.selectElementList(a);this.docRef.createInteractionFromSelection();this.docRef.showSelectionProperties()}};
_.addElements=function(a){for(var b,c,d,e=a.length,f=0;f<e;f++)b=a[f],c=b.pathOwner,d=c.getPathSegIndex(b),this.actionDataList.push({pathOwner:c,segment:b,id:d})};function SetClipPath_action(a){this.docRef=a;this.clipPath=this.clipPathTarget=null}_=SetClipPath_action.prototype;_.execute=function(){if(this.clipPath){var a=this.clipPathTarget.getAttribute("id");this.clipPathTarget.setAttribute("clip-path","url(#"+a+")")}else this.clipPathTarget.removeAttribute("clip-path")};
_.addElement=function(a,b){this.clipPathTarget=a;this.clipPath=b};function SvgSerializer(a){this.appRef=a;this.timestamp=(new Date).getTime();this.documentFullPath="";this.COUNTER=0}_=SvgSerializer.prototype;_.getUniqueID=function(){this.COUNTER++;return this.timestamp+"_"+this.COUNTER};
_.serialize=function(a,b){var c=new XMLSerializer,d=a.cloneNode(!0);(this.documentFullPath=b||a.fullPath)&&d.setAttribute("jvs-fullPath",this.documentFullPath);this.composeSVGElement(d);console.log("clonedDocument",d);d.removeUnusedDefsItems();console.log("clonedDocument removeUnusedDefsItems",d);d.renameDynamicReferences();this.serializeRGBAColors(d);this.serializeFontLinks(d);this.serializeComponents(d);this.createSVGXlinks(d);this.createLocalPaths(d);console.log("clonedDocument",d);return c.serializeToString(d)};
_.composeSVGElement=function(a){var b=a.querySelector("#jvs-workspace .jvs-page");b&&(a.setAttribute("width",b.getAttribute("width")),a.setAttribute("height",b.getAttribute("height")));(b=a.querySelector("#jvs-content"))&&b.removeAttribute("transform");(b=a.querySelector("#jvs-workspace"))&&b.remove();(a=a.querySelector("#jvs-grid"))&&a.remove()};
_.createLocalPaths=function(a){a=a.querySelectorAll("image");for(var b,c,d=0;d<a.length;d++)c=a[d],c.hasAttribute("jvs-fullPath")&&(b=GetRelativeFilePathFromBaseFilePath(this.documentFullPath,c.getAttribute("jvs-fullPath")),c.setAttribute("jvs-localPath",b))};
_.imageDataUrlToLocalPath=function(a){console.log("imageDataUrlToLocalPath",a);a=a.querySelectorAll("image");console.log("elementList",a);for(var b,c,d=0;d<a.length;d++)c=a[d],c.hasAttribute("jvs-fullPath")&&(b=GetRelativeFilePathFromBaseFilePath(this.documentFullPath,c.getAttribute("jvs-fullPath")),c.setAttributeNS(SVGElement.XLINK_NS,"href",b),c.removeAttribute("jvs-fullPath"),console.log(c))};
_.serializeFontLinks=function(a){for(var b,c=a.querySelectorAll("[font-family]"),d=[],e=0;e<c.length;e++)b=c[e],b=b.getAttribute("font-family").split(" ").join("+"),(b=document.head.querySelector('*[href*="'+b+'"]'))&&-1==d.indexOf(b)&&d.push(b);a=a.querySelector("defs");for(e=0;e<d.length;e++)c=d[e].cloneNode(),c.appendChild(document.createTextNode("")),a.appendChild(c);console.log("defsNode",a)};
_.serializeComponents=function(a){for(var b,c,d=a.querySelectorAll("[controller-class]"),e=0;e<d.length;e++)a=d[e],b=a.getAttribute("controller-class"),"IFrameInForeignObject"==b&&(c=a.getTransform().matrix.decompose(),b=c.translateX,c=c.translateY,a.hasAttribute("x")&&(b+=parseFloat(a.getAttribute("x"))),a.hasAttribute("y")&&(c+=parseFloat(a.getAttribute("y"))),a.setAttribute("x",b),a.setAttribute("y",c),a.setAttribute("transform",""))};
_.createSVGXlinks=function(a){for(var b,c,d=a.querySelectorAll("[jvs-xlink-href]"),e=0;e<d.length;e++)a=d[e],b=a.getAttribute("jvs-xlink-href"),a.hasAttribute("jvs-xlink-target")&&(c=a.getAttribute("jvs-xlink-target").trim(),""==c&&(c=null)),b=SVGElement.svgUtils.createXlink(b,c),b.appendChild(a.cloneNode(!0)),console.log("xlink",b),a.parentNode.replaceChild(b,a)};
_.serializeRGBAColors=function(a){function b(a){a=a.split("rgba(")[1].split(")")[0].split(",");var b={};b.r=a[0];b.g=a[1];b.b=a[2];b.a=a[3];return b}var c,d=a.querySelectorAll("*[fill*=rgba]");for(c=0;c<d.length;c++){var e=d[c];var f=b(e.getAttribute("fill"));e.setAttribute("fill","rgb("+f.r+","+f.g+","+f.b+")");e.setAttribute("fill-opacity",f.a)}d=a.querySelectorAll("*[stroke*=rgba]");for(c=0;c<d.length;c++)e=d[c],f=b(e.getAttribute("stroke")),e.setAttribute("stroke","rgb("+f.r+","+f.g+","+f.b+")"),
e.setAttribute("stroke-opacity",f.a)};function SvgUnserializer(a,b){this.appRef=a;this.targetDocument=this.sourceDocument=this.loadedDocumentElement=null;this.COUNTER=0;this.timestamp=(new Date).getTime();this.options=b}_=SvgUnserializer.prototype;_.getUniqueID=function(){this.COUNTER++;return this.timestamp+"_"+this.COUNTER};
_.unserialize=function(a,b,c){this.targetDocument=b;a=a.replace(/\x3c!--startCDATA--\x3e/g,"<![CDATA[").replace(/\x3c!--endCDATA--\x3e/g,"]]\x3e");this.loadedDocumentElement=(new DOMParser).parseFromString(a,"text/xml").documentElement;this.sourceDocument=(this.sourceDocument=this.loadedDocumentElement.querySelector("svg"))||this.loadedDocumentElement;this.options=c||this.options;this.options||(this.options={},this.options.parsePageSettings=!0);console.log("loadedDocumentElement",this.loadedDocumentElement);
console.log("sourceDocument",this.sourceDocument);console.log("targetDocument",this.targetDocument);this.options.renameReferences&&this.sourceDocument.renameDynamicReferences();this.options.parsePageSettings&&(this.parsePageSettings(),this.parseTitleAndDescription());this.convertStylePropertiesToAttributes();this.parseLines();this.parseFillAndStrokeOpacity();this.parseGradients();this.parseHtmlHeadMetaTags();this.parseHtmlHeadLinkTags();this.parseIncludes();this.parseDefs();this.parseAnchorElements();
this.parseSvgInHtmlLayer();this.parseScriptTags();this.absolutizeAndNormalizePaths();this.parseContent();this.parseClipPaths();this.parseImages();this.parseTextElements();InitControllers(this.targetDocument);this.fixTextElements()};
_.parsePageSettings=function(){this.sourceDocument.hasAttribute("width")&&this.sourceDocument.hasAttribute("height")&&this.targetDocument.setPageSize(parseFloat(this.sourceDocument.getAttribute("width")),parseFloat(this.sourceDocument.getAttribute("height")));this.sourceDocument.hasAttribute("pageAlignment")&&(this.targetDocument.pageAlignment=this.sourceDocument.getAttribute("pageAlignment"));this.sourceDocument.hasAttribute("bodyBackgroundColor")&&this.targetDocument.setPageColor(this.sourceDocument.getAttribute("bodyBackgroundColor"))};
_.parseFillAndStrokeOpacity=function(){function a(a,b){var c=a.split("rgb(")[1].split(")")[0].split(",");var d=c[0];return"rgba("+d+","+c[1]+","+c[2]+","+b+")"}var b,c=this.sourceDocument.querySelectorAll("*[fill-opacity]");for(b=0;b<c.length;b++){var d=c[b];var e=d.getAttribute("fill-opacity");-1<d.getAttribute("fill").indexOf("rgb(")&&(e=a(d.getAttribute("fill"),e),d.setAttribute("fill",e),d.removeAttribute("fill-opacity"))}c=this.sourceDocument.querySelectorAll("*[stroke-opacity]");for(b=0;b<c.length;b++)d=
c[b],e=d.getAttribute("stroke-opacity"),-1<d.getAttribute("stroke").indexOf("rgb(")&&(e=a(d.getAttribute("stroke"),e),d.setAttribute("stroke",e),d.removeAttribute("stroke-opacity"))};_.parseTitleAndDescription=function(){var a=this.sourceDocument.querySelector("title");a&&(this.targetDocument.svgTitle=a.innerHTML,a.remove());if(a=this.sourceDocument.querySelector("desc"))this.targetDocument.svgDesc=a.innerHTML,a.remove()};
_.parseImages=function(){function a(a,b){function c(b){"ERROR"==b.data.response?d.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Image file not found"),LOCALIZER.translate("The local image")+":"+e+" is not founds!"):(console.log("onDataUrlFileComplete _parameters",b),a.setAttribute("xlink:href",b.data),a.setAttribute("jvs-fullPath",g))}var e=a.getAttribute("xlink:href");if(-1<e.indexOf("https://www.googledrive.com/host/")){var f=e.split("https://www.googledrive.com/host/")[1].split("/");f.shift();
e=f.join("/")}var g=GetAbsoluteFilePathFromBaseFilePath(b,e);d.appRef.CHROME_FILE_SYSTEM_PANEL&&d.appRef.CHROME_FILE_SYSTEM_PANEL.getFileContentAsDataURLFromChromeFileSystem(g,c)}for(var b=this.targetDocument.querySelectorAll("image"),c,d=this,e=0;e<b.length;e++){var f=b[e];(c=f.getAttribute("xlink:href"))&&(-1<c.indexOf("https://www.googledrive.com/host/")||-1<c.indexOf("://")||-1<c.indexOf("data:")||a(f,this.targetDocument.fullPath))}};
_.parseHtmlHeadMetaTags=function(){for(var a=this.loadedDocumentElement.querySelectorAll("head meta"),b,c=0;c<a.length;c++)b=a[c],b.hasAttribute("name")?"description"!=b.getAttribute("name")&&this.targetDocument.metaTags.push(b.cloneNode(!0)):b.hasAttribute("http-equiv")&&b.hasAttribute("content")?"text/html; charset=UTF-8"!=b.getAttribute("content")&&this.targetDocument.metaTags.push(b.cloneNode(!0)):this.targetDocument.metaTags.push(b.cloneNode(!0))};
_.parseHtmlHeadLinkTags=function(){for(var a=this.loadedDocumentElement.querySelectorAll("head link"),b,c=0;c<a.length;c++)if(b=a[c],b.hasAttribute("rel")&&"stylesheet"==b.getAttribute("rel")){var d=b.getAttribute("href");if(-1!=d.indexOf("//fonts.googleapis.com/css?family")){var e="";-1==d.indexOf("http")&&(e="http:");d=e+d;document.head.querySelector('head link[href="'+d+'"]')||(b.setAttribute("href",d),document.head.appendChild(b))}else this.targetDocument.cssLinkTags.push(d)}};
_.parseScriptTags=function(){for(var a=this.loadedDocumentElement.querySelectorAll("script"),b,c,d=0;d<a.length;d++)b=a[d],b.hasAttribute("xlink:href")?(c=b.getAttribute("xlink:href"),this.targetDocument.scriptTags.push(c)):b.hasAttribute("src")&&(c=b.getAttribute("src"),this.targetDocument.scriptTags.push(c)),b.remove()};_.parseDefs=function(){var a=this.sourceDocument.querySelector("defs"),b=this.targetDocument.querySelector("defs");a&&(this.parseFonts(),a.cloneChildrenTo(b),a.remove())};
_.parseGradients=function(){var a=this.sourceDocument.querySelector("defs");a||(a=document.createElementNS(SVGElement.SVG_NS,"defs"),this.sourceDocument.appendChild(a));var b,c=this.sourceDocument.querySelectorAll("linearGradient");for(b=0;b<c.length;b++)c[b].parentElement!=a&&a.appendChild(c[b]);c=this.sourceDocument.querySelectorAll("radialGradient");for(b=0;b<c.length;b++)c[b].parentElement!=a&&a.appendChild(c[b]);c=a.querySelectorAll("linearGradient,radialGradient");for(b=0;b<c.length;b++){var d=
c[b];if(d.hasAttribute("xlink:href")){var e=d.ownerDocument.querySelector(d.getAttribute("xlink:href"));if(e){for(var f=e.querySelectorAll("stop"),g=0;g<f.length;g++)d.appendChild(f[g].cloneNode());d.removeAttribute("xlink:href");e.hasAttribute("gradientTransform")&&d.setAttribute("gradientTransform",e.getAttribute("gradientTransform"));e.classList.add("removable")}}}c=a.querySelectorAll(".removable");for(b=0;b<c.length;b++)c[b].remove()};
_.parseFonts=function(){var a=this.sourceDocument.querySelector("defs");if(a)for(var b=a.querySelectorAll("link"),c=0;c<b.length;c++)if(a=b[c],a.hasAttribute("rel")&&"stylesheet"==a.getAttribute("rel")){var d=a.getAttribute("href");-1<d.indexOf("//fonts.googleapis.com/css?family")&&(document.head.querySelector('link[href="'+d+'"]')||IncludeCSS(d),a.remove())}};
_.parseClipPaths=function(){var a=this.targetDocument.querySelector("defs").querySelectorAll("clipPath");console.log("clipPathList",a);for(var b,c,d=0;d<a.length;d++)b=a[d],(c=this.targetDocument.querySelector('[clip-path="url(#'+b.getAttribute("id")+')"]'))&&c.appendChild(b)};
_.parseTextElements=function(){for(var a=this.targetDocument.querySelectorAll("text"),b,c,d=0;d<a.length;d++)b=a[d],(c=b.querySelector("textPath"))?b.setAttribute("controller-class","Text_path"):b.setAttribute("controller-class","Text_box")};
_.fixTextElements=function(){function a(){c.redrawText();d=c.querySelector("tspan");e=parseFloat(d.getAttribute("y"));c.getTransform().setMatrix(c.getTransform().matrix.translate(0,-e))}for(var b=this.targetDocument.querySelectorAll('text[controller-class="Text_box"]'),c,d,e,f=0;f<b.length;f++)c=b[f],(d=c.querySelector("tspan"))?"0"==d.getAttribute("y")&&a():(c.addTSpan(0,0,c.textContent),a())};
_.parseContent=function(){var a=this.sourceDocument.querySelectorAll('g[type="LAYER"]'),b,c=a.length;for(b=0;b<c;b++){var d=a[b];d.removeAttribute("type");d.classList.add("jvs-layer");d.hasAttribute("locked")&&(d.removeAttribute("locked"),d.classList.add("locked"))}a=this.sourceDocument.querySelectorAll("g.jvs-layer");c=a.length;for(b=0;b<c;b++)d=a[b],d.hasAttribute("jvs-layer-color")||d.setAttribute("jvs-layer-color",this.appRef.COLOR_PICKER.rainbow(12,b));(a=this.sourceDocument.querySelector("#jvs-content"))?
a.cloneChildrenTo(this.targetDocument.content):this.options.addContentUndable?(a=[].slice.call(this.sourceDocument.children),this.targetDocument.appendElementListInLayer_undable(a,this.targetDocument.activeLayer,!0)):this.sourceDocument.cloneChildrenTo(this.targetDocument.activeLayer)};_.extractClassNames=function(a){var b="";if(a.hasAttribute("class")){a=a.getAttribute("class").split(/\s+/);for(var c,d=a.length,e=0;e<d;e++)c=a[e],-1==c.indexOf("_animation_")&&(b+=a[e].trim()+" ")}return b};
_.parseIncludes=function(){for(var a,b,c,d=this.sourceDocument.querySelectorAll("image[include-mode]"),e=0;e<d.length;e++){a=d[e];c=a.getAttribute("include-mode");if(a.hasAttribute("data-svg-idi")){b=a.getAttribute("data-svg-idi");var f=this.loadedDocumentElement.querySelector('html div[data-svg-idi="'+b+'"]');f&&(this.targetDocument.inlineContentList[b]=f.innerHTML.replace(/<!\[CDATA\[/g,"").replace(/\]\]>/g,""));a.setAttribute("jvs-as-html","true")}else a.firstChild&&a.firstChild.nodeValue&&(b=
this.getUniqueID(),this.targetDocument.inlineContentList[b]=a.firstChild.nodeValue.replace(/<!\[CDATA\[/g,"").replace(/\]\]>/g,""));a.setAttribute("jvs-idi",b);a.setAttribute("jvs-include-mode",c);f=window.location.href.split("/");f.pop();f=f.join("/")+"/data/components/default/_previews/";a.setAttribute("xlink:href",f+c+".svg");a.removeAttribute("visibility");a.removeAttribute("data-svg-idi");a.removeAttribute("include-mode")}};
_.parseSvgInHtmlLayer=function(){for(var a,b,c,d=this.loadedDocumentElement.querySelectorAll("html div[data-svg-idi]>svg"),e=0;e<d.length;e++)c=d[e],b=c.parentElement,a=b.getAttribute("data-svg-idi"),a=this.sourceDocument.querySelector('*[data-svg-idi="'+a+'"]'),c&&a&&(c=c.firstElementChild,c.setAttribute("transform",a.getAttribute("transform")),a.parentNode.replaceChild(c,a),c.setAttribute("jvs-as-html","true"),b=this.extractClassNames(b),c.setAttribute("jvs-class-names",b))};
_.parseAnchorElements=function(){for(var a,b,c,d,e=this.loadedDocumentElement.querySelectorAll("a"),f=0;f<e.length;f++)c=e[f],d=c.parentElement,a=c.getAttribute("xlink:href"),b="",c.hasAttribute("target")&&(b=c.getAttribute("target")),c.firstElementChild.setAttribute("jvs-xlink-href",a),c.firstElementChild.setAttribute("jvs-xlink-target",b),c.remove(),c.cloneChildrenTo(d)};
_.parseLines=function(){for(var a=this.sourceDocument.querySelectorAll("line"),b,c,d=0;d<a.length;d++)b=a[d],c=SVGElement.svgUtils.createPath(),c.getTransform().setMatrix(b.getTransform().matrix.clone()),c.setPathData(b.getPathData({normalize:!0})),c.copyAttributeFromElement(b),b.parentElement.replaceChild(c,b)};_.absolutizeAndNormalizePaths=function(){for(var a=this.sourceDocument.querySelectorAll("path"),b=0;b<a.length;b++)a[b].getPathData({normalize:!0})};
_.applyNonScalingStroke=function(){for(var a,b=this.sourceDocument.querySelectorAll("rect,path,ellipse,polygon"),c=0;c<b.length;c++)a=b[c],a.hasAttribute("vector-effect")||a.setAttribute("vector-effect","non-scaling-stroke")};_.convertStylePropertiesToAttributes=function(){for(var a=this.sourceDocument.querySelectorAll("[style]"),b=0;b<a.length;b++)a[b]instanceof SVGElement&&a[b].stylePropertiesToAttributes()};Extends(Align2D_panel,Panel);
function Align2D_panel(a){Align2D_panel.superConstructor.call(this,a);this.connectEvents()}_=Align2D_panel.prototype;_.onShow=function(){};_.onButtonClick=function(a){a=a.target.getAttribute("data-action");-1!=a.indexOf("align")?this.alignElements(a):-1!=a.indexOf("distribuite")&&this.distribuiteElements(a)};
_.alignElements=function(a){var b=this.appRef.editor2D.activeDocument;if(1==b.selectionList.length)var c=b.querySelector("#jvs-workspace .jvs-page").getGlobalBBox();else if(1<b.selectionList.length)c=b.getElementListGlobalBBox(b.selectionList);else return;var d=new SetMatrix_action(b);d.addElements(b.selectionList);for(var e,f,g=b.selectionList.length,k=0;k<g;k++)switch(e=b.selectionList[k],f=e.getGlobalBBox(),a){case "alignLeft":e.translateInGlobal(c.min.x-f.min.x,0);break;case "alignVCenter":e.translateInGlobal(c.center.x-
f.center.x,0);break;case "alignRight":e.translateInGlobal(c.max.x-f.max.x,0);break;case "alignTop":e.translateInGlobal(0,c.min.y-f.min.y);break;case "alignHCenter":e.translateInGlobal(0,c.center.y-f.center.y);break;case "alignBottom":e.translateInGlobal(0,c.max.y-f.max.y)}a=new SetMatrix_action(b);a.addElements(b.selectionList);b.history.addUndoRedoActions(d,a);b.onChange();b.createInteractionFromSelection()};
_.distribuiteElements=function(a){var b=this.appRef.editor2D.activeDocument;if(!(3>b.selectionList.length)){var c=b.getElementListGlobalBBox(b.selectionList),d=b.selectionList.length;switch(a){case "distribuiteCenterX":b.selectionList.sort(function(a,b){return a.getGlobalBBox().min.x-b.getGlobalBBox().min.x});var e=b.selectionList[0].getGlobalBBox();var f=b.selectionList[d-1].getGlobalBBox();c.min.x=e.center.x;c.max.x=f.center.x;var g=c.width/(d-1);break;case "distribuiteCenterY":b.selectionList.sort(function(a,
b){return a.getGlobalBBox().min.y-b.getGlobalBBox().min.y});f=b.selectionList[0].getGlobalBBox();e=b.selectionList[d-1].getGlobalBBox();c.min.y=f.center.y;c.max.y=e.center.y;c.height=c.max.y-c.min.y;var k=c.height/(d-1);break;case "distribuiteHSpace":b.selectionList.sort(function(a,b){return a.getGlobalBBox().min.x-b.getGlobalBBox().min.x});for(f=g=0;f<d;f++)g+=b.selectionList[f].getGlobalBBox().width;g=(c.width-g)/(d-1);e=b.selectionList[0].getGlobalBBox();f=b.selectionList[d-1].getGlobalBBox();
c.min.x=e.max.x;c.max.x=f.min.x;break;case "distribuiteVSpace":b.selectionList.sort(function(a,b){return a.getGlobalBBox().min.y-b.getGlobalBBox().min.y});for(f=k=0;f<d;f++)k+=b.selectionList[f].getGlobalBBox().height;k=(c.height-k)/(d-1);f=b.selectionList[0].getGlobalBBox();e=b.selectionList[d-1].getGlobalBBox();c.min.y=f.max.y;c.max.y=e.min.y}e=new SetMatrix_action(b);e.addElements(b.selectionList);for(f=1;f<d-1;f++){var l=b.selectionList[f];var h=l.getGlobalBBox();switch(a){case "distribuiteCenterX":l.translateInGlobal(c.min.x+
g-h.width/2-h.min.x,0);g+=g;break;case "distribuiteCenterY":l.translateInGlobal(0,c.min.y+k-h.height/2-h.min.y);k+=k;break;case "distribuiteHSpace":l.translateInGlobal(c.min.x+g-h.min.x,0);c.min.x=c.min.x+g+h.width;break;case "distribuiteVSpace":l.translateInGlobal(0,c.min.y+k-h.min.y),c.min.y=c.min.y+k+h.height}}a=new SetMatrix_action(b);a.addElements(b.selectionList);b.history.addUndoRedoActions(e,a);b.onChange();b.createInteractionFromSelection()}};Extends(Tools2D_panel,Panel);
function Tools2D_panel(a){Tools2D_panel.superConstructor.call(this,a);this.connectEvents()}_=Tools2D_panel.prototype;_.onClick_activateToolButton=function(a){console.log("onClick_activateToolButton",a);this.appRef.editor2D.activateTool(a.target)};_.onClick_duplicate=function(){this.appRef.editor2D.activeDocument.duplicateElementList_undable(this.appRef.editor2D.activeDocument.selectionList,10,10)};_.onClick_undoButton=function(){this.appRef.editor2D.activeDocument.undo()};_.onClick_redoButton=function(){this.appRef.editor2D.activeDocument.redo()};
_.onClick_joinPathsButton=function(){this.appRef.editor2D.activeDocument.joinPathList_undable(this.appRef.editor2D.activeDocument.selectionList)};_.onClick_textPath=function(a){this.appRef.editor2D.activeDocument.createTextPathContent_undable(this.appRef.editor2D.activeDocument.selectionList)};_.onClick_clipPath=function(a){this.appRef.editor2D.activeDocument.createClippedContent_undable(this.appRef.editor2D.activeDocument.selectionList)};_.onClick_mask=function(a){this.appRef.editor2D.activeDocument.createMaskedContent_undable(this.appRef.editor2D.activeDocument.selectionList)};
_.onChooseLocalFile_image=function(a){this.appRef.editor2D.activeDocument.onDropFile_IMG(a.target.files[0])};function Snaps_toolbar(a){this.appRef=a.appRef;this.buttonList=this.connectEvents()}_=Snaps_toolbar.prototype;
_.update=function(){var a=this.appRef.editor2D.activeDocument;console.log("documentRef",a);console.log("this.buttonList",this.buttonList);DeselectElements([this.buttonList.snapToGrid,this.buttonList.snapToVertices,this.buttonList.snapToContour,this.buttonList.snapToXY]);1==a.snapToGrid&&this.buttonList.snapToGrid.classList.add("selected");1==a.snapToVertices&&this.buttonList.snapToVertices.classList.add("selected");1==a.snapToContour&&this.buttonList.snapToContour.classList.add("selected");1==a.snapToXY&&
this.buttonList.snapToXY.classList.add("selected")};_.onClick_snapToGrid=function(){var a=this.appRef.editor2D.activeDocument;a.snapToGrid=a.snapToGrid?!1:!0;this.update()};_.onClick_snapToVertices=function(){var a=this.appRef.editor2D.activeDocument;a.snapToVertices=a.snapToVertices?!1:!0;this.update()};_.onClick_snapToContour=function(){var a=this.appRef.editor2D.activeDocument;a.snapToContour=a.snapToContour?!1:!0;this.update()};
_.onClick_snapToXY=function(){var a=this.appRef.editor2D.activeDocument;a.snapToXY=a.snapToXY?!1:!0;this.update()};function EditSelection_toolbar(a){this.appRef=a.appRef;this.connectEvents()}_=EditSelection_toolbar.prototype;_.onClick_selectAll=function(){this.appRef.editor2D.activeDocument.selectAll()};_.onClick_deleteButton=function(){this.appRef.editor2D.activeDocument.removeElementList_undable(this.appRef.editor2D.activeDocument.selectionList)};_.onClick_bringUp=function(a){this.appRef.editor2D.activeDocument.bringElementListUp_undable(this.appRef.editor2D.activeDocument.selectionList)};
_.onClick_sendDown=function(a){this.appRef.editor2D.activeDocument.sendElementListDown_undable(this.appRef.editor2D.activeDocument.selectionList)};_.onClick_bringToFront=function(a){this.appRef.editor2D.activeDocument.bringElementListToFront_undable(this.appRef.editor2D.activeDocument.selectionList)};_.onClick_sendToBack=function(a){this.appRef.editor2D.activeDocument.sendElementListToBack_undable(this.appRef.editor2D.activeDocument.selectionList)};_.onClick_flipHorizontal=function(a){this.appRef.editor2D.activeDocument.flipElementList_undable("horizontal")};
_.onClick_flipVertical=function(a){this.appRef.editor2D.activeDocument.flipElementList_undable("vertical")};_.onClick_rotate=function(){var a=this.appRef.editor2D.activeDocument;if(0!=a.selectionList.length){var b=a.getElementListGlobalBBox(a.selectionList);a.rotateElementList_undable(a.selectionList,a.snapAngle,b.center)}};_.onClick_group=function(a){this.appRef.editor2D.activeDocument.groupElementList_undable(this.appRef.editor2D.activeDocument.selectionList)};
_.onClick_ungroup=function(a){a=this.appRef.editor2D.activeDocument.getFilteredElementListByNodeName(this.appRef.editor2D.activeDocument.selectionList,"g");this.appRef.editor2D.activeDocument.ungroupElementList_undable(a)};_.onClick_lock=function(a){this.appRef.editor2D.activeDocument.lockElementList(this.appRef.editor2D.activeDocument.selectionList)};_.onClick_unlockAll=function(a){this.appRef.editor2D.activeDocument.unlockAllElements()};_.onClick_cut=function(a){this.appRef.editor2D.activeDocument.cutSelectedElements()};
_.onClick_copy=function(a){this.appRef.editor2D.activeDocument.copySelectedElements()};_.onClick_paste=function(a){a=this.appRef.editor2D.activeDocument;a.pasteElements();a.centerElementListInDocumentView(this.appRef.editor2D.activeDocument.selectionList)};_.onClick_pasteInPlace=function(a){this.appRef.editor2D.activeDocument.pasteElements()};Extends(Stroke_panel,Panel);function Stroke_panel(a){Stroke_panel.superConstructor.call(this,a);this.inOutElements=this.connectEvents()}_=Stroke_panel.prototype;
_.update=function(){this.activeDoc=this.appRef.editor2D.activeDocument;!(this.editableElement=this.activeDoc.currentEditableElement)||this.editableElement instanceof SVGSVGElement||this.editableElement instanceof SVGImageElement||(this.editableElement.hasAttribute("stroke-dasharray")&&(this.activeDoc.defaultDrawingProperties["stroke-dasharray"]=this.editableElement.getAttribute("stroke-dasharray")),this.editableElement.hasAttribute("stroke-width")&&(this.activeDoc.defaultDrawingProperties["stroke-width"]=
this.activeDoc.valueToUnit(this.editableElement.getAttribute("stroke-width"))),this.editableElement.hasAttribute("stroke-linecap")&&(this.activeDoc.defaultDrawingProperties["stroke-linecap"]=this.editableElement.getAttribute("stroke-linecap")),this.editableElement.hasAttribute("stroke-linejoin")&&(this.activeDoc.defaultDrawingProperties["stroke-linejoin"]=this.editableElement.getAttribute("stroke-linejoin")));this.inOutElements.strokeWidthSlider.value=this.inOutElements.strokeWidth.value=this.activeDoc.defaultDrawingProperties["stroke-width"];
this.inOutElements.strokeDashArray.value=this.activeDoc.defaultDrawingProperties["stroke-dasharray"]};_.onClick_dashLibrary=function(a){a=a.target.getParentElementByClass("panel").getGlobalPosition();a.x+=255;this.appRef.editor2D.STROKE_DASH_LIBRARY_2D_PANEL.setPosition(a.x,a.y);this.appRef.editor2D.STROKE_DASH_LIBRARY_2D_PANEL.open()};_.onChange_strokeMiterLimit=function(a){};
_.onClick_markerDisplay=function(a){a=a.target.parentElement;var b=a.getParentElementByClass("markers").getGlobalPosition();b.x+=220;this.appRef.editor2D.MARKER_LIBRARY_2D_PANEL.setPosition(b.x,b.y);this.appRef.editor2D.MARKER_LIBRARY_2D_PANEL.open();SelectElement(a.getParentElementByClass("property"))};
_.onChange_strokeWidth=function(a){a=this.activeDoc.unitToValue(a.target.value);0<this.activeDoc.selectionList.length&&this.activeDoc.setAttributeElementList_undable(this.activeDoc.selectionList,"stroke-width",a);this.activeDoc.defaultDrawingProperties["stroke-width"]=a};
_.onInputRange_strokeWidth=function(a){console.log("onInputRange_strokeWidth");var b=this.appRef.editor2D.activeDocument,c=a.target;if(0<this.activeDoc.selectionList.length){if(!c.isDragAction){console.log("start onInputRange_strokeWidth");a=new SetAttributes_action(b);var d=new SetAttributes_action(b);b.history.addUndoRedoActions(a,d);a.addElements(b.selectionList,"stroke-width");c.isDragAction=!0;c.onchange=function(a){console.log("onInputRange_strokeWidth.onchange");d.addElements(b.selectionList,
"stroke-width");c.isDragAction=!1;b.defaultDrawingProperties["stroke-width"]=c.value}}console.log(c.value);this.inOutElements.strokeWidth.value=c.value;b.setAttributeElementList(b.selectionList,"stroke-width",c.value)}else b.defaultDrawingProperties["stroke-width"]=this.inOutElements.strokeWidth.value=c.value};
_.onChange_strokeDashArray=function(a){a=a.target;0<this.activeDoc.selectionList.length&&this.activeDoc.setAttributeElementList_undable(this.activeDoc.selectionList,"stroke-dasharray",a.value);this.activeDoc.defaultDrawingProperties["stroke-dasharray"]=a.value};
_.onChange_strokeDashOffset=function(a){a=a.target;0<this.activeDoc.selectionList.length&&this.activeDoc.setAttributeElementList_undable(this.activeDoc.selectionList,"stroke-dashoffset",this.activeDoc.unitToValue(a.value));this.activeDoc.defaultDrawingProperties["stroke-dashoffset"]=a.value};
_.onClick_strokeLineCap=function(a){console.log(a);var b=this.appRef.editor2D.activeDocument;0<this.activeDoc.selectionList.length&&b.setAttributeElementList_undable(b.selectionList,"stroke-linecap",a.target.getAttribute("value"));this.activeDoc.defaultDrawingProperties["stroke-linecap"]=a.target.getAttribute("value")};
_.onClick_strokeLineJoin=function(a){var b=this.appRef.editor2D.activeDocument;0<this.activeDoc.selectionList.length&&b.setAttributeElementList_undable(b.selectionList,"stroke-linejoin",a.target.getAttribute("value"));this.activeDoc.defaultDrawingProperties["stroke-linejoin"]=a.target.getAttribute("value")};
_.onClick_createContour=function(a){a=this.appRef.editor2D.activeDocument;if(this.editableElement instanceof SVGPathElement){var b=this.editableElement.createContour(),c=new ReplaceElements_action(a),d=new ReplaceElements_action(a);c.addElementsToRemove([this.editableElement]);d.addElementsToAdd([this.editableElement]);this.editableElement.parentNode.replaceChild(b,this.editableElement);c.addElementsToAdd([b]);d.addElementsToRemove([b]);a.history.addUndoRedoActions(d,c);a.selectElementList([b]);a.createInteractionFromSelection();
a.showSelectionProperties()}};Extends(FillAndStrokeFilling2D_panel,Panel);function FillAndStrokeFilling2D_panel(a){FillAndStrokeFilling2D_panel.superConstructor.call(this,a);this.inOutElements=this.connectEvents()}_=FillAndStrokeFilling2D_panel.prototype;
_.update=function(){this.activeDoc=this.appRef.editor2D.activeDocument;if(this.editableElement=this.activeDoc.currentEditableElement)this.activeDoc.defaultDrawingProperties.opacity=this.editableElement.getAttribute("opacity")||1,this.activeDoc.defaultDrawingProperties.mixBlendMode=this.editableElement.style.mixBlendMode||"normal",this.editableElement instanceof SVGSVGElement||this.editableElement instanceof SVGImageElement||(this.editableElement instanceof SVGGElement?(this.editableElement.hasAttribute("fill")&&
(this.activeDoc.defaultDrawingProperties.fill=this.editableElement.getAttribute("fill")),this.editableElement.hasAttribute("stroke")&&(this.activeDoc.defaultDrawingProperties.stroke=this.editableElement.getAttribute("stroke"))):(this.activeDoc.defaultDrawingProperties.fill=this.editableElement.getAttribute("fill")||"none",this.activeDoc.defaultDrawingProperties.stroke=this.editableElement.getAttribute("stroke")||"none"));this.inOutElements.opacitySlider.value=this.inOutElements.opacity.value=Math.round(100*
this.activeDoc.defaultDrawingProperties.opacity);this.inOutElements.mixBlendMode.value=this.activeDoc.defaultDrawingProperties.mixBlendMode;this.updateEditableGraphicSide();this.appRef.editor2D.updateGraphicPropertyButton(this.inOutElements.fillColor,this.activeDoc.defaultDrawingProperties.fill);this.appRef.editor2D.updateGraphicPropertyButton(this.inOutElements.strokeColor,this.activeDoc.defaultDrawingProperties.stroke);var a="none";"fill"==this.activeDoc.editableGraphicSide?a=this.activeDoc.defaultDrawingProperties.fill:
"stroke"==this.activeDoc.editableGraphicSide&&(a=this.activeDoc.defaultDrawingProperties.stroke);if("none"!=a)if(-1==a.indexOf("url"))this.appRef.editor2D.updateGraphicPropertyButton(this.inOutElements.color,a);else{var b=this.inOutElements[this.activeDoc.editableGraphicSide+"Color"].elementDef;console.log("elementDef.nodeName",b.nodeName);"pattern"==b.nodeName?this.appRef.editor2D.updateGraphicPropertyButton(this.inOutElements.pattern,a):("linearGradient"==b.nodeName||"radialGradient"==b.nodeName)&&
this.appRef.editor2D.updateGraphicPropertyButton(this.inOutElements.gradient,a)}};
_.updateEditableGraphicSide=function(){"fill"==this.activeDoc.editableGraphicSide?this.inOutElements.fillColor.nextElementSibling&&(this.setTitle(LOCALIZER.translate("Fill")),this.inOutElements.fillColor.parentElement.insertBefore(this.inOutElements.strokeColor,this.inOutElements.fillColor),this.appRef.editor2D.activeDocument.showSelectionProperties()):"stroke"==this.activeDoc.editableGraphicSide&&this.inOutElements.strokeColor.nextElementSibling&&(this.setTitle(LOCALIZER.translate("Stroke")),this.inOutElements.fillColor.parentElement.insertBefore(this.inOutElements.fillColor,
this.inOutElements.strokeColor),this.appRef.editor2D.activeDocument.showSelectionProperties())};_.onClick_editFill=function(a){this.appRef.editor2D.activeDocument.editableGraphicSide="fill";var b=this.editableElement==this.activeDoc?this.activeDoc.defaultDrawingProperties.fill:this.editableElement.getAttribute("fill")||"#FFFFFF";-1!=b.indexOf("url")?this.editGradientProperty("fill",b,a):this.editColorProperty("fill",a);this.updateEditableGraphicSide()};
_.onClick_editStroke=function(a){this.appRef.editor2D.activeDocument.editableGraphicSide="stroke";var b=this.editableElement instanceof Document2D?this.activeDoc.defaultDrawingProperties.stroke:this.editableElement.getAttribute("stroke")||"#FFFFFF";-1!=b.indexOf("url")?this.editGradientProperty("stroke",b,a):this.editColorProperty("stroke",a);this.updateEditableGraphicSide()};
_.editColorProperty=function(a,b){var c,d,e=this,f=b.target.getGlobalPosition();f.x+=50;f.y-=232;this.appRef.COLOR_PICKER.showAndSet(f,b.target.style.backgroundColor,null,function(b){e.activeDoc.setAttributeOfElementList(e.activeDoc.selectionList,a,b.currentColorAsHtmlStringRGBA())},function(){c=new SetAttributes_action(e.activeDoc);c.addElements(e.activeDoc.selectionList,a)},function(f){d=new SetAttributes_action(e.activeDoc);d.addElements(e.activeDoc.selectionList,a);e.activeDoc.history.addUndoRedoActions(c,
d);e.activeDoc.defaultDrawingProperties[a]=b.target.style.backgroundColor=f.currentColorAsHtmlStringRGBA();b.target.classList.remove("noneColor");e.activeDoc.setAttributeOfElementList(e.activeDoc.selectionList,a,f.currentColorAsHtmlStringRGBA());e.activeDoc.showSelectionProperties()})};
_.editGradientProperty=function(a,b,c){a=SVGElement.svgUtils.getElementFromDocumentByIRI(b);a instanceof SVGGradientElement&&(c=c.target.getGlobalPosition(),c.x+=50,c.y-=this.appRef.editor2D.GRADIENT_EDITOR_PANEL.style.height,this.appRef.editor2D.GRADIENT_EDITOR_PANEL.showAndSet(c,a))};
_.onClick_setFillingType=function(a){var b=a.target;a=this.appRef.editor2D.activeDocument;switch(b.getAttribute("name")){case "color":b=b.getAttribute("style").split(";")[0].split(":")[1];a.setAttributeElementList_undable(a.selectionList,a.editableGraphicSide,b);break;case "gradient":b=a.createSVGGradientFromCSS(b.getAttribute("style"));a.setElementListGradient_undable(a.selectionList,a.editableGraphicSide,b);break;case "pattern":a.setElementListPattern_undable(a.selectionList,a.editableGraphicSide,
b.elementDef);break;case "none":a.setAttributeElementList_undable(a.selectionList,a.editableGraphicSide,"none")}a.showSelectionProperties();this.update()};_.onChange_opacity=function(a){var b=this.appRef.editor2D.activeDocument;a=b.evalMathExpression(a.target.value)/100;b.setAttributeElementList_undable(b.selectionList,"opacity",a);b.defaultDrawingProperties.opacity=a;this.update()};
_.onInputRange_opacity=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target;if(!c.isDragAction){a=new SetAttributes_action(b);var d=new SetAttributes_action(b);b.history.addUndoRedoActions(a,d);a.addElements(b.selectionList,"opacity");c.isDragAction=!0;c.onchange=function(a){d.addElements(b.selectionList,"opacity");c.isDragAction=!1}}a=b.evalMathExpression(c.value)/100;b.setAttributeElementList(b.selectionList,"opacity",a)};
_.onChange_mixBlendMode=function(a){for(var b=this.appRef.editor2D.activeDocument,c=[],d=0;d<b.selectionList.length;d++)b.selectionList[d].style&&c.push(b.selectionList[d].style);a=b.setPropertyElementList_undable(c,"mixBlendMode",a.target.value);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onClick_swapFillStroke=function(a){a=this.appRef.editor2D.activeDocument;var b={};b.stroke=a.defaultDrawingProperties.fill;b.fill=a.defaultDrawingProperties.stroke;var c=new SetAttributes_action(a),d=new SetAttributes_action(a);a.history.addUndoRedoActions(c,d);var e=this.appRef.editor2D.activeDocument.selectionList;c.addElements(e,b);c=e.length;for(var f=0;f<c;f++)a.copyPropertiesTo(e[f],b);d.addElements(e,b);a.showSelectionProperties()};
function GradientEditor2D_panel(a){this.appRef=a.appRef;this.editableGradient=null;this.isChanged=!1;this.gradientHtmlElement=this.querySelector("#GRADIENT");ConnectEvent("mousedown",this.gradientHtmlElement,this.onMouseDown,this);this.gradientType_select=this.querySelector("#GRADIENT_TYPE");ConnectEvent("change",this.gradientType_select,this.onChangeGradientType,this)}_=GradientEditor2D_panel.prototype;
_.showAndSet=function(a,b){b.hasAttribute("xlink:href")?this.editableGradient=this.appRef.editor2D.activeDocument.querySelector("defs "+b.getAttribute("xlink:href")):this.editableGradient=b;console.log("this.editableGradient",this.editableGradient);this.editableGradient.sortStopColors();ShowElement(this,null,a);this.createEditableStopColors();this.gradientType_select.value=this.editableGradient instanceof SVGLinearGradientElement?"linear":"radial";this.updateHtmlGradient()};
_.onChangeGradientType=function(a){var b=null,c=a.target.value;a=this.appRef.editor2D.activeDocument;"radial"==c&&this.editableGradient instanceof SVGLinearGradientElement?(b=this.editableGradient.x2.baseVal.value-this.editableGradient.x1.baseVal.value,c=this.editableGradient.y2.baseVal.value-this.editableGradient.y1.baseVal.value,b=a.createSVGRadialGradient(this.editableGradient.id,this.editableGradient.x1.baseVal.value+b/2,this.editableGradient.y1.baseVal.value+c/2,Math.sqrt(b*b+c*c)/2)):"linear"==
c&&this.editableGradient instanceof SVGRadialGradientElement&&(b=a.createSVGLinearGradient(this.editableGradient.id,this.editableGradient.cx.baseVal.value-this.editableGradient.r.baseVal.value,this.editableGradient.cy.baseVal.value-this.editableGradient.r.baseVal.value,this.editableGradient.cx.baseVal.value+this.editableGradient.r.baseVal.value,this.editableGradient.cy.baseVal.value+this.editableGradient.r.baseVal.value));console.log("newGradient");console.log(b);if(b){c=new ReplaceElements_action(a);
var d=new ReplaceElements_action(a);d.updateDocumentSelection=c.updateDocumentSelection=!1;c.addElementsToRemove([this.editableGradient]);d.addElementsToAdd([this.editableGradient]);this.editableGradient.cloneChildrenTo(b);this.editableGradient.parentNode.appendChild(b);this.editableGradient.remove();c.addElementsToAdd([b]);d.addElementsToRemove([b]);a.history.addUndoRedoActions(d,c);this.editableGradient=b;this.updateHtmlGradient()}};
_.createEditableStopColors=function(){this.gradientHtmlElement.innerHTML="";for(var a=this.editableGradient.children.length,b=0;b<a;b++)this.addEditableStopColor(this.editableGradient.children[b])};
_.addEditableStopColor=function(a){var b=a.getAttribute("style").split(":")[1].split(")")[0],c=this.gradientHtmlElement.offsetWidth*a.offset.baseVal-9,d=document.createElement("div");d.stopColorNode=a;d.id="GRADIENT_POINT";htmlColor=document.createElement("div");htmlColor.id="COLOR";htmlColor.style.backgroundColor=b;d.appendChild(htmlColor);d.style.left=c+"px";this.gradientHtmlElement.appendChild(d)};
_.updateHtmlGradient=function(){var a="background-image: -webkit-linear-gradient(left, "+this.editableGradient.stopColorsToHtml()+");";console.log(a);this.gradientHtmlElement.style.cssText=a};
_.onMouseDownOnGradientBar=function(a){a=this.appRef.editor2D.activeDocument;var b=this.gradientHtmlElement.globalToLocal(GMOUSE.mouseMovePt);console.log("localPos.x "+b.x);console.log(1/this.gradientHtmlElement.offsetWidth*b.x);b=a.createSVGStopColor(1/this.gradientHtmlElement.offsetWidth*b.x,"rgba(255,255,255,1)");this.editableGradient.appendChild(b);this.editableGradient.sortStopColors();var c=new RemoveElements_action(a);c.updateDocumentSelection=!1;c.addElements([b]);var d=new AddElements_action(a);
d.updateDocumentSelection=!1;d.addElements([b]);a.history.addUndoRedoActions(c,d);this.updateHtmlGradient();this.createEditableStopColors();HideElements([this.appRef.COLOR_PICKER])};_.onMouseDown=function(a){a.preventPropagation();if("GRADIENT"==a.target.id)this.onMouseDownOnGradientBar(a);else if("COLOR"==a.target.id)this.onMouseDownOnStopColor(a)};
_.onMouseDownOnStopColor=function(a){this.selectedStopColorElement=a.target.parentNode;SelectElement(this.selectedStopColorElement);var b=this.appRef.editor2D.activeDocument,c=this,d,e;a=a.target.getGlobalPosition();a.y-=270;ShowElement(this.appRef.COLOR_PICKER,"always",a);this.appRef.COLOR_PICKER.set(this.selectedStopColorElement.firstChild.style.backgroundColor,1,function(a){a=(255*a.rgb.r).toFixed(0)+","+(255*a.rgb.g).toFixed(0)+","+(255*a.rgb.b).toFixed(0)+","+a.alpha;c.selectedStopColorElement.firstChild.style.cssText=
"background-color: rgba("+a+");";c.selectedStopColorElement.stopColorNode.setAttribute("style","stop-color:rgba("+a+");");c.updateHtmlGradient()},function(a){d=new SetAttributes_action(b);d.updateDocumentSelection=!1;d.addElements([c.selectedStopColorElement.stopColorNode],"style")},function(a){e=new SetAttributes_action(b);e.updateDocumentSelection=!1;e.addElements([c.selectedStopColorElement.stopColorNode],"style");b.history.addUndoRedoActions(d,e)});a=this.selectedStopColorElement.getPosition();
this.selectedStopColorElement.dragOffsetX=GMOUSE.mouseMovePt.x-a.x;this.selectedStopColorElement.dragOffsetY=GMOUSE.mouseMovePt.y-a.y;GMOUSE.globalMouseTargetDelegate=this};_.onGlobalMouseStartDrag=function(a){this.selectedStopColorElement.savedOffsetValue=this.selectedStopColorElement.stopColorNode.getAttribute("offset")};
_.onGlobalMouseEndDrag=function(a){a=this.appRef.editor2D.activeDocument;if("none"==this.selectedStopColorElement.style.display){var b=new AddElements_action(a);b.updateDocumentSelection=!1;b.addElements([this.selectedStopColorElement.stopColorNode]);var c=new RemoveElements_action(a);c.updateDocumentSelection=!1;c.addElements([this.selectedStopColorElement.stopColorNode]);a.history.addUndoRedoActions(b,c);this.selectedStopColorElement.stopColorNode.remove();this.editableGradient.sortStopColors();
this.updateHtmlGradient();HideElements([this.appRef.COLOR_PICKER])}else{c=this.selectedStopColorElement.savedOffsetValue;var d=this.selectedStopColorElement.stopColorNode.getAttribute("offset");b=new SetAttributes_action(a);b.updateDocumentSelection=!1;b.addElementAndAttributes(this.selectedStopColorElement.stopColorNode,{offset:c});c=new SetAttributes_action(a);c.updateDocumentSelection=!1;c.addElementAndAttributes(this.selectedStopColorElement.stopColorNode,{offset:d});a.history.addUndoRedoActions(b,
c);console.log(a.history);this.editableGradient.sortStopColors();this.updateHtmlGradient()}};
_.onGlobalMouseDrag=function(a){a=this.globalToLocal(GMOUSE.mouseMovePt);this.selectedStopColorElement.style.display=0>a.x||a.x>this.offsetWidth||0>a.y||a.y>this.offsetHeight?"none":"block";a=GMOUSE.mouseMovePt.x-this.selectedStopColorElement.dragOffsetX;-9>a?a=-9:a>this.gradientHtmlElement.offsetWidth-9&&(a=this.gradientHtmlElement.offsetWidth-9);this.selectedStopColorElement.setPosition(a,0);this.selectedStopColorElement.stopColorNode.offset.baseVal=(a+9)/this.gradientHtmlElement.offsetWidth;this.updateHtmlGradient()};
Extends(Interactivity2D_panel,Panel);function Interactivity2D_panel(a){Interactivity2D_panel.superConstructor.call(this,a);this.inOutElements=this.connectEvents()}_=Interactivity2D_panel.prototype;
_.update=function(){var a=this.appRef.editor2D.activeDocument;if(0==a.selectionList.length)this.classList.add("hidden");else{this.classList.remove("hidden");a=a.currentEditableElement;this.inOutElements.id.value=a.id;this.inOutElements.cssClass.value=a.getAttribute("class");this.inOutElements.anchorLink.value=a.getAttribute("jvs-xlink-href");this.inOutElements.anchorLinkTarget.value=a.getAttribute("jvs-xlink-target");var b="",c=a.querySelector("title");c&&(b=c.innerHTML);this.inOutElements.title.value=
b;b="";if(a=a.querySelector("desc"))b=a.innerHTML;this.inOutElements.description.value=b}};_.onChange_cssClass=function(a){this.appRef.editor2D.activeDocument.setAttributeElementList_undable(this.appRef.editor2D.activeDocument.selectionList,"class",a.target.value)};_.onChange_anchorLink=function(a){this.appRef.editor2D.activeDocument.setAttributeElementList_undable(this.appRef.editor2D.activeDocument.selectionList,"jvs-xlink-href",a.target.value)};
_.onChange_anchorLinkTarget=function(a){this.appRef.editor2D.activeDocument.setAttributeElementList_undable(this.appRef.editor2D.activeDocument.selectionList,"jvs-xlink-target",a.target.value)};_.onChange_id=function(a){this.appRef.editor2D.activeDocument.setAttributeElementList_undable(this.appRef.editor2D.activeDocument.selectionList,"id",a.target.value)};
_.onChange_title=function(a){var b=this.appRef.editor2D.activeDocument.currentEditableElement,c=b.querySelector("title");c||(c=document.createElementNS(SVGElement.SVG_NS,"title"),b.appendChild(c));c.innerHTML=a.target.value};_.onChange_description=function(a){var b=this.appRef.editor2D.activeDocument.currentEditableElement,c=b.querySelector("desc");c||(c=document.createElementNS(SVGElement.SVG_NS,"desc"),b.appendChild(c));c.innerHTML=a.target.value};Extends(Transform2D_panel,Panel);
function Transform2D_panel(a){Transform2D_panel.superConstructor.call(this,a);this.inOutElements=this.connectEvents();this.pivotLocationName="left-top";this.transformMode="local";this.bbox=null;this.mantainAspectRatio=!1}_=Transform2D_panel.prototype;_.onClick_bboxPoint=function(a){SelectElement(a.target);this.pivotLocationName=a.target.getAttribute("id");console.log("this.pivotLocationName: "+this.pivotLocationName);this.update()};
_.onClick_global=function(a){SelectElement(a.target);this.transformMode="global";this.update()};_.onClick_local=function(a){SelectElement(a.target);this.transformMode="local";this.update()};
_.getBBoxPivotPosition=function(a,b){a=a||this.bbox;b=b||this.pivotLocationName;var c=b.split("-"),d={x:0,y:0};switch(c[0]){case "left":d.x=a.x;break;case "center":d.x=a.x+a.width/2;break;case "right":d.x=a.x+a.width}switch(c[1]){case "top":d.y=a.y;break;case "center":d.y=a.y+a.height/2;break;case "bottom":d.y=a.y+a.height}return d};
_.update=function(){this.activeDoc=this.appRef.editor2D.activeDocument;if(0==this.activeDoc.selectionList.length)this.classList.add("hidden");else if(this.classList.remove("hidden"),1<this.activeDoc.selectionList.length&&"local"==this.transformMode)this.transformMode="global",SelectElement(this.querySelector(".tabs").children[1]),this.update();else{var a=this.querySelector(".mantainAspectRation_icon").parentElement;DeselectElements([a]);if("local"==this.transformMode){var b=this.activeDoc.selectionList[0];
"true"==b.dataset.mantainAspectRatio&&SelectElement(a);this.bbox=b.getLocalBBox();this.decomposedMatrix=b.getTransform().matrix.decompose();var c=this.decomposedMatrix.rotation;var d=this.decomposedMatrix.scaleX;var e=this.decomposedMatrix.scaleY;var f=this.decomposedMatrix.skewX;var g=this.decomposedMatrix.skewY;a=this.getBBoxPivotPosition();a=SVGElement.svgUtils.createSVGPoint(a.x,a.y);b=b.getTransformToElement(this.activeDoc.content);a=a.matrixTransform(b);this.inOutElements.positionX.value=this.activeDoc.valueToUnit(a.x);
this.inOutElements.positionY.value=this.activeDoc.valueToUnit(a.y);this.inOutElements.sizeX.value=this.activeDoc.valueToUnit(this.bbox.width);this.inOutElements.sizeY.value=this.activeDoc.valueToUnit(this.bbox.height);this.inOutElements.rotation.value=this.activeDoc.valueToFixed(c);this.inOutElements.scaleX.value=this.activeDoc.valueToFixed(d);this.inOutElements.scaleY.value=this.activeDoc.valueToFixed(e);this.inOutElements.skewX.value=this.activeDoc.valueToFixed(f);this.inOutElements.skewY.value=
this.activeDoc.valueToFixed(g);this.querySelector(".bbox").setAttribute("style","transform:rotate("+c+"deg)")}else 1==this.mantainAspectRatio&&SelectElement(a),this.bbox=this.activeDoc.getElementListGlobalBBoxInContentSpace(this.activeDoc.selectionList),a=this.getBBoxPivotPosition(),this.inOutElements.positionX.value=this.activeDoc.valueToUnit(a.x),this.inOutElements.positionY.value=this.activeDoc.valueToUnit(a.y),this.inOutElements.sizeX.value=this.activeDoc.valueToUnit(this.bbox.width),this.inOutElements.sizeY.value=
this.activeDoc.valueToUnit(this.bbox.height),this.inOutElements.rotation.value=0,this.inOutElements.scaleX.value=1,this.inOutElements.scaleY.value=1,this.inOutElements.skewX.value=0,this.inOutElements.skewY.value=0,this.querySelector(".bbox").setAttribute("style","transform:rotate(0deg)")}};
_.onChange_positionX=function(a){var b=a.target,c=new SetMatrix_action(this.activeDoc);a=new SetMatrix_action(this.activeDoc);this.activeDoc.history.addUndoRedoActions(c,a);c.addElements(this.activeDoc.selectionList);b=this.activeDoc.unitToValue(b.value);b=this.activeDoc.content.localToGlobal(b,0);if("local"==this.transformMode){c=this.getBBoxPivotPosition();var d=this.activeDoc.selectionList[0].getTransformToElement(this.activeDoc);c=SVGElement.svgUtils.createSVGPoint(c.x,c.y).matrixTransform(d)}else c=
this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList),c=this.getBBoxPivotPosition(c);this.activeDoc.translateElementList(this.activeDoc.selectionList,b.x-c.x,0);a.addElements(this.activeDoc.selectionList);this.activeDoc.createInteractionFromSelection()};
_.onChange_positionY=function(a){var b=a.target,c=new SetMatrix_action(this.activeDoc);a=new SetMatrix_action(this.activeDoc);this.activeDoc.history.addUndoRedoActions(c,a);c.addElements(this.activeDoc.selectionList);b=this.activeDoc.unitToValue(b.value);b=this.activeDoc.content.localToGlobal(0,b);if("local"==this.transformMode){c=this.getBBoxPivotPosition();var d=this.activeDoc.selectionList[0].getTransformToElement(this.activeDoc);c=SVGElement.svgUtils.createSVGPoint(c.x,c.y).matrixTransform(d)}else c=
this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList),c=this.getBBoxPivotPosition(c);this.activeDoc.translateElementList(this.activeDoc.selectionList,0,b.y-c.y);a.addElements(this.activeDoc.selectionList);this.activeDoc.createInteractionFromSelection()};
_.onChange_sizeX=function(a){var b=this.activeDoc.unitToValue(this.activeDoc.evalMathExpression(a.target.value));if("local"==this.transformMode){a=!0;var c=this.activeDoc.selectionList[0].getBBox();var d=this.getBBoxPivotPosition(c);d=this.activeDoc.selectionList[0].localToGlobal(d.x,d.y)}else a=!1,c=this.activeDoc.getElementListGlobalBBoxInContentSpace(this.activeDoc.selectionList),d=this.getBBoxPivotPosition(c),d=this.activeDoc.content.localToGlobal(d.x,d.y);b/=c.width;c=1;"local"==this.transformMode?
"true"==this.activeDoc.selectionList[0].dataset.mantainAspectRatio&&(c=b):1==this.activeDoc.editorRef.TRANSFORM_2D_PANEL.mantainAspectRatio&&(c=b);this.activeDoc.scaleElementList(this.activeDoc.selectionList,b,c,d,a);this.activeDoc.normalizeScaleElementList(this.activeDoc.selectionList,{scaleStrokeWidth:this.activeDoc.defaultDrawingProperties.scaleStrokeWidth});this.activeDoc.createScaleUndoRedoAction(this.activeDoc.selectionList,b,c,d,a);this.activeDoc.createInteractionFromSelection();this.update()};
_.onChange_sizeY=function(a){var b=this.activeDoc.unitToValue(this.activeDoc.evalMathExpression(a.target.value));if("local"==this.transformMode){a=!0;var c=this.activeDoc.selectionList[0].getBBox();var d=this.getBBoxPivotPosition(c);d=this.activeDoc.selectionList[0].localToGlobal(d.x,d.y)}else a=!1,c=this.activeDoc.getElementListGlobalBBoxInContentSpace(this.activeDoc.selectionList),d=this.getBBoxPivotPosition(c),d=this.activeDoc.content.localToGlobal(d.x,d.y);var e=1;b/=c.height;"local"==this.transformMode?
"true"==this.activeDoc.selectionList[0].dataset.mantainAspectRatio&&(e=b):1==this.activeDoc.editorRef.TRANSFORM_2D_PANEL.mantainAspectRatio&&(e=b);this.activeDoc.scaleElementList(this.activeDoc.selectionList,e,b,d,a);this.activeDoc.normalizeScaleElementList(this.activeDoc.selectionList,{scaleStrokeWidth:this.activeDoc.defaultDrawingProperties.scaleStrokeWidth});this.activeDoc.createScaleUndoRedoAction(this.activeDoc.selectionList,e,b,d,a);this.activeDoc.createInteractionFromSelection();this.update()};
_.onChange_rotation=function(a){a=a.target;var b=this.activeDoc.evalMathExpression(a.value);var c=new SetMatrix_action(this.activeDoc);var d=new SetMatrix_action(this.activeDoc);this.activeDoc.history.addUndoRedoActions(c,d);c.addElements(this.activeDoc.selectionList);"local"==this.transformMode?(c=this.activeDoc.selectionList[0].getBBox(),c=this.getBBoxPivotPosition(c),c=this.activeDoc.selectionList[0].localToGlobal(c.x,c.y),b-=this.activeDoc.selectionList[0].getTransform().matrix.getRotation(),
this.activeDoc.selectionList[0].rotateAroundGlobalPt(b,c)):(c=this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList),c=this.getBBoxPivotPosition(c),this.activeDoc.rotateElementList(this.activeDoc.selectionList,b,c),a.value=0);d.addElements(this.activeDoc.selectionList);this.activeDoc.createInteractionFromSelection();this.update()};
_.onChange_skewX=function(a){a=a.target;var b=this.activeDoc.evalMathExpression(a.value);var c=new SetMatrix_action(this.activeDoc);var d=new SetMatrix_action(this.activeDoc);this.activeDoc.history.addUndoRedoActions(c,d);c.addElements(this.activeDoc.selectionList);if("local"==this.transformMode){var e=this.activeDoc.selectionList[0].getBBox();c=e.width+e.x;e=e.height+e.y;var f=SVGElement.svgUtils.createSVGMatrix().translate(c,e).skewX(b).translate(-c,-e);var g=this.activeDoc.selectionList[0].getTransform().matrix;
f=g.multiply(f);this.activeDoc.selectionList[0].getTransform().setMatrix(f)}else{e=this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList);c=e.width+e.x;e=e.height+e.y;for(var k=0;k<this.activeDoc.selectionList.length;k++)f=SVGElement.svgUtils.createSVGMatrix().translate(c,e).skewX(b).translate(-c,-e),g=this.activeDoc.selectionList[k].getTransform().matrix,f=f.multiply(g),this.activeDoc.selectionList[k].getTransform().setMatrix(f)}a.value=0;d.addElements(this.activeDoc.selectionList);
this.activeDoc.createInteractionFromSelection();this.update()};
_.onChange_skewY=function(a){a=a.target;var b=this.activeDoc.evalMathExpression(a.value);var c=new SetMatrix_action(this.activeDoc);var d=new SetMatrix_action(this.activeDoc);this.activeDoc.history.addUndoRedoActions(c,d);c.addElements(this.activeDoc.selectionList);if("local"==this.transformMode){var e=this.activeDoc.selectionList[0].getBBox();c=e.width+e.x;e=e.height+e.y;var f=SVGElement.svgUtils.createSVGMatrix().translate(c,e).skewY(b).translate(-c,-e);var g=this.activeDoc.selectionList[0].getTransform().matrix;
f=g.multiply(f);this.activeDoc.selectionList[0].getTransform().setMatrix(f)}else{e=this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList);c=e.width+e.x;e=e.height+e.y;for(var k=0;k<this.activeDoc.selectionList.length;k++)f=SVGElement.svgUtils.createSVGMatrix().translate(c,e).skewY(b).translate(-c,-e),g=this.activeDoc.selectionList[k].getTransform().matrix,f=f.multiply(g),this.activeDoc.selectionList[k].getTransform().setMatrix(f)}a.value=0;d.addElements(this.activeDoc.selectionList);
this.activeDoc.createInteractionFromSelection();this.update()};
_.onChange_scaleX=function(a){var b=this.activeDoc.evalMathExpression(a.target.value);if("local"==this.transformMode){a=!0;var c=this.activeDoc.selectionList[0].getBBox();var d=this.getBBoxPivotPosition(c);d=this.activeDoc.selectionList[0].localToGlobal(d.x,d.y)}else a=!1,c=this.activeDoc.getElementListGlobalBBoxInContentSpace(this.activeDoc.selectionList),d=this.getBBoxPivotPosition(c),d=this.activeDoc.content.localToGlobal(d.x,d.y);b=b*c.width/c.width;this.activeDoc.scaleElementList(this.activeDoc.selectionList,
b,1,d,a);this.activeDoc.normalizeScaleElementList(this.activeDoc.selectionList,{scaleStrokeWidth:this.activeDoc.defaultDrawingProperties.scaleStrokeWidth});this.activeDoc.createScaleUndoRedoAction(this.activeDoc.selectionList,b,1,d,a);this.activeDoc.createInteractionFromSelection();this.update()};
_.onChange_scaleY=function(a){var b=this.activeDoc.evalMathExpression(a.target.value);if("local"==this.transformMode){a=!0;var c=this.activeDoc.selectionList[0].getBBox();var d=this.getBBoxPivotPosition(c);d=this.activeDoc.selectionList[0].localToGlobal(d.x,d.y)}else a=!1,c=this.activeDoc.getElementListGlobalBBoxInContentSpace(this.activeDoc.selectionList),d=this.getBBoxPivotPosition(c),d=this.activeDoc.content.localToGlobal(d.x,d.y);b=b*c.height/c.height;this.activeDoc.scaleElementList(this.activeDoc.selectionList,
1,b,d,a);this.activeDoc.normalizeScaleElementList(this.activeDoc.selectionList,{scaleStrokeWidth:this.activeDoc.defaultDrawingProperties.scaleStrokeWidth});this.activeDoc.createScaleUndoRedoAction(this.activeDoc.selectionList,1,b,d,a);this.activeDoc.createInteractionFromSelection();this.update()};
_.onClick_mantainAspectRation=function(a){0!=this.activeDoc.selectionList.length&&(a=this.activeDoc.selectionList[0],"local"==this.transformMode?a.dataset.mantainAspectRatio="true"==a.dataset.mantainAspectRatio?!1:!0:this.mantainAspectRatio=1==this.mantainAspectRatio?!1:!0,this.update())};Extends(LayerList2D_panel,Panel);
function LayerList2D_panel(a){LayerList2D_panel.superConstructor.call(this,a);this.layerList=this.querySelector(".layer-list");this.layerListItemTemplate=this.querySelector(".templates .layer-list-item");this.ISOLATE_LAYER_EDITING_TOOLBAR=document.querySelector("#ISOLATE_LAYER_EDITING_TOOLBAR");this.ISOLATE_LAYER_EDITING_TOOLBAR.connectEvents(this);ConnectEvent("mousedown",this,this.onMouseDown,this);this.connectEvents()}_=LayerList2D_panel.prototype;
_.update=function(){var a=this.appRef.editor2D.activeDocument,b=a.content.querySelectorAll(".jvs-layer");this.layerList.removeChildren();var c=b[b.length-1];console.log("LayerList2D_panel","update");if(c.classList.contains("isolate-layer")){a.classList.add("isolate-layer-editing");this.ISOLATE_LAYER_EDITING_TOOLBAR.classList.remove("hidden");for(b="";c.classList.contains("isolate-layer");)b=c.getAttribute("name")+" / "+b,c=c.previousElementSibling;this.ISOLATE_LAYER_EDITING_TOOLBAR.querySelector(".label").innerHTML=
b;this.classList.add("hidden")}else{a.classList.remove("isolate-layer-editing");this.ISOLATE_LAYER_EDITING_TOOLBAR.classList.add("hidden");this.classList.remove("hidden");var d;for(d=b.length-1;-1<d;d--)a=b[d],c=this.layerListItemTemplate.cloneNode(!0),a.classList.contains("hidden")?c.classList.remove("visible"):c.classList.add("visible"),a.classList.contains("locked")&&c.classList.add("locked"),a.classList.contains("selected")&&c.classList.add("selected"),c.querySelector(".label").innerHTML=a.getAttribute("name"),
c.querySelector(".color-button").style.backgroundColor=a.getAttribute("jvs-layer-color"),c.layerRef=a,this.layerList.appendChild(c)}};_.onMouseDown=function(a){this.lastMouseDownTime=(new Date).getTime()};
_.onClick_layerList=function(a){a=a.target;if("INPUT"!=a.nodeName){var b="LI"==a.nodeName?a:a.parentElement;if(!a.classList.contains("color-button"))if(a.classList.contains("item-visible_icon"))this.onClick_hide(b);else if(a.classList.contains("item-locked_icon"))this.onClick_lock(b);else if(a.classList.contains("label")&&(console.log("call editLayerName",(new Date).getTime()-this.lastMouseDownTime),b.classList.contains("selected")&&250<(new Date).getTime()-this.lastMouseDownTime)){this.editLayerName(a);
return}SelectElement(b);this.appRef.editor2D.activeDocument.setActiveLayer(b.layerRef);this.appRef.editor2D.activeDocument.showSelectionProperties()}};
_.editLayerName=function(a){console.log("editLayerName",a);var b=a.textContent;a.removeChildren();var c=document.createElement("input");c.setAttribute("type","text");c.setAttribute("class","inputNodeName");c.setAttribute("value",b);c.previousValue=b;var d=this;ConnectEvent("change",c,function(a){this.blur()});ConnectEvent("blur",c,function(b){this.value!=this.previousValue&&(a.innerHTML=d.onEndEditLayerName(this));a.innerHTML=this.value});a.appendChild(c);c.focus();console.log("editLayerName",a)};
_.onEndEditLayerName=function(a){a.parentElement.parentElement.layerRef.setAttribute("name",a.value);return a.value};_.onClick_hide=function(a){a.classList.toggle("visible");a.layerRef.classList.toggle("hidden");this.appRef.editor2D.activeDocument.deselectAllElements();this.appRef.editor2D.activeDocument.createInteractionFromSelection()};_.onClick_lock=function(a){a.classList.toggle("locked");a.layerRef.classList.toggle("locked");this.appRef.editor2D.activeDocument.deselectAllElements();this.appRef.editor2D.activeDocument.createInteractionFromSelection()};
_.onClick_new=function(){var a=this.layerList.childNodes.length;a=this.appRef.editor2D.activeDocument.createLayer(LOCALIZER.translate("Layer")+" "+a,this.appRef.COLOR_PICKER.rainbow(12,a));this.appRef.editor2D.activeDocument.addLayer_undable(a);this.appRef.editor2D.activeDocument.showSelectionProperties()};_.onClick_remove=function(){var a=this.layerList.querySelector(".selected");a.remove();this.appRef.editor2D.activeDocument.removeLayer_undable(a.layerRef);this.appRef.editor2D.activeDocument.showSelectionProperties()};
_.onClick_bringUp=function(){var a=this.layerList.querySelector(".selected");a.sendDown();a.layerRef.bringUp()};_.onClick_sendDown=function(){var a=this.layerList.querySelector(".selected");a.bringUp();a.layerRef.sendDown()};_.onClick_placeSelectionInActiveLayer=function(){var a=this.layerList.querySelector(".selected");this.appRef.editor2D.activeDocument.placeElementListInLayer_undable(this.appRef.editor2D.activeDocument.selectionList,a.layerRef)};_.onClick_exitFromIsolateLayerEditing=function(){this.appRef.editor2D.activeDocument.exitFrom_isolateLayerEditing()};
Extends(Markers_panel,Panel);function Markers_panel(a){Markers_panel.superConstructor.call(this,a);this.inOutElements=this.connectEvents();this.markerData=this.querySelector(".marker-data");this.querySelector(".tabs").connectEvents(this);this.colorList=this.querySelector(".tabs-views #MARKER_COLORS")}_=Markers_panel.prototype;_.onClick_properties=function(a){SelectElement(a.target);ShowElement(this.querySelector(".tabs-views #MARKER_PROPERTIES"))};
_.onClick_colors=function(a){SelectElement(a.target);ShowElement(this.querySelector(".tabs-views #MARKER_COLORS"))};
_.update=function(){this.activeDocument=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDocument.currentEditableElement;-1==["path","line","polyline","polygon"].indexOf(this.editableElement.nodeName)?this.classList.add("hidden"):(this.classList.remove("hidden"),this.updateMarkerDisplay("marker-start"),this.updateMarkerDisplay("marker-mid"),this.updateMarkerDisplay("marker-end"),this.updateActiveMarkerData())};
_.updateMarkerDisplay=function(a){var b=this.querySelector(".markers .property ["+a+"]"),c="";this.editableElement&&this.editableElement.hasAttribute(a)&&(c=this.editableElement.getAttribute(a));b.setAttribute(a,c)};
_.updateActiveMarkerData=function(){this.activeMarkerTarget=this.querySelector(".markers .property.selected");this.activeMarkerTargetName=this.activeMarkerTarget.getAttribute("data-marker-name");this.activeMarkerDef=null;var a=this.activeMarkerTarget.querySelector("path");if(""==a.getAttribute(this.activeMarkerTargetName))this.markerData.classList.add("hidden");else if(this.markerData.classList.remove("hidden"),a=a.getAttribute(this.activeMarkerTargetName),this.activeMarkerDef=SVGElement.svgUtils.getElementFromDocumentByIRI(a))this.inOutElements.id.value=
this.activeMarkerDef.getAttribute("id"),this.inOutElements.refX.value=this.activeDocument.valueToUnit(this.activeMarkerDef.getAttribute("refX")),this.inOutElements.refY.value=this.activeDocument.valueToUnit(this.activeMarkerDef.getAttribute("refY")),this.inOutElements.markerWidth.value=this.activeDocument.valueToUnit(this.activeMarkerDef.getAttribute("markerWidth")),this.inOutElements.markerHeight.value=this.activeDocument.valueToUnit(this.activeMarkerDef.getAttribute("markerHeight")),this.inOutElements.orient.value=
this.activeMarkerDef.getAttribute("orient"),this.inOutElements.markerUnits.value=this.activeMarkerDef.getAttribute("markerUnits"),this.updateActiveMarkerColors()};
_.updateActiveMarkerColors=function(){var a=this.activeMarkerDef.querySelectorAll("[fill]"),b;var c=a.length;this.colorList.removeChildren();for(b=0;b<c;b++){var d=document.createElement("li");var e=a[b].getAttribute("fill");"none"!=e&&(d.setAttribute("style","background-color:"+e+";"),d.graphicSide="fill",d.elementTarget=a[b],this.colorList.appendChild(d))}a=this.activeMarkerDef.querySelectorAll("[stroke]");c=a.length;for(b=0;b<c;b++)d=document.createElement("li"),e=a[b].getAttribute("stroke"),"none"!=
e&&(d.setAttribute("style","background-color:"+e+";"),d.graphicSide="stroke",d.elementTarget=a[b],this.colorList.appendChild(d))};_.onClick_markerDisplay=function(a){SelectElement(a.target.parentElement.getParentElementByClass("property"));this.updateActiveMarkerData()};
_.onChange_id=function(a){function b(a){d.setAttribute("id",a);a="url(#"+a+")";var b;var c=g.length;for(b=0;b<c;b++)g[b].setAttribute("marker-start",a);c=k.length;for(b=0;b<c;b++)k[b].setAttribute("marker-mid",a);c=l.length;for(b=0;b<c;b++)l[b].setAttribute("marker-end",a);h.update()}if(""!=a.target.value){var c=this.appRef.editor2D.activeDocument,d=this.activeMarkerDef,e=d.getAttribute("id"),f=a.target.value;a="url(#"+e+")";var g=c.content.querySelectorAll('[marker-start="'+a+'"]'),k=c.content.querySelectorAll('[marker-mid="'+
a+'"]'),l=c.content.querySelectorAll('[marker-end="'+a+'"]'),h=this.appRef.editor2D.LIBRARY_2D_PANEL.querySelector("#MARKER_LIBRARY");a={};var m={};a.execute=function(){b(e);c.showSelectionProperties()};m.execute=function(){b(f);c.showSelectionProperties()};c.history.addUndoRedoActions(a,m);b(f)}};_.onChange_refX=function(a){this.activeDocument.setAttributeElementList_undable([this.activeMarkerDef],"refX",this.activeDocument.unitToValue(a.target.value),!1)};
_.onChange_refY=function(a){this.activeDocument.setAttributeElementList_undable([this.activeMarkerDef],"refY",this.activeDocument.unitToValue(a.target.value),!1)};_.onChange_markerWidth=function(a){this.activeDocument.setAttributeElementList_undable([this.activeMarkerDef],"markerWidth",this.activeDocument.unitToValue(a.target.value),!1)};
_.onChange_markerHeight=function(a){this.activeDocument.setAttributeElementList_undable([this.activeMarkerDef],"markerHeight",this.activeDocument.unitToValue(a.target.value),!1)};_.onChange_orient=function(a){this.activeDocument.setAttributeElementList_undable([this.activeMarkerDef],"orient",a.target.value,!1)};_.onChange_markerUnits=function(a){this.activeDocument.setAttributeElementList_undable([this.activeMarkerDef],"markerUnits",a.target.value,!1)};
_.onClick_clone=function(a){a=this.activeMarkerDef.cloneNode(!0);a=this.activeDocument.addElementToDefs(a);this.activeDocument.setAttributeElementList_undable(this.activeDocument.selectionList,this.activeMarkerTargetName,a);this.update();this.appRef.editor2D.LIBRARY_2D_PANEL.querySelector("#MARKER_LIBRARY").update()};_.onClick_detach=function(a){this.activeDocument.setAttributeElementList_undable(this.activeDocument.selectionList,this.activeMarkerTargetName,"");this.update()};
_.onClick_editMarkerColor=function(a){if("LI"==a.target.nodeName){var b=a.target,c=this.appRef.editor2D.activeDocument,d=this.activeMarkerDef;a=b.getGlobalPosition();a.y-=262;this.appRef.COLOR_PICKER.showAndSet(a,b.style.backgroundColor,1,function(a){b.style.backgroundColor=a.currentColorAsHtmlStringRGBA()},null,function(a){c.setAttributeElementList_undable([b.elementTarget],b.graphicSide,b.style.backgroundColor);d.style.display="none";setTimeout(function(){d.style.display="";c.showSelectionProperties()},
0)})}};Extends(Pattern_panel,Panel);function Pattern_panel(a){Pattern_panel.superConstructor.call(this,a);this.inOutElements=this.connectEvents();this.querySelector(".tabs").connectEvents(this);this.colorList=this.querySelector(".tabs-views #PATTERN_COLORS")}_=Pattern_panel.prototype;_.onClick_properties=function(a){SelectElement(a.target);ShowElement(this.querySelector(".tabs-views #PATTERN_PROPERTIES"))};_.onClick_colors=function(a){SelectElement(a.target);ShowElement(this.querySelector(".tabs-views #PATTERN_COLORS"))};
_.update=function(){this.style.display="none";this.activeDocument=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDocument.currentEditableElement;if(this.editableElement!=this.activeDocument&&this.editableElement.hasAttribute(this.activeDocument.editableGraphicSide)){var a=this.editableElement.getAttribute(this.activeDocument.editableGraphicSide);-1!=a.indexOf("url")&&(this.activePatternDef=SVGElement.svgUtils.getElementFromDocumentByIRI(a),this.activePatternDef instanceof SVGPatternElement&&
(this.style.display="block",this.updatePatternDisplay(a),this.updateActivePatternData()))}};_.updatePatternDisplay=function(a){this.querySelector(".svg-pattern-display svg rect").setAttribute("fill",a)};
_.updateActivePatternData=function(){this.inOutElements.id.value=this.activePatternDef.getAttribute("id");this.inOutElements.patternX.value=this.activeDocument.valueToUnit(this.activePatternDef.getAttribute("x"));this.inOutElements.patternY.value=this.activeDocument.valueToUnit(this.activePatternDef.getAttribute("y"));this.inOutElements.patternWidth.value=this.activeDocument.valueToUnit(this.activePatternDef.getAttribute("width"));this.inOutElements.patternHeight.value=this.activeDocument.valueToUnit(this.activePatternDef.getAttribute("height"));
console.log("this.activePatternDef.getAttribute(patternTransform)",this.activePatternDef.getAttribute("patternTransform"));var a=SVGElement.svgUtils.parseTransformString(this.activePatternDef.getAttribute("patternTransform")),b=0,c=1;a.rotate&&(b=a.rotate.value);a.scale&&(c=a.scale.x);this.inOutElements.rotate.value=b;this.inOutElements.scale.value=c;this.updateActivePatternColors()};
_.updateActivePatternColors=function(){var a=this.activePatternDef.querySelectorAll("[fill]"),b;var c=a.length;this.colorList.removeChildren();for(b=0;b<c;b++){var d=document.createElement("li");var e=a[b].getAttribute("fill");"none"!=e&&(d.setAttribute("style","background-color:"+e+";"),d.elementTarget=a[b],d.graphicSide="fill",this.colorList.appendChild(d))}a=this.activePatternDef.querySelectorAll("[stroke]");c=a.length;for(b=0;b<c;b++)d=document.createElement("li"),e=a[b].getAttribute("stroke"),
"none"!=e&&(d.setAttribute("style","background-color:"+e+";"),d.elementTarget=a[b],d.graphicSide="stroke",this.colorList.appendChild(d))};
_.onChange_id=function(a){function b(a){d.setAttribute("id",a);a="url(#"+a+")";var b;var e=g.length;for(b=0;b<e;b++)g[b].setAttribute("fill",a);e=k.length;for(b=0;b<e;b++)k[b].setAttribute("stroke",a);l.update();c.showSelectionProperties()}if(""!=a.target.value){var c=this.appRef.editor2D.activeDocument,d=this.activePatternDef,e=d.getAttribute("id"),f=a.target.value;a="url(#"+e+")";var g=c.content.querySelectorAll('[fill="'+a+'"]'),k=c.content.querySelectorAll('[stroke="'+a+'"]'),l=this.appRef.editor2D.LIBRARY_2D_PANEL.querySelector("#PATTERN_LIBRARY");
a={};var h={};a.execute=function(){b(e);c.showSelectionProperties()};h.execute=function(){b(f);c.showSelectionProperties()};c.history.addUndoRedoActions(a,h);b(f)}};_.onChange_patternX=function(a){this.activeDocument.setAttributeElementList_undable([this.activePatternDef],"x",this.activeDocument.unitToValue(a.target.value),!1)};_.onChange_patternY=function(a){this.activeDocument.setAttributeElementList_undable([this.activePatternDef],"y",this.activeDocument.unitToValue(a.target.value),!1)};
_.onChange_patternWidth=function(a){this.activeDocument.setAttributeElementList_undable([this.activePatternDef],"width",this.activeDocument.unitToValue(a.target.value),!1)};_.onChange_patternHeight=function(a){this.activeDocument.setAttributeElementList_undable([this.activePatternDef],"height",this.activeDocument.unitToValue(a.target.value),!1)};
_.onChange_rotate=function(a){this.activeDocument.setAttributeElementList_undable([this.activePatternDef],"patternTransform","rotate("+this.inOutElements.rotate.value+") scale("+this.inOutElements.scale.value+")",!1)};_.onChange_scale=function(a){this.activeDocument.setAttributeElementList_undable([this.activePatternDef],"patternTransform","rotate("+this.inOutElements.rotate.value+") scale("+this.inOutElements.scale.value+")",!1)};
_.onChange_patternUnits=function(a){this.activeDocument.setAttributeElementList_undable([this.activePatternDef],"patternUnits",a.target.value,!1)};_.onClick_clone=function(a){a=this.activePatternDef.cloneNode(!0);a=this.activeDocument.addElementToDefs(a);this.activeDocument.setAttributeElementList_undable(this.activeDocument.selectionList,this.activeDocument.editableGraphicSide,a);this.update();this.appRef.editor2D.LIBRARY_2D_PANEL.querySelector("#PATTERN_LIBRARY").update()};
_.onClick_editPatternColor=function(a){if("LI"==a.target.nodeName){var b=a.target;a=b.getGlobalPosition();a.y-=262;var c=this.appRef.editor2D.activeDocument;this.appRef.COLOR_PICKER.showAndSet(a,b.style.backgroundColor,1,function(a){b.style.backgroundColor=a.currentColorAsHtmlStringRGBA()},null,function(a){c.setAttributeElementList_undable([b.elementTarget],b.graphicSide,b.style.backgroundColor,!1);c.showSelectionProperties()})}};Extends(Filter_panel,Panel);
function Filter_panel(a){Filter_panel.superConstructor.call(this,a)}_=Filter_panel.prototype;
_.update=function(){this.classList.add("hidden");this.activeDocument=this.appRef.editor2D.activeDocument;if((this.editableElement=this.activeDocument.currentEditableElement)&&this.editableElement.hasAttribute("filter")&&""!=this.editableElement.getAttribute("filter")){var a=this.activeDocument.getElementFromDocumentByIRI(this.editableElement.getAttribute("filter")),b;if(b=a&&a.hasAttribute("jvs-controller")?this.querySelector('.content > [data-inspector-element="'+a.getAttribute("jvs-controller")+
'"]'):this.querySelector('.content > [data-inspector-element="UnknowedFilter"]'))this.classList.remove("hidden"),ShowElement(b),b.update(a)}};Extends(DOM_treeView,TreeView);function DOM_treeView(a){DOM_treeView.superConstructor.call(this);this.appRef=a.appRef}_=DOM_treeView.prototype;
_.createDOMNodes=function(a,b){b||(b=this);b.innerHTML="";if(0!=a.length)for(var c=(new Date).getTime(),d,e,f=0;f<a.length;f++)e=a[f],d=e.hasAttribute("id")?e.getAttribute("id"):e.nodeName,d=this.createTreeViewNode("dir_icon16x16",d,d,!0),d.setAttribute("itemType","dir"),d.setAttribute("id","item_"+c+"_"+f),d.nodeRef=e,b.appendChild(d)};_.expandNode=function(a){var b=DOM_treeView.superClass.expandNode.call(this,a);this.createDOMNodes(a.nodeRef.children,b)};Extends(DOM_panel,Panel);
function DOM_panel(a){DOM_panel.superConstructor.call(this,a);this.treeView=this.querySelector(".treeView").connectController(DOM_treeView,a);this.connectEvents()}_=DOM_panel.prototype;_.onOpen=function(){0==this.treeView.childNodes.length&&this.treeView.createDOMNodes(this.appRef.editor2D.activeDocument.querySelector("#jvs-content").children)};_.onExpand=function(){0==this.treeView.childNodes.length&&this.treeView.createDOMNodes(this.appRef.editor2D.activeDocument.querySelector("#jvs-content").children)};
Extends(GraphicsInspector2D_panel,Panel);function GraphicsInspector2D_panel(a){GraphicsInspector2D_panel.superConstructor.call(this,a)}_=GraphicsInspector2D_panel.prototype;
_.update=function(){var a=this.appRef.editor2D.activeDocument;a=a.currentEditableElement||a;a.hasAttribute("controller-class")?(console.log("editableElement.getAttribute(controller-class)",a.getAttribute("controller-class")),a=this.querySelector('.content > [data-inspector-element="'+a.getAttribute("controller-class")+'"]')):a=a instanceof SVGForeignObjectElement?this.querySelector('.content > [data-inspector-element="htmlText"]'):a instanceof SVGGElement?a.hasAttribute("clip-path")?this.querySelector('.content > [data-inspector-element="clipPath"]'):
a.hasAttribute("mask")?this.querySelector('.content > [data-inspector-element="mask"]'):this.querySelector('.content > [data-inspector-element="g"]'):"path"==a.nodeName?2==a.pathSegList.numberOfItems?this.querySelector('.content > [data-inspector-element="line"]'):this.querySelector('.content > [data-inspector-element="path"]'):this.querySelector('.content > [data-inspector-element="'+a.nodeName+'"]')||this.querySelector('.content > [data-inspector-element="svg"]');a&&(ShowElement(a),a.update())};
function Document2D_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents()}_=Document2D_contentPanel.prototype;
_.update=function(){this.parentElement.parentElement.setTitle(LOCALIZER.translate("Document"));this.activeDoc=this.appRef.editor2D.activeDocument;var a=this.appRef.editor2D.activeDocument.querySelector("#jvs-workspace .jvs-page");this.inOutElements.pageWidth.value=this.activeDoc.valueToFixed((a.getAttribute("width")||585)*this.activeDoc.unitValue);this.inOutElements.pageHeight.value=this.activeDoc.valueToFixed((a.getAttribute("height")||842)*this.activeDoc.unitValue);console.log("this.inOutElements",
this.inOutElements);a=a.getAttribute("fill")||"#FFFFFF";this.appRef.editor2D.updateGraphicPropertyButton(this.inOutElements.pageColor,a);this.appRef.editor2D.updateGraphicPropertyButton(this.inOutElements.workspaceColor,this.appRef.editor2D.activeDocument.style.backgroundColor||"#807C7C");this.inOutElements.gridSnapValue.value=this.activeDoc.valueToUnit(this.appRef.editor2D.activeDocument.gridSnapValue);this.inOutElements.pointSnapValue.value=this.appRef.editor2D.activeDocument.pointSnapValue;this.inOutElements.arrowKeysTranslateValue.value=
this.activeDoc.valueToUnit(this.appRef.editor2D.activeDocument.arrowKeysTranslateValue);this.inOutElements.unitKey.value=this.activeDoc.unitKey;this.inOutElements.fixedDecimals.value=this.activeDoc.fixedDecimals;this.inOutElements.drawingScale.value=this.activeDoc.drawingScale;this.inOutElements.snapAngle.value=this.activeDoc.snapAngle};
_.onChange_pageWidth=function(a){a=a.target;var b=this.appRef.editor2D.activeDocument,c=b.querySelector("#jvs-workspace .jvs-page");b.setAttributeElementList_undable([c],"width",b.evalMathExpression(a.value)/b.unitValue);b.fitPageToView()};_.onChange_pageHeight=function(a){a=a.target;var b=this.appRef.editor2D.activeDocument,c=b.querySelector("#jvs-workspace .jvs-page");b.setAttributeElementList_undable([c],"height",b.evalMathExpression(a.value)/b.unitValue);b.fitPageToView()};
_.onChange_drawingScale=function(a){this.appRef.editor2D.activeDocument.drawingScale=a.target.value;ShowElement(this)};_.onChange_gridSnapValue=function(a){this.appRef.editor2D.activeDocument.gridSnapValue=this.activeDoc.unitToValue(a.target.value)};_.onChange_pointSnapValue=function(a){this.appRef.editor2D.activeDocument.pointSnapValue=parseFloat(a.target.value)};_.onChange_snapAngle=function(a){this.appRef.editor2D.activeDocument.snapAngle=parseFloat(a.target.value)};
_.onChange_arrowKeysTranslateValue=function(a){this.appRef.editor2D.activeDocument.arrowKeysTranslateValue=this.activeDoc.unitToValue(a.target.value)};
_.onChange_pagePresets=function(a){a=a.target;var b=this.appRef.editor2D.activeDocument,c=b.querySelector("#jvs-workspace .jvs-page"),d=c.getAttribute("width")||585,e=c.getAttribute("height")||842,f=a.value.split(",")[0],g=a.value.split(",")[1],k=new SetAttributes_action(b),l=new SetAttributes_action(b);b.history.addUndoRedoActions(k,l);k.addElementAndAttributes(c,{width:d,height:e});l.addElementAndAttributes(c,{width:f,height:g});c.setAttribute("width",f);c.setAttribute("height",g);a.value="formats";
ShowElement(this);b.fitPageToView()};_.onChange_unitKey=function(a){this.appRef.editor2D.activeDocument.setUnits(a.target.value);ShowElement(this);this.update()};_.onChange_fixedDecimals=function(a){this.appRef.editor2D.activeDocument.fixedDecimals=parseInt(a.target.value);ShowElement(this)};
_.onClick_editPageColor=function(a){var b=this.appRef.editor2D.activeDocument,c=this.appRef.editor2D.activeDocument.querySelector("#jvs-workspace .jvs-page"),d,e,f=a.target.getGlobalPosition();f.x+=20;this.appRef.COLOR_PICKER.showAndSet(f,a.target.style.backgroundColor,1,function(a){b.setAttributeOfElementList([c],"fill",a.currentColorAsHtmlStringRGBA())},function(){d=new SetAttributes_action(b);d.addElements([c],"fill")},function(f){e=new SetAttributes_action(b);e.addElements([c],"fill");b.history.addUndoRedoActions(d,
e);a.target.style.backgroundColor=f.currentColorAsHtmlStringRGBA()})};
_.onClick_editWorkspaceColor=function(a){var b=this.appRef.editor2D.activeDocument,c=this.appRef.editor2D.activeDocument;c.getAttribute("style")||c.setAttribute("style","#807C7C");var d,e,f=a.target.getGlobalPosition();f.x+=20;this.appRef.COLOR_PICKER.showAndSet(f,a.target.style.backgroundColor,1,function(a){b.setAttributeOfElementList([c],"style","background-color:"+a.currentColorAsHtmlStringRGBA())},function(){d=new SetAttributes_action(b);d.addElements([c],"style")},function(f){e=new SetAttributes_action(b);
e.addElements([c],"style");b.history.addUndoRedoActions(d,e);a.target.style.backgroundColor=f.currentColorAsHtmlStringRGBA()})};function TextBaseClass_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents();this.editableElement=this.fontObject=null}_=TextBaseClass_contentPanel.prototype;
_.update=function(){this.parentElement.parentElement.setTitle(LOCALIZER.translate("Text"));this.activeDoc=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDoc.currentEditableElement;var a=this.editableElement.getAttribute("font-family")||"";this.activeDoc.defaultDrawingProperties.fontFamily=this.inOutElements.fontFamily.value=a;this.fontObject=this.appRef.editor2D.FONT_LIBRARY_2D_PANEL.getFontObjectByFamilyName(a);console.log("this.fontObject",this.fontObject);this.updateFontVariantsMenu();
a=parseFloat(this.editableElement.getAttribute("font-size"))||12;this.activeDoc.defaultDrawingProperties.fontSize=this.inOutElements.fontSizeSlider.value=this.inOutElements.fontSize.value=this.activeDoc.valueToFixed(a);this.inOutElements.textData.value=this.editableElement.querySelector("textPath").textContent;this.activeDoc.defaultDrawingProperties.letterSpacing=this.inOutElements.letterSpacing.value=this.inOutElements.letterSpacingSlider.value=this.activeDoc.valueToFixed(parseFloat(this.editableElement.letterSpacing));
this.activeDoc.defaultDrawingProperties.wordSpacing=this.inOutElements.wordSpacing.value=this.inOutElements.wordSpacingSlider.value=this.activeDoc.valueToFixed(parseFloat(this.editableElement.wordSpacing));a=this.editableElement.getAttribute("text-align")||"left";this.activeDoc.defaultDrawingProperties.textAlign=a;a=this.inOutElements.textAlign.querySelector("[value="+a+"]");SelectElement(a)};
_.onClick_textAlign=function(a){a=a.target;SelectElement(a);a=a.getAttribute("value");var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"text");this.activeDoc.setPropertyElementList_undable(b,"textAlign",a)};
_.updateFontSubsetsMenu=function(){this.inOutElements.fontSubsets.removeChildren();if(null!=this.fontObject){var a;for(a=0;a<this.fontObject.subsets.length;a++){var b=this.fontObject.subsets[a];var c=document.createElement("option");c.appendChild(document.createTextNode(b));c.setAttribute("value",b);this.inOutElements.fontSubsets.appendChild(c)}}};
_.getFontVariantName=function(a){switch(a){case "italic":return"Italic";case "100":return"Thin";case "200":return"Extra Light";case "300":return"Light";case "500":return"Medium";case "600":return"Semi Bold";case "700":return"Bold";case "800":return"Extra Bold";case "900":return"Black";case "100italic":return"Thin - italic";case "200italic":return"Extra Light - italic";case "300italic":return"Light - italic";case "400italic":return"Regular - italic";case "500italic":return"Medium - italic";case "600italic":return"Semi Bold - italic";
case "700italic":return"Bold - italic";case "800italic":return"Extra Bold - italic";case "900italic":return"Black - italic"}return"Regular"};
_.updateFontVariantsMenu=function(){this.inOutElements.fontVariants.removeChildren();if(null!=this.fontObject){var a=this.getFontVariantName,b;for(b=0;b<this.fontObject.variants.length;b++){var c=this.fontObject.variants[b];var d=document.createElement("option");d.appendChild(document.createTextNode(a(c)));d.setAttribute("value",c);this.inOutElements.fontVariants.appendChild(d)}a=this.editableElement.getAttribute("font-weight")||"";b=this.editableElement.getAttribute("font-style")||"";console.log("fontWeight+fontStyle",
a+b);this.inOutElements.fontVariants.value=a+b}};_.onClick_fontLibrary=function(a){this.appRef.editor2D.FONT_LIBRARY_2D_PANEL.open(!0)};_.onChange_fontSize=function(a){var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"text");this.activeDoc.setPropertyElementList_undable(b,"fontSize",a.target.value);this.activeDoc.createInteractionFromSelection()};
_.onInputRange_fontSize=function(a){console.log("onInputRange_fontSize");var b=this.appRef.editor2D.activeDocument,c=a.target;if(!c.isDragAction){console.log("start onInputRange_fontSize");b.removeAllInteractions();a=new SetAttributes_action(b);var d=new SetAttributes_action(b);b.history.addUndoRedoActions(a,d);a.addElements(b.selectionList,"font-size");c.isDragAction=!0;c.onchange=function(a){console.log("onInputRange_fontSize onchange");d.addElements(b.selectionList,"font-size");c.isDragAction=
!1;b.createInteractionFromSelection()}}console.log(c.value);this.inOutElements.fontSize.value=c.value;b.setAttributeElementList(b.selectionList,"font-size",c.value);b.selectionList[0].redrawText()};_.onChange_fontFamily=function(a){var b=this.appRef.editor2D.activeDocument,c=b.getFilteredElementListByNodeName(b.selectionList,"text");b.setAttributeElementList_undable(c,["font-family"],{"font-family":a.target.value})};_.onChange_fontSubsets=function(a){};
_.onChange_fontVariants=function(a){var b=this.appRef.editor2D.activeDocument,c=b.getFilteredElementListByNodeName(b.selectionList,"text");console.log("onChange_fontVariants",a.target.value);b.setFontFamilyElementList(c,this.fontObject,a.target.value);b.createInteractionFromSelection()};_.onChange_wordSpacing=function(a){var b=this.appRef.editor2D.activeDocument,c=b.getFilteredElementListByNodeName(b.selectionList,"text");b.setPropertyElementList_undable(c,"wordSpacing",a.target.value);b.createInteractionFromSelection()};
_.onInputRange_wordSpacing=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target;if(!c.isDragAction){b.removeAllInteractions();a=new SetProperties_action(b);var d=new SetProperties_action(b);b.history.addUndoRedoActions(a,d);a.addElements(b.selectionList,"wordSpacing");c.isDragAction=!0;c.onchange=function(a){d.addElements(b.selectionList,"wordSpacing");c.isDragAction=!1;b.createInteractionFromSelection()}}this.inOutElements.wordSpacing.value=c.value;b.setPropertyElementList(b.selectionList,
"wordSpacing",c.value)};_.onChange_letterSpacing=function(a){var b=this.appRef.editor2D.activeDocument,c=b.getFilteredElementListByNodeName(b.selectionList,"text");b.setPropertyElementList_undable(c,"letterSpacing",a.target.value);b.createInteractionFromSelection()};
_.onInputRange_letterSpacing=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target;if(!c.isDragAction){b.removeAllInteractions();a=new SetProperties_action(b);var d=new SetProperties_action(b);b.history.addUndoRedoActions(a,d);a.addElements(b.selectionList,"letterSpacing");c.isDragAction=!0;c.onchange=function(a){d.addElements(b.selectionList,"letterSpacing");c.isDragAction=!1;b.createInteractionFromSelection()}}this.inOutElements.letterSpacing.value=c.value;b.setPropertyElementList(b.selectionList,
"letterSpacing",c.value)};_.onClick_convertToPath=function(a){a=this.appRef.editor2D.activeDocument;var b=a.getFilteredElementListByNodeName(a.selectionList,"text");a.convertTextElementListToPath_undable(b)};function Text2D_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents();this.fontObject=null}_=Text2D_contentPanel.prototype;
_.update=function(){this.parentElement.parentElement.setTitle(LOCALIZER.translate("Text"));this.activeDoc=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDoc.currentEditableElement;var a=this.activeDoc.getElementListGlobalBBoxInContentSpace([this.editableElement]);this.inOutElements.x.value=this.activeDoc.valueToUnit(a.x);this.inOutElements.y.value=this.activeDoc.valueToUnit(a.y);this.inOutElements.width.value=this.activeDoc.valueToUnit(this.editableElement.textBoxWidth);this.inOutElements.height.value=
this.activeDoc.valueToUnit(this.editableElement.textBoxHeight);a=this.editableElement.getAttribute("font-family")||"";this.activeDoc.defaultDrawingProperties.fontFamily=this.inOutElements.fontFamily.value=a;this.fontObject=this.appRef.editor2D.FONT_LIBRARY_2D_PANEL.getFontObjectByFamilyName(a);console.log("this.fontObject",this.fontObject);this.updateFontVariantsMenu();a=parseFloat(this.editableElement.getAttribute("font-size"))||12;this.activeDoc.defaultDrawingProperties.fontSize=this.inOutElements.fontSizeSlider.value=
this.inOutElements.fontSize.value=this.activeDoc.valueToFixed(a);var b=this.editableElement.lineHeight;this.activeDoc.defaultDrawingProperties.lineHeight=this.inOutElements.lineHeight.value=b;this.inOutElements.lineHeightSlider.value="normal"==b?this.activeDoc.valueToFixed(a):this.activeDoc.valueToFixed(parseFloat(b));a=this.editableElement.getAttribute("text-align")||"left";this.activeDoc.defaultDrawingProperties.textAlign=a;this.activeDoc.defaultDrawingProperties.letterSpacing=this.inOutElements.letterSpacing.value=
this.activeDoc.valueToFixed(parseFloat(this.editableElement.letterSpacing));this.activeDoc.defaultDrawingProperties.wordSpacing=this.inOutElements.wordSpacing.value=this.activeDoc.valueToFixed(parseFloat(this.editableElement.wordSpacing));a=this.inOutElements.textAlign.querySelector("[value="+a+"]");SelectElement(a)};
_.updateFontSubsetsMenu=function(){this.inOutElements.fontSubsets.removeChildren();if(null!=this.fontObject){var a;for(a=0;a<this.fontObject.subsets.length;a++){var b=this.fontObject.subsets[a];var c=document.createElement("option");c.appendChild(document.createTextNode(b));c.setAttribute("value",b);this.inOutElements.fontSubsets.appendChild(c)}}};
_.getFontVariantName=function(a){switch(a){case "italic":return"Italic";case "100":return"Thin";case "200":return"Extra Light";case "300":return"Light";case "500":return"Medium";case "600":return"Semi Bold";case "700":return"Bold";case "800":return"Extra Bold";case "900":return"Black";case "100italic":return"Thin - italic";case "200italic":return"Extra Light - italic";case "300italic":return"Light - italic";case "400italic":return"Regular - italic";case "500italic":return"Medium - italic";case "600italic":return"Semi Bold - italic";
case "700italic":return"Bold - italic";case "800italic":return"Extra Bold - italic";case "900italic":return"Black - italic"}return"Regular"};
_.updateFontVariantsMenu=function(){this.inOutElements.fontVariants.removeChildren();if(null!=this.fontObject){var a=this.getFontVariantName,b;for(b=0;b<this.fontObject.variants.length;b++){var c=this.fontObject.variants[b];var d=document.createElement("option");d.appendChild(document.createTextNode(a(c)));d.setAttribute("value",c);this.inOutElements.fontVariants.appendChild(d)}a=this.editableElement.getAttribute("font-weight")||"";b=this.editableElement.getAttribute("font-style")||"";console.log("fontWeight+fontStyle",
a+b);this.inOutElements.fontVariants.value=a+b}};_.onClick_fontLibrary=function(a){this.appRef.editor2D.FONT_LIBRARY_2D_PANEL.expand()};_.onClick_textAlign=function(a){a=a.target;SelectElement(a);a=a.getAttribute("value");var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"text");this.activeDoc.setPropertyElementList_undable(b,"textAlign",a)};
_.onChange_positionX=function(a){var b=this.activeDoc.unitToValue(a.target.value);a=this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList);b=this.activeDoc.content.localToGlobal(b,0);var c=new SetMatrix_action(this.activeDoc),d=new SetMatrix_action(this.activeDoc);this.activeDoc.history.addUndoRedoActions(c,d);c.addElements(this.activeDoc.selectionList);this.activeDoc.translateElementList(this.activeDoc.selectionList,b.x-a.x,0);d.addElements(this.activeDoc.selectionList);this.activeDoc.createInteractionFromSelection()};
_.onChange_positionY=function(a){var b=this.activeDoc.unitToValue(a.target.value);a=this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList);b=this.activeDoc.content.localToGlobal(0,b);var c=new SetMatrix_action(this.activeDoc),d=new SetMatrix_action(this.activeDoc);this.activeDoc.history.addUndoRedoActions(c,d);c.addElements(this.activeDoc.selectionList);this.activeDoc.translateElementList(this.activeDoc.selectionList,0,b.y-a.y);d.addElements(this.activeDoc.selectionList);this.activeDoc.createInteractionFromSelection()};
_.onChange_width=function(a){var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"text");this.activeDoc.setPropertyElementList_undable(b,"textBoxWidth",a.target.value);this.activeDoc.createInteractionFromSelection()};_.onChange_height=function(a){var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"text");this.activeDoc.setPropertyElementList_undable(b,"textBoxHeight",a.target.value);this.activeDoc.createInteractionFromSelection()};
_.onChange_fontSize=function(a){var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"text");this.activeDoc.setPropertyElementList_undable(b,"fontSize",a.target.value);this.activeDoc.createInteractionFromSelection()};
_.onInputRange_fontSize=function(a){console.log("onInputRange_fontSize");var b=this.appRef.editor2D.activeDocument,c=a.target;if(!c.isDragAction){console.log("start onInputRange_fontSize");b.removeAllInteractions();a=new SetAttributes_action(b);var d=new SetAttributes_action(b);b.history.addUndoRedoActions(a,d);a.addElements(b.selectionList,"font-size");c.isDragAction=!0;c.onchange=function(a){console.log("onInputRange_fontSize onchange");d.addElements(b.selectionList,"font-size");c.isDragAction=
!1;b.createInteractionFromSelection()}}console.log(c.value);this.inOutElements.fontSize.value=c.value;b.setAttributeElementList(b.selectionList,"font-size",c.value);b.selectionList[0].redrawText()};_.onChange_fontFamily=function(a){var b=this.appRef.editor2D.activeDocument,c=b.getFilteredElementListByNodeName(b.selectionList,"text");b.setAttributeElementList_undable(c,["font-family"],{"font-family":a.target.value})};_.onChange_fontSubsets=function(a){};
_.onChange_fontVariants=function(a){var b=this.appRef.editor2D.activeDocument,c=b.getFilteredElementListByNodeName(b.selectionList,"text");console.log("onChange_fontVariants",a.target.value);b.setFontFamilyElementList(c,this.fontObject,a.target.value);b.createInteractionFromSelection()};_.onChange_lineHeight=function(a){var b=this.appRef.editor2D.activeDocument,c=b.getFilteredElementListByNodeName(b.selectionList,"text");b.setPropertyElementList_undable(c,"lineHeight",a.target.value);b.createInteractionFromSelection()};
_.onInputRange_lineHeight=function(a){console.log("onInputRange_lineHeight");var b=this.appRef.editor2D.activeDocument,c=a.target;if(!c.isDragAction){console.log("start onInputRange_lineHeight");b.removeAllInteractions();a=new SetProperties_action(b);var d=new SetProperties_action(b);b.history.addUndoRedoActions(a,d);a.addElements(b.selectionList,"lineHeight");c.isDragAction=!0;c.onchange=function(a){console.log("onInputRange_lineHeight onchange");d.addElements(b.selectionList,"lineHeight");c.isDragAction=
!1;b.createInteractionFromSelection()}}console.log(c.value);this.inOutElements.lineHeight.value=c.value;b.setPropertyElementList(b.selectionList,"lineHeight",c.value)};_.onChange_wordSpacing=function(a){var b=this.appRef.editor2D.activeDocument,c=b.getFilteredElementListByNodeName(b.selectionList,"text");b.setPropertyElementList_undable(c,"wordSpacing",a.target.value);b.createInteractionFromSelection()};
_.onInputRange_wordSpacing=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target;if(!c.isDragAction){b.removeAllInteractions();a=new SetProperties_action(b);var d=new SetProperties_action(b);b.history.addUndoRedoActions(a,d);a.addElements(b.selectionList,"wordSpacing");c.isDragAction=!0;c.onchange=function(a){d.addElements(b.selectionList,"wordSpacing");c.isDragAction=!1;b.createInteractionFromSelection()}}this.inOutElements.wordSpacing.value=c.value;b.setPropertyElementList(b.selectionList,
"wordSpacing",c.value)};_.onChange_letterSpacing=function(a){var b=this.appRef.editor2D.activeDocument,c=b.getFilteredElementListByNodeName(b.selectionList,"text");b.setPropertyElementList_undable(c,"letterSpacing",a.target.value);b.createInteractionFromSelection()};
_.onInputRange_letterSpacing=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target;if(!c.isDragAction){b.removeAllInteractions();a=new SetProperties_action(b);var d=new SetProperties_action(b);b.history.addUndoRedoActions(a,d);a.addElements(b.selectionList,"letterSpacing");c.isDragAction=!0;c.onchange=function(a){d.addElements(b.selectionList,"letterSpacing");c.isDragAction=!1;b.createInteractionFromSelection()}}this.inOutElements.letterSpacing.value=c.value;b.setPropertyElementList(b.selectionList,
"letterSpacing",c.value)};_.onClick_convertToPath=function(a){a=this.appRef.editor2D.activeDocument;var b=a.getFilteredElementListByNodeName(a.selectionList,"text");a.convertTextElementListToPath_undable(b)};Extends(TextPath2D_contentPanel,TextBaseClass_contentPanel);function TextPath2D_contentPanel(a){TextPath2D_contentPanel.superConstructor.call(this,a)}_=TextPath2D_contentPanel.prototype;
_.update=function(){TextPath2D_contentPanel.superClass.update.call(this);this.parentElement.parentElement.setTitle(LOCALIZER.translate("Text Path"));this.inOutElements.startOffset.value=this.inOutElements.startOffsetSlider.value=parseFloat(this.editableElement.querySelector("textPath").getAttribute("startOffset")||0)};
_.onChange_startOffset=function(a){var b=this.appRef.editor2D.activeDocument,c=this.editableElement.querySelector("textPath");c&&b.setAttributeElementList_undable([c],["startOffset"],{startOffset:a.target.value});b.createInteractionFromSelection()};
_.onInputRange_startOffset=function(a){var b=this.editableElement.querySelector("textPath");if(b){var c=this.appRef.editor2D.activeDocument,d=a.target;if(!d.isDragAction){d.isDragAction=!0;c.removeAllInteractions();var e=b.getAttribute("startOffset")||"0";d.onchange=function(a){b.setAttribute("startOffset",e);c.setAttributeElementList_undable([b],["startOffset"],{startOffset:d.value+"%"});d.isDragAction=!1;c.createInteractionFromSelection()}}this.inOutElements.startOffset.value=d.value;c.setAttributeElementList([b],
["startOffset"],d.value+"%")}};_.onChange_textData=function(a){this.editableElement.querySelector("textPath").innerHTML=a.target.value};function HtmlText2D_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents();this.savedTextSelectionRange=this.fontObject=this.selectedLinkNode=this.selectedTextNode=this.textContainer=this.editableElement=null}_=HtmlText2D_contentPanel.prototype;
_.saveTextSelectionRange=function(){var a,b;window.getSelection?(a=window.getSelection())&&(b=window.getSelection().getRangeAt(0)):document.selection&&(a=document.selection,b=a.createRange());console.log("selection",a);console.log("range",b);this.savedTextSelectionRange=b};_.setTextSelectionRange=function(a){if(window.getSelection){var b=window.getSelection();b.removeAllRanges();b.addRange(a)}else document.selection&&a.select&&a.select()};
_.getSelectedTextNode=function(){var a=this.savedTextSelectionRange.commonAncestorContainer;3==a.nodeType&&(a=a.parentNode);return a};_.applyTextCommandToSelection=function(a,b,c){c&&this.setTextSelectionRange(c);try{var d=document.execCommand(a,!1,b)}catch(e){alert(e)}d||(a=document.queryCommandSupported(a),alert(a?"Unknown error. Is anything selected?":"Command is not supported by your browser."));return d};
_.update=function(){this.parentElement.parentElement.setTitle("HTML Text");this.activeDoc=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDoc.currentEditableElement;this.textContainer=this.editableElement.querySelector(".text-box");var a=this.activeDoc.getElementListGlobalBBoxInContentSpace([this.editableElement]);this.inOutElements.x.value=this.activeDoc.valueToUnit(a.x);this.inOutElements.y.value=this.activeDoc.valueToUnit(a.y);this.inOutElements.width.value=this.activeDoc.valueToUnit(this.editableElement.getAttribute("width"));
this.inOutElements.height.value=this.activeDoc.valueToUnit(this.editableElement.getAttribute("height"));this.selectedLinkNode=null;this.activeDoc.isHTMLTextEditing?(this.saveTextSelectionRange(),this.selectedTextNode=this.getSelectedTextNode(),a=window.getComputedStyle(this.selectedTextNode),console.log("this.selectedTextNode",this.selectedTextNode),this.selectedLinkNode=this.selectedTextNode.getParentElementByNodeName("A"),console.log("this.selectedLinkNode",this.selectedLinkNode)):a=window.getComputedStyle(this.textContainer);
console.log("computedStyle",a);var b=a.fontFamily;var c=a.fontSize;var d=a.lineHeight;var e=a.letterSpacing;var f=a.wordSpacing;var g=a.textAlign;"start"==g?g="left":"end"==g&&(g="right");var k=a.fontWeight;var l=a.fontStyle;this.activeDoc.defaultDrawingProperties.fontFamily=b;this.activeDoc.defaultDrawingProperties.fontSize=c;this.activeDoc.defaultDrawingProperties.lineHeight=d;this.activeDoc.defaultDrawingProperties.letterSpacing=e;this.activeDoc.defaultDrawingProperties.wordSpacing=f;this.activeDoc.defaultDrawingProperties.textAlign=
g;this.activeDoc.defaultDrawingProperties.fontWeight=k;this.activeDoc.defaultDrawingProperties.fontStyle=l;SelectElement(this.inOutElements.textAlign.querySelector("[value="+g+"]"));DeselectElements(this.inOutElements.textStyle.querySelectorAll("li"));DeselectElements(this.inOutElements.editText.querySelectorAll("li"));"italic"==l&&SelectElement(this.inOutElements.textStyle.querySelector('[cmd="italic"]'),"check");"bold"==k&&SelectElement(this.inOutElements.textStyle.querySelector('[cmd="bold"]'),
"check");"underline"==a.textDecoration?SelectElement(this.inOutElements.textStyle.querySelector('[cmd="underline"]'),"check"):"line-through"==a.textDecoration&&SelectElement(this.inOutElements.textStyle.querySelector('[cmd="strikeThrough"]'),"check");a=this.querySelectorAll('[selection-context="htmlLinkEditing"]');this.selectedLinkNode?(SelectElement(this.inOutElements.editText.querySelector('[cmd="createLink"]')),a[0].classList.remove("hidden"),a[1].classList.remove("hidden"),this.inOutElements.anchorLink.value=
this.selectedLinkNode.getAttribute("href"),this.inOutElements.anchorLinkTarget.value=this.selectedLinkNode.getAttribute("target")||""):(a[0].classList.add("hidden"),a[1].classList.add("hidden"))};
_.onChange_positionX=function(a){var b=this.activeDoc.unitToValue(a.target.value);a=this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList);b=this.activeDoc.content.localToGlobal(b,0);var c=new SetMatrix_action(this.activeDoc),d=new SetMatrix_action(this.activeDoc);this.activeDoc.history.addUndoRedoActions(c,d);c.addElements(this.activeDoc.selectionList);this.activeDoc.translateElementList(this.activeDoc.selectionList,b.x-a.x,0);d.addElements(this.activeDoc.selectionList);this.activeDoc.createInteractionFromSelection()};
_.onChange_positionY=function(a){var b=this.activeDoc.unitToValue(a.target.value);a=this.activeDoc.getElementListGlobalBBox(this.activeDoc.selectionList);b=this.activeDoc.content.localToGlobal(0,b);var c=new SetMatrix_action(this.activeDoc),d=new SetMatrix_action(this.activeDoc);this.activeDoc.history.addUndoRedoActions(c,d);c.addElements(this.activeDoc.selectionList);this.activeDoc.translateElementList(this.activeDoc.selectionList,0,b.y-a.y);d.addElements(this.activeDoc.selectionList);this.activeDoc.createInteractionFromSelection()};
_.onChange_width=function(a){var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"foreignObject");this.activeDoc.setAttributeElementList_undable(b,"width",this.activeDoc.unitToValue(a.target.value));this.activeDoc.createInteractionFromSelection()};
_.onChange_height=function(a){var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"foreignObject");this.activeDoc.setAttributeElementList_undable(b,"height",this.activeDoc.unitToValue(a.target.value));this.activeDoc.createInteractionFromSelection()};_.onClick_textAlign=function(a){a=a.target;this.activeDoc.isHTMLTextEditing?this.applyTextCommandToSelection(a.getAttribute("cmd")):this.textContainer.style.textAlign=a.getAttribute("value");SelectElement(a)};
_.onClick_textStyle=function(a){a=a.target.getAttribute("cmd");this.activeDoc.isHTMLTextEditing?this.applyTextCommandToSelection(a):"removeFormat"==a?(this.textContainer.style.fontStyle=this.textContainer.style.fontWeight="normal",this.textContainer.style.textDecoration="none"):"italic"==a?(a="italic",this.textContainer.style.fontStyle==a&&(a="normal"),this.textContainer.style.fontStyle=a):"bold"==a?(a="bold",this.textContainer.style.fontWeight==a&&(a="normal"),this.textContainer.style.fontWeight=
a):"underline"==a?(a="underline",this.textContainer.style.textDecoration==a&&(a="none"),this.textContainer.style.textDecoration=a):"strikeThrough"==a&&(a="line-through",this.textContainer.style.textDecoration==a&&(a="none"),this.textContainer.style.textDecoration=a);this.update()};
_.onClick_editText=function(a){a=a.target;var b=a.getAttribute("cmd");this.activeDoc.isHTMLTextEditing&&(console.log("cmd",b),"createLink"==b?(this.selectedLinkNode?this.applyTextCommandToSelection("unlink"):this.applyTextCommandToSelection(a.getAttribute("cmd"),"http://www.janvas.com"),this.update()):this.applyTextCommandToSelection(a.getAttribute("cmd")))};
_.onChange_fontSize=function(a){this.activeDoc.isHTMLTextEditing?this.selectedTextNode.style.fontSize=a.target.value+"px":this.textContainer.style.fontSize=a.target.value+"px"};
_.onInputRange_fontSize=function(a){console.log("onInputRange_fontSize");var b=this.appRef.editor2D.activeDocument,c=a.target;var d=this.activeDoc.isHTMLTextEditing?this.selectedTextNode.style:this.textContainer.style;if(!c.isDragAction){console.log("start onInputRange_fontSize");a=new SetProperties_action(b);var e=new SetProperties_action(b);a.updateDocumentSelection=e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"fontSize");c.isDragAction=!0;c.onchange=function(a){console.log("onInputRange_fontSize onchange");
e.addElements([d],"fontSize");c.isDragAction=!1;b.createInteractionFromSelection()}}console.log(c.value);this.inOutElements.fontSize.value=c.value;b.setPropertyElementList([d],"fontSize",c.value+"px")};_.onChange_lineHeight=function(a){var b="px";"normal"==a.target.value&&(b="");this.activeDoc.isHTMLTextEditing?this.selectedTextNode.style.lineHeight=a.target.value+b:this.textContainer.style.lineHeight=a.target.value+b};
_.onInputRange_lineHeight=function(a){console.log("onInputRange_lineHeight");var b=this.appRef.editor2D.activeDocument,c=a.target;var d=this.activeDoc.isHTMLTextEditing?this.selectedTextNode.style:this.textContainer.style;if(!c.isDragAction){a=new SetProperties_action(b);var e=new SetProperties_action(b);a.updateDocumentSelection=e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"lineHeight");c.isDragAction=!0;c.onchange=function(a){console.log("onInputRange_fontSize onchange");
e.addElements([d],"lineHeight");c.isDragAction=!1;b.createInteractionFromSelection()}}console.log(c.value);this.inOutElements.lineHeight.value=c.value;b.setPropertyElementList([d],"lineHeight",c.value+"px")};_.onChange_letterSpacing=function(a){this.activeDoc.isHTMLTextEditing?this.selectedTextNode.style.letterSpacing=a.target.value+"px":this.textContainer.style.letterSpacing=a.target.value+"px"};
_.onInputRange_letterSpacing=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target;var d=this.activeDoc.isHTMLTextEditing?this.selectedTextNode.style:this.textContainer.style;if(!c.isDragAction){a=new SetProperties_action(b);var e=new SetProperties_action(b);a.updateDocumentSelection=e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"letterSpacing");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"letterSpacing");c.isDragAction=!1;b.createInteractionFromSelection()}}console.log(c.value);
this.inOutElements.letterSpacing.value=c.value;b.setPropertyElementList([d],"letterSpacing",c.value+"px")};_.onChange_wordSpacing=function(a){this.activeDoc.isHTMLTextEditing?this.selectedTextNode.style.wordSpacing=a.target.value+"px":this.textContainer.style.wordSpacing=a.target.value+"px"};
_.onInputRange_wordSpacing=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target;var d=this.activeDoc.isHTMLTextEditing?this.selectedTextNode.style:this.textContainer.style;if(!c.isDragAction){a=new SetProperties_action(b);var e=new SetProperties_action(b);a.updateDocumentSelection=e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"wordSpacing");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"wordSpacing");c.isDragAction=!1;b.createInteractionFromSelection()}}console.log(c.value);
this.inOutElements.wordSpacing.value=c.value;b.setPropertyElementList([d],"wordSpacing",c.value+"px")};_.onChange_anchorLink=function(a){this.selectedLinkNode.setAttribute("href",a.target.value)};_.onChange_anchorLinkTarget=function(a){this.selectedLinkNode.setAttribute("target",a.target.value)};function Line2D_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents()}_=Line2D_contentPanel.prototype;
_.update=function(){this.parentElement.parentElement.setTitle(LOCALIZER.translate("Line"));this.activeDoc=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDoc.currentEditableElement;var a=this.editableElement.pathSegList.getItem(0);a=SVGElement.svgUtils.createSVGPoint(a.x,a.y);var b=this.editableElement.pathSegList.getItem(1);b=SVGElement.svgUtils.createSVGPoint(b.x,b.y);var c=this.editableElement.getTransformToElement(this.activeDoc.content);a=a.matrixTransform(c);b=b.matrixTransform(c);
c=b.getDistanceFromPoint(a);this.inOutElements.x1.value=this.activeDoc.valueToUnit(a.x);this.inOutElements.y1.value=this.activeDoc.valueToUnit(a.y);this.inOutElements.x2.value=this.activeDoc.valueToUnit(b.x);this.inOutElements.y2.value=this.activeDoc.valueToUnit(b.y);this.inOutElements.width.value=this.activeDoc.valueToUnit(c);this.inOutElements.orientation.value=this.activeDoc.valueToFixed(a.getAngleFromPoint(b,!0))};
_.onChange_x1_y1=function(a){var b=this.activeDoc,c=this.editableElement;a={};var d={},e=c.pathSegList.getItem(0).x,f=c.pathSegList.getItem(0).y;a.execute=function(){c.pathSegList.getItem(0).x=e;c.pathSegList.getItem(0).y=f;b.deselectAllElements();b.selectElementList([c]);b.createInteractionFromSelection();b.showSelectionProperties()};var g=this.activeDoc.content.getTransformToElement(this.editableElement),k=SVGElement.svgUtils.createSVGPoint(this.activeDoc.unitToValue(this.inOutElements.x1.value),
this.activeDoc.unitToValue(this.inOutElements.y1.value));k=k.matrixTransform(g);d.execute=function(){c.pathSegList.getItem(0).x=k.x;c.pathSegList.getItem(0).y=k.y;b.deselectAllElements();b.selectElementList([c]);b.createInteractionFromSelection();b.showSelectionProperties()};b.history.addUndoRedoActions(a,d);c.pathSegList.getItem(0).x=k.x;c.pathSegList.getItem(0).y=k.y;this.activeDoc.createInteractionFromSelection()};
_.onChange_x2_y2=function(a){var b=this.activeDoc,c=this.editableElement;a={};var d={},e=c.pathSegList.getItem(1).x,f=c.pathSegList.getItem(1).y;a.execute=function(){c.pathSegList.getItem(1).x=e;c.pathSegList.getItem(1).y=f;b.deselectAllElements();b.selectElementList([c]);b.createInteractionFromSelection();b.showSelectionProperties()};var g=this.activeDoc.content.getTransformToElement(this.editableElement),k=SVGElement.svgUtils.createSVGPoint(this.activeDoc.unitToValue(this.inOutElements.x2.value),
this.activeDoc.unitToValue(this.inOutElements.y2.value));k=k.matrixTransform(g);d.execute=function(){c.pathSegList.getItem(1).x=k.x;c.pathSegList.getItem(1).y=k.y;b.deselectAllElements();b.selectElementList([c]);b.createInteractionFromSelection();b.showSelectionProperties()};b.history.addUndoRedoActions(a,d);c.pathSegList.getItem(1).x=k.x;c.pathSegList.getItem(1).y=k.y;this.activeDoc.createInteractionFromSelection()};
_.onChange_width=function(a){var b=this.activeDoc,c=this.editableElement.pathSegList.getItem(0);c=SVGElement.svgUtils.createSVGPoint(c.x,c.y);var d=this.editableElement.pathSegList.getItem(1);d=SVGElement.svgUtils.createSVGPoint(d.x,d.y);a=this.activeDoc.unitToValue(a.target.value)/d.getDistanceFromPoint(c);var e=c.x+(d.x-c.x)*a,f=c.y+(d.y-c.y)*a,g=this.editableElement;c={};a={};c.execute=function(){g.pathSegList.getItem(1).x=d.x;g.pathSegList.getItem(1).y=d.y;b.deselectAllElements();b.selectElementList([g]);
b.createInteractionFromSelection();b.showSelectionProperties()};a.execute=function(){g.pathSegList.getItem(1).x=e;g.pathSegList.getItem(1).y=f;b.deselectAllElements();b.selectElementList([g]);b.createInteractionFromSelection();b.showSelectionProperties()};b.history.addUndoRedoActions(c,a);this.editableElement.pathSegList.getItem(1).x=e;this.editableElement.pathSegList.getItem(1).y=f;this.activeDoc.createInteractionFromSelection();this.activeDoc.showSelectionProperties()};
_.onChange_orientation=function(a){var b=this.activeDoc,c=this.editableElement.pathSegList.getItem(0);c=SVGElement.svgUtils.createSVGPoint(c.x,c.y);var d=this.editableElement.pathSegList.getItem(1);d=SVGElement.svgUtils.createSVGPoint(d.x,d.y);var e=d.x,f=d.y;d=d.getDistanceFromPoint(c);a=SVGElement.svgUtils.createSVGPointPolar(d,Math.PI/180*a.target.value);var g=c.x+a.x,k=c.y+a.y,l=this.editableElement;c={};a={};c.execute=function(){l.pathSegList.getItem(1).x=e;l.pathSegList.getItem(1).y=f;b.deselectAllElements();
b.selectElementList([l]);b.createInteractionFromSelection();b.showSelectionProperties()};a.execute=function(){l.pathSegList.getItem(1).x=g;l.pathSegList.getItem(1).y=k;b.deselectAllElements();b.selectElementList([l]);b.createInteractionFromSelection();b.showSelectionProperties()};b.history.addUndoRedoActions(c,a);this.editableElement.pathSegList.getItem(1).x=g;this.editableElement.pathSegList.getItem(1).y=k;this.activeDoc.createInteractionFromSelection();this.activeDoc.showSelectionProperties()};
function Rect2D_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents()}_=Rect2D_contentPanel.prototype;
_.update=function(){this.parentElement.parentElement.setTitle(LOCALIZER.translate("Rect"));this.activeDoc=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDoc.currentEditableElement;var a=SVGElement.svgUtils.createSVGPoint(this.editableElement.getAttribute("x"),this.editableElement.getAttribute("y")),b=this.editableElement.getTransformToElement(this.activeDoc.content);a=a.matrixTransform(b);this.inOutElements.x.value=this.activeDoc.valueToUnit(a.x);this.inOutElements.y.value=this.activeDoc.valueToUnit(a.y);
this.inOutElements.width.value=this.activeDoc.valueToUnit(this.editableElement.getAttribute("width"));this.inOutElements.height.value=this.activeDoc.valueToUnit(this.editableElement.getAttribute("height"));this.editableElement.hasAttribute("rx")&&(this.inOutElements.rx.value=this.activeDoc.valueToUnit(this.editableElement.getAttribute("rx")));this.editableElement.hasAttribute("ry")&&(this.inOutElements.ry.value=this.activeDoc.valueToUnit(this.editableElement.getAttribute("ry")))};
_.onChange_x_y=function(a){var b=this.activeDoc.content.getTransformToElement(this.editableElement);a=SVGElement.svgUtils.createSVGPoint(this.activeDoc.unitToValue(this.inOutElements.x.value),this.activeDoc.unitToValue(this.inOutElements.y.value));a=a.matrixTransform(b);b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"rect");this.activeDoc.setAttributeElementList_undable(b,["x","y"],{x:a.x,y:a.y});this.activeDoc.createInteractionFromSelection()};
_.onChange_width=function(a){var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"rect");this.activeDoc.setAttributeElementList_undable(b,"width",this.activeDoc.unitToValue(a.target.value));this.activeDoc.createInteractionFromSelection()};_.onChange_height=function(a){var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"rect");this.activeDoc.setAttributeElementList_undable(b,"height",this.activeDoc.unitToValue(a.target.value));this.activeDoc.createInteractionFromSelection()};
_.onChange_rx=function(a){var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"rect");this.activeDoc.setAttributeElementList_undable(b,"rx",this.activeDoc.unitToValue(a.target.value))};_.onChange_ry=function(a){var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"rect");this.activeDoc.setAttributeElementList_undable(b,"ry",this.activeDoc.unitToValue(a.target.value))};_.onClick_convertToPath=function(a){this.appRef.editor2D.activeDocument.convertElementListToPath_undable(this.activeDoc.selectionList)};
function Ellipse2D_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents()}_=Ellipse2D_contentPanel.prototype;
_.update=function(){this.parentElement.parentElement.setTitle(LOCALIZER.translate("Ellipse"));this.activeDoc=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDoc.currentEditableElement;var a=SVGElement.svgUtils.createSVGPoint(this.editableElement.getAttribute("cx"),this.editableElement.getAttribute("cy")),b=this.editableElement.getTransformToElement(this.activeDoc.content);a=a.matrixTransform(b);this.inOutElements.cx.value=this.activeDoc.valueToUnit(a.x);this.inOutElements.cy.value=
this.activeDoc.valueToUnit(a.y);this.editableElement.hasAttribute("rx")&&(this.inOutElements.rx.value=this.activeDoc.valueToUnit(this.editableElement.getAttribute("rx")));this.editableElement.hasAttribute("ry")&&(this.inOutElements.ry.value=this.activeDoc.valueToUnit(this.editableElement.getAttribute("ry")))};
_.onChange_cx_cy=function(a){var b=this.activeDoc.content.getTransformToElement(this.editableElement);a=SVGElement.svgUtils.createSVGPoint(this.activeDoc.unitToValue(this.inOutElements.cx.value),this.activeDoc.unitToValue(this.inOutElements.cy.value));a=a.matrixTransform(b);b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"ellipse");this.activeDoc.setAttributeElementList_undable(b,["cx","cy"],{cx:a.x,cy:a.y});this.activeDoc.createInteractionFromSelection()};
_.onChange_rx=function(a){var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"ellipse");this.activeDoc.setAttributeElementList_undable(b,"rx",this.activeDoc.unitToValue(a.target.value));this.activeDoc.createInteractionFromSelection()};_.onChange_ry=function(a){var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"ellipse");this.activeDoc.setAttributeElementList_undable(b,"ry",this.activeDoc.unitToValue(a.target.value));this.activeDoc.createInteractionFromSelection()};
_.onClick_convertToPath=function(a){this.appRef.editor2D.activeDocument.convertElementListToPath_undable(this.activeDoc.selectionList)};function Image2D_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents()}_=Image2D_contentPanel.prototype;
_.update=function(){this.parentElement.parentElement.setTitle(LOCALIZER.translate("Image"));this.activeDoc=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDoc.currentEditableElement;var a=SVGElement.svgUtils.createSVGPoint(this.editableElement.getAttribute("x"),this.editableElement.getAttribute("y")),b=this.editableElement.getTransformToElement(this.activeDoc.content);a=a.matrixTransform(b);this.inOutElements.x.value=this.activeDoc.valueToUnit(a.x);this.inOutElements.y.value=this.activeDoc.valueToUnit(a.y);
this.inOutElements.width.value=this.activeDoc.valueToUnit(this.editableElement.getAttribute("width"));this.inOutElements.height.value=this.activeDoc.valueToUnit(this.editableElement.getAttribute("height"));a=this.editableElement.getAttributeNS(SVGElement.XLINK_NS,"href");-1<a.indexOf("data:")&&(a="data:*");this.inOutElements.href.value=a};
_.onChange_x_y=function(a){var b=this.activeDoc.content.getTransformToElement(this.editableElement);a=SVGElement.svgUtils.createSVGPoint(this.activeDoc.unitToValue(this.inOutElements.x.value),this.activeDoc.unitToValue(this.inOutElements.y.value));a=a.matrixTransform(b);b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"image");this.activeDoc.setAttributeElementList_undable(b,["x","y"],{x:a.x,y:a.y});this.activeDoc.createInteractionFromSelection()};
_.onChange_width=function(a){var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"image");this.activeDoc.setAttributeElementList_undable(b,"width",this.activeDoc.unitToValue(a.target.value));this.activeDoc.createInteractionFromSelection()};_.onChange_height=function(a){var b=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"image");this.activeDoc.setAttributeElementList_undable(b,"height",this.activeDoc.unitToValue(a.target.value));this.activeDoc.createInteractionFromSelection()};
_.onChange_href=function(a){this.loadRemoteImage(a.target.value,1E3)};_.onDropOn_href=function(a){a.stopPropagation();a.preventDefault();a=GetTransferData();console.log("transferData.data",a.data);if(a.data&&a.data.webContentLink){var b=a.data.name.split(".");b=b[b.length-1].toLowerCase();if("jpg"==b||"jpeg"==b||"png"==b||"svg"==b)this.inOutElements.href.value=a.data.webContentLink,this.loadRemoteImage(a.data.webContentLink,a.data.size)}};
_.loadRemoteImage=function(a,b){var c=this.activeDoc.selectionList[0];c.setAttributeNS(SVGElement.XLINK_NS,"href",a);var d=this.activeDoc;c.initializeWithOriginalSize(function(){d.createInteractionFromSelection();PROGRESS_PANEL.endVirtualProgress()});PROGRESS_PANEL.open(!0);PROGRESS_PANEL.startVirtualProgress(b)};function Path2D_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents();this.inOutElements.booleanButtons=this.querySelector('[name="booleanButtons"]')}
_=Path2D_contentPanel.prototype;
_.update=function(){this.parentElement.parentElement.setTitle(LOCALIZER.translate("Path"));this.activeDoc=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDoc.currentEditableElement;var a=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"path");this.inOutElements.separateButton.classList.add("hidden");this.inOutElements.unifyButton.classList.add("hidden");this.inOutElements.closeButton.classList.add("hidden");this.inOutElements.booleanButtons.classList.add("hidden");var b;
var c=a.length;1<c&&(this.inOutElements.unifyButton.classList.remove("hidden"),this.inOutElements.booleanButtons.classList.remove("hidden"));for(b=0;b<c;b++){var d=a[b];d.subPathList||d.createSubPathList();if(1<d.subPathList.length){this.inOutElements.separateButton.classList.remove("hidden");break}}for(b=0;b<c;b++)if(d=a[b],(d=d.pathSegList[d.pathSegList.length-1])&&d.pathSegType!=SVGPathSeg.PATHSEG_CLOSEPATH){this.inOutElements.closeButton.classList.remove("hidden");break}};
_.onClick_separate=function(a){a=this.appRef.editor2D.activeDocument;for(var b=a.getFilteredElementListByNodeName(a.selectionList,"path"),c,d=[],e=0;e<b.length;e++)c=b[e].separateSubPaths(),1<c.length&&(d=d.concat(b[e].separateSubPaths()));0==d.length?console.log("nothing to separate"):(c=new ReplaceElements_action(a),e=new ReplaceElements_action(a),a.history.addUndoRedoActions(e,c),c.addElementsToRemove(b),e.addElementsToAdd(b),a.removeElementList(b),a.activeLayer.appendChildren(d),c.addElementsToAdd(d),
e.addElementsToRemove(d),a.deselectAllElements(),a.selectElementList(d),a.createInteractionFromSelection(),a.showSelectionProperties(),a.onChange())};_.onClick_close=function(a){a=this.appRef.editor2D.activeDocument;for(var b=a.getFilteredElementListByNodeName(a.selectionList,"path"),c=0;c<b.length;c++)b[c].closePath();a.createInteractionFromSelection();a.showSelectionProperties();a.onChange()};
_.onClick_unify=function(a){a=this.appRef.editor2D.activeDocument;var b=a.getFilteredElementListByNodeName(a.selectionList,"path"),c=b[0].cloneNode();a.activeLayer.appendChild(c);for(var d=1;d<b.length;d++){var e=b[d];c.unifyPathSegments(e)}e=new ReplaceElements_action(a);d=new ReplaceElements_action(a);a.history.addUndoRedoActions(d,e);e.addElementsToRemove(b);d.addElementsToAdd(b);a.removeElementList(b);e.addElementsToAdd([c]);d.addElementsToRemove([c]);a.deselectAllElements();a.selectElementList([c]);
a.createInteractionFromSelection();a.showSelectionProperties();a.onChange()};_.onClick_semplify=function(a){};
_.onClick_smooth=function(a){a=this.appRef.editor2D.activeDocument;var b=a.getFilteredElementListByNodeName(a.selectionList,"path"),c=new ReplaceElements_action(a),d=new ReplaceElements_action(a);a.history.addUndoRedoActions(d,c);c.addElementsToRemove(b);d.addElementsToAdd(b);var e={};paper.install(e);paper.setup([640,480]);for(var f=0;f<b.length;f++){var g=b[f];var k=e.project.importSVG(g);k.smooth();k=k.exportSVG();g.parentElement.replaceChild(k,g);k.getPathData({normalize:!0})}c.addElementsToAdd([k]);
d.addElementsToRemove([k]);a.deselectAllElements();a.selectElementList([k]);a.createInteractionFromSelection();a.showSelectionProperties();a.onChange()};
_.onClick_revert=function(a){var b=this.appRef.editor2D.activeDocument;a=b.getFilteredElementListByNodeName(b.selectionList,"path");var c=[],d=new ReplaceElements_action(b),e=new ReplaceElements_action(b);b.history.addUndoRedoActions(e,d);d.addElementsToRemove(a);e.addElementsToAdd(a);for(var f=0;f<a.length;f++){var g=a[f];b=g.revertSegments();g.parentElement.replaceChild(b,g);c.push(b)}d.addElementsToAdd(c);e.addElementsToRemove(c);this.activeDoc.deselectAllElements();this.activeDoc.selectElementList(c);
this.activeDoc.createInteractionFromSelection();this.activeDoc.onChange()};
_.onClick_boolean=function(a){var b=a.target.getAttribute("data-action");a=this.appRef.editor2D.activeDocument;var c=a.getFilteredElementListByNodeName(a.selectionList,"path");if(!(2>c.length)&&(c=a.sortElementListByIndexZ(c))){var d={};paper.install(d);paper.setup([640,480]);var e=[];e.push(c[0]);var f=d.project.importSVG(c[0]),g=c[0].parentNode,k;var l=c.length;for(k=1;k<l;k++){var h=d.project.importSVG(c[k]);switch(b){case "unite":var m=f.unite(h);break;case "intersect":m=f.intersect(h);break;
case "subtract":m=f.subtract(h);break;case "exclude":m=f.exclude(h);break;case "divide":m=f.divide(h)}console.log(m);e.push(c[k]);if(m instanceof paper.Group)break;else f=m}console.log("usedPathList",e);m=m.exportSVG();if("g"==m.nodeName)for(b=m.querySelectorAll("path"),k=0;k<b.length;k++)b[k].getPathData({normalize:!0});else m.getPathData({normalize:!0});k=new ReplaceElements_action(a);b=new ReplaceElements_action(a);a.history.addUndoRedoActions(b,k);k.addElementsToRemove(e);b.addElementsToAdd(e);
a.removeElementList(e);g.appendChild(m);k.addElementsToAdd([m]);b.addElementsToRemove([m]);a.deselectAllElements();a.selectElementList([m]);a.createInteractionFromSelection();a.onChange()}};function Group2D_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents()}_=Group2D_contentPanel.prototype;_.update=function(){this.parentElement.parentElement.setTitle(LOCALIZER.translate("Group"));this.activeDoc=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDoc.currentEditableElement};
_.onClick_ungroup=function(a){a=this.activeDoc.getFilteredElementListByNodeName(this.activeDoc.selectionList,"g");this.appRef.editor2D.activeDocument.ungroupElementList_undable(a)};_.onClick_editGroup=function(a){this.activeDoc.enterTo_isolateLayerEditing(this.editableElement)};function ClipPath2D_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents()}_=ClipPath2D_contentPanel.prototype;
_.update=function(){this.parentElement.parentElement.setTitle(LOCALIZER.translate("Clip Path"));this.activeDoc=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDoc.currentEditableElement};
_.onClick_removeClipPath=function(a){console.log("onClick_removeClipPath",this.editableElement);a=this.editableElement.cloneNode(!0);a.querySelector("clipPath").remove();a.removeAttribute("clip-path");var b=new ReplaceElements_action(this.activeDoc),c=new ReplaceElements_action(this.activeDoc);this.activeDoc.history.addUndoRedoActions(c,b);b.addElementsToRemove([this.editableElement]);c.addElementsToAdd([this.editableElement]);this.editableElement.parentNode.replaceChild(a,this.editableElement);b.addElementsToAdd([a]);
c.addElementsToRemove([a])};_.onClick_editClipPath=function(a){this.activeDoc.enterTo_isolateLayerEditing(this.editableElement)};function Mask2D_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents()}_=Mask2D_contentPanel.prototype;_.update=function(){this.parentElement.parentElement.setTitle(LOCALIZER.translate("Mask"));this.activeDoc=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDoc.currentEditableElement};
_.onClick_removeMask=function(a){console.log("onClick_removeMask",this.editableElement);a=this.editableElement.cloneNode(!0);a.querySelector("mask").remove();a.removeAttribute("mask");var b=new ReplaceElements_action(this.activeDoc),c=new ReplaceElements_action(this.activeDoc);this.activeDoc.history.addUndoRedoActions(c,b);b.addElementsToRemove([this.editableElement]);c.addElementsToAdd([this.editableElement]);this.editableElement.parentNode.replaceChild(a,this.editableElement);b.addElementsToAdd([a]);
c.addElementsToRemove([a])};_.onClick_editMask=function(a){this.activeDoc.enterTo_isolateLayerEditing(this.editableElement)};function IFrameInForeignObject_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents()}_=IFrameInForeignObject_contentPanel.prototype;
_.update=function(){this.parentElement.parentElement.setTitle(LOCALIZER.translate("iFrame"));this.activeDoc=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDoc.currentEditableElement;this.inOutElements.iframeSource.value=this.editableElement.querySelector("iframe").getAttribute("src")};
_.onChange_iframeSource=function(a){a=a.target.value;-1<a.indexOf("<iframe")&&-1<a.indexOf('src="')&&(a=a.split('src="')[1].split('"')[0]);this.editableElement.querySelector("iframe").setAttribute("src",a)};Extends(ToolsProperties2D_panel,Panel);function ToolsProperties2D_panel(a){ToolsProperties2D_panel.superConstructor.call(this,a)}_=ToolsProperties2D_panel.prototype;_.update=function(){var a=this.querySelector('.content > [data-inspector-element="brush"]');a&&(ShowElement(a),a.update())};
function BrushTool2D_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents()}_=BrushTool2D_contentPanel.prototype;
_.update=function(){this.parentElement.parentElement.setTitle("Brush");this.activeDoc=this.appRef.editor2D.activeDocument;this.editableElement=this.activeDoc.currentEditableElement;this.brushSymbolDisplay=this.querySelector("svg");this.brushSymbolDisplay.removeChildren();var a=SVGElement.svgUtils.createUse(this.activeDoc.defaultDrawingProperties.brush["brush-symbol-id"],100,50,1,0);this.brushSymbolDisplay.appendChild(a)};
_.onInputRange_brushSize=function(a){a=a.target;a.isDragAction||(a.isDragAction=!0);this.brushEllipse.setAttribute("rx",a.value);this.brushEllipse.setAttribute("ry",a.value)};_.onInputRange_brushBlur=function(a){a=a.target;a.isDragAction||(a.isDragAction=!0);this.startColor.setAttribute("stop-opacity",a.value/100);100==a.value?this.endColor.setAttribute("stop-opacity","1"):this.endColor.setAttribute("stop-opacity","0")};
function ShadowFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents();this.filter=null}_=ShadowFilter_contentPanel.prototype;
_.update=function(a){this.parentElement.parentElement.setTitle("Filter: Shadow");this.activeDoc=this.appRef.editor2D.activeDocument;this.filter=a;a=this.filter.querySelector("feColorMatrix").getAttribute("values").split(" ");a=this.appRef.COLOR_PICKER.colorValuesToHtmlStringRGBA(parseFloat(a[0]),parseFloat(a[6]),parseFloat(a[12]),parseFloat(a[18]));this.appRef.editor2D.updateGraphicPropertyButton(this.inOutElements.shadowColor,a);a=this.filter.querySelector("feOffset");this.inOutElements.shadowOffsetX.value=
this.inOutElements.shadowOffsetXSlider.value=parseInt(a.getAttribute("dx"));this.inOutElements.shadowOffsetY.value=this.inOutElements.shadowOffsetYSlider.value=parseInt(a.getAttribute("dy"));a=this.filter.querySelector("feGaussianBlur");this.inOutElements.shadowBlur.value=this.inOutElements.shadowBlurSlider.value=parseInt(a.getAttribute("stdDeviation"))};
_.onClick_editShadowColor=function(a){var b=this.appRef.editor2D.activeDocument,c=this.filter.querySelector("feColorMatrix"),d,e,f=a.target.getGlobalPosition();f.x+=30;this.appRef.COLOR_PICKER.showAndSet(f,a.target.style.backgroundColor,null,function(a){a.rgb.a=a.alpha;b.setAttributeOfElementList([c],"values",a.rgb.r+" 0 0 0 0 0 "+a.rgb.g+" 0 0 0 0 0 "+a.rgb.b+" 0 0 0 0 0 "+a.rgb.a+" 0")},function(){d=new SetAttributes_action(b);d.updateDocumentSelection=!1;d.addElements([c],"values")},function(f){e=
new SetAttributes_action(b);e.updateDocumentSelection=!1;e.addElements([c],"values");b.history.addUndoRedoActions(d,e);a.target.style.backgroundColor=f.currentColorAsHtmlStringRGBA()})};_.onChange_shadowOffsetX=function(a){a=a.target.value;var b=this.filter.querySelector("feOffset");a=this.activeDoc.setAttributeElementList_undable([b],"dx",a);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_shadowOffsetX=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feOffset");if(!c.isDragAction){a=new SetAttributes_action(b);var e=new SetAttributes_action(b);a.updateDocumentSelection=!1;e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"dx");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"dx");c.isDragAction=!1}}this.inOutElements.shadowOffsetX.value=c.value;b.setAttributeOfElementList([d],"dx",
c.value)};_.onChange_shadowOffsetY=function(a){a=a.target.value;var b=this.filter.querySelector("feOffset");a=this.activeDoc.setAttributeElementList_undable([b],"dy",a);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_shadowOffsetY=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feOffset");if(!c.isDragAction){a=new SetAttributes_action(b);var e=new SetAttributes_action(b);a.updateDocumentSelection=!1;e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"dy");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"dy");c.isDragAction=!1}}this.inOutElements.shadowOffsetY.value=c.value;b.setAttributeOfElementList([d],"dy",
c.value)};_.onChange_shadowBlur=function(a){a=a.target.value;var b=this.filter.querySelector("feGaussianBlur");a=this.activeDoc.setAttributeElementList_undable([b],"stdDeviation",a);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_shadowBlur=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feGaussianBlur");if(!c.isDragAction){a=new SetAttributes_action(b);var e=new SetAttributes_action(b);a.updateDocumentSelection=!1;e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"stdDeviation");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"stdDeviation");c.isDragAction=!1}}this.inOutElements.shadowBlur.value=c.value;b.setAttributeOfElementList([d],
"stdDeviation",c.value)};_.onClick_removeFilter=function(a){this.activeDoc.setAttributeElementList_undable([this.appRef.editor2D.activeDocument.currentEditableElement],"filter","")};function BlurFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents();this.filter=null}_=BlurFilter_contentPanel.prototype;
_.update=function(a){this.parentElement.parentElement.setTitle("Filter: Blur");this.activeDoc=this.appRef.editor2D.activeDocument;this.filter=a;a=this.filter.querySelector("feGaussianBlur").getAttribute("stdDeviation").split(" ");this.inOutElements.blurDeviationX.value=this.inOutElements.blurDeviationXSlider.value=parseInt(a[0]);this.inOutElements.blurDeviationY.value=this.inOutElements.blurDeviationYSlider.value=parseInt(a[1])};
_.onChange_blurDeviationX=function(a){a=a.target.value;var b=this.filter.querySelector("feGaussianBlur"),c=b.getAttribute("stdDeviation").split(" ");a=this.activeDoc.setAttributeElementList_undable([b],"stdDeviation",a+" "+c[1]);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_blurDeviationX=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feGaussianBlur");a=d.getAttribute("stdDeviation").split(" ");if(!c.isDragAction){var e=new SetAttributes_action(b),f=new SetAttributes_action(b);e.updateDocumentSelection=!1;f.updateDocumentSelection=!1;b.history.addUndoRedoActions(e,f);e.addElements([d],"stdDeviation");c.isDragAction=!0;c.onchange=function(a){f.addElements([d],"stdDeviation");c.isDragAction=!1}}this.inOutElements.blurDeviationX.value=
c.value;b.setAttributeOfElementList([d],"stdDeviation",c.value+" "+a[1])};_.onChange_blurDeviationY=function(a){a=a.target.value;var b=this.filter.querySelector("feGaussianBlur"),c=b.getAttribute("stdDeviation").split(" ");a=this.activeDoc.setAttributeElementList_undable([b],"stdDeviation",c[0]+" "+a);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_blurDeviationY=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feGaussianBlur");a=d.getAttribute("stdDeviation").split(" ");if(!c.isDragAction){var e=new SetAttributes_action(b),f=new SetAttributes_action(b);e.updateDocumentSelection=!1;f.updateDocumentSelection=!1;b.history.addUndoRedoActions(e,f);e.addElements([d],"stdDeviation");c.isDragAction=!0;c.onchange=function(a){f.addElements([d],"stdDeviation");c.isDragAction=!1}}this.inOutElements.blurDeviationY.value=
c.value;b.setAttributeOfElementList([d],"stdDeviation",+a[0]+" "+c.value)};_.onClick_removeFilter=function(a){this.activeDoc.setAttributeElementList_undable([this.appRef.editor2D.activeDocument.currentEditableElement],"filter","")};
function BevelFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.filter=null;this.createNumericAttributeEventListeners("shadowBlur","feGaussianBlur","stdDeviation");this.createNumericAttributeEventListeners("specularConstant","feSpecularLighting","specularConstant");this.createNumericAttributeEventListeners("specularExponent","feSpecularLighting","specularExponent");this.inOutElements=this.connectEvents()}_=BevelFilter_contentPanel.prototype;
_.update=function(a){this.parentElement.parentElement.setTitle("Filter: Bevel");this.activeDoc=this.appRef.editor2D.activeDocument;this.filter=a;for(var b in this.inOutElements)if(this["onUpdate_"+b])this["onUpdate_"+b]();a=this.filter.querySelector("feSpecularLighting");this.appRef.editor2D.updateGraphicPropertyButton(this.inOutElements.lightingColor,a.getAttribute("lighting-color"))};
_.createNumericAttributeEventListeners=function(a,b,c){this["onUpdate_"+a]=function(){var d=this.filter.querySelector(b);this.inOutElements[a+"_slider"].value=this.inOutElements[a].value=parseFloat(d.getAttribute(c))};this["onChange_"+a]=function(a){var d=this.filter.querySelector(b);a=this.activeDoc.setAttributeElementList_undable([d],c,a.target.value);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};this["onInputRange_"+a]=function(d){var e=d.target,f=this.filter.querySelector(b);
if(!e.isDragAction){d=new SetAttributes_action(this.activeDoc);var g=new SetAttributes_action(this.activeDoc);d.updateDocumentSelection=g.updateDocumentSelection=!1;this.activeDoc.history.addUndoRedoActions(d,g);d.addElements([f],c);e.isDragAction=!0;e.onchange=function(a){g.addElements([f],c);e.isDragAction=!1}}this.inOutElements[a].value=e.value;this.activeDoc.setAttributeOfElementList([f],c,e.value)}};
_.onClick_lightingColor=function(a){var b=this.appRef.editor2D.activeDocument,c=this.filter.querySelector("feSpecularLighting"),d,e,f=a.target.getGlobalPosition();f.x-=170;this.appRef.COLOR_PICKER.showAndSet(f,a.target.style.backgroundColor,1,function(a){b.setAttributeOfElementList([c],"lighting-color",a.currentColorAsHtmlStringRGBA())},function(){d=new SetAttributes_action(b);d.addElements([c],"lighting-color")},function(f){e=new SetAttributes_action(b);e.addElements([c],"lighting-color");b.history.addUndoRedoActions(d,
e);a.target.style.backgroundColor=f.currentColorAsHtmlStringRGBA()})};_.onClick_removeFilter=function(a){this.activeDoc.setAttributeElementList_undable([this.appRef.editor2D.activeDocument.currentEditableElement],"filter","")};function ContrastBrightnessFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.filter=null;this.inOutElements=this.connectEvents()}_=ContrastBrightnessFilter_contentPanel.prototype;
_.update=function(a){this.parentElement.parentElement.setTitle("Filter: Contrast");this.activeDoc=this.appRef.editor2D.activeDocument;this.filter=a;a=this.filter.querySelector("feFuncR");this.inOutElements.contrast.value=this.inOutElements.contrast_slider.value=parseFloat(a.getAttribute("slope"));this.inOutElements.brightness.value=this.inOutElements.brightness_slider.value=parseFloat(a.getAttribute("intercept"))};
_.onChange_contrast=function(a){var b=this.filter.querySelector("feFuncR"),c=this.filter.querySelector("feFuncG"),d=this.filter.querySelector("feFuncB");a=this.activeDoc.setAttributeElementList_undable([b,c,d],"slope",a.target.value);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_contrast=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feFuncR"),e=this.filter.querySelector("feFuncG"),f=this.filter.querySelector("feFuncB");if(!c.isDragAction){a=new SetAttributes_action(b);var g=new SetAttributes_action(b);a.updateDocumentSelection=!1;g.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,g);a.addElements([d,e,f],"slope");c.isDragAction=!0;c.onchange=function(a){g.addElements([d,e,f],"slope");c.isDragAction=!1}}this.inOutElements.contrast.value=
c.value;b.setAttributeOfElementList([d,e,f],"slope",c.value)};_.onChange_brightness=function(a){var b=this.filter.querySelector("feFuncR"),c=this.filter.querySelector("feFuncG"),d=this.filter.querySelector("feFuncB");a=this.activeDoc.setAttributeElementList_undable([b,c,d],"intercept",a.target.value);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_brightness=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feFuncR"),e=this.filter.querySelector("feFuncG"),f=this.filter.querySelector("feFuncB");if(!c.isDragAction){a=new SetAttributes_action(b);var g=new SetAttributes_action(b);a.updateDocumentSelection=!1;g.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,g);a.addElements([d,e,f],"intercept");c.isDragAction=!0;c.onchange=function(a){g.addElements([d,e,f],"intercept");c.isDragAction=
!1}}this.inOutElements.brightness.value=c.value;b.setAttributeOfElementList([d,e,f],"intercept",c.value)};_.onClick_removeFilter=function(a){this.activeDoc.setAttributeElementList_undable([this.appRef.editor2D.activeDocument.currentEditableElement],"filter","")};function RGBFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents();this.filter=null}_=RGBFilter_contentPanel.prototype;
_.update=function(a){this.parentElement.parentElement.setTitle("Filter: RGB");this.activeDoc=this.appRef.editor2D.activeDocument;this.filter=a;this.colorMatrix=this.filter.querySelector("feColorMatrix").getAttribute("values").split(" ");this.inOutElements.red.value=this.inOutElements.red_slider.value=parseFloat(this.colorMatrix[0]);this.inOutElements.green.value=this.inOutElements.green_slider.value=parseFloat(this.colorMatrix[6]);this.inOutElements.blue.value=this.inOutElements.blue_slider.value=
parseFloat(this.colorMatrix[12])};_.onChange_red=function(a){this.colorMatrix[0]=a.target.value;a=this.activeDoc.setAttributeElementList_undable([this.filter.querySelector("feColorMatrix")],"values",this.colorMatrix.join(" "));a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_red=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feColorMatrix");if(!c.isDragAction){a=new SetAttributes_action(b);var e=new SetAttributes_action(b);a.updateDocumentSelection=!1;e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"values");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"values");c.isDragAction=!1}}this.colorMatrix[0]=this.inOutElements.red.value=c.value;b.setAttributeOfElementList([d],
"values",this.colorMatrix.join(" "))};_.onChange_green=function(a){this.colorMatrix[6]=a.target.value;a=this.activeDoc.setAttributeElementList_undable([this.filter.querySelector("feColorMatrix")],"values",this.colorMatrix.join(" "));a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_green=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feColorMatrix");if(!c.isDragAction){a=new SetAttributes_action(b);var e=new SetAttributes_action(b);a.updateDocumentSelection=!1;e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"values");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"values");c.isDragAction=!1}}this.colorMatrix[6]=this.inOutElements.green.value=c.value;b.setAttributeOfElementList([d],
"values",this.colorMatrix.join(" "))};_.onChange_blue=function(a){this.colorMatrix[12]=a.target.value;a=this.activeDoc.setAttributeElementList_undable([this.filter.querySelector("feColorMatrix")],"values",this.colorMatrix.join(" "));a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_blue=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feColorMatrix");if(!c.isDragAction){a=new SetAttributes_action(b);var e=new SetAttributes_action(b);a.updateDocumentSelection=!1;e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"values");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"values");c.isDragAction=!1}}this.colorMatrix[12]=this.inOutElements.blue.value=c.value;b.setAttributeOfElementList([d],
"values",this.colorMatrix.join(" "))};_.onClick_removeFilter=function(a){this.activeDoc.setAttributeElementList_undable([this.appRef.editor2D.activeDocument.currentEditableElement],"filter","")};function SaturateFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.filter=null;this.inOutElements=this.connectEvents()}_=SaturateFilter_contentPanel.prototype;
_.update=function(a){this.parentElement.parentElement.setTitle("Filter: Saturate");this.activeDoc=this.appRef.editor2D.activeDocument;this.filter=a;this.inOutElements.saturate.value=this.inOutElements.saturate_slider.value=parseFloat(this.filter.querySelector("feColorMatrix").getAttribute("values"))};
_.onChange_saturate=function(a){var b=this.filter.querySelector("feColorMatrix");a=this.activeDoc.setAttributeElementList_undable([b],"values",a.target.value);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_saturate=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feColorMatrix");if(!c.isDragAction){a=new SetAttributes_action(b);var e=new SetAttributes_action(b);a.updateDocumentSelection=!1;e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"values");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"values");c.isDragAction=!1}}this.inOutElements.saturate.value=c.value;b.setAttributeOfElementList([d],"values",
c.value)};_.onClick_removeFilter=function(a){this.activeDoc.setAttributeElementList_undable([this.appRef.editor2D.activeDocument.currentEditableElement],"filter","")};function HueRotateFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.filter=null;this.inOutElements=this.connectEvents()}_=HueRotateFilter_contentPanel.prototype;
_.update=function(a){this.parentElement.parentElement.setTitle("Filter: HUE rotate");this.activeDoc=this.appRef.editor2D.activeDocument;this.filter=a;this.inOutElements.hueRotate.value=this.inOutElements.hueRotate_slider.value=parseFloat(this.filter.querySelector("feColorMatrix").getAttribute("values"))};
_.onChange_hueRotate=function(a){var b=this.filter.querySelector("feColorMatrix");a=this.activeDoc.setAttributeElementList_undable([b],"values",a.target.value);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_hueRotate=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feColorMatrix");if(!c.isDragAction){a=new SetAttributes_action(b);var e=new SetAttributes_action(b);a.updateDocumentSelection=!1;e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"values");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"values");c.isDragAction=!1}}this.inOutElements.hueRotate.value=c.value;b.setAttributeOfElementList([d],
"values",c.value)};_.onClick_removeFilter=function(a){this.activeDoc.setAttributeElementList_undable([this.appRef.editor2D.activeDocument.currentEditableElement],"filter","")};function BrushFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents();this.filter=null}_=BrushFilter_contentPanel.prototype;
_.update=function(a){this.parentElement.parentElement.setTitle("Filter: BrushFilter");this.activeDoc=this.appRef.editor2D.activeDocument;this.filter=a;a=this.filter.querySelector("feTurbulence");this.inOutElements.baseFrequency.value=this.inOutElements.baseFrequency_slider.value=parseFloat(a.getAttribute("baseFrequency"));this.inOutElements.numOctaves.value=this.inOutElements.numOctaves_slider.value=parseFloat(a.getAttribute("numOctaves"));a=this.filter.querySelector("feDisplacementMap");this.inOutElements.displacementMapScale.value=
this.inOutElements.displacementMapScale_slider.value=parseFloat(a.getAttribute("scale"))};_.onChange_baseFrequency=function(a){a=a.target.value;var b=this.filter.querySelector("feTurbulence");a=this.activeDoc.setAttributeElementList_undable([b],"baseFrequency",a);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_baseFrequency=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feTurbulence");if(!c.isDragAction){a=new SetAttributes_action(b);var e=new SetAttributes_action(b);a.updateDocumentSelection=e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"baseFrequency");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"baseFrequency");c.isDragAction=!1}}this.inOutElements.baseFrequency.value=c.value;b.setAttributeOfElementList([d],
"baseFrequency",c.value)};_.onChange_numOctaves=function(a){a=a.target.value;var b=this.filter.querySelector("feTurbulence");a=this.activeDoc.setAttributeElementList_undable([b],"numOctaves",a);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_numOctaves=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feTurbulence");if(!c.isDragAction){a=new SetAttributes_action(b);var e=new SetAttributes_action(b);a.updateDocumentSelection=e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"numOctaves");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"numOctaves");c.isDragAction=!1}}this.inOutElements.numOctaves.value=c.value;b.setAttributeOfElementList([d],
"numOctaves",c.value)};_.onChange_displacementMapScale=function(a){a=a.target.value;var b=this.filter.querySelector("feDisplacementMap");a=this.activeDoc.setAttributeElementList_undable([b],"scale",a);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_displacementMapScale=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feDisplacementMap");if(!c.isDragAction){a=new SetAttributes_action(b);var e=new SetAttributes_action(b);a.updateDocumentSelection=e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"scale");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"scale");c.isDragAction=!1}}this.inOutElements.displacementMapScale.value=c.value;b.setAttributeOfElementList([d],
"scale",c.value)};_.onClick_removeFilter=function(a){this.activeDoc.setAttributeElementList_undable([this.appRef.editor2D.activeDocument.currentEditableElement],"filter","")};function FancyGooFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents();this.filter=null}_=FancyGooFilter_contentPanel.prototype;
_.update=function(a){this.parentElement.parentElement.setTitle("Filter: FancyGoo");this.activeDoc=this.appRef.editor2D.activeDocument;this.filter=a;this.colorMatrix=this.filter.querySelector("feColorMatrix").getAttribute("values").split(" ");this.inOutElements.matrixAlpha.value=this.colorMatrix[18];a=this.filter.querySelector("feGaussianBlur");this.inOutElements.blurDeviation.value=this.inOutElements.blurDeviation_slider.value=parseInt(a.getAttribute("stdDeviation"))};
_.onChange_matrixAlpha=function(a){this.colorMatrix[18]=a.target.value;a=this.activeDoc.setAttributeElementList_undable([this.filter.querySelector("feColorMatrix")],"values",this.colorMatrix.join(" "));a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_matrixAlpha=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feColorMatrix");if(!c.isDragAction){a=new SetAttributes_action(b);var e=new SetAttributes_action(b);a.updateDocumentSelection=!1;e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"values");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"values");c.isDragAction=!1}}this.colorMatrix[18]=this.inOutElements.matrixAlpha.value=c.value;b.setAttributeOfElementList([d],
"values",this.colorMatrix.join(" "))};_.onChange_blurDeviation=function(a){this.filter.querySelector("feGaussianBlur");a=this.activeDoc.setAttributeElementList_undable([this.filter.querySelector("feGaussianBlur")],"stdDeviation",a.target.value);a.undoAction.updateDocumentSelection=a.redoAction.updateDocumentSelection=!1};
_.onInputRange_blurDeviation=function(a){var b=this.appRef.editor2D.activeDocument,c=a.target,d=this.filter.querySelector("feGaussianBlur");if(!c.isDragAction){a=new SetAttributes_action(b);var e=new SetAttributes_action(b);a.updateDocumentSelection=!1;e.updateDocumentSelection=!1;b.history.addUndoRedoActions(a,e);a.addElements([d],"stdDeviation");c.isDragAction=!0;c.onchange=function(a){e.addElements([d],"stdDeviation");c.isDragAction=!1}}this.inOutElements.blurDeviation.value=c.value;b.setAttributeOfElementList([d],
"stdDeviation",c.value)};_.onClick_removeFilter=function(a){this.activeDoc.setAttributeElementList_undable([this.appRef.editor2D.activeDocument.currentEditableElement],"filter","")};function UnknowedFilter_contentPanel(a){a.appRef&&(this.appRef=a.appRef);this.inOutElements=this.connectEvents();this.filter=null}_=UnknowedFilter_contentPanel.prototype;
_.update=function(a){this.parentElement.parentElement.setTitle("Filter: "+a.getAttribute("id"));this.activeDoc=this.appRef.editor2D.activeDocument;this.filter=a};_.onClick_removeFilter=function(a){this.activeDoc.setAttributeElementList_undable([this.appRef.editor2D.activeDocument.currentEditableElement],"filter","")};function PageTemplateLibrary2D_contentPanel(a){this.appRef=a.appRef;document.querySelector("#PAGE_TEMPLATE_LIBRARY").connectEvents(this)}_=PageTemplateLibrary2D_contentPanel.prototype;
_.onShow=function(a){0==this.querySelector(".library-display").childNodes.length&&this.update()};_.onChange_selectLibraryItems=function(a){this.update()};_.update=function(a){a=this.querySelector("select");a=a.options[a.selectedIndex];a.hasAttribute("data-url")&&this.loadLibrary(a.getAttribute("data-url"))};_.loadLibrary=function(a){var b=this.querySelector(".library-display"),c=this;window.onLoadTemplateList=function(a){c.drawItemList(b,a)};IncludeJS(a)};
_.drawItemList=function(a,b){a.removeChildren();for(var c,d,e=0;e<b.length;e++)c=document.createElement("li"),c.data=b[e],d=document.createElement("img"),c.appendChild(d),d.setAttribute("src",b[e].thumbnail),a.appendChild(c)};_.onClick_itemList=function(a){"UL"!=a.target.nodeName&&SelectElement(a.target)};
_.onDoubleClick_itemList=function(a){var b=this;a=a.target;console.log(a);SendAndLoad(a.data.templateUrl,"GET",null,function(a){console.log("onLoadTemplate",a);b.appRef.createDocument(null,a.target.responseText,{parsePageSettings:!0,renameReferences:!0})},function(a){b.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("An error occured during loading file")+": "+_file.name)},function(a){console.log("loading total: "+a.total+"   loaded: "+a.loaded);PROGRESS_PANEL.setProgressValues(a.total,
a.loaded)})};Extends(FontLibrary2D_panel,Panel);
function FontLibrary2D_panel(a){FontLibrary2D_panel.superConstructor.call(this,a);this.inOutElements=this.connectEvents();this.fontListContainer=this.querySelector("ul");var b=this;IncludeJS("/data/janvas_v1/fonts/google-font-families.js");window.onLoadGoogleFontFamilies=function(a){var c={},e=a.items,f,g=e.length;for(f=0;f<g;f++)a=e[f],c[a.category]||(c[a.category]=[]),c[a.category].push(a);b.fontCategories=c;b.popolateCategoriesMenu();console.log("self.fontCategories",b.fontCategories)}}_=FontLibrary2D_panel.prototype;
_.popolateCategoriesMenu=function(){var a;for(a in this.fontCategories){var b=document.createElement("option");b.appendChild(document.createTextNode(a));b.setAttribute("value",a);this.inOutElements.selectLibrary.appendChild(b)}};
_.popolateFontList=function(){this.fontListContainer.removeChildren();var a=this.fontCategories[this.inOutElements.selectLibrary.options[this.inOutElements.selectLibrary.selectedIndex].value],b,c=a.length;for(b=0;b<c;b++){var d=a[b];var e=document.createElement("li");var f=document.createElement("a");f.appendChild(document.createTextNode(d.family));e.appendChild(f);f=document.createElement("img");f.setAttribute("src","/data/janvas_v1/fonts/_previews/"+d.family.replace(/ /g,"-")+".png");e.appendChild(f);
e.data=d;this.fontListContainer.appendChild(e)}};_.getFontObjectByFamilyName=function(a){for(var b in this.fontCategories){var c=this.fontCategories[b],d,e=c.length;for(d=0;d<e;d++)if(c[d].family==a)return c[d]}return null};_.onOpen=function(){};_.onExpand=function(){""==this.fontListContainer.innerHTML&&this.popolateFontList()};_.onChange_selectLibrary=function(a){this.popolateFontList()};
_.onClick_fonts=function(a){if("UL"!=a.target.nodeName){a.target.querySelector("a");var b=this.appRef.editor2D.activeDocument,c=b.getFilteredElementListByNodeName(b.selectionList,"text");b.setFontFamilyElementList(c,a.target.data)}};Extends(StrokeDashLibrary2D_panel,Panel);function StrokeDashLibrary2D_panel(a){StrokeDashLibrary2D_panel.superConstructor.call(this,a);this.inOutElements=this.connectEvents();this.activeList=this.querySelector("ul")}_=StrokeDashLibrary2D_panel.prototype;
_.onClick_dashList=function(a){if("UL"!=a.target.nodeName){a=a.target.querySelector("line").getAttribute("stroke-dasharray");var b=this.appRef.editor2D.activeDocument;b.setAttributeElementList_undable(b.selectionList,"stroke-dasharray",a);b.defaultDrawingProperties["stroke-dasharray"]=a;b.showSelectionProperties()}};function MarkerLibrary2D_contentPanel(a){this.appRef=a.appRef;this.querySelector(".tabs").connectEvents(this);this.querySelector(".views").connectEvents(this)}_=MarkerLibrary2D_contentPanel.prototype;
_.onShow=function(a){0==this.querySelector(".library-display").childNodes.length&&this.update()};_.onClick_library=function(a){SelectElement(a.target);ShowElement(this.querySelector(".views #library"));this.update()};_.onClick_document=function(a){SelectElement(a.target);ShowElement(this.querySelector(".views #document"));this.update()};_.onChange_selectLibraryItems=function(a){this.update()};_.onChange_selectDocumentItems=function(a){};
_.update=function(a){a=a||this.querySelector(".views .showed");var b=a.getAttribute("id");a=a.querySelector(".library-display");"library"==b?(this.querySelector("#library select"),""==a.innerHTML&&this.drawItemList(a,document.querySelectorAll("#SVG_GLOBAL_DEFS_MARKERS marker:not(.jvs-private)"))):"document"==b&&this.drawItemList(a,this.appRef.editor2D.activeDocument.querySelectorAll("defs marker"))};
_.drawItemList=function(a,b){for(var c="",d=0,e=b.length;d<e;d++)c+='<li><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><line x1="50%" y1="50%" x2="51%" y2="50%" stroke="#000000" fill="none" stroke-width="2" marker-start="url(#'+b[d].getAttribute("id")+')"></line></svg></li>';a.innerHTML=c};
_.onClick_itemList=function(a){if("UL"!=a.target.nodeName){var b=this.appRef.editor2D.activeDocument,c=b.getFilteredElementListByNodeName(b.selectionList,"line,polygon,path");if(0==c.length)this.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Selection required"),LOCALIZER.translate("You must select: paths,lines or polyline to apply the marker."));else{a=a.target.querySelector("[marker-start]").getAttribute("marker-start");var d=SVGElement.svgUtils.getElementFromDocumentByIRI(a);"SVG_GLOBAL_DEFS_MARKERS"==
d.parentElement.parentElement.getAttribute("id")&&(d=d.cloneNode(!0),a=b.addElementToDefs(d));b.setAttributeElementList_undable(c,this.appRef.editor2D.MARKERS_PANEL.activeMarkerTargetName,a);b.showSelectionProperties()}}};
_.onClick_new=function(a){1!=this.appRef.editor2D.activeDocument.selectionList.length||"g"!=this.appRef.editor2D.activeDocument.selectionList[0].nodeName?this.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Selection required"),LOCALIZER.translate("You must select a single group to create a new Marker")):(a=SVGElement.svgUtils.createMarker(this.appRef.editor2D.activeDocument.selectionList[0]),this.appRef.editor2D.activeDocument.addElementToDefs(a),this.update(),console.log("newMarker",a))};
function PatternLibrary2D_contentPanel(a){this.appRef=a.appRef;this.querySelector(".tabs").connectEvents(this);this.querySelector(".views").connectEvents(this)}_=PatternLibrary2D_contentPanel.prototype;_.onShow=function(a){0==this.querySelector(".library-display").childNodes.length&&this.update()};_.onClick_library=function(a){SelectElement(a.target);ShowElement(this.querySelector(".views #library"));this.update()};
_.onClick_document=function(a){SelectElement(a.target);ShowElement(this.querySelector(".views #document"));this.update()};_.onChange_selectLibraryItems=function(a){this.update()};_.onChange_selectDocumentItems=function(a){};
_.update=function(a){a=a||this.querySelector(".views .showed");var b=a.getAttribute("id");a=a.querySelector(".library-display");"library"==b?(b=this.querySelector("#library select"),b=b.options[b.selectedIndex],b.hasAttribute("data-url")?this.loadLibrary(b.getAttribute("data-url")):this.drawItemList(a,document.querySelectorAll("#SVG_GLOBAL_DEFS_PATTERNS pattern:not(.jvs-private)"))):"document"==b&&this.drawItemList(a,this.appRef.editor2D.activeDocument.querySelectorAll("defs pattern"))};
_.loadLibrary=function(a){var b=this.querySelector(".views .showed .library-display");b.innerHTML='<div class="contentLoadingProgress" ></div>';var c=this;window.onLoadPatternLibrary=function(a){c.drawItemListFromImageList(b,a.split(","))};IncludeJS(a)};
_.drawItemList=function(a,b){for(var c="",d=0,e=b.length;d<e;d++)c+='<li><svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><rect x="0" y="0" width="100%" height="100%" fill="url(#'+b[d].getAttribute("id")+')"/></svg></li>';a.innerHTML=c};_.drawItemListFromImageList=function(a,b){for(var c=0;c<b.length;c++)b[c]='<li class="pattern-image" style="background-image:url(\'/data/janvas_v1/patterns/subtlepatterns/'+b[c]+"')\"></li>";a.innerHTML=b.join("")};
_.onClick_itemList=function(a){if("UL"!=a.target.nodeName){var b=this.appRef.editor2D.activeDocument;if(0==b.selectionList.length)this.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Selection required"),LOCALIZER.translate("You must select an element to apply the pattern."));else if(a.target.classList.contains("pattern-image")){a=a.target.style.backgroundImage.split('("')[1].split('")')[0];var c=new Image;c.onload=function(){var a=b.createSVGPatternFromImage(this);b.setElementListPattern_undable(b.selectionList,
b.editableGraphicSide,a);b.showSelectionProperties()};c.src=a}else a=a.target.querySelector("svg rect").getAttribute("fill"),c=SVGElement.svgUtils.getElementFromDocumentByIRI(a),"SVG_GLOBAL_DEFS_PATTERNS"==c.parentElement.parentElement.getAttribute("id")&&(c=c.cloneNode(!0),a=b.addElementToDefs(c)),b.setAttributeElementList_undable(b.selectionList,b.editableGraphicSide,a),b.showSelectionProperties()}};
_.onClick_new=function(a){a=this.appRef.editor2D.activeDocument;var b=a.selectionList,c=a.getElementListGlobalBBoxInContentSpace(a.selectionList),d=SVGElement.svgUtils.createGroup(c.min.x,c.min.y);a.activeLayer.appendChild(d);for(var e=0;e<b.length;e++){var f=b[e],g=f.getTransformToElement(d);f=f.cloneNode(!0);d.appendChild(f);f.getTransform().setMatrix(g)}b=SVGElement.svgUtils.createSVGPattern(null,0,0,c.width,c.height);d.getTransform().matrix.identity();b.appendChild(d);a.addElementToDefs(b);this.update()};
function GradientLibrary2D_contentPanel(a){this.appRef=a.appRef;this.querySelector(".tabs").connectEvents(this);this.querySelector(".views").connectEvents(this)}_=GradientLibrary2D_contentPanel.prototype;_.onShow=function(a){0==this.querySelector(".library-display").childNodes.length&&this.update()};_.onClick_library=function(a){SelectElement(a.target);ShowElement(this.querySelector(".views #library"));this.update()};
_.onClick_document=function(a){SelectElement(a.target);ShowElement(this.querySelector(".views #document"));this.update()};_.onChange_selectLibraryItems=function(a){this.update()};_.onChange_selectDocumentItems=function(a){};
_.update=function(a){a=a||this.querySelector(".views .showed");var b=a.getAttribute("id");a=a.querySelector(".library-display");"library"==b?(b=this.querySelector("#library select"),b=b.options[b.selectedIndex],b.hasAttribute("data-url")&&this.loadLibrary(b.getAttribute("data-url"))):"document"==b&&this.drawItemList(a,this.appRef.editor2D.activeDocument.querySelectorAll("defs linearGradient","defs radialGradient"))};
_.loadLibrary=function(a){var b=this.querySelector(".views .showed .library-display");b.innerHTML='<div class="contentLoadingProgress" ></div>';window.onLoadGradientLibrary=function(a){b.innerHTML=a};IncludeJS(a)};_.drawItemList=function(a,b){for(var c="",d=0,e=b.length;d<e;d++)c+='<li style="'+b[d].toHtml()+'"></li>';a.innerHTML=c};
_.onClick_itemList=function(a){if("UL"!=a.target.nodeName){var b=this.appRef.editor2D.activeDocument;0==b.selectionList.length?this.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Selection required"),LOCALIZER.translate("You must select an element to apply the gradient.")):(a=a.target,SelectElement(a),a=b.createSVGGradientFromCSS(a.getAttribute("style")),b.setElementListGradient_undable(b.selectionList,b.editableGraphicSide,a),b.showSelectionProperties())}};
function FilterLibrary2D_contentPanel(a){this.appRef=a.appRef;this.querySelector(".tabs").connectEvents(this);this.querySelector(".views").connectEvents(this)}_=FilterLibrary2D_contentPanel.prototype;_.onShow=function(a){0==this.querySelector(".library-display").childNodes.length&&this.update()};_.onClick_library=function(a){SelectElement(a.target);ShowElement(this.querySelector(".views #library"));this.update()};
_.onClick_document=function(a){SelectElement(a.target);ShowElement(this.querySelector(".views #document"));this.update()};_.onChange_selectLibraryItems=function(a){this.update()};_.onChange_selectDocumentItems=function(a){};
_.update=function(a){a=a||this.querySelector(".views .showed");var b=a.getAttribute("id");a=a.querySelector(".library-display");"library"==b?(b=this.querySelector("#library select"),b=b.options[b.selectedIndex],b.hasAttribute("data-url")?this.loadLibrary(b.getAttribute("data-url")):this.drawItemList(a,document.querySelectorAll("#SVG_GLOBAL_DEFS_FILTERS filter:not(.jvs-private)"))):"document"==b&&this.drawItemList(a,this.appRef.editor2D.activeDocument.querySelectorAll("defs filter"))};
_.loadLibrary=function(a){};
_.drawItemList=function(a,b){a.removeChildren();for(var c,d,e,f=0,g=b.length;f<g;f++)c=b[f],d=c.getAttribute("jvs-preview")||"IMAGE_FILTER_PREVIEW",e=document.querySelector("#TEMPLATES #"+d).cloneNode(!0),e.querySelector("[filter]").setAttribute("filter","url(#"+c.getAttribute("id")+")"),d=document.createElement("li"),d.appendChild(e),e=document.createElement("div"),e.appendChild(document.createTextNode(c.getAttribute("id"))),d.appendChild(e),d.setAttribute("title",c.getAttribute("jvs-controller")),d.data=
c,a.appendChild(d)};
_.onClick_itemList=function(a){if("UL"!=a.target.nodeName){var b=this.appRef.editor2D.activeDocument;0==b.selectionList.length?this.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Selection required"),LOCALIZER.translate("You must select an element to apply the filter.")):(a=a.target.data,"SVG_GLOBAL_DEFS_FILTERS"==a.parentElement.parentElement.getAttribute("id")?(a=a.cloneNode(!0),a=b.addElementToDefs(a)):a="url(#"+a.getAttribute("id")+")",console.log("filterIRI",a),b.setAttributeElementList_undable(b.selectionList,"filter",
a),b.showSelectionProperties())}};function ColorLibrary2D_contentPanel(a){this.appRef=a.appRef;this.querySelector(".tabs").connectEvents(this);this.querySelector(".views").connectEvents(this)}_=ColorLibrary2D_contentPanel.prototype;_.onShow=function(a){0==this.querySelector(".library-display").childNodes.length&&this.update()};_.onClick_library=function(a){SelectElement(a.target);ShowElement(this.querySelector(".views #library"));this.update()};
_.onClick_document=function(a){SelectElement(a.target);ShowElement(this.querySelector(".views #document"));this.update()};_.onChange_selectLibraryItems=function(a){this.update()};_.onChange_selectDocumentItems=function(a){};
_.update=function(a){a=a||this.querySelector(".views .showed");var b=a.getAttribute("id");a=a.querySelector(".library-display");"library"==b?(b=this.querySelector("#library select"),b=b.options[b.selectedIndex],b.hasAttribute("data-url")&&this.loadLibrary(b.getAttribute("data-url"))):"document"==b&&(b={},this.appRef.editor2D.activeDocument.getUsedColorList("fill",b),b=this.appRef.editor2D.activeDocument.getUsedColorList("stroke",b),this.drawItemList(a,b))};
_.loadLibrary=function(a){var b=this.querySelector(".views .showed .library-display"),c=this;window.onLoadColorLibrary=function(a){c.drawItemList(b,a)};IncludeJS(a)};_.drawItemList=function(a,b){a.removeChildren();if(b instanceof Array)for(var c=0;c<b.length;c++){var d=document.createElement("li");d.setAttribute("style","background-color:"+b[c]+";");a.appendChild(d)}else for(c in b)d=document.createElement("li"),d.setAttribute("style","background-color:"+b[c]+";"),a.appendChild(d)};
_.onClick_itemList=function(a){if("UL"!=a.target.nodeName){var b=this.appRef.editor2D.activeDocument;a=a.target;SelectElement(a);a=a.getAttribute("style").split(";")[0].split(":")[1];0==b.selectionList.length?"fill"==b.editableGraphicSide?b.defaultDrawingProperties.fill=a:"stroke"==b.editableGraphicSide&&(b.defaultDrawingProperties.stroke=a):b.setAttributeElementList_undable(b.selectionList,b.editableGraphicSide,a);b.showSelectionProperties()}};
function ComponentLibrary2D_contentPanel(a){this.appRef=a.appRef;this.querySelector(".tabs").connectEvents(this);this.querySelector(".views").connectEvents(this)}_=ComponentLibrary2D_contentPanel.prototype;_.onShow=function(a){0==this.querySelector(".library-display").childNodes.length&&this.update()};_.onClick_library=function(a){SelectElement(a.target);ShowElement(this.querySelector(".views #library"));this.update()};
_.onClick_document=function(a){SelectElement(a.target);ShowElement(this.querySelector(".views #document"));this.update()};_.onChange_selectLibraryItems=function(a){this.update()};_.onChange_selectDocumentItems=function(a){};_.update=function(a){a=a||this.querySelector(".views .showed");var b=a.getAttribute("id");a.querySelector(".library-display");"library"==b&&(a=this.querySelector("#library select"),a=a.options[a.selectedIndex],a.hasAttribute("data-url")&&this.loadLibrary(a.getAttribute("data-url")))};
_.loadLibrary=function(a){var b=this.querySelector(".views .showed .library-display");b.innerHTML='<div class="contentLoadingProgress" ></div>';window.onLoadComponentLibrary=function(a){b.innerHTML=a};IncludeJS(a)};_.onClick_itemList=function(a){"UL"!=a.target.nodeName&&SelectElement(a.target)};function BrushLibrary2D_contentPanel(a){this.appRef=a.appRef;this.querySelector(".tabs").connectEvents(this);this.querySelector(".views").connectEvents(this)}_=BrushLibrary2D_contentPanel.prototype;
_.onShow=function(a){0==this.querySelector(".library-display").childNodes.length&&this.update()};_.onClick_library=function(a){SelectElement(a.target);ShowElement(this.querySelector(".views #library"));this.update()};_.onChange_selectLibraryItems=function(a){this.update()};_.update=function(a){a=a||this.querySelector(".views .showed");"library"==a.getAttribute("id")&&(a=this.querySelector("#library select"),a=a.options[a.selectedIndex],a.hasAttribute("data-url")&&this.loadLibrary(a.getAttribute("data-url")))};
_.loadLibrary=function(a){var b=this.querySelector(".views .showed .library-display");b.innerHTML='<div class="contentLoadingProgress" ></div>';window.onLoadBrushLibrary=function(a){a instanceof Function&&(a=a.toString(),a=a.substring(a.indexOf("/*")+2,a.lastIndexOf("*/")),b.innerHTML=a)};IncludeJS(a)};_.onClick_itemList=function(a){"UL"!=a.target.nodeName&&(this.setActiveBrushMaskImageData(a.target),this.appRef.editor2D.activateTool("drawBrush_tool"))};
_.setActiveBrushMaskImageData=function(a){var b=this.invertImage(a),c=this.appRef.editor2D.activeDocument.querySelector("defs #brush-001-mask image");console.log("_img",a);console.log("imageToUsaAsAlphaChannel",c);console.log("imageData",b);c.setAttributeNS(SVGElement.XLINK_NS,"href",b)};
_.invertImage=function(a){var b=document.createElement("canvas");b.width=a.naturalWidth;b.height=a.naturalHeight;var c=b.getContext("2d");c.imageSmoothingQuality="high";c.imageSmoothingEnabled=!0;c.drawImage(a,0,0);a=c.getImageData(0,0,b.width,b.height);for(var d=a.data,e=0;e<d.length;e+=4)d[e]=255-d[e],d[e+1]=255-d[e+1],d[e+2]=255-d[e+2];c.putImageData(a,0,0);return b.toDataURL("image/jpeg",1)};Extends(Library2D_panel,Panel);
function Library2D_panel(a){Library2D_panel.superConstructor.call(this,a);this.querySelector(".buttonList").connectEvents(this);this.querySelector("#COLOR_LIBRARY").connectController(ColorLibrary2D_contentPanel,a);this.querySelector("#GRADIENT_LIBRARY").connectController(GradientLibrary2D_contentPanel,a);this.querySelector("#PATTERN_LIBRARY").connectController(PatternLibrary2D_contentPanel,a);this.querySelector("#FILTER_LIBRARY").connectController(FilterLibrary2D_contentPanel,a);this.querySelector("#MARKER_LIBRARY").connectController(MarkerLibrary2D_contentPanel,
a);this.querySelector("#PAGE_TEMPLATE_LIBRARY").connectController(PageTemplateLibrary2D_contentPanel,a);ShowElement(this.querySelector(".content #PAGE_TEMPLATE_LIBRARY"))}_=Library2D_panel.prototype;_.onClick_colorLibrary=function(a){SelectElement(a.target);ShowElement(this.querySelector(".content #COLOR_LIBRARY"))};_.onClick_gradientLibrary=function(a){SelectElement(a.target);ShowElement(this.querySelector(".content #GRADIENT_LIBRARY"))};
_.onClick_patternLibrary=function(a){SelectElement(a.target);ShowElement(this.querySelector(".content #PATTERN_LIBRARY"))};_.onClick_filterLibrary=function(a){SelectElement(a.target);ShowElement(this.querySelector(".content #FILTER_LIBRARY"))};_.onClick_markerLibrary=function(a){SelectElement(a.target);ShowElement(this.querySelector(".content #MARKER_LIBRARY"))};_.onClick_brushLibrary=function(a){SelectElement(a.target);ShowElement(this.querySelector(".content #BRUSH_LIBRARY"))};
_.onClick_templateLibrary=function(a){SelectElement(a.target);ShowElement(this.querySelector(".content #PAGE_TEMPLATE_LIBRARY"))};
function Document2D(a){this.appRef=a.appRef;this.fullPath=a.fullPath||"Untitled";this.idFile=null;this.editorRef=this.appRef.editor2D;this.type="DOCUMENT_2D";ConnectEvent("mousedown",this,this.onMouseDown,this);ConnectEvent("mousemove",this,this.onMouseMove,this);ConnectEvent("mouseup",this,this.onMouseUp,this);ConnectEvent("dragover",this,this.onDragOver,this);ConnectEvent("drop",this,this.onDropOver,this);this.content=this.querySelector("#jvs-content");this.workspace=this.querySelector("#jvs-workspace");
this.history=new UndoRedoHistory;this.activeLayer=this.content;this.isChanged=!1;this.inlineContentList={};this.metaTags=[];this.cssLinkTags=[];this.scriptTags=[];this.svgDesc=this.svgTitle="";this.pageAlignment="center-horizontally";this.viewBox=[0,0,2560,2E3];this.units={POINT:1,KILOMETER:3.53E-7,METER:3.52778E-4,CENTIMETER:.035277778,MILLIMETER:.352777778,FOOT:.001157407,INCH:.013888889,YARD:3.85802E-4,MILE:2.19E-7,NAUTICAL_MILE:1.9E-7};this.unitKey="POINT";this.unitValue=this.units[this.unitKey];
this.drawingScale=1;this.fixedDecimals=2;this.useStoredUndoRedoContentView=!1;this.editableGraphicSide="fill";this.origin={x:0,y:0};this.gridSnapValue=1;this.pointSnapValue=10;this.snapAngle=45;this.arrowKeysTranslateValue=1;this.selectionList=[];this.selectionPointList=[];this.BBOX_INTERACTION=new BBoxInteraction2D(this.editorRef);this.POINTS_INTERACTION=new PointInteraction2D(this.editorRef);this.PEN_LOCATION=document.querySelector("#TEMPLATES #INTERACTION_TEMPLATES #PEN_LOCATION").cloneNode(!0);
this.PROJECTION_GUIDE_X=document.querySelector("#TEMPLATES #INTERACTION_TEMPLATES #PROJECTION_GUIDE_X").cloneNode(!0);this.PROJECTION_GUIDE_Y=document.querySelector("#TEMPLATES #INTERACTION_TEMPLATES #PROJECTION_GUIDE_Y").cloneNode(!0);this.defaultDrawingProperties={};this.defaultDrawingProperties.fill="none";this.defaultDrawingProperties.stroke="#000000";this.defaultDrawingProperties["stroke-width"]=1;this.defaultDrawingProperties["stroke-linecap"]="butt";this.defaultDrawingProperties["stroke-linejoin"]=
"miter";this.defaultDrawingProperties["stroke-dasharray"]="";this.defaultDrawingProperties.opacity=1;this.defaultDrawingProperties.scaleStrokeWidth=!0;this.defaultDrawingProperties.brush={"brush-filter":"","brush-symbol-id":"brush-001-alpha","brush-symbol-distance":30,"brush-symbol-orient-on-path":!0,"brush-symbol-offset-x":0,"brush-symbol-offset-y":0,"scale-in":!1,"scale-out":!1,"opacity-in":1,"opacity-out":1,"randomize-offset":!1,"randomize-scale":!1,"randomize-orientation":!1,"randomize-opacity":!1};
this.snapToGrid=!1;this.snapToVertices=!0;this.isTextEditing=this.isHTMLTextEditing=this.isGroupEditing=this.snapToXY=this.snapToContour=!1}_=Document2D.prototype;_.getFullPath=function(){return this.fullPath};_.getTitle=function(){var a=this.fullPath.split("/");return 1<a.length?a.pop():a[0]};_.isNewDocument=function(){return 0==this.fullPath.indexOf("_new_")};_.onMouseWheel=function(a){if(!this.isTextEditing)this.editorRef.tools.activeTool.onMouseWheel(a)};_.onResize=function(a){};
_.exitFromTextEditing=function(a){this.isHTMLTextEditing&&(a.target==this||a.target instanceof SVGGraphicsElement&&a.target.ownerSVGElement==this)&&this.exitFrom_HTMLTextEditing()};_.onMouseDown=function(a){if(this.isHTMLTextEditing||this.isTextEditing)this.exitFromTextEditing(a);else if(3!=a.which)this.editorRef.tools.activeTool.onMouseDown(a)};_.onMouseMove=function(a){if(!GMOUSE.globalMouseTargetDelegate)this.editorRef.tools.activeTool.onMouseMove(a)};
_.onMouseUp=function(a){console.log("Document2D onMouseUp");if(this.isHTMLTextEditing)this.showSelectionProperties();else if(!GMOUSE.globalMouseTargetDelegate)this.editorRef.tools.activeTool.onMouseUp(a)};_.onTouchStart=function(a){};_.onTouchMove=function(a){};_.onTouchEnd=function(a){};_.onTouchCancel=function(a){};_.onGestureStart=function(a){};_.onGestureEnd=function(a){};_.onGestureChange=function(a){};
_.onKeyDown=function(a){var b=a.keyCode;if(a.metaKey||a.ctrlKey)switch(b){case 67:return this.copySelectedElements(),a.preventPropagation();case 86:return a.altKey?this.pasteElements():(this.pasteElements(),this.centerElementListInDocumentView(this.selectionList)),a.preventPropagation();case 88:return this.cutSelectedElements(),a.preventPropagation();case 187:case 107:return this.zoom(1.1),this.createInteractionFromSelection(),a.preventPropagation();case 189:case 109:return this.zoom(.9),this.createInteractionFromSelection(),
a.preventPropagation();case 65:return this.selectAll(),a.preventPropagation();case 68:return this.duplicateElementList_undable(this.selectionList),a.preventPropagation();case 71:return a.shiftKey?this.ungroupElementList_undable(this.selectionList):this.groupElementList_undable(this.selectionList),a.preventPropagation();case 90:return this.undo(),this.editorRef.tools.activeTool.onUndo(),a.preventPropagation();case 89:return this.redo(),this.editorRef.tools.activeTool.onRedo(),a.preventPropagation()}else{switch(b){case 8:case 46:return this.removeElementList_undable(this.selectionList),
a.preventPropagation(),a.preventPropagation()}this.editorRef.tools.activeTool.onKeyDown(a)}};_.onKeyUp=function(a){};_.onChange=function(){0==this.isChanged&&(this.isChanged=!0,this.editorRef.appRef.onDocumentStartChange(this));this.appRef.onDocumentChange(this)};_.undo=function(){this.deselectAllElements();this.history.undo()};_.redo=function(){this.deselectAllElements();this.history.redo()};_.cutSelectedElements=function(){this.copySelectedElements();this.removeElementList_undable(this.selectionList)};
_.copySelectedElements=function(){if(0!=this.selectionList.length){var a=this.content.getTransform().matrix.clone(),b=this.workspace.getTransform().matrix.clone();this.content.getTransform().matrix.identity();this.workspace.getTransform().matrix.identity();var c=this.querySelector("#jvs-workspace .jvs-page"),d=Math.floor(c.getAttribute("width"))||595,e=Math.floor(c.getAttribute("height"))||842;c=this.createSVG(1E3,1E3);c.appendChild(this.querySelector("defs").cloneNode(!0));c.setAttribute("width",
d);c.setAttribute("height",e);c.setAttribute("viewBox","0 0 "+d+" "+e);this.selectionList=this.sortElementListByIndexZ(this.selectionList);for(d=0;d<this.selectionList.length;d++){e=this.selectionList[d];var f=this.getLayerFromElement(e);f=e.getTransformToElement(f);e=e.cloneNode(!0);e.removeAttribute("selected");e.getTransform().setMatrix(f);c.appendChild(e)}c=(new SvgSerializer(this.appRef)).serialize(c);c=c.replace(/\x3c!--(?!\s*(?:\[if [^\]]+]|<!|>))(?:(?!--\x3e)(.|\n))*--\x3e/g,"");this.content.getTransform().setMatrix(a);
this.workspace.getTransform().setMatrix(b);console.log("copiedDoc",c);SetClipboardData({properties:{type:"svg"},content:c});console.log("GetClipboardData",GetClipboardData())}};_.pasteElements=function(){this.deselectAllElements();var a=GetClipboardData().content;(new SvgUnserializer(this.appRef,{parsePageSettings:!1,addContentUndable:!0,renameReferences:!0})).unserialize(a,this)};_.setUnits=function(a){this.unitKey=a;this.unitValue=this.units[this.unitKey]};
_.setPageSize=function(a,b){var c=this.querySelector("#jvs-workspace .jvs-page");c.setAttribute("width",a);c.setAttribute("height",b)};_.setPageColor=function(a){this.querySelector("#jvs-workspace .jvs-page").setAttribute("fill",a)};_.createLayer=function(a,b){a=a||LOCALIZER.translate("Layer");b=b||"#fb0094";var c=SVGElement.svgUtils.createGroup();c.setAttribute("name",a);c.setAttribute("jvs-layer-color",b);c.classList.add("jvs-layer");return c};
_.addLayer=function(a){this.content.appendChild(a);SelectElement(a);return this.activeLayer=a};
_.addLayer_undable=function(a){var b=this.activeLayer;this.addLayer(a);var c=new RemoveElements_action(this);c.addElements([a]);var d=new AddElements_action(this);d.addElements([a]);var e=this;c.onExecuteEnd=function(){e.deselectAllElements();e.setActiveLayer(b);e.removeAllInteractions();e.showSelectionProperties()};d.onExecuteEnd=function(){e.deselectAllElements();e.setActiveLayer(a);e.removeAllInteractions();e.showSelectionProperties()};this.history.addUndoRedoActions(c,d);return a};
_.removeLayer=function(a){var b=a.previousElementSibling||a.nextElementSibling;a.parentElement.removeChild(a);this.setActiveLayer(b)};_.removeLayer_undable=function(a){var b=new AddElements_action(this);b.addElements([a]);var c=new RemoveElements_action(this);c.addElements([a]);this.history.addUndoRedoActions(b,c);this.removeLayer(a)};_.setActiveLayer=function(a){a?(SelectElement(a),this.activeLayer=a):this.activeLayer=this.content};
_.getLayerFromElement=function(a){for(;a.parentElement;){if(a.parentElement===this.content)return a.classList.contains("jvs-layer")?a:this.content;a=a.parentElement}return null};_.isLockedElement=function(a){for(;a.parentElement;){if(a.classList.contains("locked"))return!0;if(a===this.content)break;a=a.parentElement}return!1};
_.getUsedColorList=function(a,b){for(var c=b||{},d=this.content.querySelectorAll("["+a+"]:not(.jvs-layer)"),e,f=d.length,g=0;g<f;g++)e=d[g].getAttribute(a),-1==e.indexOf("url")&&"none"!=e&&(c[e]=e);return c};
_.setFontFamilyElementList=function(a,b,c,d){"webfonts#webfont"==b.kind&&(d||(d=-1<b.subsets.indexOf("latin")?"latin":b.subsets[0]),c||(c=-1<b.variants.indexOf("regular")?"regular":b.variants[0]),d="https://fonts.googleapis.com/css?family="+b.family.replace(/ /g,"+")+":"+c+"&subset="+d,document.head.querySelector('link[href="'+d+'"]')||(console.log("includo fontUrl",d),IncludeCSS(d)));b=b.family;var e=d="";if("regular"==c)d="regular";else{var f=c.indexOf("italic");-1==f?e=c:0==f?d="italic":0<f&&(d=
"italic",e=c.split("italic")[0])}this.setAttributeElementList_undable(a,["font-family","font-style","font-weight"],{"font-family":b,"font-style":d,"font-weight":e});this.createInteractionFromSelection();this.showSelectionProperties()};
_.groupElementList=function(a){if(0==a.length)return null;var b=a[0].parentElement;a=this.sortElementListByIndexZ(a);if(null==a)return null;for(var c=1;c<a.length;c++)if(a[c].parentElement!=b)return this.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Invalid operation"),LOCALIZER.translate("To make a group the elements must be inside the same level or group!")),null;var d=this.getElementListGlobalBBox(a);c=b.globalToLocal(d.center.x,d.center.y);d=SVGElement.svgUtils.createGroup(c.x,c.y);var e=this.createSVGMatrix();
e=e.translate(-c.x,-c.y);for(c=0;c<a.length;c++){var f=a[c].cloneNode(!0);f.getTransform().setMatrix(e.multiply(f.getTransform().matrix));d.appendChild(f)}b.appendChild(d);this.removeElementList(a);return d};_.getGroupsFromElementList=function(a){for(var b=[],c=a.length,d=0;d<c;d++)a[d]instanceof SVGGElement&&b.push(a[d]);if(0==b.length)return null;b=this.sortElementListByIndexZ(b);return null==b?null:b};
_.ungroupElementList=function(a){if(0==a.length)return null;for(var b=a[0].parentElement,c=[],d,e,f,g=a.length,k,l,h=0;h<g;h++){k=a[h];l=k.getTransform().matrix;d=k.childNodes.length;for(var m=0;m<d;m++)e=k.childNodes[m],console.log(e),e instanceof SVGGraphicsElement&&(f=e.getTransform().matrix,e=e.cloneNode(!0),b.appendChild(e),e.getTransform().setMatrix(l.multiply(f)),c.push(e));k.remove()}return c};
_.duplicateElementList=function(a){for(var b=[],c,d=0;d<a.length;d++)c=a[d].cloneNode(!0),b.push(c),a[d].parentNode.appendChild(c),c.createUniqueDefReferences();return b};_.removeElementList=function(a){for(var b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])};
_.selectAll=function(){var a=this.activeLayer.classList.contains("isolate-layer")?this.querySelectorAll("#jvs-content>.jvs-layer.selected>*:not(.locked)"):this.querySelectorAll("#jvs-content>.jvs-layer:not(.locked):not(.hidden)>*:not(.locked):not(.hidden)");a=this.getFilteredElementListByNodeName(a,"line,rect,ellipse,path,g,text,use,image,foreignObject");this.selectElementList(a);this.createInteractionFromSelection()};
_.elementAtScreenPoint=function(a,b){var c=this.createSVGRect();c.x=a-this.pointSnapValue/2;c.y=b-40-this.pointSnapValue/2;c.width=this.pointSnapValue;c.height=this.pointSnapValue;c=this.getIntersectionList(c,null);var d;if(0==c.length){if(d=document.elementFromPoint(a,b))if(c=d.getParentElementByNodeName("foreignObject"))return c;return null}for(var e=1/this.content.getTransform().matrix.getScale().x,f=c.length-1;-1<f;f--){var g=c[f];if(g.hasAttribute("stroke-width")){var k=g.getAttribute("stroke");
var l=g.getAttribute("stroke-width");g.setAttribute("stroke","#000000");g.setAttribute("stroke-width",this.pointSnapValue*e);d=document.elementFromPoint(a,b);g.setAttribute("stroke",k);g.setAttribute("stroke-width",l);if(d==g)return g}}return(d=document.elementFromPoint(a,b))&&d instanceof SVGGraphicsElement&&d.ownerSVGElement==this?d:null};_.disableSelectionPointerEvents=function(){this.classList.add("disabled-selection-pointer-events")};_.enableSelectionPointerEvents=function(){this.classList.remove("disabled-selection-pointer-events")};
_.deselectAllElements=function(){for(var a=0;a<this.selectionList.length;a++)this.selectionList[a].isSelected=!1,this.selectionList[a].removeAttribute("selected");this.selectionList=[];this.currentEditableElement=null;this.deselectAllPoints()};_.deselectElement=function(a){a.isSelected=!1;a.removeAttribute("selected");this.selectionList.remove(a);this.deselectElementPoints(a);0<this.selectionList.length&&(this.currentEditableElement=this.selectionList[this.selectionList.length-1])};
_.selectElementList=function(a){this.deselectAllElements();for(var b=0;b<a.length;b++)this.selectElement(a[b])};_.selectElement=function(a){a&&(this.currentEditableElement=a,1!=a.isSelected&&(this.selectionList.push(a),a.isSelected=!0,a.setAttribute("selected","true")))};_.deselectElementPoints=function(a){if(a instanceof SVGPathElement)for(var b,c=a.pathSegList.numberOfItems,d=0;d<c;d++)b=a.pathSegList.getItem(d),b.isSelected&&this.deselectPoint(b)};
_.deselectAllPoints=function(){for(var a=0;a<this.selectionPointList.length;a++)this.selectionPointList[a].isSelected=!1;this.selectionPointList=[]};_.deselectPoint=function(a){a.isSelected=!1;this.selectionPointList.remove(a)};_.selectPointList=function(a){this.deselectAllPoints();for(var b=0;b<a.length;b++)this.selectPoint(a[b])};_.selectPoint=function(a){1!=a.isSelected&&(this.selectionPointList.push(a),a.isSelected=!0)};
_.getElementListGlobalBBoxInContentSpace=function(a){a=this.getElementListGlobalBBox(a);var b=this.content.globalToLocal(a.x,a.y);a.min.x=a.x=b.x;a.min.y=a.y=b.y;b=this.content.globalToLocal(a.max.x,a.max.y);a.max.x=b.x;a.max.y=b.y;a.width=a.max.x-a.min.x;a.height=a.max.y-a.min.y;return a};
_.getElementListGlobalBBox=function(a){if(0!=a.length){for(var b=a[0].getGlobalBBox(),c={x:b.x,y:b.y},d={x:b.x+b.width,y:b.y+b.height},e,f,g=1;g<a.length;g++){var k=a[g].getGlobalBBox();e=k.x+k.width;f=k.y+k.height;k.x<c.x&&(c.x=k.x);k.y<c.y&&(c.y=k.y);e>d.x&&(d.x=e);f>d.y&&(d.y=f)}b.min=c;b.max=d;b.x=c.x;b.y=c.y;b.width=d.x-c.x;b.height=d.y-c.y;b.center={x:b.x+b.width/2,y:b.y+b.height/2};return b}};_.translateElementList=function(a,b,c){for(var d=a.length,e=0;e<d;e++)a[e].translateInGlobal(b,c)};
_.scaleElementList=function(a,b,c,d,e){for(var f=a.length,g=0;g<f;g++)a[g].scaleAroundGlobalPt(b,c,d,e)};_.rotateElementList=function(a,b,c){for(var d=a.length,e=0;e<d;e++)a[e].rotateAroundGlobalPt(b,c)};_.bringElementListToFront=function(a){for(var b=a.length,c=0;c<b;c++)a[c].bringToFront()};_.sendElementListToBack=function(a){for(var b=a.length,c=0;c<b;c++)a[c].sendToBack()};_.bringElementListUp=function(a){for(var b=a.length,c=0;c<b;c++)a[c].bringUp()};
_.sendElementListDown=function(a){for(var b=a.length,c=0;c<b;c++)a[c].sendDown()};
_.sortElementListByIndexZ=function(a){function b(a,b){return a.index-b.index}for(var c=a.length,d={},e=[],f,g,k,l=0;l<c;l++)f=a[l],g=this.getLayerFromElement(f),k=g.getAttribute("name"),d[k]||(d[k]={index:g.getIndex(),elements:[]}),d[k].elements.push({element:f,index:f.getIndex()});for(var h in d)d[h].elements.sort(b),e.push(d[h]);e.sort(b);c=[];for(l=0;l<e.length;l++)for(g=e[l],a=0;a<g.elements.length;a++)c.push(g.elements[a].element);return c};
_.setAttributeOfElementList=function(a,b,c){for(var d=a.length,e=0;e<d;e++)a[e].setAttribute(b,c)};_.normalizeScaleElementList=function(a,b){var c=this.content.getTransform(),d=c.matrix.clone();c.matrix.identity();var e,f=a.length;for(e=0;e<f;e++)a[e].prepareToNormalizeScale(b);for(e=0;e<f;e++)a[e].normalizeScale(b);for(e=0;e<f;e++)a[e].normalizationData&&(a[e].normalizationData=null);c.setMatrix(d)};_.removeAllInteractions=function(){this.editorRef.INTERACTION_SVG.removeChildren()};
_.showPenLocation=function(){this.PEN_LOCATION.parentElement||this.editorRef.INTERACTION_SVG.appendChild(this.PEN_LOCATION);this.penInfo.snapClassName?this.PEN_LOCATION.classList.add(this.penInfo.snapClassName):this.PEN_LOCATION.setAttribute("class","");var a=this.PEN_LOCATION.getTransform();a.matrix.e=this.penInfo.screenPositionSnapped.x;a.matrix.f=this.penInfo.screenPositionSnapped.y;this.showProjectionGuideX();this.showProjectionGuideY()};
_.showProjectionGuideX=function(){this.penInfo.projectedPointX?(this.PROJECTION_GUIDE_X.parentElement||this.editorRef.INTERACTION_SVG.appendChild(this.PROJECTION_GUIDE_X),this.PROJECTION_GUIDE_X.updateGeometry(this.penInfo.projectedPointX.x,this.penInfo.projectedPointX.y,this.penInfo.screenPositionSnapped.x,this.penInfo.screenPositionSnapped.y)):this.PROJECTION_GUIDE_X.parentElement&&this.editorRef.INTERACTION_SVG.removeChild(this.PROJECTION_GUIDE_X)};
_.showProjectionGuideY=function(){this.penInfo.projectedPointY?(this.PROJECTION_GUIDE_Y.parentElement||this.editorRef.INTERACTION_SVG.appendChild(this.PROJECTION_GUIDE_Y),this.PROJECTION_GUIDE_Y.updateGeometry(this.penInfo.projectedPointY.x,this.penInfo.projectedPointY.y,this.penInfo.screenPositionSnapped.x,this.penInfo.screenPositionSnapped.y)):this.PROJECTION_GUIDE_Y.parentElement&&this.editorRef.INTERACTION_SVG.removeChild(this.PROJECTION_GUIDE_Y)};
_.createInteractionFromSelection=function(){this.removeAllInteractions();0!=this.selectionList.length&&(this.appRef.editor2D.selectionMode==this.appRef.editor2D.POINTS_SELECTION?this.POINTS_INTERACTION.createPointsInteraction(this.selectionList):this.BBOX_INTERACTION.createBBoxInteraction(this.selectionList))};
_.createClippedContent=function(a){if(2>a.length)return null;if(a=this.sortElementListByIndexZ(a)){var b=a[0],c=b.parentElement,d="__"+(new Date).getTime()+"__",e=SVGElement.svgUtils.createClipPath(d),f=SVGElement.svgUtils.createGroup();f.getTransform().setMatrix(b.getTransform().matrix.clone());c.appendChild(f);f.appendChild(e);c=b.getTransformToElement(f);b=b.cloneNode(!0);f.appendChild(b);b.getTransform().setMatrix(c);for(b=1;b<a.length;b++){c=a[b];var g=c.getTransformToElement(e);c=c.cloneNode(!0);
e.appendChild(c);c.getTransform().setMatrix(g)}f.setAttribute("clip-path","url(#"+d+")");return f}};
_.createClippedContent_undable=function(a){if(2>a.length)return null;this.deselectAllElements();var b=new ReplaceElements_action(this),c=new ReplaceElements_action(this);b.addElementsToRemove(a);c.addElementsToAdd(a);var d=this.createClippedContent(a);d&&(b.addElementsToAdd([d]),c.addElementsToRemove([d]),this.history.addUndoRedoActions(c,b),this.removeElementList(a),this.selectElementList([d]),this.createInteractionFromSelection(),this.showSelectionProperties())};
_.createMaskedContent=function(a){if(2>a.length)return null;if(a=this.sortElementListByIndexZ(a)){var b=a[0],c=b.parentElement,d="__"+(new Date).getTime()+"__",e=SVGElement.svgUtils.createMask(d),f=SVGElement.svgUtils.createGroup();f.getTransform().setMatrix(b.getTransform().matrix.clone());c.appendChild(f);f.appendChild(e);c=b.getTransformToElement(f);b=b.cloneNode(!0);f.appendChild(b);b.getTransform().setMatrix(c);for(b=1;b<a.length;b++){c=a[b];console.log("_graphicElementToAdd",c);var g=c.getTransformToElement(f);
c=c.cloneNode(!0);e.appendChild(c);c.getTransform().setMatrix(g)}f.setAttribute("mask","url(#"+d+")");return f}};
_.createMaskedContent_undable=function(a){if(2>a.length)return null;this.deselectAllElements();var b=new ReplaceElements_action(this),c=new ReplaceElements_action(this);b.addElementsToRemove(a);c.addElementsToAdd(a);var d=this.createMaskedContent(a);d&&(b.addElementsToAdd([d]),c.addElementsToRemove([d]),this.history.addUndoRedoActions(c,b),this.removeElementList(a),this.selectElementList([d]),this.createInteractionFromSelection(),this.showSelectionProperties())};
_.createTextPathContent=function(a){if(2!=a.length)return null;if(a[0]instanceof SVGTextElement){var b=a[0];var c=a[1]}else c=a[0],b=a[1];if("path"!=c.nodeName)this.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Graphic Path element required"),LOCALIZER.translate("Please convert the graphic element into a path."));else{var d="__"+(new Date).getTime()+"__";a=c.parentElement;var e=SVGElement.svgUtils.createGroup();e.getTransform().setMatrix(c.getTransform().matrix.clone());c=c.cloneNode();c.getTransform().matrix.identity();
c.setAttribute("id",d);e.appendChild(c);c=document.createElementNS(SVGElement.SVG_NS,"text");c.setAttribute("controller-class","Text_path");c.setAttribute("font-family",b.getAttribute("font-family"));c.setAttribute("font-size",b.getAttribute("font-size"));c.setAttribute("font-style",b.getAttribute("font-style"));var f=document.createElementNS(SVGElement.SVG_NS,"textPath");f.setAttributeNS(SVGElement.XLINK_NS,"href","#"+d);b=document.createTextNode(b.getTextData());f.appendChild(b);c.appendChild(f);
e.appendChild(c);a.appendChild(e);c.connectController(Text_path);return e}};
_.createTextPathContent_undable=function(a){if(2!=a.length)return null;this.deselectAllElements();var b=new ReplaceElements_action(this),c=new ReplaceElements_action(this);b.addElementsToRemove(a);c.addElementsToAdd(a);var d=this.createTextPathContent(a);console.log("createTextPathContent_undable",d);d&&(b.addElementsToAdd([d]),c.addElementsToRemove([d]),this.history.addUndoRedoActions(c,b),this.removeElementList(a),this.selectElementList([d]),this.createInteractionFromSelection(),this.showSelectionProperties())};
_.createBrush=function(a,b,c,d,e){var f=document.createElementNS(SVGElement.SVG_NS,"use");b=b||0;c=c||0;d=d||1;e=e||0;var g=SVGElement.svgUtils.createSVGMatrix();g=g.translate(b,c).scale(d).rotate(e);f.getTransform().setMatrix(g);f.setAttributeNS(SVGElement.XLINK_NS,"href","#"+a);return f};
_.getElementAsBitmap=function(a,b,c,d){c=c||0;d=this.content.getTransform().matrix.clone();var e=this.workspace.getTransform().matrix.clone();this.content.getTransform().matrix.identity();this.workspace.getTransform().matrix.identity();var f=this.querySelector("#jvs-workspace .jvs-page");f=this.createSVG(f.getAttribute("width"),f.getAttribute("height"));f.appendChild(this.querySelector("defs").cloneNode(!0));var g=a.getGlobalBBox(),k=a.cloneNode(!0);k.getTransform().setMatrix(a.getTransformToElement(this));
f.appendChild(k);this.content.getTransform().setMatrix(d);this.workspace.getTransform().setMatrix(e);d=(new XMLSerializer).serializeToString(f);var l=document.createElement("canvas");l.width=Math.floor(g.width)+2*c;l.height=Math.floor(g.height)+2*c;var h=l.getContext("2d"),m=window.URL,n=new Image;d=new Blob([d],{type:"image/svg+xml;charset=utf-8"});var p=m.createObjectURL(d),q=this;n.onload=function(){h.drawImage(n,-Math.floor(g.x)+c,-Math.floor(g.y)+c);var d=document.createElementNS(SVGElement.SVG_NS,
"image");d.setAttributeNS(SVGElement.XLINK_NS,"href",l.toDataURL("image/png"));var e=SVGElement.svgUtils.createSVGMatrix();e=e.translate(g.x-c,g.y-c);d.getTransform().setMatrix(e);q.content.appendChild(d);d.getTransform().setMatrix(d.getTransformToElement(a.parentNode));m.revokeObjectURL(p);b(d)};n.src=p};
_.enterTo_isolateLayerEditing=function(a){this.deselectAllElements();var b=a.nodeName.toUpperCase();a.hasAttribute("id")&&(b=a.getAttribute("id"));b=this.createLayer(b);b.classList.add("isolate-layer");a.hasAttribute("clip-path")?b.connectController(Layer2D_clipEditing,{document:this}):a.hasAttribute("mask")?b.connectController(Layer2D_maskEditing,{document:this}):b.connectController(Layer2D_groupEditing,{document:this});this.addLayer_undable(b);b.enterToEditing(a);this.removeAllInteractions();this.showSelectionProperties()};
_.exitFrom_isolateLayerEditing=function(){var a=this.content.querySelectorAll(".jvs-layer"),b=a[a.length-1];if(b.classList.contains("isolate-layer")){a=new ReplaceElements_action(this);var c=new ReplaceElements_action(this);a.addElementsToRemove([b.editableElementRef]);c.addElementsToAdd([b.editableElementRef]);var d=b.exitFromEditing();if(d){a.addElementsToAdd([d]);c.addElementsToRemove([d]);var e=this;a.onExecuteEnd=function(){e.deselectAllElements();e.removeLayer(b);e.removeAllInteractions();e.showSelectionProperties()};
c.onExecuteEnd=function(){e.deselectAllElements();e.addLayer(b);e.removeAllInteractions();e.showSelectionProperties()};this.history.addUndoRedoActions(c,a)}else this.removeElementList_undable([b.editableElementRef]);this.deselectAllElements();this.removeLayer(b);this.removeAllInteractions();this.createInteractionFromSelection();this.showSelectionProperties()}};_.enterTo_GroupEditing=function(){this.isGroupEditing=!0};_.exitFrom_GroupEditing=function(){this.isGroupEditing=!1};
_.enterTo_HTMLTextEditing=function(a){this.deselectAllElements();this.selectElement(a);this.createInteractionFromSelection();a=a.firstChild;a.setAttribute("contenteditable","true");a.focus();this.isHTMLTextEditing=!0;this.showSelectionProperties()};_.exitFrom_HTMLTextEditing=function(a){a=a||this.querySelector("[contenteditable]");a.blur();a.removeAttribute("contenteditable");this.isHTMLTextEditing=!1;this.onChange();this.createInteractionFromSelection();this.showSelectionProperties()};
_.enterTo_TextEditing=function(a,b){var c=a.toHTML();c.setAttribute("id","TEXT_INTERACTION");c.setAttribute("contentEditable","true");c.addEventListener("paste",function(a){a.preventDefault();a=a.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,a)});var d=this;c.onblur=function(){d.exitFrom_TextEditing(this)};this.editorRef.INTERACTION_HTML.appendChild(c);a.style.display="none";this.removeAllInteractions();this.isTextEditing=!0;c.focus();b&&c.selectAllTextInElement();this.showSelectionProperties()};
_.exitFrom_TextEditing=function(a){a=a||this.editorRef.INTERACTION_HTML.querySelector("#TEXT_INTERACTION");a.blur();var b=a.svgTextElementRef,c=b.style.display="";document.body.innerText&&(c=a.innerText);for(var d=c.length-1;"\n"==c.charAt(d);)d--;c=c.substring(0,d+1);d=new SetProperties_action(this);var e=new SetProperties_action(this);d.addElementAndProperties(b,{textData:b.textData});e.addElementAndProperties(b,{textData:c});this.history.addUndoRedoActions(d,e);b.textData=c;this.isTextEditing=
!1;a.parentNode.removeChild(a);this.onChange();this.createInteractionFromSelection();this.showSelectionProperties()};_.dispatchGeometryChangedEvent=function(a,b){var c,d=a.length;for(c=0;c<d;c++)a[c].onGeometryChanged()};
_.createElementListPreviews=function(a,b,c){var d=!1;a||(this.removeAllInteractions(),a=SVGElement.svgUtils.createGroup(0,0,"interactive-elements"),this.editorRef.INTERACTION_SVG.appendChild(a),d=!0);var e=b.length;for(var f=0;f<e;f++){var g=b[f];var k=c||this.getLayerFromElement(g).getAttribute("jvs-layer-color");if(g.createElementPreview){var l=d?g.getScreenCTM():g.getTransform().matrix.clone();if(g instanceof SVGGElement){var h=SVGElement.svgUtils.createGroup();h.getTransform().setMatrix(l);a.appendChild(h);
this.createElementListPreviews(h,g.childNodes,k)}else if(g=g.createElementPreview(l))g.style.stroke=k,a.appendChild(g)}}};_.showSelectionProperties=function(){this.currentEditableElement||(this.currentEditableElement=0<this.selectionList.length?this.selectionList[0]:this);this.editorRef.showSelectionProperties()};_.getFilteredElementListByNodeName=function(a,b){for(var c=[],d=b.split(","),e=a.length,f=0;f<e;f++)-1<d.indexOf(a[f].nodeName)&&c.push(a[f]);return c};
_.setAttributeElementList=function(a,b,c){for(var d=a.length,e=0;e<d;e++)a[e].setAttribute(b,c)};
_.setAttributeElementList_undable=function(a,b,c,d){var e=a.length;if(0!=e){var f=new SetAttributes_action(this),g=new SetAttributes_action(this);!1===d&&(f.updateDocumentSelection=g.updateDocumentSelection=!1);this.history.addUndoRedoActions(f,g);f.addElements(a,b);console.log("typeof",typeof b);if("string"==typeof b)for(d=0;d<e;d++)a[d].setAttribute(b,c);else for(var k in c)for(d=0;d<e;d++)a[d].setAttribute(k,c[k]);g.addElements(a,b);return{undoAction:f,redoAction:g}}};
_.setPropertyElementList=function(a,b,c){for(var d=a.length,e=0;e<d;e++)a[e][b]=c};_.setPropertyElementList_undable=function(a,b,c){var d=a.length;if(0!=d){var e=new SetProperties_action(this),f=new SetProperties_action(this);this.history.addUndoRedoActions(e,f);e.addElements(a,b);d=a.length;for(var g=0;g<d;g++)a[g][b]=c;f.addElements(a,b);return{undoAction:e,redoAction:f}}};
_.placeElementListInLayer_undable=function(a,b){if(0==a.length)return null;var c=new ReplaceElements_action(this),d=new ReplaceElements_action(this);c.addElementsToRemove(a);d.addElementsToAdd(a);b.appendChildren(a);c.addElementsToAdd(a);d.addElementsToRemove(a);this.history.addUndoRedoActions(d,c);this.deselectAllElements();this.selectElementList(a);this.createInteractionFromSelection();this.showSelectionProperties();this.onChange()};
_.appendElementListInLayer_undable=function(a,b,c){if(0==a.length)return null;var d=new RemoveElements_action(this);d.addElements(a);for(var e=a.length,f=0;f<e;f++)b.appendChild(a[f]);b=new AddElements_action(this);b.addElements(a);this.history.addUndoRedoActions(d,b);this.deselectAllElements();c&&this.selectElementList(a);this.createInteractionFromSelection();this.showSelectionProperties();this.onChange()};
_.groupElementList_undable=function(a){if(0==a.length)return null;this.deselectAllElements();var b=new ReplaceElements_action(this),c=new ReplaceElements_action(this);b.addElementsToRemove(a);c.addElementsToAdd(a);if(a=this.groupElementList(a))b.addElementsToAdd([a]),c.addElementsToRemove([a]),this.history.addUndoRedoActions(c,b),this.selectElementList([a]),this.createInteractionFromSelection(),this.showSelectionProperties()};
_.ungroupElementList_undable=function(a){if(0==a.length)return null;var b=this.getGroupsFromElementList(a);if(b){a=new ReplaceElements_action(this);var c=new ReplaceElements_action(this);a.addElementsToRemove(b);c.addElementsToAdd(b);b=this.ungroupElementList(b);a.addElementsToAdd(b);c.addElementsToRemove(b);this.history.addUndoRedoActions(c,a);this.deselectAllElements();this.selectElementList(b);this.createInteractionFromSelection();this.showSelectionProperties()}};
_.lockElementList=function(a){for(var b=0,c=a.length;b<c;b++)a[b].classList.add("locked");this.deselectAllElements();this.createInteractionFromSelection();this.showSelectionProperties()};_.unlockAllElements=function(){for(var a=this.querySelectorAll("#jvs-content>.jvs-layer:not(.locked) *.locked"),b=0,c=a.length;b<c;b++)a[b].classList.remove("locked");this.selectElementList(a);this.createInteractionFromSelection();this.showSelectionProperties()};
_.joinPathList_undable=function(a){if(0==a.length)return null;var b;if(b=1==a.length?a[0].joinPath(a[0]):a[0].joinPath(a[1])){var c=new ReplaceElements_action(this),d=new ReplaceElements_action(this);c.addElementsToRemove(a);d.addElementsToAdd(a);this.removeElementList(a);this.activeLayer.appendChild(b);c.addElementsToAdd([b]);d.addElementsToRemove([b]);this.history.addUndoRedoActions(d,c);this.deselectAllElements();this.selectElementList([b]);this.createInteractionFromSelection()}};
_.convertElementListToPath=function(a){a=this.getFilteredElementListByNodeName(a,"ellipse,rect,line");var b,c=[];var d=a.length;for(b=0;b<d;b++){var e=SVGElement.svgUtils.createPath();var f=a[b];e.getTransform().setMatrix(f.getTransform().matrix.clone());e.setPathData(f.getPathData({normalize:!0}));c.push(e)}return c};
_.convertElementListToPath_undable=function(a){a=this.getFilteredElementListByNodeName(a,"ellipse,rect,line");var b,c=[];var d=a.length;for(b=0;b<d;b++){var e=SVGElement.svgUtils.createPath();var f=a[b];e.getTransform().setMatrix(f.getTransform().matrix.clone());e.setPathData(f.getPathData({normalize:!0}));c.push(e)}var g=new ReplaceElements_action(this),k=new ReplaceElements_action(this);this.history.addUndoRedoActions(k,g);g.addElementsToRemove(a);k.addElementsToAdd(a);for(b=0;b<d;b++)f=a[b],e=
c[b],f.parentNode.replaceChild(e,f),e.setAttribute("stroke-width",f.getAttribute("stroke-width")),e.setAttribute("stroke",f.getAttribute("stroke")),e.setAttribute("fill",f.getAttribute("fill"));g.addElementsToAdd(c);k.addElementsToRemove(c);this.deselectAllElements();this.selectElementList(c);this.createInteractionFromSelection();this.showSelectionProperties();this.onChange()};
_.convertTextElementListToPath_undable=function(a,b){function c(a,b){opentype.load(a,function(a,c){a?(console.log("Font could not be loaded: "+a),g.appRef.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The Font file could not be loaded."))):(console.log("Font loaded: ",c),b(c))})}function d(d){var h=d.getAttribute("font-family");var k=parseFloat(d.getAttribute("font-size"));var l=d.getAttribute("font-weight")||"";var p=d.getAttribute("font-style");var q=parseFloat(d.getAttribute("letter-spacing"))||
0;var u=parseFloat(d.getAttribute("word-spacing"))||0;var r=d.getAttribute("text-align");var v=parseFloat(d.getAttribute("width"));var A=0;"center"==r?A=v/2:"right"==r&&(A=v);h=g.editorRef.FONT_LIBRARY_2D_PANEL.getFontObjectByFamilyName(h).files[l+p];var y=SVGElement.svgUtils.createGroup();y.getTransform().setMatrix(d.getTransform().matrix.clone());e.push(y);c(h,function(c){for(var h="",l=d.querySelectorAll("tspan"),m,n,p,v,F,na=0;na<l.length;na++)m=l[na],v=q,F=u,m.getAttribute("word-spacing")&&(v=
0,F=parseFloat(m.getAttribute("word-spacing"))),p=m.getComputedTextLength({letterSpacing:v,wordSpacing:F}),n=A,"center"==r?n-=p/2:"right"==r&&(n-=p),p=parseFloat(m.getAttribute("y")),m=c.getPath(m.textContent,n,p,k,{letterSpacing:v,wordSpacing:F}),h+=m.toSVG(3);y.innerHTML=h;c=y.querySelectorAll("path");g.setAttributeOfElementList(c,"stroke-width",d.getAttribute("stroke-width")||"");g.setAttributeOfElementList(c,"stroke",d.getAttribute("stroke"));g.setAttributeOfElementList(c,"fill",d.getAttribute("fill"));
f++;f==a.length&&(c=new ReplaceElements_action(g),h=new ReplaceElements_action(g),g.history.addUndoRedoActions(h,c),c.addElementsToRemove(a),h.addElementsToAdd(a),g.removeElementList(a),g.activeLayer.appendChildren(e),c.addElementsToAdd(e),h.addElementsToRemove(e),g.deselectAllElements(),g.createInteractionFromSelection(),g.onChange(),b&&b())})}for(var e=[],f=0,g=this,k=0;k<a.length;k++)d(a[k])};
_.duplicateElementList_undable=function(a,b,c){if(0==a.length)return null;a=this.duplicateElementList(a);void 0==b?this.applyLastTransformAction&&this.applyLastTransformAction(a):this.translateElementList(a,b,c);console.log("createdElementList");console.log(a);b=new RemoveElements_action(this);b.addElements(a);c=new AddElements_action(this);c.addElements(a);this.history.addUndoRedoActions(b,c);this.deselectAllElements();this.selectElementList(a);this.createInteractionFromSelection();this.showSelectionProperties()};
_.createScaleUndoRedoAction=function(a,b,c,d,e,f){var g=new ScaleElements_action(this);g.addElements(a,f);var k=new ScaleElements_action(this);k.addElements(a,f);this.history.addUndoRedoActions(g,k);k.localMode=g.localMode=e;k.pivotPt=g.pivotPt=d;g.scaleX=1/b;g.scaleY=1/c;k.scaleX=b;k.scaleY=c};
_.scaleElementList_undable=function(a,b,c,d,e){if(0==a.length)return null;this.scaleElementList(a,b,c,d,e);this.normalizeScaleElementList(this.selectionList,{scaleStrokeWidth:this.defaultDrawingProperties.scaleStrokeWidth});this.createScaleUndoRedoAction(a,b,c,d,e);this.onChange();this.createInteractionFromSelection()};
_.rotateElementList_undable=function(a,b,c){if(0==a.length)return null;var d=new SetMatrix_action(this);d.addElements(a);this.rotateElementList(a,b,c);b=new SetMatrix_action(this);b.addElements(a);this.history.addUndoRedoActions(d,b);this.onChange();this.createInteractionFromSelection()};
_.translateElementList_undable=function(a,b,c){if(0==a.length)return null;var d=new SetMatrix_action(this),e=new SetMatrix_action(this);this.history.addUndoRedoActions(d,e);d.addElements(a);this.translateElementList(a,b,c);e.addElements(a);this.onChange();this.createInteractionFromSelection();this.showSelectionProperties()};
_.translatePointList_undable=function(a,b,c){var d;for(idElem=0;idElem<maxElem;idElem++){element=this.dataToDrag[idElem];b=element.screenMatrixInverted;a=element.selectedSegmentDataList;pt1_local=pt1.matrixTransform(b);pt2_local=pt2.matrixTransform(b);b=pt2_local.x-pt1_local.x;c=pt2_local.y-pt1_local.y;var e=a.length;for(d=0;d<e;d++){var f=a[d];var g=f.segment;f.x_y&&(g.x+=b,g.y+=c);f.x1_y1?(g.x1+=b,g.y1+=c):f.x2_y2&&(g.x2+=b,g.y2+=c)}}};
_.flipElementList_undable=function(a){if(0!=this.selectionList.length){var b=this.getElementListGlobalBBox(this.selectionList),c=1,d=1;console.log(a);switch(a){case "horizontal":c=-1;break;case "vertical":d=-1}console.log(a+" "+c+" "+d);this.scaleElementList_undable(this.selectionList,c,d,b.center,!1);this.showSelectionProperties();this.onChange()}};
_.centerElementListInPage=function(a){if(0<a.length){var b=this.getElementListGlobalBBox(a),c=this.querySelector("#jvs-workspace .jvs-page"),d=parseFloat(c.getAttribute("width"))/2,e=parseFloat(c.getAttribute("height"))/2;c=c.localToGlobal(d,e);this.translateElementList(a,c.x-b.center.x,c.y-b.center.y)}};
_.centerElementListInDocumentView=function(a){if(0<a.length){var b=this.getElementListGlobalBBox(a);this.translateElementList(a,this.clientWidth/2-b.center.x,this.clientHeight/2-b.center.y);this.createInteractionFromSelection();this.showSelectionProperties();this.onChange()}};
_.removeElementList_undable=function(a,b){if(0==a.length)return null;var c=new AddElements_action(this);c.addElements(a);var d=new RemoveElements_action(this);d.addElements(a);b&&!1===b.updateDocumentSelection&&(c.updateDocumentSelection=d.updateDocumentSelection=!1);this.history.addUndoRedoActions(c,d);this.removeElementList(a);this.deselectAllElements();this.createInteractionFromSelection();this.showSelectionProperties();this.onChange()};
_.executeBooleanOperation=function(a,b){if(!(2>a.length)){var c={};paper.install(c);paper.setup([640,480]);var d=c.project.importSVG(a[0]),e;var f=a.length;for(e=1;e<f;e++){var g=c.project.importSVG(a[e]);switch(b){case "unite":var k=d.unite(g);break;case "intersect":k=d.intersect(g);break;case "subtract":k=d.subtract(g);break;case "exclude":k=d.exclude(g);break;case "divide":k=d.divide(g)}if(k instanceof paper.Group)break;else d=k}k=k.exportSVG();if("g"==k.nodeName)for(c=k.querySelectorAll("path"),
e=0;e<c.length;e++)c[e].getPathData({normalize:!0});else k.getPathData({normalize:!0});return k}};_.bringElementListToFront_undable=function(a){if(0==a.length)return null;var b=new SetIndex_action(this);b.addElements(a);this.bringElementListToFront(a);var c=new SetIndex_action(this);c.addElements(a);this.history.addUndoRedoActions(b,c);this.onChange()};
_.sendElementListToBack_undable=function(a){if(0==a.length)return null;var b=new SetIndex_action(this);b.addElements(a);this.sendElementListToBack(a);var c=new SetIndex_action(this);c.addElements(a);this.history.addUndoRedoActions(b,c);this.onChange()};_.bringElementListUp_undable=function(a){if(0==a.length)return null;var b=new SetIndex_action(this);b.addElements(a);this.bringElementListUp(a);var c=new SetIndex_action(this);c.addElements(a);this.history.addUndoRedoActions(b,c);this.onChange()};
_.sendElementListDown_undable=function(a){if(0==a.length)return null;var b=new SetIndex_action(this);b.addElements(a);this.sendElementListDown(a);var c=new SetIndex_action(this);c.addElements(a);this.history.addUndoRedoActions(b,c);this.onChange()};
_.setElementListGradientsPoints_undable=function(a,b,c,d){var e=a.length;if(0!=e){var f=new SetAttributes_action(this);f.updateDocumentSelection=!1;var g=new SetAttributes_action(this);g.updateDocumentSelection=!1;this.history.addUndoRedoActions(f,g);for(var k,l,h,m=0;m<e;m++)if(k=a[m],l=k.getGradient(b))h=k.globalToLocal(c.x,c.y),k=k.globalToLocal(d.x,d.y),l instanceof SVGRadialGradientElement?(f.addElementAndAttributes(l,{cx:l.cx.baseVal.value,cy:l.cy.baseVal.value,r:l.r.baseVal.value}),l.cx.baseVal.value=
h.x,l.cy.baseVal.value=h.y,l.r.baseVal.value=k.getDistanceFromPoint(h),g.addElementAndAttributes(l,{cx:l.cx.baseVal.value,cy:l.cy.baseVal.value,r:l.r.baseVal.value})):l instanceof SVGLinearGradientElement&&(f.addElementAndAttributes(l,{x1:l.x1.baseVal.value,y1:l.y1.baseVal.value,x2:l.x2.baseVal.value,y2:l.y2.baseVal.value}),l.x1.baseVal.value=h.x,l.y1.baseVal.value=h.y,l.x2.baseVal.value=k.x,l.y2.baseVal.value=k.y,g.addElementAndAttributes(l,{x1:l.x1.baseVal.value,y1:l.y1.baseVal.value,x2:l.x2.baseVal.value,
y2:l.y2.baseVal.value}));this.onChange()}};_.setElementListGradient_undable=function(a,b,c){var d,e={},f=a.length;if(0!=f){var g=new SetAttributes_action(this);var k=new SetAttributes_action(this);this.history.addUndoRedoActions(g,k);g.addElements(a,b);for(var l=0;l<f;l++)g=a[l],(d=g.getGradient(b))?d.copyPointsTo(c):c.setPointsFromBBox(g.getLocalBBox()),d=this.addElementToDefs(c.cloneNode(!0)),g.setAttribute(b,d),e[b]=d,k.addElementAndAttributes(g,e);this.onChange();return d}};
_.setElementListPattern_undable=function(a,b,c){var d={},e=a.length;if(0!=e){var f=new SetAttributes_action(this);var g=new SetAttributes_action(this);this.history.addUndoRedoActions(f,g);f.addElements(a,b);for(var k=0;k<e;k++){f=a[k];var l=this.addElementToDefs(c.cloneNode(!0));f.setAttribute(b,l);d[b]=l;g.addElementAndAttributes(f,d)}this.onChange();return l}};
_.applyDefaultDrawingProperties=function(a){"none"==this.defaultDrawingProperties.stroke&&"none"==this.defaultDrawingProperties.fill&&(a instanceof SVGTextElement?this.defaultDrawingProperties.fill="#000000":this.defaultDrawingProperties.stroke="#000000");this.copyPropertiesTo(a,this.defaultDrawingProperties)};
_.copyPropertiesTo=function(a,b){var c;b.fill&&(-1!=b.fill.indexOf("url")&&(c=this.getElementFromDefs(b.fill))&&(c=c.cloneNode(!0),b.fill=this.addElementToDefs(c),c instanceof SVGGradientElement&&c.setPointsFromBBox(a.getLocalBBox())),a.setAttribute("fill",b.fill));b.stroke&&(-1!=b.stroke.indexOf("url")&&(c=this.getElementFromDefs(b.stroke))&&(c=c.cloneNode(!0),b.stroke=this.addElementToDefs(c),c instanceof SVGGradientElement&&c.setPointsFromBBox(a.getLocalBBox())),a.setAttribute("stroke",b.stroke),
b["stroke-width"]&&a.setAttribute("stroke-width",b["stroke-width"]),b["stroke-dasharray"]&&a.setAttribute("stroke-dasharray",b["stroke-dasharray"]),b["stroke-linecap"]&&a.setAttribute("stroke-linecap",b["stroke-linecap"]),b["stroke-linejoin"]&&a.setAttribute("stroke-linejoin",b["stroke-linejoin"]));b.opacity&&a.setAttribute("opacity",b.opacity)};
_.pan=function(a,b){var c=this.content.getTransform().matrix;c.e+=a;c.f+=b;this.workspace.getTransform().setMatrix(c);this.editorRef.rulersAndGridManager.update(c.e,c.f,c.getScale().x)};
_.zoom=function(a,b,c){var d=this.content.getTransform().matrix,e=d.getScale().x*a;250<e||.01>e||(b||(b=this.parentElement.getSize(),b.x/=2,b.y/=2,c=this.screenPointToGlobal(b),b=c.x,c=c.y),d.a*=a,d.b*=a,d.c*=a,d.d*=a,d.e*=a,d.f*=a,d.e+=(1-a)*b,d.f+=(1-a)*c,this.workspace.getTransform().setMatrix(d),this.editorRef.rulersAndGridManager.update(d.e,d.f,e))};
_.screenPointToGlobal=function(a){return{x:a.x-this.appRef.DOCUMENTS.offsetLeft+this.appRef.DOCUMENTS.scrollLeft,y:a.y-this.appRef.DOCUMENTS.offsetTop+this.appRef.DOCUMENTS.scrollTop}};_.globalPointToScreen=function(a){return{x:a.x+this.appRef.DOCUMENTS.offsetLeft-this.appRef.DOCUMENTS.scrollLeft,y:a.y+this.appRef.DOCUMENTS.offsetTop-this.appRef.DOCUMENTS.scrollTop}};
_.screenPointToPenInfo=function(a,b){var c=this.content.globalToLocal(a.x-this.appRef.DOCUMENTS.offsetLeft,a.y-this.appRef.DOCUMENTS.offsetTop);this.penInfo={snapClassName:null,pointInContent:c,pointInContentSnapped:c,screenPosition:a,screenPositionSnapped:a,element:null};this.penInfo.element=this.elementAtScreenPoint(this.penInfo.screenPosition.x,this.penInfo.screenPosition.y);if(1!=b&&(this.snapToGrid&&this.applySnapTo_Grid(),this.snapToXY&&this.pointToSnap_projections(),this.penInfo.element&&(this.snapToVertices||
this.snapToContour)&&(c=this.penInfo.element,this.penInfo.element instanceof SVGPathElement||(c=this.penInfo.element.toSVGPathElement()),c))){var d=this.penInfo.element.getScreenCTM().inverse().getScale().x*this.pointSnapValue,e=this.penInfo.element.screenToLocal(this.penInfo.screenPosition.x,this.penInfo.screenPosition.y);this.snapToContour&&this.applySnapTo_contour(c,e,d);this.snapToVertices&&this.applySnapTo_vertices(c,e,d)}this.showPenLocation();return this.penInfo};
_.screenPointToContent=function(a){return this.content.globalToLocal(a.x-this.appRef.DOCUMENTS.offsetLeft,a.y-this.appRef.DOCUMENTS.offsetTop)};_.pointToSnap_angle45=function(a,b){var c={x:a.x-b.x,y:a.y-b.y},d=Math.PI/180*45,e=Math.atan2(c.y,c.x);console.log("angle",e);0<e&&e<Math.PI/2?e=d:e>d&&e<Math.PI&&(e=Math.PI-d);0>e&&e>-Math.PI/2?e=-d:e<-Math.PI/2&&(e=-Math.PI+d);c=SVGElement.svgUtils.createSVGPointPolar(Math.sqrt(c.x*c.x+c.y*c.y),e);c.x=b.x+c.x;c.y=b.y+c.y;return c};
_.pointToSnap_angle=function(a,b,c){var d={x:a.x-b.x,y:a.y-b.y},e=Math.sqrt(d.x*d.x+d.y*d.y);c=c||Math.PI/180*this.snapAngle;d=SVGElement.svgUtils.createSVGPointPolar(e,Math.round(Math.atan2(d.y,d.x)/c)*c);d.x=b.x+d.x;d.y=b.y+d.y;0==d.x&&(d.x=a.x);0==d.y&&(d.y=a.y);return d};
_.applySnapTo_Grid=function(){this.penInfo.pointInContentSnapped=SVGElement.svgUtils.createSVGPoint(this.origin.x+this.gridSnapValue*Math.round((this.penInfo.pointInContent.x-this.origin.x)/this.gridSnapValue),this.origin.y+this.gridSnapValue*Math.round((this.penInfo.pointInContent.y-this.origin.y)/this.gridSnapValue));this.penInfo.screenPositionSnapped=this.content.localToScreen(this.penInfo.pointInContentSnapped.x,this.penInfo.pointInContentSnapped.y)};
_.applySnapTo_vertices=function(a,b,c){for(var d,e=a.pathSegList.numberOfItems,f=0;f<e;f++)if(d=a.pathSegList.getItem(f),"Z"!=d.type&&Math.abs(a.distanceFromPoints(d,b))<c)return this.penInfo.pointInElementSnapped={x:d.x,y:d.y},this.penInfo.idSegment=f,this.penInfo.screenPositionSnapped=this.penInfo.element.localToScreen(this.penInfo.pointInElementSnapped.x,this.penInfo.pointInElementSnapped.y),this.penInfo.pointInContentSnapped=this.content.screenToLocal(this.penInfo.screenPositionSnapped.x,this.penInfo.screenPositionSnapped.y),
this.penInfo.snapClassName="vertices",this.penInfo.projectedPointX=this.penInfo.projectedPointY=null,!0;return!1};
_.applySnapTo_contour=function(a,b,c){a=a.closestPoint(b);a.distance<c&&(this.penInfo.pointInElementSnapped={x:a.x,y:a.y},this.penInfo.screenPositionSnapped=this.penInfo.element.localToScreen(this.penInfo.pointInElementSnapped.x,this.penInfo.pointInElementSnapped.y),this.penInfo.pointInContentSnapped=this.content.screenToLocal(this.penInfo.screenPositionSnapped.x,this.penInfo.screenPositionSnapped.y),this.penInfo.snapClassName="contour",this.penInfo.projectedPointX=this.penInfo.projectedPointY=null)};
_.pointToSnap_projections=function(){var a=this.createSVGRect();a.left=0;a.top=0;a.width=this.clientWidth;a.height=this.clientHeight;a=this.getIntersectionList(a,null);for(var b,c,d=this.pointSnapValue,e=this.pointSnapValue,f=0;f<a.length;f++)b=a[f],b=b.getBoundingClientRect(),c=Math.abs(this.penInfo.screenPositionSnapped.x-b.left),c<d&&(this.penInfo.screenPositionSnapped.x=b.left,this.penInfo.projectedPointX={x:b.left,y:b.top},d=c),c=Math.abs(this.penInfo.screenPositionSnapped.x-(b.left+b.width)),
c<d&&(this.penInfo.screenPositionSnapped.x=b.left+b.width,this.penInfo.projectedPointX={x:b.left+b.width,y:b.top},d=c),c=Math.abs(this.penInfo.screenPositionSnapped.y-b.top),c<e&&(this.penInfo.screenPositionSnapped.y=b.top,this.penInfo.projectedPointY={x:b.left,y:b.top},e=c),c=Math.abs(this.penInfo.screenPositionSnapped.y-(b.top+b.height)),c<e&&(this.penInfo.screenPositionSnapped.y=b.top+b.height,this.penInfo.projectedPointY={x:b.left,y:b.top+b.height},e=c);this.penInfo.pointInContentSnapped=this.content.screenToLocal(this.penInfo.screenPositionSnapped.x,
this.penInfo.screenPositionSnapped.y)};_.valueToUnit=function(a){return(a*this.unitValue*this.drawingScale).toFixed(this.fixedDecimals)};_.unitToValue=function(a){return a/this.unitValue/this.drawingScale};_.valueToFixed=function(a){return a.toFixed(this.fixedDecimals)};_.evalMathExpression=function(a){a=parseFloat(a);isNaN(a)&&(a=1);return a};
_.fitPageToView=function(a,b){a=a||20;b=b||20;var c=parseFloat(this.parentElement.parentElement.offsetWidth),d=parseFloat(this.parentElement.parentElement.offsetHeight),e=this.content.getTransform().matrix.identity(),f=this.querySelector("#jvs-workspace .jvs-page"),g=f.getAttribute("width");f=f.getAttribute("height");var k=Math.min((c-a)/g,(d-b)/f);e=e.translate(c/2-g*k/2,d/2-f*k/2);e=e.scale(k);this.content.getTransform().setMatrix(e);this.workspace.getTransform().setMatrix(e);this.editorRef.rulersAndGridManager.update(e.e,
e.f,k);this.editorRef.activeDocument.createInteractionFromSelection()};
_.toImage=function(a,b,c){var d=this.content.getTransform().matrix.clone(),e=this.workspace.getTransform().matrix.clone();this.content.getTransform().matrix.identity();this.workspace.getTransform().matrix.identity();this.workspace.style.display="none";var f=(new XMLSerializer).serializeToString(this);this.workspace.style.display="inline";this.content.getTransform().setMatrix(d);this.workspace.getTransform().setMatrix(e);var g=document.createElement("canvas");d=this.querySelector("#jvs-workspace .jvs-page");
g.width=Math.floor(d.getAttribute("width"));g.height=Math.floor(d.getAttribute("height"));var k=g.getContext("2d"),l=window.URL,h=new Image;f=new Blob([f],{type:"image/svg+xml;charset=utf-8"});var m=l.createObjectURL(f);h.onload=function(){"image/jpeg"==a&&(k.fillStyle="#ffffff",k.fillRect(0,0,g.width,g.height));k.drawImage(h,0,0);c?g.toBlob(function(a){b(a)},a):b(g.toDataURL(a));l.revokeObjectURL(m)};h.src=m};_.onDragOver=function(a){a.preventPropagation()};
_.onDropOver=function(a){console.log("onDropOver",a);GMOUSE.onMouseUp(a);if(null!=GetTransferData())this.onDropTransferData(a);else{var b=a.dataTransfer.getData("url");if(b)this.activeLayer.appendChild(this.createSVGImage(b,0,0));else if("text/html,text/uri-list,url"!=a.dataTransfer.types&&"text,text/plain"!=a.dataTransfer.types&&0<a.dataTransfer.files.length)this.onDropFiles(a)}a.preventPropagation()};
_.onDropChromeFileSystemItem=function(a){var b=a.data.fullPath;a=PathInfo(b).fileExtension;var c=this;"svg"==a||"htm"==a||"html"==a?this.appRef.CHROME_FILE_SYSTEM_PANEL.getFileContentAsTextFromChromeFileSystem(b,function(a){(new SvgUnserializer(c.appRef)).unserialize(a.data,c,{parsePageSettings:!1})}):("jpg"==a||"jpeg"==a||"png"==a||"gif"==a)&&this.appRef.CHROME_FILE_SYSTEM_PANEL.getFileContentAsDataURLFromChromeFileSystem(b,function(a){console.log("onFileComplete",a);a=c.createSVGImage(a.data,0,
0);a.setAttribute("jvs-fullPath",b);c.activeLayer.appendChild(a)})};_.onDropTransferData=function(a){a=GetTransferData();console.log("onDropOver",a);a.data&&a.data.fullPath&&this.appRef.importRemoteFile(a.data,this);SetTransferData(null)};
_.onDropFiles=function(a){a=a.dataTransfer.files;if(0<a.length)for(var b=0,c;c=a[b];b++){var d=c.name.split(".");d=d[d.length-1].toLowerCase();if("svg"==d||"htm"==d||"html"==d)this.onDropFile_SVG(c);else if("jpg"==d||"jpeg"==d||"png"==d||"gif"==d)this.onDropFile_IMG(c);else if("dxf"==d)this.onDropFile_DXF(c);else this.appRef.ALERT_DIALOG.open("Unsupported file type","You can drop only svg,jpg,png file types.")}};
_.onDropFile_DXF=function(a){var b=this,c=new FileReader;c.onloadend=function(a){(new DXF2D_Parser(this)).parseModel(a.target.result,b,50)};c.readAsText(a)};_.onDropFile_SVG=function(a){var b=this,c=new FileReader;c.onloadend=function(a){(new SvgUnserializer(b.appRef)).unserialize(a.target.result,b,{parsePageSettings:!1})};c.readAsText(a);this.ch};
_.onDropFile_IMG=function(a){if(a&&window.File&&window.FileReader&&window.FileList&&window.Blob){var b=this,c=new FileReader;c.onloadend=function(a){var c=b.createSVGImage(a.target.result,0,0,null,null,function(a){PROGRESS_PANEL.endVirtualProgress();b.centerElementListInDocumentView([c])});c.dataset.mantainAspectRatio=!0;b.activeLayer.appendChild(c)};c.readAsDataURL(a)}};function Layer2D(a){this.documentRef=a.document}_=Layer2D.prototype;_.onAdded=function(){console.log("layer onAdded")};
_.onRemoved=function(){console.log("layer onRemoved")};Extends(Layer2D_groupEditing,Layer2D);function Layer2D_groupEditing(a){Layer2D_groupEditing.superConstructor.call(this,a);this.editableElementRef=null}_=Layer2D_groupEditing.prototype;_.onAdded=function(){console.log("Layer2D_groupEditing onAdded",this);this.editableElementRef&&this.editableElementRef.classList.add("hidden")};
_.onRemoved=function(){console.log("Layer2D_groupEditing onRemoved this.editableElementRef",this.editableElementRef);this.editableElementRef&&this.editableElementRef.classList.remove("hidden");console.log("Layer2D_groupEditing onRemoved")};
_.enterToEditing=function(a){this.editableElementRef=a;for(var b=this.editableElementRef.children.length,c=0;c<b;c++)if(a=this.editableElementRef.children[c],a.getScreenCTM){var d=a.getTransformToElement(this);a=a.cloneNode(!0);this.appendChild(a);a.getTransform().setMatrix(d)}else a=a.cloneNode(!0),this.appendChild(a);this.onAdded()};
_.exitFromEditing=function(){this.editableElementRef.classList.remove("hidden");if(0==this.children.length)return null;for(var a=this.editableElementRef.cloneNode(),b,c,d=this.children.length,e=0;e<d;e++)b=this.children[e],b.getScreenCTM?(c=b.getTransformToElement(this.editableElementRef),b=b.cloneNode(!0),b.getTransform().setMatrix(c)):b=b.cloneNode(!0),a.appendChild(b);this.editableElementRef.parentElement.replaceChild(a,this.editableElementRef);return a};Extends(Layer2D_clipEditing,Layer2D);
function Layer2D_clipEditing(a){Layer2D_clipEditing.superConstructor.call(this,a);this.editableElementRef=null}_=Layer2D_clipEditing.prototype;_.onAdded=function(){this.editableElementRef&&this.editableElementRef.classList.add("hidden");console.log("Layer2D_clipEditing onAdded")};_.onRemoved=function(){this.editableElementRef&&this.editableElementRef.classList.remove("hidden");console.log("Layer2D_clipEditing onRemoved")};
_.getClipPath=function(a){var b=a.getAttribute("clip-path");a=this.documentRef.extractIdFromUrl(b);(b=this.documentRef.getElementFromDefs(b))||(b=this.documentRef.querySelector('[id="'+a+'"]'));return b};
_.enterToEditing=function(a){this.editableElementRef=a;a=null;var b,c=this.editableElementRef.children.length;for(b=0;b<c;b++){var d=this.editableElementRef.children[b];if("clipPath"==d.nodeName)a=d;else if(d.getScreenCTM){var e=d.getTransformToElement(this);d=d.cloneNode(!0);this.appendChild(d);d.getTransform().setMatrix(e)}else d=d.cloneNode(!0),this.appendChild(d)}if(a)for(c=a.children.length,b=0;b<c;b++)d=a.children[b],d.getScreenCTM?(e=d.getTransformToElement(this),d=d.cloneNode(!0),this.appendChild(d),
d.getTransform().setMatrix(e),d.setAttribute("stroke","none"),d.setAttribute("fill","rgba(255,0,0,.3)")):(d=d.cloneNode(!0),this.appendChild(d));this.onAdded()};_.exitFromEditing=function(){var a=this.documentRef.createClippedContent(this.children);this.editableElementRef.parentElement.replaceChild(a,this.editableElementRef);return a};Extends(Layer2D_maskEditing,Layer2D);function Layer2D_maskEditing(a){Layer2D_maskEditing.superConstructor.call(this,a);this.editableElementRef=null}_=Layer2D_maskEditing.prototype;
_.onAdded=function(){this.editableElementRef&&this.editableElementRef.classList.add("hidden");console.log("Layer2D_maskEditing onAdded")};_.onRemoved=function(){this.editableElementRef&&this.editableElementRef.classList.remove("hidden");console.log("Layer2D_maskEditing onRemoved")};
_.enterToEditing=function(a){this.editableElementRef=a;a=null;var b,c=this.editableElementRef.children.length;for(b=0;b<c;b++){var d=this.editableElementRef.children[b];if("mask"==d.nodeName)a=d;else if(d.getScreenCTM){var e=d.getTransformToElement(this);d=d.cloneNode(!0);this.appendChild(d);d.getTransform().setMatrix(e)}else d=d.cloneNode(!0),this.appendChild(d)}if(a)for(c=a.children.length,b=0;b<c;b++)d=a.children[b],d.getScreenCTM?(e=d.getTransformToElement(this),d=d.cloneNode(!0),this.appendChild(d),
d.getTransform().setMatrix(e)):(d=d.cloneNode(!0),this.appendChild(d));this.onAdded()};_.exitFromEditing=function(){var a=this.documentRef.createMaskedContent(this.children);this.editableElementRef.parentElement.replaceChild(a,this.editableElementRef);return a};function Text_box(a){}_=Text_box.prototype;_.getTextData=function(){this.__textData||this.setTextData(this.parseInnerText());return this.__textData};_.setTextData=function(a){this.__textData=a};
_.getLocalBBox=function(){var a={};this.hasAttribute("width")&&this.hasAttribute("height")?(a.x=0,a.y=0,a.width=parseFloat(this.getAttribute("width")),a.height=parseFloat(this.getAttribute("height"))):(a=this.getBBox(),this.setAttribute("width",a.width),this.setAttribute("height",a.height));a.center={x:a.x+a.width/2,y:a.y+a.height/2};a.min={x:a.x,y:a.y};a.max={x:a.x+a.width,y:a.y+a.height};return a};
_.normalizeScale=function(a){var b=this.globalMatrixToLocalMatrix(this.normalizationData.previousGlobalMatrix),c=b.getScale(),d=Math.sqrt(Math.abs(c.x)*Math.abs(c.y));this.scaleAttributeNumber("x",c.x);this.scaleAttributeNumber("y",c.y);this.scaleAttributeNumber("width",c.x);this.scaleAttributeNumber("height",c.y);a.scaleText&&(this.scaleAttributeNumber("stroke-width",d),this.scaleAttributeNumber("font-size",d),this.scaleAttributeNumber("letter-spacing",d),this.scaleAttributeNumber("word-spacing",
d));a=this.ownerSVGElement.createSVGMatrix().scaleNonUniform(c.x,c.y).inverse();this.getTransform().setMatrix(b.multiply(a));this.redrawText();(b=this.getGradient("fill"))&&this.normalizeGradientScale(b);(b=this.getGradient("stroke"))&&this.normalizeGradientScale(b)};
_.intersectGlobalRect=SVGRectElement.prototype.intersectGlobalRect=function(a){if(this.isContainedInGlobalRect(a))return!0;a=this.globalRectToLocalPolygon(a);var b=this.getBBox();var c=b.x;var d=b.y;var e=b.x+b.width;b=b.y+b.height;var f;return(f=SVGElement.svgUtils.getPolygonLineIntersection(a,{x:c,y:d},{x:e,y:d},!0))||(f=SVGElement.svgUtils.getPolygonLineIntersection(a,{x:e,y:d},{x:e,y:b},!0))||(f=SVGElement.svgUtils.getPolygonLineIntersection(a,{x:e,y:b},{x:c,y:b},!0))?!0:(f=SVGElement.svgUtils.getPolygonLineIntersection(a,
{x:c,y:b},{x:c,y:d},!0))?!0:!1};
_.parseInnerText=function(){function a(a){switch(a.localName){case "tspan":if(a.firstChild){var b=a.firstChild.nodeValue;a.hasAttribute("y")?(a=parseInt(a.getAttribute("y")),null!=d&&(a>d?b="\n"+b:""!=c&&(b=" "+b)),d=a):""!=c&&(b=" "+b);c+=b}else c+="\n"}}function b(a){switch(a.localName){case "tspan":if(a.firstChild){a:{var b=a.childNodes.length;for(var d=0;d<b;d++)if(console.log("_node.childNodes[i].nodeType",a.childNodes[d].nodeType),4==a.childNodes[d].nodeType){b=a.childNodes[d].nodeValue;break a}b=
""}console.log("parseChildrenWithNewLine textInNode",b);""!=c&&(b=a.hasAttribute("newline")?"\n"+b:" "+b);c+=b}}}var c="",d=null,e,f=this.childNodes.length;if(this.querySelector("[newline]"))for(e=0;e<f;e++)b(this.childNodes[e]);else for(e=0;e<f;e++)a(this.childNodes[e]);return c};
_.toHTML=function(){var a=document.createElement("div");a.svgTextElementRef=this;var b=this.getBBox(),c=this.getScreenCTM().toHTML(),d=this.getAttribute("font-size")||12,e=this.getAttribute("font-style")||"",f=this.getAttribute("font-weight")||"",g=this.getAttribute("font-family")||"arial",k=this.getAttribute("text-align")||"left",l="normal";this.hasAttribute("line-height")&&"normal"!=this.getAttribute("line-height")&&(l=parseFloat(this.getAttribute("line-height"))+"px;");var h=parseFloat(this.getAttribute("width"));
parseFloat(this.getAttribute("height"));h=" width:"+h+"px; max-width:"+h+"px;";""!=l&&(h+=" line-height:"+l);h+=" -ms-transform:"+c+" translateY("+b.y+"px); -ms-transform-origin: top left;";h+=" -webkit-transform:"+c+" translateY("+b.y+"px); -webkit-transform-origin: top left;";h+=" transform:"+c+" translateY("+b.y+"px); transform-origin: top left;";h=h+(" font-size:"+d+"px; ")+(" font-style:"+e+";")+(" font-weight:"+f+";");h+=" font-family:"+g+";";h+=" text-align:"+k+";";h+=" color:#2f2f2f;";h+=
" background-color:rgba(255, 255, 255, 0.5);";h+=" letter-spacing:"+this.letterSpacing+"px;";h+=" word-spacing:"+this.wordSpacing+"px;";h+=" -moz-user-select: text; -webkit-user-select: text; -ms-user-select: text; user-select: text;";a.setAttribute("style",h);console.log("toHTML",this.getTextData());a.innerHTML=this.getTextData().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").split(/(?:\r\n|\r|\n)/).join("<br/>");return a};
_.addTSpan=function(a,b,c){var d=document.createElementNS(SVGElement.SVG_NS,"tspan");d.setAttributeNS(null,"x",a);d.setAttributeNS(null,"y",b);a=(new DOMParser).parseFromString("<xml></xml>","application/xml").createCDATASection(c);d.appendChild(a);this.appendChild(d);return d};
_.redrawText=function(){console.log("---------------redrawText-------------------");this.autoHeight=!0;var a=this.getTextData();this.removeChildren();var b=parseFloat(this.getAttribute("width"));parseFloat(this.getAttribute("height"));var c=this.getAttribute("font-size")||12,d=this.getAttribute("text-align")||"left",e=0,f=1;"center"==d?(e=b/2,this.setAttribute("text-anchor","middle")):"right"==d?(e=b,this.setAttribute("text-anchor","end")):"justify"==d?(this.setAttribute("text-anchor","start"),this.setAttribute("letter-spacing",
"0")):this.setAttribute("text-anchor","start");var g=this.addTSpan(e,0,"Jj");var k=this.hasAttribute("line-height")&&"normal"!=this.getAttribute("line-height")?parseFloat(this.getAttribute("line-height")):g.getBBox().height;c=k-parseInt(c);var l=a.split(/(?:\r\n|\r|\n)/),h,m;var n=l.length;console.log("maxFixedLines:",n);this.removeChild(g);for(h=0;h<n;h++){g=this.addTSpan(e,k*f-c,"");g.setAttribute("newline","");a=l[h].split(" ");var p=a.length;for(m=0;m<p;m++){var q=g.addWord(a[m],b);0==q&&(f++,
g=this.addTSpan(e,k*f-c,a[m]))}f++}e=this.getBBox();e.width>b&&(console.log("il box \u00e8 pi\u00f9 grande:",e.width),this.setAttribute("width",e.width));this.autoHeight&&this.setAttribute("height",e.height);if("justify"==d)for(e=this.querySelectorAll("tspan"),f=parseFloat(this.getAttribute("width")),g=0;g<e.length-1;g++)b=e[g],d=b.getComputedTextLength(),k=b.firstChild.nodeValue.split(" ").length,1<k&&b.setAttribute("word-spacing",(f-d)/(k-1))};function Text_path(a){}_=Text_path.prototype;
_.normalizeScale=function(a){var b=this.globalMatrixToLocalMatrix(this.normalizationData.previousGlobalMatrix),c=b.getScale(),d=Math.sqrt(Math.abs(c.x)*Math.abs(c.y));this.scaleAttributeNumber("stroke-width",d);this.scaleAttributeNumber("font-size",d);this.scaleAttributeNumber("letter-spacing",d);this.scaleAttributeNumber("word-spacing",d);c=this.ownerSVGElement.createSVGMatrix().scaleNonUniform(c.x,c.y).inverse();this.getTransform().setMatrix(b.multiply(c));b=this.childNodes.length;for(c=0;c<b;c++)this.childNodes[c].normalizeScale&&
this.childNodes[c].normalizeScale(a);(a=this.getGradient("fill"))&&this.normalizeGradientScale(a);(a=this.getGradient("stroke"))&&this.normalizeGradientScale(a)};_.redrawText=function(){var a=this.getAttribute("text-align")||"left";"center"==a?this.setAttribute("text-anchor","middle"):"right"==a?this.setAttribute("text-anchor","end"):this.setAttribute("text-anchor","start")};_.toHTML=function(){};_.getTextData=function(){};_.setTextData=function(a){};
_.onClone=function(){console.log("onClone di Text_path");var a=this.querySelector("textPath");if(a){var b=a.getAttributeNS(SVGElement.XLINK_NS,"href");if(this.parentNode&&(b=this.parentNode.querySelector(b))){var c="__"+(new Date).getTime()+"__";b.setAttribute("id",c);a.setAttributeNS(SVGElement.XLINK_NS,"href","#"+c)}}};
function Brush_element(a){this.brushScale=1;this.opacityOut=this.opacityIn=this.scaleOut=this.scaleIn=!1;this.brushSymbolName="brush-001-alpha";this.brushPath=null;this.setAttribute("jvs-brush","");this.brushPath=this.querySelector("path");this.randomOffsetRadious=30;this.orientOnPath=!0;this.randomizeOpacity=this.randomizeOrientation=this.randomizeScale=this.randomizeOffset=!1}_=Brush_element.prototype;_.onAttributeChanged=function(a){if("stroke"==a||"stroke-width"==a)this.onStyleChanged()};
_.applyBrushColor=function(a){var b=this.ownerSVGElement.querySelector("defs #brush-gradient"),c=b.querySelector("#start-color");b=b.querySelector("#end-color");c.setAttribute("stop-color",a);b.setAttribute("stop-color",a)};_.onGeometryChanged=function(){this.renderRequest()};_.onStyleChanged=function(){this.renderRequest()};_.setPathEvents=function(a){console.log("--------- setPathEvents -------------  ");var b=this;a.onGeometryChanged=function(){b.onGeometryChanged()}};_.render=function(){this.update()};
_.update=function(){if(this.ownerSVGElement){var a=this.querySelectorAll("path"),b=this.getAttribute("stroke"),c=parseInt(this.getAttribute("stroke-width"));this.brushScale=.01*c;var d=SVGElement.svgUtils.createGroup(0,0);d.setAttribute("fill",b);b=c/2;30>b&&(b=30);var e=a.length;for(c=0;c<e;c++){this.setPathEvents(a[c]);a[c].style.display="none";var f=this.drawGraphicsWithSymbol(a[c]);d.appendChild(f)}this.appendChild(d);this.createBitmapCache(d,b)}};
_.createBitmapCache=function(a,b){b=b||50;var c=this,d=c.querySelector("image[bitmap-cache]");d&&(d.style.display="none");this.ownerSVGElement.getElementAsBitmap(a,function(b){var d=c.querySelector("image[bitmap-cache]");d&&d.remove();b.setAttribute("no-preview","");b.setAttribute("bitmap-cache","");a.remove();c.insertBefore(b,c.children[0]);b.style.display="inline"},b)};
_.drawGraphicsWithPath=function(a){var b=SVGElement.svgUtils.createGroup(0,0);b.setAttribute("fill","url(#brush-gradient)");b.setAttribute("jvs-brush-graphics","url(#brush-gradient)");b.getTransform().setMatrix(a.getTransform().matrix.clone());a=a.cloneNode();a.getTransform().matrix.identity();b.appendChild(a);return b};
_.drawGraphicsWithSymbol=function(a){var b=a.getTotalLength(),c=0,d=SVGElement.svgUtils.createGroup(0,0);d.getTransform().setMatrix(a.getTransform().matrix.clone());var e=b/2,f=this.brushScale,g=1;var k=b/(b/(100*this.brushScale))/4;console.log("totalLength",b);console.log("step",k);for(console.log("this.brushScale",this.brushScale);c<=b;){var l=a.getPointAndRotationAtLength(c);var h=l.angle;h/=Math.PI/180;var m=l.x;l=l.y;if(this.randomizeOffset){var n=2*Math.random()*Math.PI;var p=Math.random()*
this.randomOffsetRadious;k=Math.cos(n)*p;n=Math.sin(n)*p;m+=k;l+=n}this.randomizeScale?f=.001+Math.random()*this.brushScale:this.scaleIn&&this.scaleOut?f=c<e?this.brushScale*Interpolation.adobe_easeinout(c/e):this.brushScale-this.brushScale*Interpolation.adobe_easeinout((c-e)/e):this.scaleOut?f=this.brushScale*Interpolation.adobe_easeinout(c/e):this.scaleIn&&(f=this.brushScale-this.brushScale*Interpolation.adobe_easeinout((c-e)/e));0>=f&&(f=.001);k=b/(b/(100*f))/8;this.randomizeOpacity?g=.1+.9*Math.random():
this.opacityIn&&this.opacityOut?g=c<e?1/b*c:1-1/b*c:this.opacityOut?g=1/b*c:this.opacityIn&&(g=1-1/b*c);1>k&&(k=1);m=SVGElement.svgUtils.createUse(this.brushSymbolName,Math.round(m),Math.round(l),f,h);m.setAttribute("opacity",g);d.appendChild(m);c+=k}return d};
_.drawBrushWithVectors=function(){for(var a=this.brushPath.getTotalLength(),b=0,c=a/(a/3),d,e,f=[],g=[];b<=a;)d=this.brushPath.getPointAndRotationAtLength(b),e=SVGElement.svgUtils.createSVGPointPolar(10,d.angle+Math.PI/2),f.push({type:"L",values:[d.x+e.x,d.y+e.y]}),g.push({type:"L",values:[d.x-e.x,d.y-e.y]}),b+=c;a=SVGElement.svgUtils.createPath();a.setAttribute("stroke","#0047FF");a.setAttribute("fill","none");a.matrix=SVGElement.svgUtils.createSVGMatrix();f[0].type="M";g=g.reverse();this.brushPath.isClosed()&&
(f.push({type:"Z",values:[]}),g[0].type="M");g.push({type:"Z",values:[]});f=f.concat(g);a.setPathData(f);a.getPathData({normalize:!0});return a};function IFrameInForeignObject(a){this.documentRef=a.document}_=IFrameInForeignObject.prototype;_.onAdded=function(){console.log("IFrameInForeignObject onAdded")};_.onRemoved=function(){console.log("IFrameInForeignObject onRemoved")};
function Editor2D(a){this.appRef=a;this.activeDocument=null;this.GLOBAL_BBOX_SELECTION=0;this.LOCAL_BBOX_SELECTION=1;this.POINTS_SELECTION=2;this.selectionMode=this.GLOBAL_BBOX_SELECTION;SVG_UTILS=this.INTERACTION_SVG=document.querySelector("#STAGE #INTERACTION_2D #SVG");this.INTERACTION_HTML=document.querySelector("#STAGE #INTERACTION_2D #HTML");this.rulersAndGridManager=new RulersAndGrid_manager(this);this.initPanels();this.initMainGraphicTools();this.activateTool("selectGlobal_tool")}_=Editor2D.prototype;
_.initPanels=function(){var a={appRef:this.appRef};this.GRAPHICS_INSPECTOR_2D_PANEL=document.querySelector("#GRAPHICS_INSPECTOR_2D_PANEL").connectController(GraphicsInspector2D_panel,a);this.GRAPHICS_INSPECTOR_2D_PANEL.querySelector("#DOCUMENT_2D_CONTENT_PANEL").connectController(Document2D_contentPanel,a);this.GRAPHICS_INSPECTOR_2D_PANEL.querySelector("#TEXT_2D_CONTENT_PANEL").connectController(Text2D_contentPanel,a);this.GRAPHICS_INSPECTOR_2D_PANEL.querySelector("#TEXT_PATH_2D_CONTENT_PANEL").connectController(TextPath2D_contentPanel,
a);this.GRAPHICS_INSPECTOR_2D_PANEL.querySelector("#HTML_TEXT_2D_CONTENT_PANEL").connectController(HtmlText2D_contentPanel,a);this.GRAPHICS_INSPECTOR_2D_PANEL.querySelector("#LINE_2D_CONTENT_PANEL").connectController(Line2D_contentPanel,a);this.GRAPHICS_INSPECTOR_2D_PANEL.querySelector("#RECT_2D_CONTENT_PANEL").connectController(Rect2D_contentPanel,a);this.GRAPHICS_INSPECTOR_2D_PANEL.querySelector("#ELLIPSE_2D_CONTENT_PANEL").connectController(Ellipse2D_contentPanel,a);this.GRAPHICS_INSPECTOR_2D_PANEL.querySelector("#IMAGE_2D_CONTENT_PANEL").connectController(Image2D_contentPanel,
a);this.GRAPHICS_INSPECTOR_2D_PANEL.querySelector("#PATH_2D_CONTENT_PANEL").connectController(Path2D_contentPanel,a);this.GRAPHICS_INSPECTOR_2D_PANEL.querySelector("#GROUP_2D_CONTENT_PANEL").connectController(Group2D_contentPanel,a);this.GRAPHICS_INSPECTOR_2D_PANEL.querySelector("#CLIP_PATH_2D_CONTENT_PANEL").connectController(ClipPath2D_contentPanel,a);this.GRAPHICS_INSPECTOR_2D_PANEL.querySelector("#MASK_2D_CONTENT_PANEL").connectController(Mask2D_contentPanel,a);this.GRAPHICS_INSPECTOR_2D_PANEL.querySelector("#IFRAME_IN_FOREIGNOBJECT_CONTENT_PANEL").connectController(IFrameInForeignObject_contentPanel,
a);this.FILTER_PANEL=document.querySelector("#FILTER_PANEL").connectController(Filter_panel,a);this.FILTER_PANEL.querySelector("#SHADOW_FILTER_CONTENT_PANEL").connectController(ShadowFilter_contentPanel,a);this.FILTER_PANEL.querySelector("#BLUR_FILTER_CONTENT_PANEL").connectController(BlurFilter_contentPanel,a);this.FILTER_PANEL.querySelector("#BEVEL_FILTER_CONTENT_PANEL").connectController(BevelFilter_contentPanel,a);this.FILTER_PANEL.querySelector("#CONTRAST_BRIGHTNESS_FILTER_CONTENT_PANEL").connectController(ContrastBrightnessFilter_contentPanel,
a);this.FILTER_PANEL.querySelector("#RGB_FILTER_CONTENT_PANEL").connectController(RGBFilter_contentPanel,a);this.FILTER_PANEL.querySelector("#SATURATE_FILTER_CONTENT_PANEL").connectController(SaturateFilter_contentPanel,a);this.FILTER_PANEL.querySelector("#HUE_ROTATE_FILTER_CONTENT_PANEL").connectController(HueRotateFilter_contentPanel,a);this.FILTER_PANEL.querySelector("#BRUSH_FILTER_CONTENT_PANEL").connectController(BrushFilter_contentPanel,a);this.FILTER_PANEL.querySelector("#FANCY_GOO_FILTER_CONTENT_PANEL").connectController(FancyGooFilter_contentPanel,
a);this.FILTER_PANEL.querySelector("#UNKNOWED_FILTER_CONTENT_PANEL").connectController(UnknowedFilter_contentPanel,a);this.MAIN_TOOLS_2D_PANEL=document.querySelector("#MAIN_TOOLS_2D_PANEL").connectController(Tools2D_panel,a);this.GRADIENT_EDITOR_PANEL=document.querySelector("#GRADIENT_EDITOR_PANEL").connectController(GradientEditor2D_panel,a);this.STROKE_PANEL=document.querySelector("#STROKE_PANEL").connectController(Stroke_panel,a);this.MARKERS_PANEL=document.querySelector("#MARKERS_PANEL").connectController(Markers_panel,
a);this.PATTERN_PANEL=document.querySelector("#PATTERN_PANEL").connectController(Pattern_panel,a);this.FILL_AND_STROKE_FILLING_2D_PANEL=document.querySelector("#FILL_AND_STROKE_FILLING_2D_PANEL").connectController(FillAndStrokeFilling2D_panel,a);this.updateGraphicPropertyButton(this.FILL_AND_STROKE_FILLING_2D_PANEL.querySelector('[name="pattern"]'),"url(#default-pattern)");this.ALIGN_2D_PANEL=document.querySelector("#ALIGN_2D_PANEL").connectController(Align2D_panel,a);this.TRANSFORM_2D_PANEL=document.querySelector("#TRANSFORM_2D_PANEL").connectController(Transform2D_panel,
a);this.INTERACTIVITY_2D_PANEL=document.querySelector("#INTERACTIVITY_2D_PANEL").connectController(Interactivity2D_panel,a);this.LAYER_LIST_2D_PANEL=document.querySelector("#LAYER_LIST_2D_PANEL").connectController(LayerList2D_panel,a);this.LIBRARY_2D_PANEL=document.querySelector("#LIBRARY_2D_PANEL").connectController(Library2D_panel,a);this.FONT_LIBRARY_2D_PANEL=document.querySelector("#FONT_LIBRARY_2D_PANEL").connectController(FontLibrary2D_panel,a);this.STROKE_DASH_LIBRARY_2D_PANEL=document.querySelector("#STROKE_DASH_LIBRARY_2D_PANEL").connectController(StrokeDashLibrary2D_panel,
a);this.DOM_PANEL=document.querySelector("#DOM_PANEL").connectController(DOM_panel,a);this.SNAPS_TOOLBAR=document.querySelector("#SNAPS_TOOLBAR").connectController(Snaps_toolbar,a);this.EDIT_SELECTION_TOOLBAR=document.querySelector("#EDIT_SELECTION_TOOLBAR").connectController(EditSelection_toolbar,a)};
_.showSelectionProperties=function(){this.GRAPHICS_INSPECTOR_2D_PANEL.update(this.activeDocument.currentEditableElement);this.FILTER_PANEL.update(this.activeDocument.currentEditableElement);this.STROKE_PANEL.update();this.MARKERS_PANEL.update();this.PATTERN_PANEL.update();this.INTERACTIVITY_2D_PANEL.update();this.TRANSFORM_2D_PANEL.update();this.FILL_AND_STROKE_FILLING_2D_PANEL.update();this.LAYER_LIST_2D_PANEL.update()};
_.initMainGraphicTools=function(){this.tools=[];this.tools.selectGlobal_tool=new Selection_tool(this);this.tools.selectLocal_tool=new Selection_tool(this);this.tools.selectLocal_tool.setSelectionMode(this.POINTS_SELECTION);this.tools.panView_tool=new PanView_tool(this);this.tools.zoomView_tool=new ZoomView_tool(this);this.tools.drawLine_tool=new DrawLine_tool(this);this.tools.drawRectangle_tool=new DrawRectangle_tool(this);this.tools.drawEllipse_tool=new DrawEllipse_tool(this);this.tools.drawTextBox_tool=
new DrawTextBox_tool(this);this.tools.drawPath_tool=new DrawPath_tool(this);this.tools.splitPath_tool=new SplitPath_tool(this);this.tools.addPathSegment_tool=new AddPathSegment_tool(this);this.tools.removePathSegment_tool=new RemovePathSegment_tool(this);this.tools.drawFreehand_tool=new DrawFreehand_tool(this);this.tools.drawBrush_tool=new DrawBrush_tool(this);this.tools.editGradientPoints_tool=new EditGradientPoints_tool(this);this.tools.eyeDropper_tool=new EyeDropper_tool(this);this.tools.drawIFrameInForeignObject_tool=
new DrawIFrameInForeignObject_tool(this)};
_.activateTool=function(a){"string"==typeof a&&(a=this.MAIN_TOOLS_2D_PANEL.querySelector('li[toolName="'+a+'"]'));"A"==a.nodeName&&(a=a.parentElement);var b=a.getAttribute("toolName");if(!this.tools[b])console.log("lo strumento: "+b+" non esiste ");else if(this.tools.activeTool!=this.tools[b]){var c=this.tools.activeTool;if(c)c.onDeactivate();this.tools.activeTool=this.tools[b];this.tools.activeTool.onActivate();this.activeTooButton&&DeselectElements([this.activeTooButton]);this.activeTooButton=a;
SelectElement(this.activeTooButton);this.appRef.STAGE.setAttribute("active-tool",b)}};_.disableInteraction=function(){this.INTERACTION_SVG.classList.add("disabled")};_.enableInteraction=function(){this.INTERACTION_SVG.classList.remove("disabled")};_.hideInteractionHandles=function(){this.INTERACTION_SVG.classList.add("hideHandles")};_.showInteractionHandles=function(){this.INTERACTION_SVG.classList.remove("hideHandles")};
_.updateGraphicPropertyButton=function(a,b){a.style.cssText="";if("none"==b)a.style.backgroundColor="#FFFFFF",a.classList.add("noneColor");else if(a.classList.remove("noneColor"),-1!=b.indexOf("url")){var c=b.split("#")[1].split(")")[0];c=c.split('"')[0];c=document.querySelector('defs [id="'+c+'"]');c.hasAttribute("xlink:href")&&(c=this.appRef.editor2D.activeDocument.querySelector("defs "+c.getAttribute("xlink:href")));c&&(a.style.backgroundColor="#FFFFFF",a.elementDef=c,a.style.cssText=c.toHtml())}else a.style.backgroundColor=
b};function RegisterUser(a,b){var c={action:"createUserAccount",google_user_id:GoogleAuth.currentUser.get().getBasicProfile().getId(),google_user_email:GoogleAuth.currentUser.get().getBasicProfile().getEmail()};console.log("userData",c);var d=SendAndLoad(ACCOUNT_MANAGER_URL,"POST",c,function(c){if(d.response&&(console.log("registerUser response",d.response),"SUCCESS"==d.response.actionResponse)){a(d.response);return}b(d)});d.responseType="json"}
function ValidateUserAccount(a,b){var c=SendAndLoad(ACCOUNT_MANAGER_URL,"POST",{action:"validateUserAccount",google_user_id:GoogleAuth.currentUser.get().getBasicProfile().getId()},function(){c.response&&(console.log("validateUserAccount response",c.response),"YES"==c.response.actionResponse?a():"NO"==c.response.actionResponse?"NONE"==c.response.subscription?RegisterUser(function(c){console.log("onRegisterUserSuccess",c);ValidateUserAccount(a,b)},function(a){console.log("onRegisterUserError",a)}):
"FREE"==c.response.subscription?"EXPIRED"==c.response.accountState&&(console.log("goto bay PREMIUM"),ShowBuyLicenseDialog()):"PREMIUM"==c.response.subscription&&"EXPIRED"==c.response.accountState&&(console.log("goto bay PREMIUM renew"),ShowBuyLicenseDialog()):b())});c.responseType="json"}
function ShowActivationLicenseErrorDialog(){ShowElement(document.querySelector("#MODAL_DIALOGS #ACCOUNT_PLAN_DIALOG"));ShowElement(document.querySelector("#MODAL_DIALOGS #ACCOUNT_PLAN_DIALOG #PLAN_ACTIVATION_ERROR"))}
function ShowActivationLicenseDialog(a){var b=document.querySelector("#MODAL_DIALOGS #ACCOUNT_PLAN_DIALOG"),c=b.querySelector("#PLAN_ACTIVATION_SUCCESS");ShowElement(b);ShowElement(c);c.querySelector(".start-plan-date").innerHTML=a.startPlanTimestamp;c.querySelector(".end-plan-date").innerHTML=a.endPlanTimestamp}
function ShowBuyLicenseResponseDialog(a){function b(){console.log("onCheckTransactionResponse xhr",d);d.response&&(console.log("onCheckTransactionResponse response",d.response),"WAIT"==d.response.actionResponse?24>e?(e++,setTimeout(c,5E3)):ShowActivationLicenseErrorDialog():ShowActivationLicenseDialog(d.response))}function c(){var c={action:"checkTransaction",txn_id:a.transactions[0].related_resources[0].sale.id};console.log("checkTransaction postData",c);d=SendAndLoad(ACCOUNT_MANAGER_URL,"POST",
c,b);d.responseType="json"}ShowElement(document.querySelector("#MODAL_DIALOGS #ACCOUNT_PLAN_DIALOG"));ShowElement(document.querySelector("#MODAL_DIALOGS #ACCOUNT_PLAN_DIALOG #BUY_PLAN_RESPONSE"));var d;console.log("_data",a);console.log("txn_id",a.transactions[0].related_resources[0].sale.id);var e=0;setTimeout(c,5E3)}
function ShowBuyLicenseDialog(){function a(a,b,g){d.arePaypalButtonsAlreadyDrawn=!0;paypal.Button.render({env:PAYPAL_ENVIRONMENT,client:{sandbox:PAYPAL_CLIENT_ID_SANDBOX,production:PAYPAL_CLIENT_ID_PRODUCTION},commit:!0,payment:function(a,d){return d.payment.create({payment:{transactions:[{amount:{total:g,currency:"EUR"},custom:GoogleAuth.currentUser.get().getBasicProfile().getId(),description:b,notify_url:c}]}})},onAuthorize:function(a,b){return b.payment.execute().then(function(a){console.log("payment execute data",
a);ShowBuyLicenseResponseDialog(a)})}},"#"+a)}ShowElement(document.querySelector("#MODAL_DIALOGS #ACCOUNT_PLAN_DIALOG"));ShowElement(document.querySelector("#MODAL_DIALOGS #ACCOUNT_PLAN_DIALOG #BUY_PLAN"));var b=window.location.href.split("/");b.pop();var c=b.join("/")+"/paypal_IPN.php",d=this;whenGoogleUserWillBeAuthorizedCall(function(){d.arePaypalButtonsAlreadyDrawn||(a("paypal-button-container-3-months","Janvas Plan 3 Months","12"),a("paypal-button-container-6-months","Janvas Plan 6 Months","21"),
a("paypal-button-container-12-months","Janvas Plan 12 Months","36"))})}
var SCOPE="https://www.googleapis.com/auth/drive",CLIENT_ID="224665388995-f6b3p5i0et7c7u14vo092kqa27cg57mm.apps.googleusercontent.com",DISCOVERY_URL="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",GOOGLE_SHEET_TO_JSON_SERVICE_URL="https://script.google.com/macros/s/AKfycbxxdZRI5UwhIvJDLTDVuVF5STH4PuehY0F4qu8DBAYzc758F5Q/exec?",GOOGLE_LOCALIZER_SERVICE_URL="https://script.google.com/macros/s/AKfycbzwQ8iuowB_tKgxnt6utfHcZdFFrv9RXzBKQHBCytRPdMbFfJk/exec?",GOOGLE_LOCALIZER_SHEET_ID="17_l_HiEpXMzhOaW2TcmYdirCgw6EKqPizXz3hnAbkRU",
LANGUAGE="EN",ACCOUNT_MANAGER_URL="account.php",PAYPAL_CLIENT_ID_SANDBOX="AVhvuhvVc7rbGkrHIZhyWaqeauY4b8MR4ee8lkUeL00b-Hxm68S1fCfYqJHMaFVP4oKSSiIwFn1OgvG7",PAYPAL_CLIENT_ID_PRODUCTION="AXe3DYj_NEnDJbgFI8okn4_MC2JFn3KMtUGNqxj4jIMxml8Ktu4sN-oYMZuqPAoIDU6Ztrm42oPnF63m",PAYPAL_ENVIRONMENT="production";"chrome"!=BROWSER_TYPE&&alert("Janvas works well only with Chrome Browser!");var DATA={},APPLICATION,CHROME_APPLICATION_BRIDGE=null,GDRIVE_SERVICE=null,LOCALIZER=new Localizer;
function init(){APPLICATION=new Janvas_application}window.addEventListener("load",init,!1);Extends(Janvas_application,Application);function Janvas_application(){Janvas_application.superConstructor.call(this);this.activeEditor=this.editor2D=new Editor2D(this);this.onApplicationStart()}_=Janvas_application.prototype;_.onBrowserResize=function(a){this.activeEditor.rulersAndGridManager.updateRulerSize();this.activeEditor.rulersAndGridManager.update();this.activeEditor.activeDocument.onResize()};
_.onApplicationStart=function(){var a=this;this.initLanguage(function(){var b=GetUrlVars();b.documentKey?a.loadSharedDocument(b.documentKey):a.createDocument();a.initEvents()})};
_.initPanels=function(){this.TABBED_DOCUMENT_TAB_TEMPLATE_NAME="TABBED_DOCUMENT_2D_TAB";this.TABBED_DOCUMENT_VIEW_TEMPLATE_NAME="TABBED_DOCUMENT_2D_VIEW";Janvas_application.superClass.initPanels.call(this);var a={appRef:this};GDRIVE_SERVICE=new GDriveFileSystem_service;this.GDRIVE_FILE_SYSTEM_PANEL=document.querySelector("#GDRIVE_FILE_SYSTEM_PANEL").connectController(GDriveFileSystem_panel,a);this.FILE_SYSTEM_SAVE_PANEL=this.GDRIVE_FILE_SYSTEM_SAVE_PANEL=document.querySelector("#GDRIVE_FILE_SYSTEM_SAVE_PANEL").connectController(GDriveFileSystemSave_panel,
a)};_.onShowTabbedDocumentView=function(a){this.editor2D.activeDocument=this.getDocumentFromTabbedDocumentView(a);this.editor2D.activeDocument.removeAllInteractions();this.editor2D.activeDocument.createInteractionFromSelection();this.editor2D.activeDocument.showSelectionProperties();this.editor2D.SNAPS_TOOLBAR.update()};_.getDocumentFromTabbedDocumentView=function(a){return a.querySelector("svg")};
_.setActiveApplicationContext=function(a){document.querySelector("#APPLICATION").setAttribute("active-app-context",a)};_.onKeyDown=function(a){if(0==this.isValidKeyEvent(a))console.log("onKeyDown: evento bloccato");else{var b=a.keyCode;if(a.metaKey||a.ctrlKey)switch(b){case 83:return this.saveDocument(),a.preventPropagation();case 80:return this.printDocument(),a.preventPropagation()}else switch(b){case 116:return a.preventPropagation()}this.activeEditor.activeDocument.onKeyDown(a)}};
_.onClick_new=function(){this.createDocument()};_.onClick_open=function(){(this.CHROME_FILE_SYSTEM_PANEL?this.CHROME_FILE_SYSTEM_PANEL:this.GDRIVE_FILE_SYSTEM_PANEL).open(!0)};_.onClick_save=function(a){this.saveDocument()};_.onClick_saveAs=function(a){this.saveDocumentAs()};_.onClick_exportPNG=function(a){this.exportDocumentAsImage("png")};_.onClick_exportJPG=function(a){this.exportDocumentAsImage("jpg")};_.onClick_importDXF=function(a){};_.onClick_print=function(){this.printDocument()};
_.onClick_buyLicense=function(){ShowBuyLicenseDialog()};
_.createDocument=function(a,b,c){if(!a){var d=LOCALIZER.translate("Untitled")||"Untitled";a="_new_"+(new Date).getTime()+"/"+d}d=this.DOCUMENTS.createView();var e=d.querySelector("svg");e.connectController(Document2D,{appRef:this,fullPath:a});b?(new SvgUnserializer(this)).unserialize(b,e,c):(b=e.createLayer(),e.addLayer(b));this.DOCUMENTS.showView(d);this.DOCUMENTS.updateViewTab(d);e.fitPageToView();e.showSelectionProperties();this.onBrowserResize();return e};
_.printDocument=function(){var a=this.activeEditor.activeDocument,b=a.content.getTransform().matrix.clone(),c=a.workspace.getTransform().matrix.clone();a.content.getTransform().matrix.identity();a.workspace.getTransform().matrix.identity();var d=a.querySelector("#jvs-workspace .jvs-page"),e=Math.floor(d.getAttribute("width"))||595;d=Math.floor(d.getAttribute("height"))||842;a.setAttribute("width",e);a.setAttribute("height",d);a.setAttribute("viewBox","0 0 "+e+" "+d);window.print();a.setAttribute("width",
"100%");a.setAttribute("height","100%");a.removeAttribute("viewBox");a.content.getTransform().setMatrix(b);a.workspace.getTransform().setMatrix(c)};_.onSaveDocument=function(a){a.isChanged=!1;this.DOCUMENTS.updateViewTab(a.parentNode)};
_.saveDocument=function(){var a=this,b=this.activeEditor.activeDocument;if(b.isNewDocument())this.saveDocumentAs();else{var c=(new SvgSerializer(this)).serialize(b);this.FILE_SYSTEM_SAVE_PANEL.service.updateFileContent(b.idFile,"image/svg+xml",c,function(){a.onSaveDocument(b)},function(){a.PROGRESS_PANEL.close();a.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The document was not saved, try again."))},function(b){a.PROGRESS_PANEL.onLoadingProgress(b)},!0);this.PROGRESS_PANEL.open(!0)}};
_.saveDocumentAs=function(){function a(){k.PROGRESS_PANEL.close();k.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The document was not saved, try again."))}function b(){f.fullPath=l.getTargetFileFullPath();k.onSaveDocument(f)}function c(a){k.PROGRESS_PANEL.onLoadingProgress(a)}function d(d){console.log("writeDocument",d);var e=(new SvgSerializer(k)).serialize(f);d?(f.idFile=d,l.service.updateFileContent(d,"image/svg+xml",e,b,a,c,!0)):l.service.createFile(l.currentDirData.id,
"image/svg+xml",l.fileNameInputField.value,function(d){console.log("onFileCreateSuccess",d);d.result&&d.result.id&&(f.idFile=d.result.id,l.service.updateFileContent(d.result.id,"image/svg+xml",e,b,a,c))},function(){k.PROGRESS_PANEL.close();k.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The document was not saved, try again."))},!0)}function e(a){0<a.result.files.length?a.result.files[0].isDirectory?(k.PROGRESS_PANEL.close(),k.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("A folder named:")+
" "+l.fileNameInputField.value+" "+LOCALIZER.translate("can't be replaced by a document!"))):k.CONFIRM_DIALOG.open(LOCALIZER.translate("File exists"),LOCALIZER.translate("The folder")+' "'+l.currentDirData.name+'" '+LOCALIZER.translate("already contains a file named")+' "'+l.fileNameInputField.value+'".\n'+LOCALIZER.translate("Do you want to replace it?"),function(){d(a.result.files[0].id)}):d()}var f=this.activeEditor.activeDocument,g="root";f.isNewDocument()||(g=PathInfo(f.fullPath).dir);var k=
this,l=this.FILE_SYSTEM_SAVE_PANEL;l.open(g,f.getTitle(),["svg","html","php"],function(){l.service.getFileInFolder(l.fileNameInputField.value,l.currentDirData.id,e);l.close();k.PROGRESS_PANEL.open(!0)})};
_.exportDocumentAsImage=function(a){function b(){h.PROGRESS_PANEL.close();h.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The document was not saved, try again."))}function c(){}function d(a){h.PROGRESS_PANEL.onLoadingProgress(a)}function e(a){console.log("writeDocument",a);g.toImage(k,function(e){a?m.service.updateFileContent(a,k,e,c,b,d,!0):m.service.createFile(m.currentDirData.id,k,m.fileNameInputField.value,function(a){console.log("onFileCreateSuccess",a);a.result&&a.result.id&&
m.service.updateFileContent(a.result.id,k,e,c,b,d)},function(){h.PROGRESS_PANEL.close();h.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("The document was not saved, try again."))},!0)},!0)}function f(a){0<a.result.files.length?a.result.files[0].isDirectory?(h.PROGRESS_PANEL.close(),h.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("A folder named:")+" "+m.fileNameInputField.value+" "+LOCALIZER.translate("can't be replaced by a document!"))):h.CONFIRM_DIALOG.open(LOCALIZER.translate("File exists"),
LOCALIZER.translate("The folder")+' "'+m.currentDirData.name+'" '+LOCALIZER.translate("already contains a file named")+' "'+m.fileNameInputField.value+'".\n'+LOCALIZER.translate("Do you want to replace it?"),function(){e(a.result.files[0].id)}):e()}var g=this.activeEditor.activeDocument;a=a||"svg";var k;"svg"==a?k="image/svg+xml":"png"==a?k="image/png":"jpg"==a?k="image/jpeg":"jpeg"==a&&(k="image/jpeg");var l="root";g.isNewDocument()||(l=PathInfo(g.fullPath).dir);var h=this,m=this.FILE_SYSTEM_SAVE_PANEL;
m.open(l,g.getTitle().split(".")[0]+"."+a,["png","jpg","jpeg"],function(){m.service.getFileInFolder(m.fileNameInputField.value,m.currentDirData.id,f);m.close();h.PROGRESS_PANEL.open(!0)})};
_.importRemoteFile=function(a,b){function c(a){g.setProgressValues(a.total,a.loaded)}function d(b){f.ALERT_DIALOG.open(LOCALIZER.translate("Error"),LOCALIZER.translate("An error occured during loading file:")+" "+a.name)}b=b||this.activeEditor.activeDocument;var e=PathInfo(a.fullPath).fileExtension.toLowerCase(),f=this,g=this.PROGRESS_PANEL;g.open(!0);g.setProgressBarValue(1);if("svg"==e)GDRIVE_SERVICE.getFileContent(a,function(a){console.log("onGetFileContent",a);(new SvgUnserializer(f)).unserialize(a.target.responseText,
b,{parsePageSettings:!1});g.close()},d,c);else if("jpg"==e||"jpeg"==e||"png"==e||"gif"==e){var k=b.createSVGImage(a.webContentLink,0,0,null,null,function(a){g.endVirtualProgress();b.centerElementListInDocumentView([k])});k.setAttribute("jvs-fullPath",a.fullPath);k.dataset.mantainAspectRatio=!0;b.activeLayer.appendChild(k);g.open(!0);g.startVirtualProgress(a.size)}};

SVGPathElement.prototype.getPathSegAtLength = function(distance) {
    if (distance === undefined || !isFinite(distance))
        throw "Invalid arguments.";

    var measurementElement = document.createElementNS("http://www.w3.org/2000/svg", "path");
    measurementElement.setAttribute("d", this.getAttribute("d"));
    var lastPathSegment = measurementElement.pathSegList.numberOfItems - 1;

    // If the path is empty, return 0.
    if (lastPathSegment <= 0)
        return 0;
    console.log('measurementElement.getTotalLength()' , measurementElement.getTotalLength() );
    do {
        measurementElement.pathSegList.removeItem(lastPathSegment);
        measurementElement.drawPathData();
        if (distance > measurementElement.getTotalLength())
            break;
        lastPathSegment--;
    } while (lastPathSegment > 0);
    return lastPathSegment;
};